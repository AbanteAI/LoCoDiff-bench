Here's a summary of the key changes made to the `StructPayloadIndex` struct and its implementation:

1. Added `StorageType` enum to represent different storage backends (Appendable RocksDB, Non-Appendable RocksDB, Non-Appendable mmap).

2. Replaced `db` and `is_appendable` fields with `storage_type: StorageType`.

3. Updated `open` method to initialize the appropriate `StorageType` based on configuration and feature flags.

4. Modified `selector` method to choose the appropriate `IndexSelector` based on `StorageType` and payload schema.

5. Added IO measurement support using `HardwareCounterCell` for various operations like querying, estimating cardinality, and building indexes.

6. Implemented `populate` and `clear_cache` methods for managing in-memory caches of on-disk indexes.

7. Updated `take_database_snapshot` to handle different `StorageType` cases.

8. Improved error handling in the `flusher` method to deal with potential column family not found errors.

9. Added support for nested payload queries and cardinality estimation.

10. Implemented `query_field` method to handle different types of primary conditions.

11. Updated `build_field_indexes` to use hardware counters for IO measurement.

12. Replaced `std::collections::HashSet` with `ahash::AHashSet` for better performance when dealing with point IDs.

These changes primarily focus on improving flexibility in storage backends, adding IO measurement capabilities, and optimizing performance for different use cases (appendable vs. non-appendable, in-memory vs. on-disk).