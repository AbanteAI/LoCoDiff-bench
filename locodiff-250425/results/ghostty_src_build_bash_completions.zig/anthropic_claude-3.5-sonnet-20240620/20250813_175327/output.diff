
index bb347e1ba..88e2ea624 100644
--- a/ghostty_src_build_bash_completions.zig_expectedoutput.txt (expected):tmp/tmpvtjg2lqa_expected.txt	
+++ b/ghostty_src_build_bash_completions.zig_extracted.txt (actual):tmp/tmp4c2s_mb0_actual.txt	
@@ -1,338 +1,388 @@
-const std = @import("std");
-
-const Config = @import("../config/Config.zig");
-const Action = @import("../cli/action.zig").Action;
-
-/// A bash completions configuration that contains all the available commands
-/// and options.
-///
-/// Notes: bash completion support for --<key>=<value> depends on setting the completion
-/// system to _not_ print a space following each successful completion (see -o nospace).
-/// This results leading or tailing spaces being necessary to move onto the next match.
-///
-/// bash completion will read = as it's own completiong word regardless of whether or not
-/// it's part of an on going completion like --<key>=. Working around this requires looking
-/// backward in the command line args to pretend the = is an empty string
-/// see: https://www.gnu.org/software/gnuastro/manual/html_node/Bash-TAB-completion-tutorial.html
-pub const completions = comptimeGenerateBashCompletions();
+# -o nospace requires we add back a space when a completion is finished
+# and not part of a --key= completion
+addSpaces() {
+  for idx in "${!COMPREPLY[@]}"; do
+    [ -n "${COMPREPLY[idx]}" ] && COMPREPLY[idx]="${COMPREPLY[idx]} ";
+  done
+}
 
-fn comptimeGenerateBashCompletions() []const u8 {
-    comptime {
-        @setEvalBranchQuota(50000);
-        var counter = std.io.countingWriter(std.io.null_writer);
-        try writeBashCompletions(&counter.writer());
+_fonts() {
+  local IFS=$'\n'
+  mapfile -t COMPREPLY < <( compgen -P '"' -S '"' -W "$($ghostty +list-fonts | grep '^[A-Z]' )" -- "$cur")
+}
 
-        var buf: [counter.bytes_written]u8 = undefined;
-        var stream = std.io.fixedBufferStream(&buf);
-        try writeBashCompletions(stream.writer());
-        const final = buf;
-        return final[0..stream.getWritten().len];
-    }
+_themes() {
+  local IFS=$'\n'
+  mapfile -t COMPREPLY < <( compgen -P '"' -S '"' -W "$($ghostty +list-themes | sed -E 's/^(.*) \(.*$/\1/')" -- "$cur")
 }
 
-fn writeBashCompletions(writer: anytype) !void {
-    const pad1 = "  ";
-    const pad2 = pad1 ++ pad1;
-    const pad3 = pad2 ++ pad1;
-    const pad4 = pad3 ++ pad1;
-    const pad5 = pad4 ++ pad1;
+_files() {
+  mapfile -t COMPREPLY < <( compgen -o filenames -f -- "$cur" )
+  for i in "${!COMPREPLY[@]}"; do
+    if [[ -d "${COMPREPLY[i]}" ]]; then
+      COMPREPLY[i]="${COMPREPLY[i]}/";
+    fi
+    if [[ -f "${COMPREPLY[i]}" ]]; then
+      COMPREPLY[i]="${COMPREPLY[i]} ";
+    fi
+  done
+}
 
-    try writer.writeAll(
-        \\_ghostty() {
-        \\
-        \\  # -o nospace requires we add back a space when a completion is finished
-        \\  # and not part of a --key= completion
-        \\  _add_spaces() {
-        \\    for idx in "${!COMPREPLY[@]}"; do
-        \\      [ -n "${COMPREPLY[idx]}" ] && COMPREPLY[idx]="${COMPREPLY[idx]} ";
-        \\    done
-        \\  }
-        \\
-        \\  _fonts() {
-        \\    local IFS=$'\n'
-        \\    mapfile -t COMPREPLY < <( compgen -P '"' -S '"' -W "$($ghostty +list-fonts | grep '^[A-Z]' )" -- "$cur")
-        \\  }
-        \\
-        \\  _themes() {
-        \\    local IFS=$'\n'
-        \\    mapfile -t COMPREPLY < <( compgen -P '"' -S '"' -W "$($ghostty +list-themes | sed -E 's/^(.*) \(.*$/\1/')" -- "$cur")
-        \\  }
-        \\
-        \\  _files() {
-        \\    mapfile -t COMPREPLY < <( compgen -o filenames -f -- "$cur" )
-        \\    for i in "${!COMPREPLY[@]}"; do
-        \\      if [[ -d "${COMPREPLY[i]}" ]]; then
-        \\        COMPREPLY[i]="${COMPREPLY[i]}/";
-        \\      fi
-        \\      if [[ -f "${COMPREPLY[i]}" ]]; then
-        \\        COMPREPLY[i]="${COMPREPLY[i]} ";
-        \\      fi
-        \\    done
-        \\  }
-        \\
-        \\  _dirs() {
-        \\    mapfile -t COMPREPLY < <( compgen -o dirnames -d -- "$cur" )
-        \\    for i in "${!COMPREPLY[@]}"; do
-        \\      if [[ -d "${COMPREPLY[i]}" ]]; then
-        \\        COMPREPLY[i]="${COMPREPLY[i]}/";
-        \\      fi
-        \\    done
-        \\    if [[ "${#COMPREPLY[@]}" == 0 && -d "$cur" ]]; then
-        \\      COMPREPLY=( "$cur " )
-        \\    fi
-        \\  }
-        \\
-        \\  _handle_config() {
-        \\    local config="--help"
-        \\    config+=" --version"
-        \\
-    );
+_dirs() {
+  mapfile -t COMPREPLY < <( compgen -o dirnames -d -- "$cur" )
+  for i in "${!COMPREPLY[@]}"; do
+    if [[ -d "${COMPREPLY[i]}" ]]; then
+      COMPREPLY[i]="${COMPREPLY[i]}/";
+    fi
+  done
+  if [[ "${#COMPREPLY[@]}" == 0 && -d "$cur" ]]; then
+    COMPREPLY=( "$cur " )
+  fi
+}
 
-    for (@typeInfo(Config).@"struct".fields) |field| {
-        if (field.name[0] == '_') continue;
-        switch (field.type) {
-            bool, ?bool => try writer.writeAll(pad2 ++ "config+=\" '--" ++ field.name ++ " '\"\n"),
-            else => try writer.writeAll(pad2 ++ "config+=\" --" ++ field.name ++ "=\"\n"),
-        }
-    }
+_ghostty() {
 
-    try writer.writeAll(
-        \\
-        \\    case "$prev" in
-        \\
-    );
+  # -o nospace requires we add back a space when a completion is finished
+  # and not part of a --key= completion
+  _add_spaces() {
+    for idx in "${!COMPREPLY[@]}"; do
+      [ -n "${COMPREPLY[idx]}" ] && COMPREPLY[idx]="${COMPREPLY[idx]} ";
+    done
+  }
 
-    for (@typeInfo(Config).@"struct".fields) |field| {
-        if (field.name[0] == '_') continue;
-        try writer.writeAll(pad3 ++ "--" ++ field.name ++ ") ");
+  _fonts() {
+    local IFS=$'\n'
+    mapfile -t COMPREPLY < <( compgen -P '"' -S '"' -W "$($ghostty +list-fonts | grep '^[A-Z]' )" -- "$cur")
+  }
 
-        if (std.mem.startsWith(u8, field.name, "font-family"))
-            try writer.writeAll("_fonts ;;")
-        else if (std.mem.eql(u8, "theme", field.name))
-            try writer.writeAll("_themes ;;")
-        else if (std.mem.eql(u8, "working-directory", field.name))
-            try writer.writeAll("_dirs ;;")
-        else if (field.type == Config.RepeatablePath)
-            try writer.writeAll("_files ;;")
-        else {
-            const compgenPrefix = "mapfile -t COMPREPLY < <( compgen -W \"";
-            const compgenSuffix = "\" -- \"$cur\" ); _add_spaces ;;";
-            switch (@typeInfo(field.type)) {
-                .bool => try writer.writeAll("return ;;"),
-                .@"enum" => |info| {
-                    try writer.writeAll(compgenPrefix);
-                    for (info.fields, 0..) |f, i| {
-                        if (i > 0) try writer.writeAll(" ");
-                        try writer.writeAll(f.name);
-                    }
-                    try writer.writeAll(compgenSuffix);
-                },
-                .@"struct" => |info| {
-                    if (!@hasDecl(field.type, "parseCLI") and info.layout == .@"packed") {
-                        try writer.writeAll(compgenPrefix);
-                        for (info.fields, 0..) |f, i| {
-                            if (i > 0) try writer.writeAll(" ");
-                            try writer.writeAll(f.name ++ " no-" ++ f.name);
-                        }
-                        try writer.writeAll(compgenSuffix);
-                    } else {
-                        try writer.writeAll("return ;;");
-                    }
-                },
-                else => try writer.writeAll("return ;;"),
-            }
-        }
+  _themes() {
+    local IFS=$'\n'
+    mapfile -t COMPREPLY < <( compgen -P '"' -S '"' -W "$($ghostty +list-themes | sed -E 's/^(.*) \(.*$/\1/')" -- "$cur")
+  }
 
-        try writer.writeAll("\n");
-    }
+  _files() {
+    mapfile -t COMPREPLY < <( compgen -o filenames -f -- "$cur" )
+    for i in "${!COMPREPLY[@]}"; do
+      if [[ -d "${COMPREPLY[i]}" ]]; then
+        COMPREPLY[i]="${COMPREPLY[i]}/";
+      fi
+      if [[ -f "${COMPREPLY[i]}" ]]; then
+        COMPREPLY[i]="${COMPREPLY[i]} ";
+      fi
+    done
+  }
 
-    try writer.writeAll(
-        \\      *) mapfile -t COMPREPLY < <( compgen -W "$config" -- "$cur" ) ;;
-        \\    esac
-        \\
-        \\    return 0
-        \\  }
-        \\
-        \\  _handle_actions() {
-        \\
-    );
+  _dirs() {
+    mapfile -t COMPREPLY < <( compgen -o dirnames -d -- "$cur" )
+    for i in "${!COMPREPLY[@]}"; do
+      if [[ -d "${COMPREPLY[i]}" ]]; then
+        COMPREPLY[i]="${COMPREPLY[i]}/";
+      fi
+    done
+    if [[ "${#COMPREPLY[@]}" == 0 && -d "$cur" ]]; then
+      COMPREPLY=( "$cur " )
+    fi
+  }
 
-    for (@typeInfo(Action).@"enum".fields) |field| {
-        if (std.mem.eql(u8, "help", field.name)) continue;
-        if (std.mem.eql(u8, "version", field.name)) continue;
+  _handle_config() {
+    local config="--help"
+    config+=" --version"
+    config+=" '--background-opacity '"
+    config+=" --background-opacity="
+    config+=" '--clipboard-read '"
+    config+=" '--clipboard-write '"
+    config+=" '--confirm-close-surface '"
+    config+=" '--confirm-close-surface-threshold '"
+    config+=" '--confirm-close-surface-threshold="
+    config+=" '--cursor-blink-interval-ms '"
+    config+=" --cursor-blink-interval-ms="
+    config+=" '--cursor-click-distance-px '"
+    config+=" --cursor-click-distance-px="
+    config+=" '--cursor-hold-select '"
+    config+=" '--cursor-shape '"
+    config+=" --cursor-shape="
+    config+=" '--cursor-style '"
+    config+=" --cursor-style="
+    config+=" '--debug-logging '"
+    config+=" '--default-cwd '"
+    config+=" --default-cwd="
+    config+=" '--default-program '"
+    config+=" --default-program="
+    config+=" '--enable-audio-bell '"
+    config+=" '--font-family '"
+    config+=" --font-family="
+    config+=" '--font-features '"
+    config+=" --font-features="
+    config+=" '--font-size '"
+    config+=" --font-size="
+    config+=" '--framerate '"
+    config+=" --framerate="
+    config+=" '--gtk-theme-variant '"
+    config+=" --gtk-theme-variant="
+    config+=" '--hide-cursor-when-typing '"
+    config+=" '--hold-after-exit '"
+    config+=" '--ignore-ime-mod-state '"
+    config+=" '--ime-preedit-offset '"
+    config+=" --ime-preedit-offset="
+    config+=" '--ime-style '"
+    config+=" --ime-style="
+    config+=" '--keyboard-layout '"
+    config+=" --keyboard-layout="
+    config+=" '--ligature-blacklist '"
+    config+=" --ligature-blacklist="
+    config+=" '--load-existing-config '"
+    config+=" '--macos-colorspace '"
+    config+=" --macos-colorspace="
+    config+=" '--macos-disable-window-tabbing '"
+    config+=" '--macos-move-to-active-space-when-opened '"
+    config+=" '--macos-option-as-alt '"
+    config+=" '--macos-quit-when-last-window-closed '"
+    config+=" '--macos-titlebar-is-vibrant '"
+    config+=" '--middle-click-action '"
+    config+=" --middle-click-action="
+    config+=" '--mouse-hide-while-typing '"
+    config+=" '--native-macos-fullscreen '"
+    config+=" '--native-wayland-fullscreen '"
+    config+=" '--pad-horiz '"
+    config+=" --pad-horiz="
+    config+=" '--pad-vert '"
+    config+=" --pad-vert="
+    config+=" '--pixel-snap '"
+    config+=" '--preserve-root-title '"
+    config+=" '--print-style '"
+    config+=" --print-style="
+    config+=" '--resize-increments '"
+    config+=" '--right-click-action '"
+    config+=" --right-click-action="
+    config+=" '--scroll-multiplier '"
+    config+=" --scroll-multiplier="
+    config+=" '--scrollback-lines '"
+    config+=" --scrollback-lines="
+    config+=" '--scrollback-live-feed '"
+    config+=" '--selection-block-scrolling '"
+    config+=" '--selection-scrolling '"
+    config+=" '--selection-semantic-shift '"
+    config+=" '--selection-word-select '"
+    config+=" '--shell-integration '"
+    config+=" '--shell-integration-features '"
+    config+=" --shell-integration-features="
+    config+=" '--style '"
+    config+=" --style="
+    config+=" '--sync-selections '"
+    config+=" '--syslog-errors '"
+    config+=" '--theme '"
+    config+=" --theme="
+    config+=" '--use-ime '"
+    config+=" '--window-decoration '"
+    config+=" --window-decoration="
+    config+=" '--working-directory '"
+    config+=" --working-directory="
 
-        const options = @field(Action, field.name).options();
-        // assumes options will never be created with only <_name> members
-        if (@typeInfo(options).@"struct".fields.len == 0) continue;
+    case "$prev" in
+      --background-opacity) mapfile -t COMPREPLY < <( compgen -W "0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1" -- "$cur" ); _add_spaces ;;
+      --clipboard-read) return ;;
+      --clipboard-write) return ;;
+      --confirm-close-surface) return ;;
+      --confirm-close-surface-threshold) return ;;
+      --cursor-blink-interval-ms) return ;;
+      --cursor-click-distance-px) return ;;
+      --cursor-hold-select) return ;;
+      --cursor-shape) mapfile -t COMPREPLY < <( compgen -W "block beam underline" -- "$cur" ); _add_spaces ;;
+      --cursor-style) mapfile -t COMPREPLY < <( compgen -W "blink steady" -- "$cur" ); _add_spaces ;;
+      --debug-logging) return ;;
+      --default-cwd) _dirs ;;
+      --default-program) return ;;
+      --enable-audio-bell) return ;;
+      --font-family) _fonts ;;
+      --font-features) return ;;
+      --font-size) return ;;
+      --framerate) return ;;
+      --gtk-theme-variant) mapfile -t COMPREPLY < <( compgen -W "system light dark" -- "$cur" ); _add_spaces ;;
+      --hide-cursor-when-typing) return ;;
+      --hold-after-exit) return ;;
+      --ignore-ime-mod-state) return ;;
+      --ime-preedit-offset) return ;;
+      --ime-style) mapfile -t COMPREPLY < <( compgen -W "native system" -- "$cur" ); _add_spaces ;;
+      --keyboard-layout) return ;;
+      --ligature-blacklist) return ;;
+      --load-existing-config) return ;;
+      --macos-colorspace) mapfile -t COMPREPLY < <( compgen -W "default srgb display-p3" -- "$cur" ); _add_spaces ;;
+      --macos-disable-window-tabbing) return ;;
+      --macos-move-to-active-space-when-opened) return ;;
+      --macos-option-as-alt) mapfile -t COMPREPLY < <( compgen -W "left right both none" -- "$cur" ); _add_spaces ;;
+      --macos-quit-when-last-window-closed) return ;;
+      --macos-titlebar-is-vibrant) return ;;
+      --middle-click-action) mapfile -t COMPREPLY < <( compgen -W "paste-selection open-link" -- "$cur" ); _add_spaces ;;
+      --mouse-hide-while-typing) return ;;
+      --native-macos-fullscreen) return ;;
+      --native-wayland-fullscreen) return ;;
+      --pad-horiz) return ;;
+      --pad-vert) return ;;
+      --pixel-snap) return ;;
+      --preserve-root-title) return ;;
+      --print-style) mapfile -t COMPREPLY < <( compgen -W "default unicode" -- "$cur" ); _add_spaces ;;
+      --resize-increments) return ;;
+      --right-click-action) mapfile -t COMPREPLY < <( compgen -W "paste clipboard-paste open-link" -- "$cur" ); _add_spaces ;;
+      --scroll-multiplier) return ;;
+      --scrollback-lines) return ;;
+      --scrollback-live-feed) return ;;
+      --selection-block-scrolling) return ;;
+      --selection-scrolling) return ;;
+      --selection-semantic-shift) return ;;
+      --selection-word-select) return ;;
+      --shell-integration) mapfile -t COMPREPLY < <( compgen -W "native none" -- "$cur" ); _add_spaces ;;
+      --shell-integration-features) mapfile -t COMPREPLY < <( compgen -W "no-cursor no-title no-status-bar no-cwd" -- "$cur" ); _add_spaces ;;
+      --style) _files ;;
+      --sync-selections) return ;;
+      --syslog-errors) return ;;
+      --theme) _themes ;;
+      --use-ime) return ;;
+      --window-decoration) mapfile -t COMPREPLY < <( compgen -W "none title-bar macos-native" -- "$cur" ); _add_spaces ;;
+      --working-directory) _dirs ;;
+      *) mapfile -t COMPREPLY < <( compgen -W "$config" -- "$cur" ) ;;
+    esac
 
-        var buffer: [field.name.len]u8 = undefined;
-        const bashName: []u8 = buffer[0..field.name.len];
-        @memcpy(bashName, field.name);
+    return 0
+  }
 
-        std.mem.replaceScalar(u8, bashName, '-', '_');
-        try writer.writeAll(pad2 ++ "local " ++ bashName ++ "=\"");
+  _handle_actions() {
+    local config_set="--config-file= --help"
+    local config_get="--config-file= --help"
+    local window_new="--config-file= --help"
+    local surface_new="--config-file= --help"
+    local list_fonts="--help"
+    local list_themes="--help"
+    local debug_info="--help"
+    local update_terminfo="--help"
+    local update_shell_integration="--help"
+    local update_manpages="--help"
 
-        {
-            var count = 0;
-            for (@typeInfo(options).@"struct".fields) |opt| {
-                if (opt.name[0] == '_') continue;
-                if (count > 0) try writer.writeAll(" ");
-                switch (opt.type) {
-                    bool, ?bool => try writer.writeAll("'--" ++ opt.name ++ " '"),
-                    else => try writer.writeAll("--" ++ opt.name ++ "="),
-                }
-                count += 1;
-            }
-        }
-        try writer.writeAll(" --help\"\n");
-    }
+    case "${COMP_WORDS[1]}" in
+      +config-set)
+        case $prev in
+          --config-file) _files ;;
+          *) mapfile -t COMPREPLY < <( compgen -W "$config_set" -- "$cur" ) ;;
+        esac
+      ;;
+      +config-get)
+        case $prev in
+          --config-file) _files ;;
+          *) mapfile -t COMPREPLY < <( compgen -W "$config_get" -- "$cur" ) ;;
+        esac
+      ;;
+      +window-new)
+        case $prev in
+          --config-file) _files ;;
+          *) mapfile -t COMPREPLY < <( compgen -W "$window_new" -- "$cur" ) ;;
+        esac
+      ;;
+      +surface-new)
+        case $prev in
+          --config-file) _files ;;
+          *) mapfile -t COMPREPLY < <( compgen -W "$surface_new" -- "$cur" ) ;;
+        esac
+      ;;
+      +list-fonts)
+        case $prev in
+          *) mapfile -t COMPREPLY < <( compgen -W "$list_fonts" -- "$cur" ) ;;
+        esac
+      ;;
+      +list-themes)
+        case $prev in
+          *) mapfile -t COMPREPLY < <( compgen -W "$list_themes" -- "$cur" ) ;;
+        esac
+      ;;
+      +debug-info)
+        case $prev in
+          *) mapfile -t COMPREPLY < <( compgen -W "$debug_info" -- "$cur" ) ;;
+        esac
+      ;;
+      +update-terminfo)
+        case $prev in
+          *) mapfile -t COMPREPLY < <( compgen -W "$update_terminfo" -- "$cur" ) ;;
+        esac
+      ;;
+      +update-shell-integration)
+        case $prev in
+          *) mapfile -t COMPREPLY < <( compgen -W "$update_shell_integration" -- "$cur" ) ;;
+        esac
+      ;;
+      +update-manpages)
+        case $prev in
+          *) mapfile -t COMPREPLY < <( compgen -W "$update_manpages" -- "$cur" ) ;;
+        esac
+      ;;
+      *) mapfile -t COMPREPLY < <( compgen -W "--help" -- "$cur" ) ;;
+    esac
 
-    try writer.writeAll(
-        \\
-        \\    case "${COMP_WORDS[1]}" in
-        \\
-    );
+    return 0
+  }
 
-    for (@typeInfo(Action).@"enum".fields) |field| {
-        if (std.mem.eql(u8, "help", field.name)) continue;
-        if (std.mem.eql(u8, "version", field.name)) continue;
+  # begin main logic
+  local topLevel="-e"
+  topLevel+=" --help"
+  topLevel+=" --version"
+  topLevel+=" +config-set"
+  topLevel+=" +config-get"
+  topLevel+=" +window-new"
+  topLevel+=" +surface-new"
+  topLevel+=" +list-fonts"
+  topLevel+=" +list-themes"
+  topLevel+=" +debug-info"
+  topLevel+=" +update-terminfo"
+  topLevel+=" +update-shell-integration"
+  topLevel+=" +update-manpages"
 
-        const options = @field(Action, field.name).options();
-        if (@typeInfo(options).@"struct".fields.len == 0) continue;
+  local cur=""; local prev=""; local prevWasEq=false; COMPREPLY=()
+  local ghostty="$1"
 
-        // bash doesn't allow variable names containing '-' so replace them
-        var buffer: [field.name.len]u8 = undefined;
-        const bashName: []u8 = buffer[0..field.name.len];
-        _ = std.mem.replace(u8, field.name, "-", "_", bashName);
+  # script assumes default COMP_WORDBREAKS of roughly $' \t\n"\'><=;|&(:'
+  # if = is missing this script will degrade to matching on keys only.
+  # eg: --key=
+  # this can be improved if needed see: https://github.com/ghostty-org/ghostty/discussions/2994
 
-        try writer.writeAll(pad3 ++ "+" ++ field.name ++ ")\n");
-        try writer.writeAll(pad4 ++ "case $prev in\n");
-        for (@typeInfo(options).@"struct".fields) |opt| {
-            if (opt.name[0] == '_') continue;
+  if [ "$2" = "=" ]; then cur=""
+  else                    cur="$2"
+  fi
 
-            try writer.writeAll(pad5 ++ "--" ++ opt.name ++ ") ");
+  if [ "$3" = "=" ]; then prev="${COMP_WORDS[COMP_CWORD-2]}"; prevWasEq=true;
+  else                    prev="${COMP_WORDS[COMP_CWORD-1]}"
+  fi
 
-            const compgenPrefix = "mapfile -t COMPREPLY < <( compgen -W \"";
-            const compgenSuffix = "\" -- \"$cur\" ); _add_spaces ;;";
-            switch (@typeInfo(opt.type)) {
-                .bool => try writer.writeAll("return ;;"),
-                .@"enum" => |info| {
-                    try writer.writeAll(compgenPrefix);
-                    for (info.fields, 0..) |f, i| {
-                        if (i > 0) try writer.writeAll(" ");
-                        try writer.writeAll(f.name);
-                    }
-                    try writer.writeAll(compgenSuffix);
-                },
-                .optional => |optional| {
-                    switch (@typeInfo(optional.child)) {
-                        .@"enum" => |info| {
-                            try writer.writeAll(compgenPrefix);
-                            for (info.fields, 0..) |f, i| {
-                                if (i > 0) try writer.writeAll(" ");
-                                try writer.writeAll(f.name);
-                            }
-                            try writer.writeAll(compgenSuffix);
-                        },
-                        else => {
-                            if (std.mem.eql(u8, "config-file", opt.name)) {
-                                try writer.writeAll("return ;;");
-                            } else try writer.writeAll("return;;");
-                        },
-                    }
-                },
-                else => {
-                    if (std.mem.eql(u8, "config-file", opt.name)) {
-                        try writer.writeAll("_files ;;");
-                    } else try writer.writeAll("return;;");
-                },
-            }
-            try writer.writeAll("\n");
-        }
-        try writer.writeAll(pad5 ++ "*) mapfile -t COMPREPLY < <( compgen -W \"$" ++ bashName ++ "\" -- \"$cur\" ) ;;\n");
-        try writer.writeAll(
-            \\        esac
-            \\      ;;
-            \\
-        );
-    }
+  # current completion is double quoted add a space so the curor progresses
+  if [[ "$2" == \"*\" ]]; then
+    COMPREPLY=( "$cur " );
+    return;
+  fi
 
-    try writer.writeAll(
-        \\      *) mapfile -t COMPREPLY < <( compgen -W "--help" -- "$cur" ) ;;
-        \\    esac
-        \\
-        \\    return 0
-        \\  }
-        \\
-        \\  # begin main logic
-        \\  local topLevel="-e"
-        \\  topLevel+=" --help"
-        \\  topLevel+=" --version"
-        \\
-    );
+  case "$COMP_CWORD" in
+    1)
+      case "${COMP_WORDS[1]}" in
+        -e | --help | --version) return 0 ;;
+        --*) _handle_config ;;
+        *) mapfile -t COMPREPLY < <( compgen -W "${topLevel}" -- "$cur" ); _add_spaces ;;
+      esac
+      ;;
+    *)
+      case "$prev" in
+        -e | --help | --version) return 0 ;;
+        *)
+          if [[ "=" != "${COMP_WORDS[COMP_CWORD]}" && $prevWasEq != true ]]; then
+            # must be completing with a space after the key eg: '--<key> '
+            # clear out prev so we don't run any of the key specific completions
+            prev=""
+          fi
 
-    for (@typeInfo(Action).@"enum".fields) |field| {
-        if (std.mem.eql(u8, "help", field.name)) continue;
-        if (std.mem.eql(u8, "version", field.name)) continue;
+          case "${COMP_WORDS[1]}" in
+            --*) _handle_config ;;
+            +*) _handle_actions ;;
+          esac
+          ;;
+      esac
+      ;;
+  esac
 
-        try writer.writeAll(pad1 ++ "topLevel+=\" +" ++ field.name ++ "\"\n");
-    }
+  return 0
+}
 
-    try writer.writeAll(
-        \\
-        \\  local cur=""; local prev=""; local prevWasEq=false; COMPREPLY=()
-        \\  local ghostty="$1"
-        \\
-        \\  # script assumes default COMP_WORDBREAKS of roughly $' \t\n"\'><=;|&(:'
-        \\  # if = is missing this script will degrade to matching on keys only.
-        \\  # eg: --key=
-        \\  # this can be improved if needed see: https://github.com/ghostty-org/ghostty/discussions/2994
-        \\
-        \\  if [ "$2" = "=" ]; then cur=""
-        \\  else                    cur="$2"
-        \\  fi
-        \\
-        \\  if [ "$3" = "=" ]; then prev="${COMP_WORDS[COMP_CWORD-2]}"; prevWasEq=true;
-        \\  else                    prev="${COMP_WORDS[COMP_CWORD-1]}"
-        \\  fi
-        \\
-        \\  # current completion is double quoted add a space so the curor progresses
-        \\  if [[ "$2" == \"*\" ]]; then
-        \\    COMPREPLY=( "$cur " );
-        \\    return;
-        \\  fi
-        \\
-        \\  case "$COMP_CWORD" in
-        \\    1)
-        \\      case "${COMP_WORDS[1]}" in
-        \\        -e | --help | --version) return 0 ;;
-        \\        --*) _handle_config ;;
-        \\        *) mapfile -t COMPREPLY < <( compgen -W "${topLevel}" -- "$cur" ); _add_spaces ;;
-        \\      esac
-        \\      ;;
-        \\    *)
-        \\      case "$prev" in
-        \\        -e | --help | --version) return 0 ;;
-        \\        *)
-        \\          if [[ "=" != "${COMP_WORDS[COMP_CWORD]}" && $prevWasEq != true ]]; then
-        \\            # must be completing with a space after the key eg: '--<key> '
-        \\            # clear out prev so we don't run any of the key specific completions
-        \\            prev=""
-        \\          fi
-        \\
-        \\          case "${COMP_WORDS[1]}" in
-        \\            --*) _handle_config ;;
-        \\            +*) _handle_actions ;;
-        \\          esac
-        \\          ;;
-        \\      esac
-        \\      ;;
-        \\  esac
-        \\
-        \\  return 0
-        \\}
-        \\
-        \\complete -o nospace -o bashdefault -F _ghostty ghostty
-        \\
-    );
-}
\ No newline at end of file
+complete -o nospace -o bashdefault -F _ghostty ghostty
\ No newline at end of file
