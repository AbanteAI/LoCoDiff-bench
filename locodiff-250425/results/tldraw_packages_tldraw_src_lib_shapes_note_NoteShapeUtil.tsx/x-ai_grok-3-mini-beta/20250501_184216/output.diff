--- tldraw_packages_tldraw_src_lib_shapes_note_NoteShapeUtil.tsx_expectedoutput.txt (expected)+++ tldraw_packages_tldraw_src_lib_shapes_note_NoteShapeUtil.tsx_extracted.txt (actual)@@ -1,4 +1,3 @@-/* eslint-disable react-hooks/rules-of-hooks */
 import {
 	Box,
 	Editor,
@@ -41,8 +40,6 @@ 	TEXT_PROPS,
 } from '../shared/default-shape-constants'
 
-import { startEditingShapeWithLabel } from '../../tools/SelectTool/selectHelpers'
-
 import isEqual from 'lodash.isequal'
 import {
 	isEmptyRichText,
@@ -136,14 +133,14 @@ 						shape.props.align === 'start'
 							? 0
 							: shape.props.align === 'end'
-								? nw - lw
-								: (nw - lw) / 2,
+							? nw - lw
+							: (nw - lw) / 2,
 					y:
 						shape.props.verticalAlign === 'start'
 							? 0
 							: shape.props.verticalAlign === 'end'
-								? nh - lh
-								: (nh - lh) / 2,
+							? nh - lh
+							: (nh - lh) / 2,
 					width: lw,
 					height: lh,
 					isFilled: true,
@@ -265,24 +262,18 @@ 			[this.editor]
 		)
 
-		// todo: consider hiding shadows on dark mode if they're invisible anyway
-
-		const hideShadows = useValue('zoom', () => this.editor.getZoomLevel() < 0.35 / scale, [
-			scale,
+		const isDarkMode = useValue('dark mode', () => this.editor.user.getIsDarkMode(), [
 			this.editor,
 		])
 
-		const isDarkMode = useValue('dark mode', () => this.editor.user.getIsDarkMode(), [this.editor])
-
-		const isSelected = shape.id === this.editor.getOnlySelectedShapeId()
-
 		const isReadyForEditing = useIsReadyForEditing(this.editor, shape.id)
 		const isEmpty = isEmptyRichText(richText)
+		const isSelected = shape.id === this.editor.getOnlySelectedShapeId()
 
 		return (
 			<>
 				<div
-					id={id}
+					data-shape-id={id}
 					className="tl-note__container"
 					style={{
 						width: nw,
@@ -374,10 +365,28 @@ 		) {
 			return
 		}
-
 		return getNoteSizeAdjustments(this.editor, next)
 	}
 
+	override onEditEnd(shape: TLNoteShape) {
+		const {
+			id,
+			type,
+			props: { text },
+		} = shape
+
+		if (text.trimEnd() !== shape.props.text) {
+			this.editor.updateShapes([
+				{
+					id,
+					type,
+					props: {
+						text: text.trimEnd(),
+					},
+				},
+			])
+		}
+	}
 	override getInterpolatedProps(
 		startShape: TLNoteShape,
 		endShape: TLNoteShape,
@@ -388,11 +397,25 @@ 			scale: lerp(startShape.props.scale, endShape.props.scale, t),
 		}
 	}
-}
-
-/**
- * Get the growY and fontSizeAdjustment for a shape.
- */
+
+	/** @internal */
+	static override defaultProps: TLNoteShape['props'] = {
+		color: 'black',
+		richText: toRichText(''),
+		size: 'm',
+		font: 'draw',
+		align: 'middle',
+		verticalAlign: 'middle',
+		labelColor: 'black',
+		growY: 0,
+		fontSizeAdjustment: 0,
+		url: '',
+		scale: 1,
+	}
+}
+
+const labelSizesForNote = new WeakCache<TLShape, ReturnType<typeof getNoteLabelSize>>()
+
 function getNoteSizeAdjustments(editor: Editor, shape: TLNoteShape) {
 	const { labelHeight, fontSizeAdjustment } = getLabelSize(editor, shape)
 	// When the label height is more than the height of the shape, we add extra height to it
@@ -470,13 +493,11 @@ 	} while (iterations++ < 50)
 
 	return {
-		labelHeight: labelHeight,
-		labelWidth: labelWidth,
-		fontSizeAdjustment: fontSizeAdjustment,
-	}
-}
-
-const labelSizesForNote = new WeakCache<TLShape, ReturnType<typeof getNoteLabelSize>>()
+		labelHeight,
+		labelWidth,
+		fontSizeAdjustment,
+	}
+}
 
 function getLabelSize(editor: Editor, shape: TLNoteShape) {
 	return labelSizesForNote.get(shape, () => getNoteLabelSize(editor, shape))
@@ -524,7 +545,12 @@ 					.rot(pageRotation)
 					.add(pageTransform.point())
 
-				const newNote = getNoteShapeForAdjacentPosition(editor, shape, adjacentCenter, pageRotation)
+				const newNote = getNoteShapeForAdjacentPosition(
+					editor,
+					shape,
+					adjacentCenter,
+					pageRotation
+				)
 
 				if (newNote) {
 					editor.markHistoryStoppingPoint('editing adjacent shape')
