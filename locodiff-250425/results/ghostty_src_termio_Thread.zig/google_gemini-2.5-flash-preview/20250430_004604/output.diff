--- ghostty_src_termio_Thread.zig_expectedoutput.txt (expected)+++ ghostty_src_termio_Thread.zig_extracted.txt (actual)@@ -400,9 +400,10 @@         return .rearm;
     };
 
+    const cb = cb_ orelse return .rearm;
+
     // When we wake up, we check the mailbox. Mailbox producers should
     // wake up our thread after publishing.
-    const cb = cb_ orelse return .rearm;
     cb.self.drainMailbox(cb) catch |err|
         log.err("error draining mailbox err={}", .{err});
 
