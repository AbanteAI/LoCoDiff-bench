Here's a summary of the changes made to the `src/font/shaper/harfbuzz.zig` file:

1. The shaper now uses a dynamically allocated buffer for shaped cells, allowing it to handle pathological grapheme clusters that use a lot of memory.

2. The shaper no longer splits runs on background color changes, as this is not necessary for rendering.

3. The shaper now forces left-to-right (LTR) font shaping, even for right-to-left (RTL) text, as Ghostty doesn't currently support RTL rendering.

4. The font feature settings have been made more flexible, allowing non-boolean values and a more lenient parsing syntax.

5. The shaper now uses a `Feature` struct and `FeatureList` for managing font features, instead of directly using Harfbuzz features.

6. The test for shaping long emoji sequences has been updated to use proper grapheme clustering, as the previous test method didn't accurately represent how the terminal would handle these sequences.

7. The shaper no longer requires emoji presentation for all parts of a grapheme cluster, only for the base character.

These changes improve the shaper's flexibility, correctness, and ability to handle complex text scenarios, while also making it easier to configure and test.