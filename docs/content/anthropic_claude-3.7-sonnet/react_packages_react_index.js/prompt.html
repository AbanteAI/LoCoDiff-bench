<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt: packages/react/index.js - Sonnet 3.7</title>
    <link rel="stylesheet" href="../../../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>
<body>
    <header>
        <h1>Prompt: packages/react/index.js</h1>
        <h2>Model: Sonnet 3.7</h2>
        <p><a href="../../../cases/anthropic_claude-3.7-sonnet/react_packages_react_index.js.html">Back to Case</a> | <a href="../../../cases.html">All Cases</a> | <a href="../../../index.html">Home</a></p>
    </header>
    <main>
        <section>
            <h2>Prompt Content</h2>
            <pre><code class="language-plaintext"># Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- packages/react/index.js

commit 4b2eac3de7e1dbf5c2dd742fd9989974a83972cb
Author: Dominic Gannaway <trueadm@users.noreply.github.com>
Date:   Wed Apr 5 16:47:29 2017 +0100

    Convert current build system to Rollup and adopt flat bundles (#9327)
    
    * WIP
    
    * fbjs support
    
    * WIP
    
    * dev/prod mode WIP
    
    * More WIP
    
    * builds a cjs bundle
    
    * adding forwarding modules
    
    * more progress on forwarding modules and FB config
    
    * improved how certain modules get inlined for fb and cjs
    
    * more forwarding modules
    
    * added comments to the module aliasing code
    
    * made ReactPerf and ReactTestUtils bundle again
    
    * Use -core suffix for all bundles
    
    This makes it easier to override things in www.
    
    * Add a lazy shim for ReactPerf
    
    This prevents a circular dependency between ReactGKJSModule and ReactDOM
    
    * Fix forwarding module for ReactCurrentOwner
    
    * Revert "Add a lazy shim for ReactPerf"
    
    This reverts commit 723b402c07116a70ce8ff1e43a1f4d92052e8f43.
    
    * Rename -core suffix to -fb for clarity
    
    * Change forwarding modules to import from -fb
    
    This is another, more direct fix for ReactPerf circular dependency
    
    * should fix fb and cjs bundles for ReactCurrentOwner
    
    * added provides module for ReactCurrentOwner
    
    * should improve console output
    
    * fixed typo with argument passing on functon call
    
    * Revert "should improve console output"
    
    This breaks the FB bundles.
    
    This reverts commit 65f11ee64f678c387cb3cfef9a8b28b89a6272b9.
    
    * Work around internal FB transform require() issue
    
    * moved  ReactInstanceMap out of React and into ReactDOM and ReactDOMFiber
    
    * Expose more internal modules to www
    
    * Add missing modules to Stack ReactDOM to fix UFI
    
    * Fix onlyChild module
    
    * improved the build tool
    
    * Add a rollup npm script
    
    * Rename ReactDOM-fb to ReactDOMStack-fb
    
    * Fix circular dependencies now that ReactDOM-fb is a GK switch
    
    * Revert "Work around internal FB transform require() issue"
    
    This reverts commit 0a50b6a90bffc59f8f5416ef36000b5e3a44d253.
    
    * Bump rollup-plugin-commonjs to include a fix for rollup/rollup-plugin-commonjs#176
    
    * Add more forwarding modules that are used on www
    
    * Add even more forwarding modules that are used on www
    
    * Add DOMProperty to hidden exports
    
    * Externalize feature flags
    
    This lets www specify them dynamically.
    
    * Remove forwarding modules with implementations
    
    Instead I'm adding them to react-fb in my diff.
    
    * Add all injection necessary for error logging
    
    * Add missing forwarding module (oops)
    
    * Add ReactART builds
    
    * Add ReactDOMServer bundle
    
    * Fix UMD build of ReactDOMFiber
    
    * Work in progress: start adding ReactNative bundle
    
    * tidied up the options for bundles, so they can define what types they output and exclude
    
    * Add a working RN build
    
    * further improved and tidied up build process
    
    * improved how bundles are built by exposing externals and making the process less "magical", also tidied up code and added more comments
    
    * better handling of bundling ReactCurrentOwner and accessing it from renderer modules
    
    * added NODE_DEV and NODE_PROD
    
    * added NPM package creation and copying into build chain
    
    * Improved UMD bundles, added better fixture testing and doc plus prod builds
    
    * updated internal modules (WIP)
    
    * removed all react/lib/* dependencies from appearing in bundles created on build
    
    * added react-test-renderer bundles
    
    * renamed bundles and paths
    
    * fixed fixture path changes
    
    * added extract-errors support
    
    * added extractErrors warning
    
    * moved shims to shims directory in rollup scripts
    
    * changed pathing to use build rather than build/rollup
    
    * updated release doc to reflect some rollup changes
    
    * Updated ReactNative findNodeHandle() to handle number case (#9238)
    
    * Add dynamic injection to ReactErrorUtils (#9246)
    
    * Fix ReactErrorUtils injection (#9247)
    
    * Fix Haste name
    
    * Move files around
    
    * More descriptive filenames
    
    * Add missing ReactErrorUtils shim
    
    * Tweak reactComponentExpect to make it standalone-ish in www
    
    * Unflowify shims
    
    * facebook-www shims now get copied over correctly to build
    
    * removed unnecessary resolve
    
    * building facebook-www/build is now all sync to prevent IO issues plus handles extra facebook-www src assets
    
    * removed react-native-renderer package and made build make a react-native build dir instead
    
    * ðŸ˜­ðŸ˜­ðŸ˜­
    
    * Add more SSR unit tests for elements and children. (#9221)
    
    * Adding more SSR unit tests for elements and children.
    
    * Some of my SSR tests were testing for react-text and react-empty elements that no longer exist in Fiber. Fixed the tests so that they expect correct markup in Fiber.
    
    * Tweaked some test names after @gaearon review comment https://github.com/facebook/react/pull/9221#discussion_r107045673 . Also realized that one of the tests was essentially a direct copy of another, so deleted it.
    
    * Responding to code review https://github.com/facebook/react/pull/9221#pullrequestreview-28996315 . Thanks @spicyj!
    
    * ReactElementValidator uses temporary ReactNative View propTypes getter (#9256)
    
    * Updating packages for 16.0.0-alpha.6 release
    
    * Revert "ðŸ˜­ðŸ˜­ðŸ˜­"
    
    This reverts commit 7dba33b2cfc67246881f6d57633a80e628ea05ec.
    
    * Work around Jest issue with CurrentOwner shared state in www
    
    * updated error codes
    
    * splits FB into FB_DEV and FB_PROD
    
    * Remove deps on specific builds from shims
    
    * should no longer mangle FB_PROD output
    
    * Added init() dev block to ReactTestUtils
    
    * added shims for DEV only code so it does not get included in prod bundles
    
    * added a __DEV__ wrapping code to FB_DEV
    
    * added __DEV__ flag behind a footer/header
    
    * Use right haste names
    
    * keeps comments in prod
    
    * added external babel helpers plugin
    
    * fixed fixtures and updated cjs/umd paths
    
    * Fixes Jest so it run tests correctly
    
    * fixed an issue with stubbed modules not properly being replaced due to greedy replacement
    
    * added a WIP solution for ReactCurrentOwner on FB DEV
    
    * adds a FB_TEST bundle
    
    * allows both ReactCurrentOwner and react/lib/ReactCurrentOwner
    
    * adds -test to provides module name
    
    * Remove TEST env
    
    * Ensure requires stay at the top
    
    * added basic mangle support (disbaled by default)
    
    * per bundle property mangling added
    
    * moved around plugin order to try and fix deadcode requires as per https://github.com/rollup/rollup/issues/855
    
    * Fix flow issues
    
    * removed gulp and grunt and moved tasks to standalone node script
    
    * configured circleci to use new paths
    
    * Fix lint
    
    * removed gulp-extract-errors
    
    * added test_build.sh back in
    
    * added missing newline to flow.js
    
    * fixed test coverage command
    
    * changed permissions on test_build.sh
    
    * fixed test_html_generations.sh
    
    * temp removed html render test
    
    * removed the warning output from test_build, the build should do this instead
    
    * fixed test_build
    
    * fixed broken npm script
    
    * Remove unused ViewportMetrics shim
    
    * better error output
    
    * updated circleci to node 7 for async/await
    
    * Fixes
    
    * removed coverage test from circleci run
    
    * circleci run tets
    
    * removed build from circlci
    
    * made a dedicated jest script in a new process
    
    * moved order around of circlci tasks
    
    * changing path to jest in more circleci tests
    
    * re-enabled code coverage
    
    * Add file header to prod bundles
    
    * Remove react-dom/server.js (WIP: decide on the plan)
    
    * Only UMD bundles need version header
    
    * Merge with master
    
    * disabled const evaluation by uglify for <script></script> string literal
    
    * deal with ART modules for UMD bundles
    
    * improved how bundle output gets printed
    
    * fixed filesize difference reporting
    
    * added filesize dep
    
    * Update yarn lockfile for some reason
    
    * now compares against the last run branch built on
    
    * added react-dom-server
    
    * removed un-needed comment
    
    * results only get saved on full builds
    
    * moved the rollup sized plugin into a plugins directory
    
    * added a missing commonjs()
    
    * fixed missing ignore
    
    * Hack around to fix RN bundle
    
    * Partially fix RN bundles
    
    * added react-art bundle and a fixture for it
    
    * Point UMD bundle to Fiber and add EventPluginHub to exported internals
    
    * Make it build on Node 4
    
    * fixed eslint error with resolve being defined in outer scope
    
    * Tweak how build results are calculated and stored
    
    * Tweak fixtures build to work on Node 4
    
    * Include LICENSE/PATENTS and fix up package.json files
    
    * Add Node bundle for react-test-renderer
    
    * Revert "Hack around to fix RN bundle"
    
    We'll do this later.
    
    This reverts commit 59445a625962d7be4c7c3e98defc8a31f8761ec1.
    
    * Revert more RN changes
    
    We'll do them separately later
    
    * Revert more unintentional changes
    
    * Revert changes to error codes
    
    * Add accidentally deleted RN externals
    
    * added RN_DEV/RN_PROD bundles
    
    * fixed typo where RN_DEV and RN_PROD were the wrong way around
    
    * Delete/ignore fixture build outputs
    
    * Format scripts/ with Prettier
    
    * tidied up the Rollup build process and split functions into various different files to improve readability
    
    * Copy folder before files
    
    * updated yarn.lock
    
    * updated results and yarn dependencies to the latest versions

diff --git a/packages/react/index.js b/packages/react/index.js
new file mode 100644
index 0000000000..999ead7789
--- /dev/null
+++ b/packages/react/index.js
@@ -0,0 +1,7 @@
+'use strict';
+
+if (process.env.NODE_ENV === 'production') {
+  module.exports = require('./cjs/react.production.min.js');
+} else {
+  module.exports = require('./cjs/react.development.js');
+}

commit 34092a0f242c8059fd4cec4970f72d9326f2824d
Author: Flarnie Marchan <flarnie@users.noreply.github.com>
Date:   Wed Aug 16 11:44:31 2017 -0700

    Throw error to warn of mistaken loading of prod + dev React bundles (#10446)
    
    * Throw error to warn of mistaken loading of prod + dev React bundles
    
    **what is the change?:**
    Credit to @gaearon for coming up with a clever way to check for this. :)
    
    I mainly just did the manual testing and fixed a couple of typos in his
    idea.
    
    I'd like to do a follow-up PR to add a link and a page explaining this
    issue more and suggesting how to fix it.
    
    **why make this change?:**
    
    We want to warn for an unfortunate gotcha for
    the following situation -
    1. Wanting to shrink their JS bundle, an engineer runs it through
       'uglifyjs' or some other minifier. They assume this will also do
       dead-code-elimination, but the 'prod' and 'dev' checks are not
       envified yet and dev-only code does not get removed.
    2. Then they run it through browserify's 'envify' or some other tool to
       change all calls to 'process.env.NODE_ENV' to "production". This
       makes their code ready to ship, except the 'dev' only dead code is
       still in the bundle. Their bundle is twice as large as it needs to
       be, due to the dead code.
    
    This was a problem with the old build system before, but with our new
    build system output it's possible to detect and throw an informative
    error in this case.
    
    **test plan:**
    1. run the build in react as usual; `yarn build`
    2. manually run 'uglifyjs -mt' on 'build/packages/react/index.js' to
       simulate mistakenly minifying React before env variables are
       resolved, which skips dead code elimination.
    3. run the fixtures build - `cd fixtures/packaging && node
       ./build-all.js && serve ../..`
    4. Visit just the production browserify fixture -
       http://localhost:5000/fixtures/packaging/browserify/prod/
    5. You should see the error thrown indicating this problem has occurred.
    (Flarnie will insert a screenshot)
    6. Do the above steps with NO uglifyjs step, and verify that no error is
       thrown. When there is no minification applied, we don't assume that
       this mix-up has occurred.
    (Flarnie will insert a screenshot)
    
    **issue:**
    fixes #9589
    
    * Remove extra 'prod' env. check and add link to docs in error message
    
    **what is the change?:**
    Based on helpful feedback from @gaearon
    - removed outer check that `process.env.NODE_ENV` is "production" since
      we are only calling the `testMinification` method inside of another
      check for "production" environment.
    - Added an fburl that points to [our current docs on using the production version of React](https://facebook.github.io/react/docs/optimizing-performance.html#use-the-production-build)
    
    **why make this change?:**
    To save an extra layer of conditionals and to make the error message
    more clear.
    
    **test plan:**
    Same test plan as earlier -
    
    1. run the build in react as usual; yarn build
    2. manually run 'uglifyjs -mt' on 'build/packages/react/index.js' to
       simulate mistakenly minifying React before env variables are
       resolved, which skips dead code elimination.
    3. run the fixtures build - cd fixtures/packaging && node ./build-all.js && serve ../..
    4. Visit just the production browserify fixture -
       http://localhost:5000/fixtures/packaging/browserify/prod/
       You should see the error thrown indicating this problem has occurred.
       (Flarnie will insert a screenshot in comments on the PR)
    6. Do the above steps with NO uglifyjs step, and verify that no error is thrown. When there is no minification applied, we don't assume that this mix-up has occurred.
    (Flarnie will insert a screenshot in the comments on the PR.)
    
    **issue:**
    https://github.com/facebook/react/issues/9589
    
    * WIP fix and test 'testMinificationUsedDCE' method
    
    **what is the change?:**
    - Instead of looking for one match when having the method inspect it's
      own source, we look for two matches, because the search itself will be
      a match.
    - WIP moving this method into another file and testing it.
    
    Next steps:
    - Figure out why the babel.transform call is not actually minifying the
      code
    - Add tests for uglifyjs
    - Update build process so that this file can be accessed from
      `packages/react/index.js`
    
    **why make this change?:**
    - We had a bug in the 'testMinification' method, and I thought the name
      could be more clear. I fixed the code and also changed the name.
    - In order to avoid other bugs and keep this code working in the future
      we'd like to add a unit test for this method. Using the npm modules
      for 'uglifyjs' and 'babel'/'babili' we should be able to actually test
      how this method will work when minified with different configurations.
    
    **test plan:**
    `yarn test`
    
    **issue:**
    https://github.com/facebook/react/issues/9589
    
    * Add babeli and uglifyjs as dev-only dependencies
    
    **what is the change?:**
    See commit title
    
    **why make this change?:**
    In order to test that we are correctly detecting different minification
    situations, we are using these modules in a test.
    
    **test plan:**
    NA
    
    **issue:**
    https://github.com/facebook/react/issues/9589
    
    * Fix typo and add 'uglifyjs' tests
    
    **what is the change?:**
    There was a mix-up in the conditional in 'testMinificationUsedDCE' and
    this fixes it.
    
    The great new tests we added caught the typo. :)
    
    Next steps:
    - get the tests for 'babili' working
    - update build scripts so that this the 'testMinificationUsedDCE'
      module is available from 'packages/react/index.js'
    
    **why make this change?:**
    We want to modularize 'testMinificationUsedDCE' and test it.
    
    This verifies that the method warns when `uglifyjs` is used to minify
    but dead code elimination is not done, in a production environment.
    Generally this is a 'gotcha' which we want to warn folks aboug.
    
    **test plan:**
    `yarn test src/shared/utils/__tests__/testMinificationUsedDCE-test.js`
    
    **issue:**
    https://github.com/facebook/react/issues/9589
    
    * Run prettier
    
    * var -> const/let
    
    * Require specific version of `uglify-js`
    
    **what is the change?:**
    Removed the '^' from the npm package requirement
    
    **why make this change?:**
    I am seeing failures in CI that show `uglify-js` is returning different
    output there from my local environment. To further debug this I'd like
    to run CI with the exact same version of `uglify-js` that I am using
    locally.
    
    **test plan:**
    push and see what CI does
    
    **issue:**
    https://github.com/facebook/react/issues/9589
    
    * Add build step copying testMinificationUsedDCE into build/packages/react/cj
    
    **what is the change?:**
    This is a first step - we still need (I think) to process this file to
    get it's contents wrapped in an 'iffe'.
    
    Added a step to the build script which copies the source file for the
    'testMinificationUsedDCE' module into the 'cjs' directory of our react
    package build.
    
    **why make this change?:**
    We want this module to be available to the 'index.js' module in this
    build.
    
    **test plan:**
    Will do manual testing once the build stuff is fully set up.
    
    **issue:**
    
    * Inline 'testMinificationUsedDCE' and remove unit test for now
    
    What:
    - Inlines the 'testMinificationUsedDCE' method into
      'packages/react/index.js'
    - Removes unit test for 'testMinififcationUsedDCE'
    - Puts dependencies back the way that they were; should remove extra
      dependencies that were added for the unit test.
    
    Why:
    - It would add complexity to the build process to add another file to
      the 'build/packages/react/cjs' folder, and that is the only way to
      pull this out and test it. So instead we are inlining this.
    
    * Revert unintentional changes to dependency versions, variable placing
    
    **what is the change?:**
    - We had updated and added some dependencies, but ended up reverting
      this in a previous commit. The `yarn.lock` and `package.json` needed
      updated still though.
    - There is a call to `Function.toString` which we wanted to wrap in a
      `try/catch` block.
    
    **why make this change?:**
    To remove unrelated dependency changes and increase the safety of the
    `Function.toString` call.
    
    **test plan:**
    Manual testing again
    
    **issue:**
    https://github.com/facebook/react/issues/9589

diff --git a/packages/react/index.js b/packages/react/index.js
index 999ead7789..8d1da5d173 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -1,6 +1,50 @@
 'use strict';
 
+function testMinificationUsedDCE() {
+  if (process.env.NODE_ENV === 'development') {
+    // We expect this method only to be called in production.
+    throw new Error('This is unreachable');
+  }
+  try {
+    // use scoped variable for our initial test, in case
+    // 'top-level' mangling is not enabled.
+    const source = testMinificationUsedDCE.toString();
+    const longVariableName = true;
+    if (longVariableName && source.match(/longVariableName/g).length === 3) {
+      // We are not minified.
+      // This might be a Node environment where DCE is not expected anyway.
+      return;
+    }
+    if (source.match(/toString/g).length !== 2) {
+      // We always look for two matches:
+      // The actual occurence and then the call to 'match'
+      //
+      // We know for a fact the above line exists so there should be 2
+      // matches.
+      // Therefore the browser gave us invalid source.
+      return;
+    }
+    if (source.match(/unreachable/g).length === 2) {
+      // We always look for two matches:
+      // The actual occurence and then the call to 'match'
+
+      // Dead code elimination would have stripped that branch
+      // because it is impossible to reach in production.
+      setTimeout(function() {
+        // Ensure it gets reported to production logging
+        throw new Error(
+          'React is running in production mode, but dead code ' +
+            'elimination has not been applied. Read how to correctly ' +
+            'configure React for production: ' +
+            'https://fburl.com/react-perf-use-the-production-build'
+        );
+      });
+    }
+  } catch (e) {}
+}
+
 if (process.env.NODE_ENV === 'production') {
+  testMinificationUsedDCE();
   module.exports = require('./cjs/react.production.min.js');
 } else {
   module.exports = require('./cjs/react.development.js');

commit 16a39b8f02f7db9df16b64e41d145bd4f0cb250a
Author: Sophie Alpert <git@sophiebits.com>
Date:   Wed Sep 6 20:32:14 2017 -0700

    Remove "const" in uncompiled code (#10631)
    
    Test Plan: All fixtures/packaging iframes display correctly on Chrome 38.0.2125.0 from https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/290001/; previously several were blank with "Use of const in strict mode" errors logged to the console.

diff --git a/packages/react/index.js b/packages/react/index.js
index 8d1da5d173..d79f5d2d9b 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -8,8 +8,8 @@ function testMinificationUsedDCE() {
   try {
     // use scoped variable for our initial test, in case
     // 'top-level' mangling is not enabled.
-    const source = testMinificationUsedDCE.toString();
-    const longVariableName = true;
+    var source = testMinificationUsedDCE.toString();
+    var longVariableName = true;
     if (longVariableName && source.match(/longVariableName/g).length === 3) {
       // We are not minified.
       // This might be a Node environment where DCE is not expected anyway.

commit 61282d38d5172e5b2c4f1a29bb20d55ba4d727dc
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Mon Sep 11 19:22:41 2017 +0100

    Remove toString-based minification check (#10673)

diff --git a/packages/react/index.js b/packages/react/index.js
index d79f5d2d9b..999ead7789 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -1,50 +1,6 @@
 'use strict';
 
-function testMinificationUsedDCE() {
-  if (process.env.NODE_ENV === 'development') {
-    // We expect this method only to be called in production.
-    throw new Error('This is unreachable');
-  }
-  try {
-    // use scoped variable for our initial test, in case
-    // 'top-level' mangling is not enabled.
-    var source = testMinificationUsedDCE.toString();
-    var longVariableName = true;
-    if (longVariableName && source.match(/longVariableName/g).length === 3) {
-      // We are not minified.
-      // This might be a Node environment where DCE is not expected anyway.
-      return;
-    }
-    if (source.match(/toString/g).length !== 2) {
-      // We always look for two matches:
-      // The actual occurence and then the call to 'match'
-      //
-      // We know for a fact the above line exists so there should be 2
-      // matches.
-      // Therefore the browser gave us invalid source.
-      return;
-    }
-    if (source.match(/unreachable/g).length === 2) {
-      // We always look for two matches:
-      // The actual occurence and then the call to 'match'
-
-      // Dead code elimination would have stripped that branch
-      // because it is impossible to reach in production.
-      setTimeout(function() {
-        // Ensure it gets reported to production logging
-        throw new Error(
-          'React is running in production mode, but dead code ' +
-            'elimination has not been applied. Read how to correctly ' +
-            'configure React for production: ' +
-            'https://fburl.com/react-perf-use-the-production-build'
-        );
-      });
-    }
-  } catch (e) {}
-}
-
 if (process.env.NODE_ENV === 'production') {
-  testMinificationUsedDCE();
   module.exports = require('./cjs/react.production.min.js');
 } else {
   module.exports = require('./cjs/react.development.js');

commit d9c1dbd61772f8f8ab0cdf389e70463d704c480b
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Oct 19 00:22:21 2017 +0100

    Use Yarn Workspaces (#11252)
    
    * Enable Yarn workspaces for packages/*
    
    * Move src/isomorphic/* into packages/react/src/*
    
    * Create index.js stubs for all packages in packages/*
    
    This makes the test pass again, but breaks the build because npm/ folders aren't used yet.
    I'm not sure if we'll keep this structure--I'll just keep working and fix the build after it settles down.
    
    * Put FB entry point for react-dom into packages/*
    
    * Move src/renderers/testing/* into packages/react-test-renderer/src/*
    
    Note that this is currently broken because Jest ignores node_modules,
    and so Yarn linking makes Jest skip React source when transforming.
    
    * Remove src/node_modules
    
    It is now unnecessary. Some tests fail though.
    
    * Add a hacky workaround for Jest/Workspaces issue
    
    Jest sees node_modules and thinks it's third party code.
    
    This is a hacky way to teach Jest to still transform anything in node_modules/react*
    if it resolves outside of node_modules (such as to our packages/*) folder.
    
    I'm not very happy with this and we should revisit.
    
    * Add a fake react-native package
    
    * Move src/renderers/art/* into packages/react-art/src/*
    
    * Move src/renderers/noop/* into packages/react-noop-renderer/src/*
    
    * Move src/renderers/dom/* into packages/react-dom/src/*
    
    * Move src/renderers/shared/fiber/* into packages/react-reconciler/src/*
    
    * Move DOM/reconciler tests I previously forgot to move
    
    * Move src/renderers/native-*/* into packages/react-native-*/src/*
    
    * Move shared code into packages/shared
    
    It's not super clear how to organize this properly yet.
    
    * Add back files that somehow got lost
    
    * Fix the build
    
    * Prettier
    
    * Add missing license headers
    
    * Fix an issue that caused mocks to get included into build
    
    * Update other references to src/
    
    * Re-run Prettier
    
    * Fix lint
    
    * Fix weird Flow violation
    
    I didn't change this file but Flow started complaining.
    Caleb said this annotation was unnecessarily using $Abstract though so I removed it.
    
    * Update sizes
    
    * Fix stats script
    
    * Fix packaging fixtures
    
    Use file: instead of NODE_PATH since NODE_PATH.
    NODE_PATH trick only worked because we had no react/react-dom in root node_modules, but now we do.
    
    file: dependency only works as I expect in Yarn, so I moved the packaging fixtures to use Yarn and committed lockfiles.
    Verified that the page shows up.
    
    * Fix art fixture
    
    * Fix reconciler fixture
    
    * Fix SSR fixture
    
    * Rename native packages

diff --git a/packages/react/index.js b/packages/react/index.js
index 999ead7789..6fe57dc44d 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -1,7 +1,10 @@
+/**
+ * Copyright (c) 2013-present, Facebook, Inc.
+ *
+ * This source code is licensed under the MIT license found in the
+ * LICENSE file in the root directory of this source tree.
+ */
+
 'use strict';
 
-if (process.env.NODE_ENV === 'production') {
-  module.exports = require('./cjs/react.production.min.js');
-} else {
-  module.exports = require('./cjs/react.development.js');
-}
+module.exports = require('./src/ReactEntry');

commit 313611572b6567d229367ed20ff63d1bca8610bb
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Oct 19 19:50:24 2017 +0100

    Reorganize code structure (#11288)
    
    * Move files and tests to more meaningful places
    
    * Fix the build
    
    Now that we import reconciler via react-reconciler, I needed to make a few tweaks.
    
    * Update sizes
    
    * Move @preventMunge directive to FB header
    
    * Revert unintentional change
    
    * Fix Flow coverage
    
    I forgot to @flow-ify those files. This uncovered some issues.
    
    * Prettier, I love you but you're bringing me down
    Prettier, I love you but you're bringing me down
    
    Like a rat in a cage
    Pulling minimum wage
    Prettier, I love you but you're bringing me down
    
    Prettier, you're safer and you're wasting my time
    Our records all show you were filthy but fine
    But they shuttered your stores
    When you opened the doors
    To the cops who were bored once they'd run out of crime
    
    Prettier, you're perfect, oh, please don't change a thing
    Your mild billionaire mayor's now convinced he's a king
    So the boring collect
    I mean all disrespect
    In the neighborhood bars I'd once dreamt I would drink
    
    Prettier, I love you but you're freaking me out
    There's a ton of the twist but we're fresh out of shout
    Like a death in the hall
    That you hear through your wall
    Prettier, I love you but you're freaking me out
    
    Prettier, I love you but you're bringing me down
    Prettier, I love you but you're bringing me down
    Like a death of the heart
    Jesus, where do I start?
    But you're still the one pool where I'd happily drown
    
    And oh! Take me off your mailing list
    For kids who think it still exists
    Yes, for those who think it still exists
    Maybe I'm wrong and maybe you're right
    Maybe I'm wrong and maybe you're right
    Maybe you're right, maybe I'm wrong
    And just maybe you're right
    
    And oh! Maybe mother told you true
    And there'll always be somebody there for you
    And you'll never be alone
    But maybe she's wrong and maybe I'm right
    And just maybe she's wrong
    Maybe she's wrong and maybe I'm right
    And if so, here's this song!

diff --git a/packages/react/index.js b/packages/react/index.js
index 6fe57dc44d..778778e296 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -3,8 +3,10 @@
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE file in the root directory of this source tree.
+ *
+ * @flow
  */
 
 'use strict';
 
-module.exports = require('./src/ReactEntry');
+module.exports = require('./src/React');

commit 21d0c115238b4f38837020cf83e0c657d8c01c9f
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Nov 2 19:50:03 2017 +0000

    Convert the Source to ES Modules (#11389)
    
    * Update transforms to handle ES modules
    
    * Update Jest to handle ES modules
    
    * Convert react package to ES modules
    
    * Convert react-art package to ES Modules
    
    * Convert react-call-return package to ES Modules
    
    * Convert react-test-renderer package to ES Modules
    
    * Convert react-cs-renderer package to ES Modules
    
    * Convert react-rt-renderer package to ES Modules
    
    * Convert react-noop-renderer package to ES Modules
    
    * Convert react-dom/server to ES modules
    
    * Convert react-dom/{client,events,test-utils} to ES modules
    
    * Convert react-dom/shared to ES modules
    
    * Convert react-native-renderer to ES modules
    
    * Convert react-reconciler to ES modules
    
    * Convert events to ES modules
    
    * Convert shared to ES modules
    
    * Remove CommonJS support from transforms
    
    * Move ReactDOMFB entry point code into react-dom/src
    
    This is clearer because we can use ES imports in it.
    
    * Fix Rollup shim configuration to work with ESM
    
    * Fix incorrect comment
    
    * Exclude external imports without side effects
    
    * Fix ReactDOM FB build
    
    * Remove TODOs I donâ€™t intend to fix yet

diff --git a/packages/react/index.js b/packages/react/index.js
index 778778e296..5793d0669e 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -9,4 +9,8 @@
 
 'use strict';
 
-module.exports = require('./src/React');
+var React = require('./src/React');
+
+// TODO: decide on the top-level export form.
+// This is hacky but makes it work with both Rollup and Jest.
+module.exports = React.default ? React.default : React;

commit 3c977dea6b96f6a9bb39f09886848da870748441
Author: Raphael Amorim <rapha850@gmail.com>
Date:   Thu Nov 30 10:08:58 2017 -0200

    react: convert var to let/const (#11715)

diff --git a/packages/react/index.js b/packages/react/index.js
index 5793d0669e..2591bb0d23 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -9,7 +9,7 @@
 
 'use strict';
 
-var React = require('./src/React');
+const React = require('./src/React');
 
 // TODO: decide on the top-level export form.
 // This is hacky but makes it work with both Rollup and Jest.

commit 004cb21bbb5db92734f763b44419d0c4d071c873
Author: Joseph <jngugi88@gmail.com>
Date:   Mon Aug 20 14:29:40 2018 +0300

    Short circuit the logic for exporting a module (#13392)
    
    * short circuit some logic
    
    * revert back to ternary operator

diff --git a/packages/react/index.js b/packages/react/index.js
index 2591bb0d23..5caac3da85 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -13,4 +13,4 @@ const React = require('./src/React');
 
 // TODO: decide on the top-level export form.
 // This is hacky but makes it work with both Rollup and Jest.
-module.exports = React.default ? React.default : React;
+module.exports = React.default || React;

commit b87aabdfe1b7461e7331abb3601d9e6bb27544bc
Author: HÃ©ctor Ramos <165856+hramos@users.noreply.github.com>
Date:   Fri Sep 7 15:11:23 2018 -0700

    Drop the year from Facebook copyright headers and the LICENSE file. (#13593)

diff --git a/packages/react/index.js b/packages/react/index.js
index 5caac3da85..4268898c08 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -1,5 +1,5 @@
 /**
- * Copyright (c) 2013-present, Facebook, Inc.
+ * Copyright (c) Facebook, Inc. and its affiliates.
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE file in the root directory of this source tree.

commit 60016c448bb7d19fc989acd05dda5aca2e124381
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Tue Feb 25 13:54:27 2020 -0800

    Export React as Named Exports instead of CommonJS (#18106)
    
    * Add options for forked entry points
    
    We currently fork .fb.js entry points. This adds a few more options.
    
    .modern.fb.js - experimental FB builds
    .classic.fb.js - stable FB builds
    .fb.js - if no other FB build, use this for FB builds
    .experimental.js - experimental builds
    .stable.js - stable builds
    .js - used if no other override exists
    
    This will be used to have different ES exports for different builds.
    
    * Switch React to named exports
    
    * Export named exports from the export point itself
    
    We need to re-export the Flow exported types so we can use them in our code.
    
    We don't want to use the Flow types from upstream since it doesn't have the non-public APIs that we have.
    
    This should be able to use export * but I don't know why it doesn't work.
    
    This actually enables Flow typing of React which was just "any" before.
    This exposed some Flow errors that needs fixing.
    
    * Create forks for the react entrypoint
    
    None of our builds expose all exports and they all differ in at least one
    way, so we need four forks.
    
    * Set esModule flag to false
    
    We don't want to emit the esModule compatibility flag on our CommonJS
    output. For now we treat our named exports as if they're CommonJS.
    
    This is a potentially breaking change for scheduler (but all those apis
    are unstable), react-is and use-subscription. However, it seems unlikely
    that anyone would rely on this since these only have named exports.
    
    * Remove unused Feature Flags
    
    * Let jest observe the stable fork for stable tests
    
    This lets it do the negative test by ensuring that the right tests fail.
    
    However, this in turn will make other tests that are not behind
    __EXPERIMENTAL__ fail. So I need to do that next.
    
    * Put all tests that depend on exports behind __EXPERIMENTAL__
    
    Since there's no way to override the exports using feature flags
    in .intern.js anymore we can't use these APIs in stable.
    
    The tradeoff here is that we can either enable the negative tests on
    "stable" that means experimental are expected to fail, or we can disable
    tests on stable. This is unfortunate since some of these APIs now run on
    a "stable" config at FB instead of the experimental.
    
    * Switch ReactDOM to named exports
    
    Same strategy as React.
    
    I moved the ReactDOMFB runtime injection to classic.fb.js
    
    Since we only fork the entrypoint, the `/testing` entrypoint needs to
    be forked too to re-export the same things plus `act`. This is a bit
    unfortunate. If it becomes a pattern we can consider forking in the
    module resolution deeply.
    
    fix flow
    
    * Fix ReactDOM Flow Types
    
    Now that ReactDOM is Flow type checked we need to fix up its types.
    
    * Configure jest to use stable entry for ReactDOM in non-experimental
    
    * Remove additional FeatureFlags that are no longer needed
    
    These are only flagging the exports and no implementation details so we
    can control them fully through the export overrides.

diff --git a/packages/react/index.js b/packages/react/index.js
index 4268898c08..c0dd6bbdb3 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -7,10 +7,74 @@
  * @flow
  */
 
-'use strict';
+// Keep in sync with https://github.com/facebook/flow/blob/master/lib/react.js
+export type StatelessFunctionalComponent<
+  P,
+> = React$StatelessFunctionalComponent<P>;
+export type ComponentType<-P> = React$ComponentType<P>;
+export type AbstractComponent<
+  -Config,
+  +Instance = mixed,
+> = React$AbstractComponent<Config, Instance>;
+export type ElementType = React$ElementType;
+export type Element<+C> = React$Element<C>;
+export type Key = React$Key;
+export type Ref<C> = React$Ref<C>;
+export type Node = React$Node;
+export type Context<T> = React$Context<T>;
+export type Portal = React$Portal;
+export type ElementProps<C> = React$ElementProps<C>;
+export type ElementConfig<C> = React$ElementConfig<C>;
+export type ElementRef<C> = React$ElementRef<C>;
+export type Config<Props, DefaultProps> = React$Config<Props, DefaultProps>;
+export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
+export type Interaction = {
+  name: string,
+  timestamp: number,
+  ...
+};
 
-const React = require('./src/React');
-
-// TODO: decide on the top-level export form.
-// This is hacky but makes it work with both Rollup and Jest.
-module.exports = React.default || React;
+// Export all exports so that they're available in tests.
+// We can't use export * from in Flow for some reason.
+export {
+  Children,
+  createRef,
+  Component,
+  PureComponent,
+  createContext,
+  forwardRef,
+  lazy,
+  memo,
+  useCallback,
+  useContext,
+  useEffect,
+  useImperativeHandle,
+  useDebugValue,
+  useLayoutEffect,
+  useMemo,
+  useReducer,
+  useRef,
+  useState,
+  Fragment,
+  Profiler,
+  StrictMode,
+  Suspense,
+  createElement,
+  cloneElement,
+  isValidElement,
+  version,
+  __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,
+  createFactory,
+  useTransition,
+  useDeferredValue,
+  SuspenseList,
+  unstable_withSuspenseConfig,
+  block,
+  DEPRECATED_useResponder,
+  DEPRECATED_createResponder,
+  unstable_createFundamental,
+  unstable_createScope,
+  jsx,
+  jsxs,
+  jsxDEV,
+} from './src/React';

commit 322cdcd3abfaca985a001a12247f02c5d31d311e
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed Mar 11 12:34:39 2020 -0700

    useMutableSource hook (#18000)
    
    useMutableSource hook
    
    useMutableSource() enables React components to safely and efficiently read from a mutable external source in Concurrent Mode. The API will detect mutations that occur during a render to avoid tearing and it will automatically schedule updates when the source is mutated.
    
    RFC: reactjs/rfcs#147

diff --git a/packages/react/index.js b/packages/react/index.js
index c0dd6bbdb3..d139aa877d 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -55,6 +55,8 @@ export {
   useReducer,
   useRef,
   useState,
+  useMutableSource,
+  createMutableSource,
   Fragment,
   Profiler,
   StrictMode,

commit 90f8fe6f5509cab7d6d280b4ed17181697f394e9
Author: Luna Ruan <luna@fb.com>
Date:   Tue Mar 17 13:22:19 2020 -0700

    add jsx-runtime and jsx-dev-runtime (#18299)
    
    This PR adds the jsx-runtime and jsx-dev-runtime modules for the JSX Babel Plugin. WWW still relies on jsx/jsxs/jsxDEV from the "react" module, so once we refactor the code to point to the runtime modules we will remove jsx/jsxs/jsxDEV from the "react" module.

diff --git a/packages/react/index.js b/packages/react/index.js
index d139aa877d..f97dd1fc0c 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -76,7 +76,4 @@ export {
   DEPRECATED_createResponder,
   unstable_createFundamental,
   unstable_createScope,
-  jsx,
-  jsxs,
-  jsxDEV,
 } from './src/React';

commit 3278d242184a13add3f25f683b77ef9a6a2305f3
Author: Luna Ruan <luna@fb.com>
Date:   Mon Apr 6 17:17:27 2020 -0700

    Add useOpaqueIdentifier Hook (#17322)
    
    * Add useOpaqueIdentifier Hook
    
    We currently use unique IDs in a lot of places. Examples are:
      * `<label for="ID">`
      * `aria-labelledby`
    
    This can cause some issues:
      1. If we server side render and then hydrate, this could cause an
         hydration ID mismatch
      2. If we server side render one part of the page and client side
         render another part of the page, the ID for one part could be
         different than the ID for another part even though they are
         supposed to be the same
      3. If we conditionally render something with an ID ,  this might also
         cause an ID mismatch because the ID will be different on other
         parts of the page
    
    This PR creates a new hook `useUniqueId` that generates a different
    unique ID based on whether the hook was called on the server or client.
    If the hook is called during hydration, it generates an opaque object
    that will rerender the hook so that the IDs match.
    
    Co-authored-by: Andrew Clark <git@andrewclark.io>

diff --git a/packages/react/index.js b/packages/react/index.js
index f97dd1fc0c..3ca22840f9 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -76,4 +76,5 @@ export {
   DEPRECATED_createResponder,
   unstable_createFundamental,
   unstable_createScope,
+  unstable_useOpaqueIdentifier,
 } from './src/React';

commit 22dc2e42bdc00d87fc19c5e75fc7c0b3fdcdc572
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed Apr 15 19:10:15 2020 -0700

    Add experimental DebugTracing logger for internal use (#18531)

diff --git a/packages/react/index.js b/packages/react/index.js
index 3ca22840f9..d3fa1b145f 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -59,6 +59,7 @@ export {
   createMutableSource,
   Fragment,
   Profiler,
+  unstable_DebugTracingMode,
   StrictMode,
   Suspense,
   createElement,

commit fe7163e73dadceda2655736d97cdd745d7abc8ea
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon May 4 22:25:41 2020 -0700

    Add unstable prefix to experimental APIs (#18825)
    
    We've been shipping unprefixed experimental APIs (like `createRoot` and
    `useTransition`) to the Experimental release channel, with the rationale
    that because these APIs do not appear in any stable release, we're free
    to change or remove them later without breaking any downstream projects.
    
    What we didn't consider is that downstream projects might be tempted to
    use feature detection:
    
    ```js
    const useTransition = React.useTransition || fallbackUseTransition;
    ```
    
    This pattern assumes that the version of `useTransition` that exists in
    the Experimental channel today has the same API contract as the final
    `useTransition` API that we'll eventually ship to stable.
    
    To discourage feature detection, I've added an `unstable_` prefix to
    all of our unstable APIs.
    
    The Facebook builds still have the unprefixed APIs, though. We will
    continue to support those; if we make any breaking changes, we'll
    migrate the internal callers like we usually do. To make testing easier,
    I added the `unstable_`-prefixed APIs to the www builds, too. That way
    our tests can always use the prefixed ones without gating on the
    release channel.

diff --git a/packages/react/index.js b/packages/react/index.js
index d3fa1b145f..4cd2d761fb 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -69,10 +69,14 @@ export {
   __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,
   createFactory,
   useTransition,
+  useTransition as unstable_useTransition,
   useDeferredValue,
+  useDeferredValue as unstable_useDeferredValue,
   SuspenseList,
+  SuspenseList as unstable_SuspenseList,
   unstable_withSuspenseConfig,
   block,
+  block as unstable_block,
   DEPRECATED_useResponder,
   DEPRECATED_createResponder,
   unstable_createFundamental,

commit 8b9c4d1688333865e702fcd65ad2ab7d83b3c33c
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon May 11 20:02:08 2020 -0700

    Expose LegacyHidden type and disable <div hidden /> API in new fork (#18891)
    
    * Expose LegacyHidden type
    
    I will use this internally at Facebook to migrate away from
    <div hidden />. The end goal is to migrate to the Offscreen type, but
    that has different semantics. This is an incremental step.
    
    * Disable <div hidden /> API in new fork
    
    Migrates to the unstable_LegacyHidden type instead. The old fork does
    not support the new component type, so I updated the tests to use an
    indirection that picks the correct API. I will remove this once the
    LegacyHidden (and/or Offscreen) type has landed in both implementations.
    
    * Add gated warning for `<div hidden />` API
    
    Only exists so we can detect callers in www and migrate them to the new
    API. Should not visible to anyone outside React Core team.

diff --git a/packages/react/index.js b/packages/react/index.js
index 4cd2d761fb..c30ed85e69 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -77,6 +77,7 @@ export {
   unstable_withSuspenseConfig,
   block,
   block as unstable_block,
+  unstable_LegacyHidden,
   DEPRECATED_useResponder,
   DEPRECATED_createResponder,
   unstable_createFundamental,

commit 9102719baacb64738e9235bc80d3d7d9918cc74c
Author: Dominic Gannaway <trueadm@users.noreply.github.com>
Date:   Thu Jul 16 16:21:21 2020 +0100

    Tidy up React Scope API (#19352)

diff --git a/packages/react/index.js b/packages/react/index.js
index c30ed85e69..4568c5df56 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -81,6 +81,6 @@ export {
   DEPRECATED_useResponder,
   DEPRECATED_createResponder,
   unstable_createFundamental,
-  unstable_createScope,
+  unstable_Scope,
   unstable_useOpaqueIdentifier,
 } from './src/React';

commit 5227a37868c4bf3133ba5f2b3b39cac9175d7ea9
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Jul 28 12:38:13 2020 -0400

    Add "unstable_" prefix to experimental mutable source APIs (#19472)
    
    * Add "unstbale_" prefix to mutable source APIs
    
    * DebugHooks no longer calls useMutableSource() on init
    
    This was causing an observable behavioral difference between experimental DEV and PROD builds.
    
    We don't initialize stack position for other composite hooks (e.g. useDeferredValue, useTransition, useOpaqueIdentifier). If we did, it would cause the same obesrvable behavioral difference.

diff --git a/packages/react/index.js b/packages/react/index.js
index 4568c5df56..1dd97db59c 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -56,7 +56,9 @@ export {
   useRef,
   useState,
   useMutableSource,
+  useMutableSource as unstable_useMutableSource,
   createMutableSource,
+  createMutableSource as unstable_createMutableSource,
   Fragment,
   Profiler,
   unstable_DebugTracingMode,

commit b61174fb7b09580c1ec2a8f55e73204b706d2935
Author: Dominic Gannaway <trueadm@users.noreply.github.com>
Date:   Wed Aug 5 15:13:29 2020 +0100

    Remove the deprecated React Flare event system (#19520)

diff --git a/packages/react/index.js b/packages/react/index.js
index 1dd97db59c..a02725917e 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -80,8 +80,6 @@ export {
   block,
   block as unstable_block,
   unstable_LegacyHidden,
-  DEPRECATED_useResponder,
-  DEPRECATED_createResponder,
   unstable_createFundamental,
   unstable_Scope,
   unstable_useOpaqueIdentifier,

commit 5564f2c95bb61b446f93dc5c519740bdb39e1989
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Wed Aug 26 11:34:17 2020 -0400

    Add React.startTransition (#19696)
    
    * Add React.startTransition
    
    * Export startTransition from index.js as well

diff --git a/packages/react/index.js b/packages/react/index.js
index a02725917e..ebbb6cf42e 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -72,6 +72,8 @@ export {
   createFactory,
   useTransition,
   useTransition as unstable_useTransition,
+  startTransition,
+  startTransition as unstable_startTransition,
   useDeferredValue,
   useDeferredValue as unstable_useDeferredValue,
   SuspenseList,

commit 1f38dcff67d12828be771403e183652f5e93909a
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon Aug 31 11:16:49 2020 -0500

    Remove withSuspenseConfig (#19724)
    
    Removes `withSuspenseConfig` and migrates relevant tests to
    `startTransition` instead.
    
    We only had one caller in www, which I've removed.

diff --git a/packages/react/index.js b/packages/react/index.js
index ebbb6cf42e..9fd5ccfbf3 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -78,7 +78,6 @@ export {
   useDeferredValue as unstable_useDeferredValue,
   SuspenseList,
   SuspenseList as unstable_SuspenseList,
-  unstable_withSuspenseConfig,
   block,
   block as unstable_block,
   unstable_LegacyHidden,

commit 56e9feead0f91075ba0a4f725c9e4e343bca1c67
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Sat Oct 31 02:03:45 2020 -0400

    Remove Blocks (#20138)
    
    * Remove Blocks
    
    * Remove Flight Server Runtime
    
    There's no need for this now that the JSResource is part of the bundler
    protocol. Might need something for Webpack plugin specifically later.
    
    * Devtools

diff --git a/packages/react/index.js b/packages/react/index.js
index 9fd5ccfbf3..5a170667c0 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -78,8 +78,6 @@ export {
   useDeferredValue as unstable_useDeferredValue,
   SuspenseList,
   SuspenseList as unstable_SuspenseList,
-  block,
-  block as unstable_block,
   unstable_LegacyHidden,
   unstable_createFundamental,
   unstable_Scope,

commit e23673b511a2eab6ddcb848a4150105c954f289a
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Dec 3 03:44:56 2020 +0000

    [Flight] Add getCacheForType() to the dispatcher (#20315)
    
    * Remove react/unstable_cache
    
    We're probably going to make it available via the dispatcher. Let's remove this for now.
    
    * Add readContext() to the dispatcher
    
    On the server, it will be per-request.
    
    On the client, there will be some way to shadow it.
    
    For now, I provide it on the server, and throw on the client.
    
    * Use readContext() from react-fetch
    
    This makes it work on the server (but not on the client until we implement it there.)
    
    Updated the test to use Server Components. Now it passes.
    
    * Fixture: Add fetch from a Server Component
    
    * readCache -> getCacheForType<T>
    
    * Add React.unstable_getCacheForType
    
    * Add a feature flag
    
    * Fix Flow
    
    * Add react-suspense-test-utils and port tests
    
    * Remove extra Map lookup
    
    * Unroll async/await because build system
    
    * Add some error coverage and retry
    
    * Add unstable_getCacheForType to Flight entry

diff --git a/packages/react/index.js b/packages/react/index.js
index 5a170667c0..1553bdd9e9 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -82,4 +82,5 @@ export {
   unstable_createFundamental,
   unstable_Scope,
   unstable_useOpaqueIdentifier,
+  unstable_getCacheForType,
 } from './src/React';

commit efc57e5cbbd618f3c98d941c48eec859026c2dcb
Author: Andrew Clark <git@andrewclark.io>
Date:   Fri Dec 18 12:57:24 2020 -0600

    Add built-in Suspense cache with support for invalidation (refreshing) (#20456)

diff --git a/packages/react/index.js b/packages/react/index.js
index 1553bdd9e9..80e6591171 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -83,4 +83,6 @@ export {
   unstable_Scope,
   unstable_useOpaqueIdentifier,
   unstable_getCacheForType,
+  unstable_Cache,
+  unstable_useCacheRefresh,
 } from './src/React';

commit 4ecf11977c46966d3deedcdc71f1280a34607d1d
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Fri Feb 5 20:36:55 2021 +0000

    Remove the Fundamental internals (#20745)

diff --git a/packages/react/index.js b/packages/react/index.js
index 80e6591171..5319bb80be 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -79,7 +79,6 @@ export {
   SuspenseList,
   SuspenseList as unstable_SuspenseList,
   unstable_LegacyHidden,
-  unstable_createFundamental,
   unstable_Scope,
   unstable_useOpaqueIdentifier,
   unstable_getCacheForType,

commit fc33f12bdee1d0ffbcc83d25199cdf4d47252736
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Mon Apr 26 19:16:18 2021 -0400

    Remove unstable scheduler/tracing API (#20037)

diff --git a/packages/react/index.js b/packages/react/index.js
index 5319bb80be..094d0fcd23 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -28,11 +28,6 @@ export type ElementConfig<C> = React$ElementConfig<C>;
 export type ElementRef<C> = React$ElementRef<C>;
 export type Config<Props, DefaultProps> = React$Config<Props, DefaultProps>;
 export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
-export type Interaction = {
-  name: string,
-  timestamp: number,
-  ...
-};
 
 // Export all exports so that they're available in tests.
 // We can't use export * from in Flow for some reason.

commit 2bf4805e4bd63dab45cd7f5e1ad32ef8fed3f6ab
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed May 12 11:28:14 2021 -0400

    Update entry point exports (#21488)
    
    The following APIs have been added to the `react` stable entry point:
    * `SuspenseList`
    * `startTransition`
    * `unstable_createMutableSource`
    * `unstable_useMutableSource`
    * `useDeferredValue`
    * `useTransition`
    
    The following APIs have been added or removed from the `react-dom` stable entry point:
    * `createRoot`
    * `unstable_createPortal` (removed)
    
    The following APIs have been added to the `react-is` stable entry point:
    * `SuspenseList`
    * `isSuspenseList`
    
    The following feature flags have been changed from experimental to true:
    * `enableLazyElements`
    * `enableSelectiveHydration`
    * `enableSuspenseServerRenderer`

diff --git a/packages/react/index.js b/packages/react/index.js
index 094d0fcd23..bc77959248 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -32,51 +32,45 @@ export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
 // Export all exports so that they're available in tests.
 // We can't use export * from in Flow for some reason.
 export {
+  __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,
   Children,
-  createRef,
   Component,
+  Fragment,
+  Profiler,
   PureComponent,
+  StrictMode,
+  Suspense,
+  SuspenseList,
+  cloneElement,
   createContext,
+  createElement,
+  createFactory,
+  createMutableSource,
+  createRef,
   forwardRef,
+  isValidElement,
   lazy,
   memo,
+  startTransition,
+  unstable_Cache,
+  unstable_DebugTracingMode,
+  unstable_LegacyHidden,
+  unstable_Scope,
+  unstable_getCacheForType,
+  unstable_useCacheRefresh,
+  unstable_useOpaqueIdentifier,
   useCallback,
   useContext,
+  useDebugValue,
+  useDeferredValue,
   useEffect,
   useImperativeHandle,
-  useDebugValue,
   useLayoutEffect,
   useMemo,
+  useMutableSource,
   useReducer,
   useRef,
   useState,
-  useMutableSource,
-  useMutableSource as unstable_useMutableSource,
-  createMutableSource,
-  createMutableSource as unstable_createMutableSource,
-  Fragment,
-  Profiler,
-  unstable_DebugTracingMode,
-  StrictMode,
-  Suspense,
-  createElement,
-  cloneElement,
-  isValidElement,
-  version,
-  __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,
-  createFactory,
   useTransition,
-  useTransition as unstable_useTransition,
-  startTransition,
-  startTransition as unstable_startTransition,
-  useDeferredValue,
-  useDeferredValue as unstable_useDeferredValue,
-  SuspenseList,
-  SuspenseList as unstable_SuspenseList,
-  unstable_LegacyHidden,
-  unstable_Scope,
-  unstable_useOpaqueIdentifier,
-  unstable_getCacheForType,
-  unstable_Cache,
-  unstable_useCacheRefresh,
+  version,
 } from './src/React';

commit e16d61c3000e2de6217d06b9afad162e883f73c4
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Jun 1 15:46:08 2021 -0400

    [Offscreen] Mount/unmount layout effects (#21386)
    
    * [Offscreen] Mount/unmount layout effects
    
    Exposes the Offscreen component type and implements basic support for
    mount/unmounting layout effects when the visibility is toggled.
    
    Mostly it works the same way as hidden Suspense trees, which use the
    same internal fiber type. I had to add an extra bailout, though, that
    doesn't apply to the Suspense case but does apply to Offscreen
    components: a hidden Offscreen tree will eventually render at low
    priority, and when we it does, its `subtreeTag` will have effects
    scheduled on it. So I added a check to the layout phase where, if the
    subtree is hidden, we skip over the subtree entirely. An alternate
    design would be to clear the subtree flags in the render phase, but I
    prefer doing it this way since it's harder to mess up.
    
    We also need an API to enable the same thing for passive effects. This
    is not yet implemented.
    
    * Add test starting from hidden
    
    Co-authored-by: Rick Hanlon <rickhanlonii@gmail.com>

diff --git a/packages/react/index.js b/packages/react/index.js
index bc77959248..59e76eff92 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -55,6 +55,7 @@ export {
   unstable_Cache,
   unstable_DebugTracingMode,
   unstable_LegacyHidden,
+  unstable_Offscreen,
   unstable_Scope,
   unstable_getCacheForType,
   unstable_useCacheRefresh,

commit 06f7b4f43a93eae9111cfbd972ab1ae1148f6afb
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Jun 22 17:25:07 2021 -0400

    `act` should work without mock Scheduler (#21714)
    
    Currently, in a React 18 root, `act` only works if you mock the
    Scheduler package. This was because we didn't want to add additional
    checks at runtime.
    
    But now that the `act` testing API is dev-only, we can simplify its
    implementation.
    
    Now when an update is wrapped with `act`, React will bypass Scheduler
    entirely and push its tasks onto a special internal queue. Then, when
    the outermost `act` scope exists, we'll flush that queue.
    
    I also removed the "wrong act" warning, because the plan is to move
    `act` to an isomorphic entry point, simlar to `startTransition`. That's
    not directly related to this PR, but I didn't want to bother
    re-implementing that warning only to immediately remove it.
    
    I'll add the isomorphic API in a follow up.
    
    Note that the internal version of `act` that we use in our own tests
    still depends on mocking the Scheduler package, because it needs to work
    in production. I'm planning to move that implementation to a shared
    (internal) module, too.

diff --git a/packages/react/index.js b/packages/react/index.js
index 59e76eff92..247d17ec01 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -33,6 +33,7 @@ export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
 // We can't use export * from in Flow for some reason.
 export {
   __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,
+  act as unstable_act,
   Children,
   Component,
   Fragment,

commit d483463bc86555decb3e8caa18459d1d0f7c0148
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Jun 29 14:26:24 2021 -0400

    Updated scripts and config to replace "master" with "main" branch (#21768)

diff --git a/packages/react/index.js b/packages/react/index.js
index 247d17ec01..890b060847 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -7,7 +7,7 @@
  * @flow
  */
 
-// Keep in sync with https://github.com/facebook/flow/blob/master/lib/react.js
+// Keep in sync with https://github.com/facebook/flow/blob/main/lib/react.js
 export type StatelessFunctionalComponent<
   P,
 > = React$StatelessFunctionalComponent<P>;

commit 464f275724ab11e3b55ea753bc4aee6700399332
Author: Ehsan Hosseini <53467610+e-hosseini@users.noreply.github.com>
Date:   Tue Jul 13 16:55:54 2021 +0200

    Update link to flow (#21862)
    
    `main` branch does not exist in the `flow` project and it is `master`.
    
    Co-authored-by: Ehsan Hosseini <53467610+dh-hosseini@users.noreply.github.com>

diff --git a/packages/react/index.js b/packages/react/index.js
index 890b060847..247d17ec01 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -7,7 +7,7 @@
  * @flow
  */
 
-// Keep in sync with https://github.com/facebook/flow/blob/main/lib/react.js
+// Keep in sync with https://github.com/facebook/flow/blob/master/lib/react.js
 export type StatelessFunctionalComponent<
   P,
 > = React$StatelessFunctionalComponent<P>;

commit 77912d9a05d7a90287fabdec76486f25869b2981
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Sep 7 13:20:24 2021 -0400

    Wire up the native API for useSyncExternalStore (#22237)
    
    Adds useSyncExternalStore to the internal dispatcher, and exports
    the native API from the React package without yet implementing it.

diff --git a/packages/react/index.js b/packages/react/index.js
index 247d17ec01..c2285c6b0b 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -70,6 +70,8 @@ export {
   useLayoutEffect,
   useMemo,
   useMutableSource,
+  useSyncExternalStore,
+  useSyncExternalStore as unstable_useSyncExternalStore,
   useReducer,
   useRef,
   useState,

commit 86c7ca70a9965c18e504cafc24753c1edbe36749
Author: Konstantin Popov <konst.hardy@gmail.com>
Date:   Sun Sep 12 18:09:53 2021 +0300

    Fix link (#22296)
    
    Fix link (branch master was renamed to main):
    
    master -> main

diff --git a/packages/react/index.js b/packages/react/index.js
index c2285c6b0b..0acb8d9fa9 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -7,7 +7,7 @@
  * @flow
  */
 
-// Keep in sync with https://github.com/facebook/flow/blob/master/lib/react.js
+// Keep in sync with https://github.com/facebook/flow/blob/main/lib/react.js
 export type StatelessFunctionalComponent<
   P,
 > = React$StatelessFunctionalComponent<P>;

commit 263cfa6ecb9879ecb629d4e04a8c26422b4c4ff9
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Sep 14 10:27:09 2021 -0400

    [Experimental] Add useInsertionEffect (#21913)

diff --git a/packages/react/index.js b/packages/react/index.js
index 0acb8d9fa9..1b4552a90f 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -67,6 +67,7 @@ export {
   useDeferredValue,
   useEffect,
   useImperativeHandle,
+  unstable_useInsertionEffect,
   useLayoutEffect,
   useMemo,
   useMutableSource,

commit 8209de269531767b33d8db26eda41db38bfb6a27
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon Sep 20 00:11:50 2021 -0400

    Delete useMutableSource implementation (#22292)
    
    This API was replaced by useSyncExternalStore

diff --git a/packages/react/index.js b/packages/react/index.js
index 1b4552a90f..17916a322b 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -46,7 +46,6 @@ export {
   createContext,
   createElement,
   createFactory,
-  createMutableSource,
   createRef,
   forwardRef,
   isValidElement,
@@ -70,7 +69,6 @@ export {
   unstable_useInsertionEffect,
   useLayoutEffect,
   useMemo,
-  useMutableSource,
   useSyncExternalStore,
   useSyncExternalStore as unstable_useSyncExternalStore,
   useReducer,

commit 82c8fa90be86fc0afcbff2dc39486579cff1ac9a
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Sep 21 23:38:24 2021 -0400

    Add back useMutableSource temporarily (#22396)
    
    Recoil uses useMutableSource behind a flag. I thought this was fine
    because Recoil isn't used in any concurrent roots, so the behavior
    would be the same, but it turns out that it is used by concurrent
    roots in a few places.
    
    I'm not expecting it to be hard to migrate to useSyncExternalStore, but
    to de-risk the change I'm going to roll it out gradually with a flag. In
    the meantime, I've added back the useMutableSource API.

diff --git a/packages/react/index.js b/packages/react/index.js
index 17916a322b..1b4552a90f 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -46,6 +46,7 @@ export {
   createContext,
   createElement,
   createFactory,
+  createMutableSource,
   createRef,
   forwardRef,
   isValidElement,
@@ -69,6 +70,7 @@ export {
   unstable_useInsertionEffect,
   useLayoutEffect,
   useMemo,
+  useMutableSource,
   useSyncExternalStore,
   useSyncExternalStore as unstable_useSyncExternalStore,
   useReducer,

commit 02f411578a8e58af8ec28e385f6b0dcb768cdc41
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Oct 19 17:32:54 2021 -0400

    Upgrade useInsertionEffect to stable (#22589)
    
    @huozhi tried this out and says it's working as expected. I think we
    can go ahead and move this into the stable channel, so that it is
    available in the React 18 alpha releases.

diff --git a/packages/react/index.js b/packages/react/index.js
index 1b4552a90f..b4a3bf6e11 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -67,7 +67,7 @@ export {
   useDeferredValue,
   useEffect,
   useImperativeHandle,
-  unstable_useInsertionEffect,
+  useInsertionEffect,
   useLayoutEffect,
   useMemo,
   useMutableSource,

commit fa9bea0c41ccfef5b528ef9b5517607f9f94c52a
Author: Joseph Savona <joesavona@fb.com>
Date:   Thu Oct 21 14:11:42 2021 -0700

    Initial implementation of cache cleanup (#22510)
    
    This is an initial, partial implementation of a cleanup mechanism for the experimental Cache API. The idea is that consumers of the Cache API can register to be informed when a given Cache instance is no longer needed so that they can perform associated cleanup tasks to free resources stored in the cache. A canonical example would be cancelling pending network requests.
    
    An overview of the high-level changes:
    
    * Changes the `Cache` type from a Map of cache instances to be an object with the original Map of instances, a reference count (to count roughly "active references" to the cache instances - more below), and an AbortController.
    * Adds a new public API, `unstable_getCacheSignal(): AbortSignal`, which is callable during render. It returns an AbortSignal tied to the lifetime of the cache - developers can listen for the 'abort' event on the signal, which React now triggers when a given cache instance is no longer referenced.
      * Note that `AbortSignal` is a web standard that is supported by other platform APIs; for example a signal can be passed to `fetch()` to trigger cancellation of an HTTP request.
    * Implements the above - triggering the 'abort' event - by handling passive mount/unmount for HostRoot and CacheComponent fiber nodes.
    
    Cases handled:
    * Aborted transitions: we clean up a new cache created for an aborted transition
    * Suspense: we retain a fresh cache instance until a suspended tree resolves
    
    For follow-ups:
    * When a subsequent cache refresh is issued before a previous refresh completes, the refreshes are queued. Fresh cache instances for previous refreshes in the queue should be cleared, retaining only the most recent cache. I plan to address this in a follow-up PR.
    * If a refresh is cancelled, the fresh cache should be cleaned up.

diff --git a/packages/react/index.js b/packages/react/index.js
index b4a3bf6e11..59cc05f025 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -58,6 +58,7 @@ export {
   unstable_LegacyHidden,
   unstable_Offscreen,
   unstable_Scope,
+  unstable_getCacheSignal,
   unstable_getCacheForType,
   unstable_useCacheRefresh,
   unstable_useOpaqueIdentifier,

commit 6bce0355c3e4bf23c16e82317094230908ee7560
Author: Andrew Clark <git@andrewclark.io>
Date:   Sun Oct 31 18:38:03 2021 -0400

    Upgrade useSyncExternalStore to alpha channel (#22662)
    
    * Move useSyncExternalStore shim to a nested entrypoint
    
    Also renames `useSyncExternalStoreExtra` to
    `useSyncExternalStoreWithSelector`.
    
    - 'use-sync-external-store/shim' -> A shim for `useSyncExternalStore`
      that works in React 16 and 17 (any release that supports hooks). The
      module will first check if the built-in React API exists, before
      falling back to the shim.
    - 'use-sync-external-store/with-selector' -> An extended version of
      `useSyncExternalStore` that also supports `selector` and `isEqual`
      options. It does _not_ shim `use-sync-external-store`; it composes the
      built-in React API. **Use this if you only support 18+.**
    - 'use-sync-external-store/shim/with-selector' -> Same API, but it
      composes `use-sync-external-store/shim` instead. **Use this for
      compatibility with 16 and 17.**
    - 'use-sync-external-store' -> Re-exports React's built-in API. Not
      meant to be used. It will warn and direct users to either the shim or
      the built-in API.
    
    * Upgrade useSyncExternalStore to alpha channel

diff --git a/packages/react/index.js b/packages/react/index.js
index 59cc05f025..9a6a99ee52 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -73,7 +73,6 @@ export {
   useMemo,
   useMutableSource,
   useSyncExternalStore,
-  useSyncExternalStore as unstable_useSyncExternalStore,
   useReducer,
   useRef,
   useState,

commit ebf9ae8579230e7b1ed0b1d243e1cf802f56938b
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon Nov 1 16:30:44 2021 -0400

    useId (#22644)
    
    * Add useId to dispatcher
    
    * Initial useId implementation
    
    Ids are base 32 strings whose binary representation corresponds to the
    position of a node in a tree.
    
    Every time the tree forks into multiple children, we add additional bits
    to the left of the sequence that represent the position of the child
    within the current level of children.
    
        00101       00010001011010101
        â•°â”€â”¬â”€â•¯       â•°â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â•¯
      Fork 5 of 20       Parent id
    
    The leading 0s are important. In the above example, you only need 3 bits
    to represent slot 5. However, you need 5 bits to represent all the forks
    at the current level, so we must account for the empty bits at the end.
    
    For this same reason, slots are 1-indexed instead of 0-indexed.
    Otherwise, the zeroth id at a level would be indistinguishable from
    its parent.
    
    If a node has only one child, and does not materialize an id (i.e. does
    not contain a useId hook), then we don't need to allocate any space in
    the sequence. It's treated as a transparent indirection. For example,
    these two trees produce the same ids:
    
    <>                          <>
      <Indirection>               <A />
        <A />                     <B />
      </Indirection>            </>
      <B />
    </>
    
    However, we cannot skip any materializes an id. Otherwise, a parent id
    that does not fork would be indistinguishable from its child id. For
    example, this tree does not fork, but the parent and child must have
    different ids.
    
    <Parent>
      <Child />
    </Parent>
    
    To handle this scenario, every time we materialize an id, we allocate a
    new level with a single slot. You can think of this as a fork with only
    one prong, or an array of children with length 1.
    
    It's possible for the the size of the sequence to exceed 32 bits, the
    max size for bitwise operations. When this happens, we make more room by
    converting the right part of the id to a string and storing it in an
    overflow variable. We use a base 32 string representation, because 32 is
    the largest power of 2 that is supported by toString(). We want the base
    to be large so that the resulting ids are compact, and we want the base
    to be a power of 2 because every log2(base) bits corresponds to a single
    character, i.e. every log2(32) = 5 bits. That means we can lop bits off
    the end 5 at a time without affecting the final result.
    
    * Incremental hydration
    
    Stores the tree context on the dehydrated Suspense boundary's state
    object so it resume where it left off.
    
    * Add useId to react-debug-tools
    
    * Add selective hydration test
    
    Demonstrates that selective hydration works and ids are preserved even
    after subsequent client updates.

diff --git a/packages/react/index.js b/packages/react/index.js
index 9a6a99ee52..3108c06c55 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -62,6 +62,7 @@ export {
   unstable_getCacheForType,
   unstable_useCacheRefresh,
   unstable_useOpaqueIdentifier,
+  unstable_useId,
   useCallback,
   useContext,
   useDebugValue,

commit 75f3ddebfa0d9885ce8df42571cf0c09ad6c0a3b
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon Nov 1 18:02:39 2021 -0400

    Remove experimental useOpaqueIdentifier API (#22672)
    
    useId is the updated version of this API.

diff --git a/packages/react/index.js b/packages/react/index.js
index 3108c06c55..a27507524e 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -61,7 +61,6 @@ export {
   unstable_getCacheSignal,
   unstable_getCacheForType,
   unstable_useCacheRefresh,
-  unstable_useOpaqueIdentifier,
   unstable_useId,
   useCallback,
   useContext,

commit 5cccacd131242bdea2c2fe4b33fac50d2e3132b4
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon Nov 1 18:26:42 2021 -0400

    Upgrade useId to alpha channel (#22674)

diff --git a/packages/react/index.js b/packages/react/index.js
index a27507524e..6a249ba432 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -61,7 +61,7 @@ export {
   unstable_getCacheSignal,
   unstable_getCacheForType,
   unstable_useCacheRefresh,
-  unstable_useId,
+  useId,
   useCallback,
   useContext,
   useDebugValue,

commit a6987bee730052dccdddd4645e15b1ce458fd9a6
Author: Luna Ruan <lunaris.ruan@gmail.com>
Date:   Fri Feb 11 11:42:55 2022 -0500

    add <TracingMarker> component boilerplate (#23275)
    
    - Add Tracing Marker component type to React exports
    - Add reconciler work tag
    - Add devtools work tag
    - Add boilerplate for the cache to render children
    
    No functionality yet

diff --git a/packages/react/index.js b/packages/react/index.js
index 6a249ba432..e4946bf095 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -58,6 +58,7 @@ export {
   unstable_LegacyHidden,
   unstable_Offscreen,
   unstable_Scope,
+  unstable_TracingMarker,
   unstable_getCacheSignal,
   unstable_getCacheForType,
   unstable_useCacheRefresh,

commit d5f1b067c8bbb826b823d0354a28ba31078b70c0
Author: salazarm <salazarm@users.noreply.github.com>
Date:   Tue Mar 8 07:55:32 2022 -0500

    [ServerContext] Flight support for ServerContext (#23244)
    
    * Flight side of server context
    
    * 1 more test
    
    * rm unused function
    
    * flow+prettier
    
    * flow again =)
    
    * duplicate ReactServerContext across packages
    
    * store default value when lazily initializing server context
    
    * .
    
    * better comment
    
    * derp... missing import
    
    * rm optional chaining
    
    * missed feature flag
    
    * React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED ??
    
    * add warning if non ServerContext passed into useServerContext
    
    * pass context in as array of arrays
    
    * make importServerContext nott pollute the global context state
    
    * merge main
    
    * remove useServerContext
    
    * dont rely on object getters in ReactServerContext and disallow JSX
    
    * add symbols to devtools + rename globalServerContextRegistry to just ContextRegistry
    
    * gate test case as experimental
    
    * feedback
    
    * remove unions
    
    * Lint
    
    * fix oopsies (tests/lint/mismatching arguments/signatures
    
    * lint again
    
    * replace-fork
    
    * remove extraneous change
    
    * rebase
    
    * 1 more test
    
    * rm unused function
    
    * flow+prettier
    
    * flow again =)
    
    * duplicate ReactServerContext across packages
    
    * store default value when lazily initializing server context
    
    * .
    
    * better comment
    
    * derp... missing import
    
    * rm optional chaining
    
    * missed feature flag
    
    * React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED ??
    
    * add warning if non ServerContext passed into useServerContext
    
    * pass context in as array of arrays
    
    * make importServerContext nott pollute the global context state
    
    * merge main
    
    * remove useServerContext
    
    * dont rely on object getters in ReactServerContext and disallow JSX
    
    * add symbols to devtools + rename globalServerContextRegistry to just ContextRegistry
    
    * gate test case as experimental
    
    * feedback
    
    * remove unions
    
    * Lint
    
    * fix oopsies (tests/lint/mismatching arguments/signatures
    
    * lint again
    
    * replace-fork
    
    * remove extraneous change
    
    * rebase
    
    * reinline
    
    * rebase
    
    * add back changes lost due to rebase being hard
    
    * emit chunk for provider
    
    * remove case for React provider type
    
    * update type for SomeChunk
    
    * enable flag with experimental
    
    * add missing types
    
    * fix flow type
    
    * missing type
    
    * t: any
    
    * revert extraneous type change
    
    * better type
    
    * better type
    
    * feedback
    
    * change import to type import
    
    * test?
    
    * test?
    
    * remove react-dom
    
    * remove react-native-renderer from react-server-native-relay/package.json
    
    * gate change in FiberNewContext, getComponentNameFromType, use switch statement in FlightServer
    
    * getComponentNameFromTpe: server context type gated and use displayName if available
    
    * fallthrough
    
    * lint....
    
    * POP
    
    * lint

diff --git a/packages/react/index.js b/packages/react/index.js
index e4946bf095..084aabb53c 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -48,6 +48,7 @@ export {
   createFactory,
   createMutableSource,
   createRef,
+  createServerContext,
   forwardRef,
   isValidElement,
   lazy,

commit 9e67e7a31582079263665fac0391220b99d8bb86
Author: Joseph Savona <joesavona@fb.com>
Date:   Tue Aug 23 01:36:02 2022 -0700

    Scaffolding for useMemoCache hook (#25123)
    
    * Scaffolding for useMemoCache hook
    * cleanup leftovers from copy/paste of use() diff
    
    Co-authored-by: Andrew Clark <git@andrewclark.io>

diff --git a/packages/react/index.js b/packages/react/index.js
index 084aabb53c..77cd739625 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -63,6 +63,7 @@ export {
   unstable_getCacheSignal,
   unstable_getCacheForType,
   unstable_useCacheRefresh,
+  unstable_useMemoCache,
   useId,
   useCallback,
   useContext,

commit b6978bc38f6788c7e73982b9fd2771aabdf36f15
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Aug 25 14:12:07 2022 -0400

    experimental_use(promise) (#25084)
    
    * Internal `act`: Unwrapping resolved promises
    
    This update our internal implementation of `act` to support React's new
    behavior for unwrapping promises. Like we did with Scheduler, when
    something suspends, it will yield to the main thread so the microtasks
    can run, then continue in a new task.
    
    I need to implement the same behavior in the public version of `act`,
    but there are some additional considerations so I'll do that in a
    separate commit.
    
    * Move throwException to after work loop resumes
    
    throwException is the function that finds the nearest boundary and
    schedules it for a second render pass. We should only call it right
    before we unwind the stack â€” not if we receive an immediate ping and
    render the fiber again.
    
    This was an oversight in 8ef3a7c that I didn't notice because it happens
    to mostly work, anyway. What made me notice the mistake is that
    throwException also marks the entire render phase as suspended
    (RootDidSuspend or RootDidSuspendWithDelay), which is only supposed to
    be happen if we show a fallback. One consequence was that, in the
    RootDidSuspendWithDelay case, the entire commit phase was blocked,
    because that's the exit status we use to block a bad fallback
    from appearing.
    
    * Use expando to check whether promise has resolved
    
    Add a `status` expando to a thrown thenable to track when its value has
    resolved.
    
    In a later step, we'll also use `value` and `reason` expandos to track
    the resolved value.
    
    This is not part of the official JavaScript spec â€” think of
    it as an extension of the Promise API, or a custom interface that is a
    superset of Thenable. However, it's inspired by the terminology used
    by `Promise.allSettled`.
    
    The intent is that this will be a public API â€” Suspense implementations
    can set these expandos to allow React to unwrap the value synchronously
    without waiting a microtask.
    
    * Scaffolding for `experimental_use` hook
    
    Sets up a new experimental hook behind a feature flag, but does not
    implement it yet.
    
    * use(promise)
    
    Adds experimental support to Fiber for unwrapping the value of a promise
    inside a component. It is not yet implemented for Server Components,
    but that is planned.
    
    If promise has already resolved, the value can be unwrapped
    "immediately" without showing a fallback. The trick we use to implement
    this is to yield to the main thread (literally suspending the work
    loop), wait for the microtask queue to drain, then check if the promise
    resolved in the meantime. If so, we can resume the last attempted fiber
    without unwinding the stack. This functionality was implemented in
    previous commits.
    
    Another feature is that the promises do not need to be cached between
    attempts. Because we assume idempotent execution of components, React
    will track the promises that were used during the previous attempt and
    reuse the result. You shouldn't rely on this property, but during
    initial render it mostly just works. Updates are trickier, though,
    because if you used an uncached promise, we have no way of knowing
    whether the underlying data has changed, so we have to unwrap the
    promise every time. It will still work, but it's inefficient and can
    lead to unnecessary fallbacks if it happens during a discrete update.
    
    When we implement this for Server Components, this will be less of an
    issue because there are no updates in that environment. However, it's
    still better for performance to cache data requests, so the same
    principles largely apply.
    
    The intention is that this will eventually be the only supported way to
    suspend on arbitrary promises. Throwing a promise directly will
    be deprecated.

diff --git a/packages/react/index.js b/packages/react/index.js
index 77cd739625..d0628ab003 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -49,6 +49,7 @@ export {
   createMutableSource,
   createRef,
   createServerContext,
+  experimental_use,
   forwardRef,
   isValidElement,
   lazy,

commit c91a1e03be54733a7dbfcb5663d7a9e8606ab1c1
Author: Lauren Tan <poteto@users.noreply.github.com>
Date:   Wed Sep 14 14:39:06 2022 -0400

    experimental_useEvent (#25229)
    
    This commit adds a new hook `useEvent` per the RFC [here](https://github.com/reactjs/rfcs/pull/220), gated as experimental.
    
    Co-authored-by: Rick Hanlon <rickhanlonii@gmail.com>
    Co-authored-by: Rick Hanlon <rickhanlonii@fb.com>
    Co-authored-by: Lauren Tan <poteto@users.noreply.github.com>

diff --git a/packages/react/index.js b/packages/react/index.js
index d0628ab003..9db87fa892 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -71,6 +71,7 @@ export {
   useDebugValue,
   useDeferredValue,
   useEffect,
+  experimental_useEvent,
   useImperativeHandle,
   useInsertionEffect,
   useLayoutEffect,

commit 9cdf8a99edcfd94d7420835ea663edca04237527
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Oct 18 11:19:24 2022 -0400

    [Codemod] Update copyright header to Meta (#25315)
    
    * Facebook -> Meta in copyright
    
    rg --files | xargs sed -i 's#Copyright (c) Facebook, Inc. and its affiliates.#Copyright (c) Meta Platforms, Inc. and affiliates.#g'
    
    * Manual tweaks

diff --git a/packages/react/index.js b/packages/react/index.js
index 9db87fa892..145513fb93 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -1,5 +1,5 @@
 /**
- * Copyright (c) Facebook, Inc. and its affiliates.
+ * Copyright (c) Meta Platforms, Inc. and affiliates.
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE file in the root directory of this source tree.

commit 8e2bde6f2751aa6335f3cef488c05c3ea08e074a
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Tue Oct 18 16:55:06 2022 -0400

    Add cache() API (#25506)
    
    Like memo() but longer lived.

diff --git a/packages/react/index.js b/packages/react/index.js
index 145513fb93..62c7d2f281 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -54,6 +54,7 @@ export {
   isValidElement,
   lazy,
   memo,
+  experimental_cache,
   startTransition,
   unstable_Cache,
   unstable_DebugTracingMode,

commit e7c5af45ceb8fa2b64d39ec68345254ce9abd65e
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Sun Oct 23 23:20:52 2022 -0400

    Update cache() and use() to the canary aka next channel (#25502)
    
    Testing what it would look like to move this to the `next` channel.

diff --git a/packages/react/index.js b/packages/react/index.js
index 62c7d2f281..bee9b71e48 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -49,12 +49,12 @@ export {
   createMutableSource,
   createRef,
   createServerContext,
-  experimental_use,
+  use,
   forwardRef,
   isValidElement,
   lazy,
   memo,
-  experimental_cache,
+  cache,
   startTransition,
   unstable_Cache,
   unstable_DebugTracingMode,

commit 84a0a171ea0ecd25e287bd3d3dd30e932beb4677
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Wed Dec 14 15:08:29 2022 -0500

    Rename experimental useEvent to useEffectEvent (#25881)
    
    We originally had grand plans for using this Event concept for more but
    now it's only meant to be used in combination with effects.
    
    It's an Event in the FRP terms, that is triggered from an Effect.
    Technically it can also be from another function that itself is
    triggered from an existing side-effect but that's kind of an advanced
    case.
    
    The canonical case is an effect that triggers an event:
    
    ```js
    const onHappened = useEffectEvent(() => ...);
    useEffect(() => {
      onHappened();
    }, []);
    ```

diff --git a/packages/react/index.js b/packages/react/index.js
index bee9b71e48..548c1fe171 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -72,7 +72,7 @@ export {
   useDebugValue,
   useDeferredValue,
   useEffect,
-  experimental_useEvent,
+  experimental_useEffectEvent,
   useImperativeHandle,
   useInsertionEffect,
   useLayoutEffect,

commit 6b3083266686f62b29462d32de75c6e71f7ba3e3
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Jan 31 08:25:05 2023 -0500

    Upgrade prettier (#26081)
    
    The old version of prettier we were using didn't support the Flow syntax
    to access properties in a type using `SomeType['prop']`. This updates
    `prettier` and `rollup-plugin-prettier` to the latest versions.
    
    I added the prettier config `arrowParens: "avoid"` to reduce the diff
    size as the default has changed in Prettier 2.0. The largest amount of
    changes comes from function expressions now having a space. This doesn't
    have an option to preserve the old behavior, so we have to update this.

diff --git a/packages/react/index.js b/packages/react/index.js
index 548c1fe171..2ed91ec25b 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -8,9 +8,8 @@
  */
 
 // Keep in sync with https://github.com/facebook/flow/blob/main/lib/react.js
-export type StatelessFunctionalComponent<
-  P,
-> = React$StatelessFunctionalComponent<P>;
+export type StatelessFunctionalComponent<P> =
+  React$StatelessFunctionalComponent<P>;
 export type ComponentType<-P> = React$ComponentType<P>;
 export type AbstractComponent<
   -Config,

commit 491aec5d6113ce5bae7c10966bc38a4a8fc091a8
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon May 1 13:19:20 2023 -0400

    Implement experimental_useOptimisticState (#26740)
    
    This adds an experimental hook tentatively called useOptimisticState.
    (The actual name needs some bikeshedding.)
    
    The headline feature is that you can use it to implement optimistic
    updates. If you set some optimistic state during a transition/action,
    the state will be automatically reverted once the transition completes.
    
    Another feature is that the optimistic updates will be continually
    rebased on top of the latest state.
    
    It's easiest to explain with examples; we'll publish documentation as
    the API gets closer to stabilizing. See tests for now.
    
    Technically the use cases for this hook are broader than just optimistic
    updates; you could use it implement any sort of "pending" state, such as
    the ones exposed by useTransition and useFormStatus. But we expect
    people will most often reach for this hook to implement the optimistic
    update pattern; simpler cases are covered by those other hooks.

diff --git a/packages/react/index.js b/packages/react/index.js
index 2ed91ec25b..f7a190f136 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -77,6 +77,7 @@ export {
   useLayoutEffect,
   useMemo,
   useMutableSource,
+  experimental_useOptimisticState,
   useSyncExternalStore,
   useReducer,
   useRef,

commit b7972822b5887d05ae772ef757a453265b4b7aec
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed May 3 14:26:00 2023 -0400

    useOptimisticState -> useOptimistic (#26772)
    
    Drop the "state". Just "useOptimistic". It's cleaner.
    
    This is still an experimental API. May not be the final name.

diff --git a/packages/react/index.js b/packages/react/index.js
index f7a190f136..d6eb4a5e14 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -77,7 +77,7 @@ export {
   useLayoutEffect,
   useMemo,
   useMutableSource,
-  experimental_useOptimisticState,
+  experimental_useOptimistic,
   useSyncExternalStore,
   useReducer,
   useRef,

commit 80d9a40114bb43c07d021e8254790852f450bd2b
Author: Noah Lemen <noah.lemen@gmail.com>
Date:   Tue Jun 27 12:45:46 2023 -0400

    Remove useMutableSource (#27011)
    
    ## Summary
    
    This PR cleans up `useMutableSource`. This has been blocked by a
    remaining dependency internally at Meta, but that has now been deleted.
    
    <!--
    Explain the **motivation** for making this change. What existing problem
    does the pull request solve?
    -->
    
    ## How did you test this change?
    
    ```
    yarn flow
    yarn lint
    yarn test --prod
    ```
    
    <!--
    Demonstrate the code is solid. Example: The exact commands you ran and
    their output, screenshots / videos if the pull request changes the user
    interface.
    How exactly did you verify that your PR solves the issue you wanted to
    solve?
      If you leave this empty, your PR will very likely be closed.
    -->

diff --git a/packages/react/index.js b/packages/react/index.js
index d6eb4a5e14..fd24be44fc 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -45,7 +45,6 @@ export {
   createContext,
   createElement,
   createFactory,
-  createMutableSource,
   createRef,
   createServerContext,
   use,
@@ -76,7 +75,6 @@ export {
   useInsertionEffect,
   useLayoutEffect,
   useMemo,
-  useMutableSource,
   experimental_useOptimistic,
   useSyncExternalStore,
   useReducer,

commit eb2c2f7c2cf2652a168c2b433d2989131c69754b
Author: Noah Lemen <noah.lemen@gmail.com>
Date:   Thu Jul 6 14:09:53 2023 -0400

    rename SuspenseList export to unstable_SuspenseList (#27061)
    
    ## Summary
    
    as we began [discussing
    yesterday](https://github.com/facebook/react/pull/27056#discussion_r1253282784),
    `SuspenseList` is not actually stable yet, and should likely be exported
    with the `unstable_` prefix.
    
    the conversation yesterday began discussing this in the context of the
    fb-specific packages, but changing it there without updating everywhere
    else leads to test failures, so here the change is made across packages.
    
    ## How did you test this change?
    
    ```
    yarn flow dom-browser
    yarn test
    ```

diff --git a/packages/react/index.js b/packages/react/index.js
index fd24be44fc..fd2c377668 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -40,7 +40,6 @@ export {
   PureComponent,
   StrictMode,
   Suspense,
-  SuspenseList,
   cloneElement,
   createContext,
   createElement,
@@ -59,6 +58,7 @@ export {
   unstable_LegacyHidden,
   unstable_Offscreen,
   unstable_Scope,
+  unstable_SuspenseList,
   unstable_TracingMarker,
   unstable_getCacheSignal,
   unstable_getCacheForType,

commit bfefb228422f7264a29b3a6b98ec95e05925e80e
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Oct 4 14:51:36 2023 -0400

    Upgrade Server Actions to canary (#27459)
    
    Upgrades the stability of Server Actions from experimental to canary.
    
    - Turns on enableAsyncActions and enableFormActions
    - Removes "experimental_" prefix from useOptimistic, useFormStatus, and
    useFormState

diff --git a/packages/react/index.js b/packages/react/index.js
index fd2c377668..9ba3d9402c 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -75,7 +75,7 @@ export {
   useInsertionEffect,
   useLayoutEffect,
   useMemo,
-  experimental_useOptimistic,
+  useOptimistic,
   useSyncExternalStore,
   useReducer,
   useRef,

commit ce2bc58a9f6f3b0bfc8c738a0d8e2a5f3a332ff5
Author: Jan Kassens <jkassens@meta.com>
Date:   Thu Nov 2 16:13:21 2023 -0400

    [activity] rename unstable_Offscreen to unstable_Activity (#27640)
    
    `Activity` is the current candidate name. This PR starts the rename work
    by renaming the exported unstable component name.
    
    NOTE: downstream consumers need to rename the import when updating to
    this commit.

diff --git a/packages/react/index.js b/packages/react/index.js
index 9ba3d9402c..bef926da87 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -56,7 +56,7 @@ export {
   unstable_Cache,
   unstable_DebugTracingMode,
   unstable_LegacyHidden,
-  unstable_Offscreen,
+  unstable_Activity,
   unstable_Scope,
   unstable_SuspenseList,
   unstable_TracingMarker,

commit 45d61cf7effdba6bbd9835bb427c99c95beb7e17
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Jan 2 14:39:14 2024 -0500

    [flow] upgrade to 0.225.1 (#27871)
    
    This Flow upgrade includes 2 fixes:
    - Remove `React$StatelessFunctionalComponent` as that was replaced by
    just `React$AbstractComponent` as Flow doesn't make any guarantees, see
    the Flow change here:
    https://github.com/facebook/flow/commit/521317c48f44ffb5eac072a7b2548a72b0745095
    - Flow no longer allows `number` type indexing into objects which
    discovered an incorrect type that is actually an array of the data.
    
    Used this command to upgrade
    ```
    yarn add -W flow-bin flow-remove-types hermes-parser hermes-eslint
    ```
    and ran `yarn flow-ci` to check for errors in different configurations.

diff --git a/packages/react/index.js b/packages/react/index.js
index bef926da87..b60e8957c5 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -8,8 +8,6 @@
  */
 
 // Keep in sync with https://github.com/facebook/flow/blob/main/lib/react.js
-export type StatelessFunctionalComponent<P> =
-  React$StatelessFunctionalComponent<P>;
 export type ComponentType<-P> = React$ComponentType<P>;
 export type AbstractComponent<
   -Config,

commit f16344ea6db5bcc108de80dbc39a41ec28e8210d
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Jan 16 20:19:01 2024 -0500

    Refactor React Server entrypoint to not depend on the client one (#27940)
    
    This refactors the Server Components entrypoint for the `react` package
    (ReactServer.js) so that it doesn't depend on the client entrypoint
    (React.js). I also renamed React.js to ReactClient.js to make the
    separation clearer.
    
    This structure will make it easier to add client-only and server-only
    features.

diff --git a/packages/react/index.js b/packages/react/index.js
index b60e8957c5..abce6537b5 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -80,4 +80,4 @@ export {
   useState,
   useTransition,
   version,
-} from './src/React';
+} from './src/ReactClient';

commit 53b12e46a17549ec7644e13c126440ed2f3629fd
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Feb 1 13:28:14 2024 -0500

    Add stable React.act export (#28160)
    
    Starting in version 19, users can import the `act` testing API from the
    `react` package instead of using a renderer specific API, like
    `react-dom/test-utils`.

diff --git a/packages/react/index.js b/packages/react/index.js
index abce6537b5..70f61f58e0 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -30,7 +30,7 @@ export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
 // We can't use export * from in Flow for some reason.
 export {
   __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,
-  act as unstable_act,
+  act,
   Children,
   Component,
   Fragment,

commit 472854820bfd0058dfc85524051171c7b7c998c1
Author: dan <dan.abramov@me.com>
Date:   Mon Feb 5 22:39:15 2024 +0000

    [Flight] Delete Server Context (#28225)
    
    Server Context was never documented, and has been deprecated in
    https://github.com/facebook/react/pull/27424.
    
    This PR removes it completely, including the implementation code.
    
    Notably, `useContext` is removed from the shared subset, so importing it
    from a React Server environment would now should be a build error in
    environments that are able to enforce that.

diff --git a/packages/react/index.js b/packages/react/index.js
index 70f61f58e0..ac3b45c3a7 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -43,7 +43,6 @@ export {
   createElement,
   createFactory,
   createRef,
-  createServerContext,
   use,
   forwardRef,
   isValidElement,

commit 5c65b27587c0507d66a84e055de948fc62d471d4
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Fri Mar 22 13:03:44 2024 -0400

    Add `React.useActionState` (#28491)
    
    ## Overview
    
    _Depends on https://github.com/facebook/react/pull/28514_
    
    This PR adds a new React hook called `useActionState` to replace and
    improve the ReactDOM `useFormState` hook.
    
    ## Motivation
    
    This hook intends to fix some of the confusion and limitations of the
    `useFormState` hook.
    
    The `useFormState` hook is only exported from the `ReactDOM` package and
    implies that it is used only for the state of `<form>` actions, similar
    to `useFormStatus` (which is only for `<form>` element status). This
    leads to understandable confusion about why `useFormState` does not
    provide a `pending` state value like `useFormStatus` does.
    
    The key insight is that the `useFormState` hook does not actually return
    the state of any particular form at all. Instead, it returns the state
    of the _action_ passed to the hook, wrapping it and returning a
    trackable action to add to a form, and returning the last returned value
    of the action given. In fact, `useFormState` doesn't need to be used in
    a `<form>` at all.
    
    Thus, adding a `pending` value to `useFormState` as-is would thus be
    confusing because it would only return the pending state of the _action_
    given, not the `<form>` the action is passed to. Even if we wanted to
    tie them together, the returned `action` can be passed to multiple
    forms, creating confusing and conflicting pending states during multiple
    form submissions.
    
    Additionally, since the action is not related to any particular
    `<form>`, the hook can be used in any renderer - not only `react-dom`.
    For example, React Native could use the hook to wrap an action, pass it
    to a component that will unwrap it, and return the form result state and
    pending state. It's renderer agnostic.
    
    To fix these issues, this PR:
    - Renames `useFormState` to `useActionState`
    - Adds a `pending` state to the returned tuple
    - Moves the hook to the `'react'` package
    
    ## Reference
    
    The `useFormState` hook allows you to track the pending state and return
    value of a function (called an "action"). The function passed can be a
    plain JavaScript client function, or a bound server action to a
    reference on the server. It accepts an optional `initialState` value
    used for the initial render, and an optional `permalink` argument for
    renderer specific pre-hydration handling (such as a URL to support
    progressive hydration in `react-dom`).
    
    Type:
    
    ```ts
    function useActionState<State>(
            action: (state: Awaited<State>) => State | Promise<State>,
            initialState: Awaited<State>,
            permalink?: string,
        ): [state: Awaited<State>, dispatch: () => void, boolean];
    ```
    
    The hook returns a tuple with:
    - `state`: the last state the action returned
    - `dispatch`: the method to call to dispatch the wrapped action
    - `pending`: the pending state of the action and any state updates
    contained
    
    Notably, state updates inside of the action dispatched are wrapped in a
    transition to keep the page responsive while the action is completing
    and the UI is updated based on the result.
    
    ## Usage
    
    The `useActionState` hook can be used similar to `useFormState`:
    
    ```js
    import { useActionState } from "react"; // not react-dom
    
    function Form({ formAction }) {
      const [state, action, isPending] = useActionState(formAction);
    
      return (
        <form action={action}>
          <input type="email" name="email" disabled={isPending} />
          <button type="submit" disabled={isPending}>
            Submit
          </button>
          {state.errorMessage && <p>{state.errorMessage}</p>}
        </form>
      );
    }
    ```
    
    But it doesn't need to be used with a `<form/>` (neither did
    `useFormState`, hence the confusion):
    
    ```js
    import { useActionState, useRef } from "react";
    
    function Form({ someAction }) {
      const ref = useRef(null);
      const [state, action, isPending] = useActionState(someAction);
    
      async function handleSubmit() {
        // See caveats below
        await action({ email: ref.current.value });
      }
    
      return (
        <div>
          <input ref={ref} type="email" name="email" disabled={isPending} />
          <button onClick={handleSubmit} disabled={isPending}>
            Submit
          </button>
          {state.errorMessage && <p>{state.errorMessage}</p>}
        </div>
      );
    }
    ```
    
    ## Benefits
    
    One of the benefits of using this hook is the automatic tracking of the
    return value and pending states of the wrapped function. For example,
    the above example could be accomplished via:
    
    ```js
    import { useActionState, useRef } from "react";
    
    function Form({ someAction }) {
      const ref = useRef(null);
      const [state, setState] = useState(null);
      const [isPending, setIsPending] = useTransition();
    
      function handleSubmit() {
        startTransition(async () => {
          const response = await someAction({ email: ref.current.value });
          setState(response);
        });
      }
    
      return (
        <div>
          <input ref={ref} type="email" name="email" disabled={isPending} />
          <button onClick={handleSubmit} disabled={isPending}>
            Submit
          </button>
          {state.errorMessage && <p>{state.errorMessage}</p>}
        </div>
      );
    }
    ```
    
    However, this hook adds more benefits when used with render specific
    elements like react-dom `<form>` elements and Server Action. With
    `<form>` elements, React will automatically support replay actions on
    the form if it is submitted before hydration has completed, providing a
    form of partial progressive enhancement: enhancement for when javascript
    is enabled but not ready.
    
    Additionally, with the `permalink` argument and Server Actions,
    frameworks can provide full progressive enhancement support, submitting
    the form to the URL provided along with the FormData from the form. On
    submission, the Server Action will be called during the MPA navigation,
    similar to any raw HTML app, server rendered, and the result returned to
    the client without any JavaScript on the client.
    
    ## Caveats
    There are a few Caveats to this new hook:
    **Additional state update**: Since we cannot know whether you use the
    pending state value returned by the hook, the hook will always set the
    `isPending` state at the beginning of the first chained action,
    resulting in an additional state update similar to `useTransition`. In
    the future a type-aware compiler could optimize this for when the
    pending state is not accessed.
    
    **Pending state is for the action, not the handler**: The difference is
    subtle but important, the pending state begins when the return action is
    dispatched and will revert back after all actions and transitions have
    settled. The mechanism for this under the hook is the same as
    useOptimisitic.
    
    Concretely, what this means is that the pending state of
    `useActionState` will not represent any actions or sync work performed
    before dispatching the action returned by `useActionState`. Hopefully
    this is obvious based on the name and shape of the API, but there may be
    some temporary confusion.
    
    As an example, let's take the above example and await another action
    inside of it:
    
    ```js
    import { useActionState, useRef } from "react";
    
    function Form({ someAction, someOtherAction }) {
      const ref = useRef(null);
      const [state, action, isPending] = useActionState(someAction);
    
      async function handleSubmit() {
        await someOtherAction();
    
        // The pending state does not start until this call.
        await action({ email: ref.current.value });
      }
    
      return (
        <div>
          <input ref={ref} type="email" name="email" disabled={isPending} />
          <button onClick={handleSubmit} disabled={isPending}>
            Submit
          </button>
          {state.errorMessage && <p>{state.errorMessage}</p>}
        </div>
      );
    }
    
    ```
    
    Since the pending state is related to the action, and not the handler or
    form it's attached to, the pending state only changes when the action is
    dispatched. To solve, there are two options.
    
    First (recommended): place the other function call inside of the action
    passed to `useActionState`:
    
    ```js
    import { useActionState, useRef } from "react";
    
    function Form({ someAction, someOtherAction }) {
      const ref = useRef(null);
      const [state, action, isPending] = useActionState(async (data) => {
        // Pending state is true already.
        await someOtherAction();
        return someAction(data);
      });
    
      async function handleSubmit() {
        // The pending state starts at this call.
        await action({ email: ref.current.value });
      }
    
      return (
        <div>
          <input ref={ref} type="email" name="email" disabled={isPending} />
          <button onClick={handleSubmit} disabled={isPending}>
            Submit
          </button>
          {state.errorMessage && <p>{state.errorMessage}</p>}
        </div>
      );
    }
    ```
    
    For greater control, you can also wrap both in a transition and use the
    `isPending` state of the transition:
    
    ```js
    import { useActionState, useTransition, useRef } from "react";
    
    function Form({ someAction, someOtherAction }) {
      const ref = useRef(null);
    
      // isPending is used from the transition wrapping both action calls.
      const [isPending, startTransition] = useTransition();
    
      // isPending not used from the individual action.
      const [state, action] = useActionState(someAction);
    
      async function handleSubmit() {
        startTransition(async () => {
          // The transition pending state has begun.
          await someOtherAction();
          await action({ email: ref.current.value });
        });
      }
    
      return (
        <div>
          <input ref={ref} type="email" name="email" disabled={isPending} />
          <button onClick={handleSubmit} disabled={isPending}>
            Submit
          </button>
          {state.errorMessage && <p>{state.errorMessage}</p>}
        </div>
      );
    }
    ```
    
    A similar technique using `useOptimistic` is preferred over using
    `useTransition` directly, and is left as an exercise to the reader.
    
    ## Thanks
    
    Thanks to @ryanflorence @mjackson @wesbos
    (https://github.com/facebook/react/issues/27980#issuecomment-1960685940)
    and [Allan
    Lasser](https://allanlasser.com/posts/2024-01-26-avoid-using-reacts-useformstatus)
    for their feedback and suggestions on `useFormStatus` hook.

diff --git a/packages/react/index.js b/packages/react/index.js
index ac3b45c3a7..a3bd573706 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -78,5 +78,6 @@ export {
   useRef,
   useState,
   useTransition,
+  useActionState,
   version,
 } from './src/ReactClient';

commit 2aed507a76a0b1524426c398897cbe47d80c51e5
Author: Jan Kassens <jkassens@meta.com>
Date:   Fri Mar 29 16:29:48 2024 -0400

    Remove React.createFactory (#27798)
    
    `React.createFactory` has been long deprecated. This removes it for the
    next release.

diff --git a/packages/react/index.js b/packages/react/index.js
index a3bd573706..2f267f6eeb 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -41,7 +41,6 @@ export {
   cloneElement,
   createContext,
   createElement,
-  createFactory,
   createRef,
   use,
   forwardRef,

commit 7319c61b18274ee7e7c20bd2e533b93c922d8fe0
Author: Joseph Savona <joesavona@fb.com>
Date:   Tue Apr 2 07:57:08 2024 -0700

    [be] Remove unshipped experimental <Cache> element type (#28698)
    
    Removes the `<Cache />` element type since we're going with a simpler
    caching strategy.

diff --git a/packages/react/index.js b/packages/react/index.js
index 2f267f6eeb..e8f7b10788 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -49,7 +49,6 @@ export {
   memo,
   cache,
   startTransition,
-  unstable_Cache,
   unstable_DebugTracingMode,
   unstable_LegacyHidden,
   unstable_Activity,

commit 8cb6a1c0347a69ad4c580c5cf5f28d8be544d6d4
Author: Joseph Savona <joesavona@fb.com>
Date:   Tue Apr 2 10:54:31 2024 -0700

    [be] Remove unused, experimental getCacheSignal API (#28706)
    
    Similar to #28698, this removes the `unstable_getCacheSignal()` API
    since we don't intend to ship this to stable.

diff --git a/packages/react/index.js b/packages/react/index.js
index e8f7b10788..ba3a705cac 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -55,7 +55,6 @@ export {
   unstable_Scope,
   unstable_SuspenseList,
   unstable_TracingMarker,
-  unstable_getCacheSignal,
   unstable_getCacheForType,
   unstable_useCacheRefresh,
   unstable_useMemoCache,

commit f6131653570bbbf62d642ba9343b9cd0ab1ae97c
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Tue Apr 9 12:20:22 2024 -0400

    Rename SECRET INTERNALS to `__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE` (#28789)
    
    Follow up to #28783 and #28786.
    
    Since we've changed the implementations of these we can rename them to
    something a bit more descriptive while we're at it, since anyone
    depending on them will need to upgrade their code anyway.
    
    "react" with no condition:
    `__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE`
    "react" with "react-server" condition:
    `__SERVER_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE`
    "react-dom":
    `__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE`

diff --git a/packages/react/index.js b/packages/react/index.js
index ba3a705cac..6dcbe3a83e 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -29,7 +29,7 @@ export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
 // Export all exports so that they're available in tests.
 // We can't use export * from in Flow for some reason.
 export {
-  __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,
+  __CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,
   act,
   Children,
   Component,

commit 4508873393058e86bed308b56e49ec883ece59d1
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Apr 30 12:00:22 2024 -0400

    Move useMemoCache hook to react/compiler-runtime (#28954)
    
    Move useMemoCache hook to react/compiler-runtime
    
    For Meta-internal purposes, we keep the export on `react` itself to
    reduce churn.

diff --git a/packages/react/index.js b/packages/react/index.js
index 6dcbe3a83e..8808d25958 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -57,7 +57,6 @@ export {
   unstable_TracingMarker,
   unstable_getCacheForType,
   unstable_useCacheRefresh,
-  unstable_useMemoCache,
   useId,
   useCallback,
   useContext,

commit 6b4646cbd0fd20a7c37f5dfcb0f12193259a6289
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Wed Jun 19 14:19:48 2024 -0400

    Export captureOwnerStacks() only in DEV "react" builds (#29923)
    
    Only with the enableOwnerStacks flag (which is not on in www).
    
    This is a new DEV-only API to be able to implement what we do for
    console.error in user space.
    
    This API does not actually include the current stack that you'd get from
    `new Error().stack`. That you'd have to add yourself.
    
    This adds the ability to have conditional development exports because we
    plan on eventually having separate ESM builds that use the "development"
    or "production" export conditions.
    
    NOTE: This removes the export of `act` from `react` in prod (as opposed
    to a function that throws) - inline with what we do with other
    conditional exports.

diff --git a/packages/react/index.js b/packages/react/index.js
index 8808d25958..bad2c40e6c 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -30,7 +30,6 @@ export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
 // We can't use export * from in Flow for some reason.
 export {
   __CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,
-  act,
   Children,
   Component,
   Fragment,

commit 85fb95cdffdd95f2f908ee71974cae06b1c866e1
Author: Sam Zhou <sam@developersam.com>
Date:   Fri Aug 16 12:53:52 2024 -0400

    [flow] Eliminate a few React.Element type that will be synced to react-native (#30719)
    
    ## Summary
    
    Flow will eventually remove the specific `React.Element` type. For most
    of the code, it can be replaced with `React.MixedElement` or
    `React.Node`.
    
    When specific react elements are required, it needs to be replaced with
    either `React$Element` which will trigger a `internal-type` lint error
    that can be disabled project-wide, or use
    `ExactReactElement_DEPRECATED`.
    
    Fortunately in this case, this one can be replaced with just
    `React.MixedElement`.
    
    ## How did you test this change?
    
    `flow`

diff --git a/packages/react/index.js b/packages/react/index.js
index bad2c40e6c..19f256fd73 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -15,6 +15,7 @@ export type AbstractComponent<
 > = React$AbstractComponent<Config, Instance>;
 export type ElementType = React$ElementType;
 export type Element<+C> = React$Element<C>;
+export type MixedElement = React$Element<ElementType>;
 export type Key = React$Key;
 export type Ref<C> = React$Ref<C>;
 export type Node = React$Node;

commit b78a7f2f35e554a8647c3262d7f392e68d06febc
Author: lauren <poteto@users.noreply.github.com>
Date:   Mon Oct 7 16:25:04 2024 -0400

    [rcr] Re-export useMemoCache in top level React namespace (#31139)
    
    In order to support using the compiler on versions of React prior to 19,
    we need the ability to statically import `c` (aka useMemoCache) or
    fallback to a polyfill supplied by `react-compiler-runtime` (note: this
    is a separate npm package, not to be confused with
    `react/compiler-runtime`, which is currently a part of react).
    
    To do this we first need to re-export `useMemoCache` under the top level
    React namespace again, which is additive and thus non-breaking. Doing so
    allows `react-compiler-runtime` to statically either re-export
    `React.__COMPILER_RUNTIME.c` or supply a polyfill, without the need for
    a dynamic import which is finicky to support due to returning a promise.
    
    In later PRs I will remove `react/compiler-runtime` and update the
    compiler to emit imports to `react-compiler-runtime` instead.

diff --git a/packages/react/index.js b/packages/react/index.js
index 19f256fd73..0c048c4e9c 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -31,6 +31,7 @@ export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
 // We can't use export * from in Flow for some reason.
 export {
   __CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,
+  __COMPILER_RUNTIME,
   Children,
   Component,
   Fragment,

commit 45804af18d589fd2c181f3b020f07661c46b73ea
Author: Sam Zhou <sam@developersam.com>
Date:   Mon Oct 21 16:17:41 2024 -0700

    [flow] Eliminate usage of more than 1-arg `React.AbstractComponent` in React codebase (#31314)
    
    <!--
      Thanks for submitting a pull request!
    We appreciate you spending the time to work on these changes. Please
    provide enough information so that others can review your pull request.
    The three fields below are mandatory.
    
    Before submitting a pull request, please make sure the following is
    done:
    
    1. Fork [the repository](https://github.com/facebook/react) and create
    your branch from `main`.
      2. Run `yarn` in the repository root.
    3. If you've fixed a bug or added code that should be tested, add tests!
    4. Ensure the test suite passes (`yarn test`). Tip: `yarn test --watch
    TestName` is helpful in development.
    5. Run `yarn test --prod` to test in the production environment. It
    supports the same options as `yarn test`.
    6. If you need a debugger, run `yarn test --debug --watch TestName`,
    open `chrome://inspect`, and press "Inspect".
    7. Format your code with
    [prettier](https://github.com/prettier/prettier) (`yarn prettier`).
    8. Make sure your code lints (`yarn lint`). Tip: `yarn linc` to only
    check changed files.
      9. Run the [Flow](https://flowtype.org/) type checks (`yarn flow`).
      10. If you haven't already, complete the CLA.
    
    Learn more about contributing:
    https://reactjs.org/docs/how-to-contribute.html
    -->
    
    ## Summary
    
    In order to adopt react 19's ref-as-prop model, Flow needs to eliminate
    all the places where they are treated differently.
    `React.AbstractComponent` is the worst example of this, and we need to
    eliminate it.
    
    This PR eliminates them from the react repo, and only keeps the one that
    has 1 argument of props.
    
    ## How did you test this change?
    
    yarn flow

diff --git a/packages/react/index.js b/packages/react/index.js
index 0c048c4e9c..2edb0a2c1d 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -9,15 +9,11 @@
 
 // Keep in sync with https://github.com/facebook/flow/blob/main/lib/react.js
 export type ComponentType<-P> = React$ComponentType<P>;
-export type AbstractComponent<
-  -Config,
-  +Instance = mixed,
-> = React$AbstractComponent<Config, Instance>;
+export type AbstractComponent<-Config> = React$AbstractComponent<Config>;
 export type ElementType = React$ElementType;
 export type Element<+C> = React$Element<C>;
 export type MixedElement = React$Element<ElementType>;
 export type Key = React$Key;
-export type Ref<C> = React$Ref<C>;
 export type Node = React$Node;
 export type Context<T> = React$Context<T>;
 export type Portal = React$Portal;

commit 2d320563f35ad75419983f166431055b4e7ed9f6
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Sun Dec 15 12:16:10 2024 -0500

    [flags] Delete enableDebugTracing (#31780)
    
    This is unused, even in the one builds that uses it, and we don't plan
    on landing it in this form.

diff --git a/packages/react/index.js b/packages/react/index.js
index 2edb0a2c1d..3e087509cc 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -46,7 +46,6 @@ export {
   memo,
   cache,
   startTransition,
-  unstable_DebugTracingMode,
   unstable_LegacyHidden,
   unstable_Activity,
   unstable_Scope,

commit a4d122f2d192fe0b6480e669cca43c8f953aaf85
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Wed Jan 8 12:11:18 2025 -0500

    Add <ViewTransition> Component (#31975)
    
    This will provide the opt-in for using [View
    Transitions](https://developer.mozilla.org/en-US/docs/Web/API/View_Transition_API)
    in React.
    
    View Transitions only trigger for async updates like `startTransition`,
    `useDeferredValue`, Actions or `<Suspense>` revealing from fallback to
    content. Synchronous updates provide an opt-out but also guarantee that
    they commit immediately which View Transitions can't.
    
    There's no need to opt-in to View Transitions at the "cause" side like
    event handlers or actions. They don't know what UI will change and
    whether that has an animated transition described.
    
    Conceptually the `<ViewTransition>` component is like a DOM fragment
    that transitions its children in its own isolate/snapshot. The API works
    by wrapping a DOM node or inner component:
    
    ```js
    import {ViewTransition} from 'react';
    
    <ViewTransition><Component /></ViewTransition>
    ```
    
    The default is `name="auto"` which will automatically assign a
    `view-transition-name` to the inner DOM node. That way you can add a
    View Transition to a Component without controlling its DOM nodes styling
    otherwise.
    
    A difference between this and the browser's built-in
    `view-transition-name: auto` is that switching the DOM nodes within the
    `<ViewTransition>` component preserves the same name so this example
    cross-fades between the DOM nodes instead of causing an exit and enter:
    
    ```js
    <ViewTransition>{condition ? <ComponentA /> : <ComponentB />}</ViewTransition>
    ```
    
    This becomes especially useful with `<Suspense>` as this example
    cross-fades between Skeleton and Content:
    
    ```js
    <ViewTransition>
      <Suspense fallback={<Skeleton />}>
        <Content />
      </Suspense>
    </ViewTransition>
    ```
    
    Where as this example triggers an exit of the Skeleton and an enter of
    the Content:
    
    ```js
    <Suspense fallback={<ViewTransition><Skeleton /></ViewTransition>}>
      <ViewTransition><Content /></ViewTransition>
    </Suspense>
    ```
    
    Managing instances and keys becomes extra important.
    
    You can also specify an explicit `name` property for example for
    animating the same conceptual item from one page onto another. However,
    best practices is to property namespace these since they can easily
    collide. It's also useful to add an `id` to it if available.
    
    ```js
    <ViewTransition name="my-shared-view">
    ```
    
    The model in general is the same as plain `view-transition-name` except
    React manages a set of heuristics for when to apply it. A problem with
    the naive View Transitions model is that it overly opts in every
    boundary that *might* transition into transitioning. This is leads to
    unfortunate effects like things floating around when unrelated updates
    happen. This leads the whole document to animate which means that
    nothing is clickable in the meantime. It makes it not useful for smaller
    and more local transitions. Best practice is to add
    `view-transition-name` only right before you're about to need to animate
    the thing. This is tricky to manage globally on complex apps and is not
    compositional. Instead we let React manage when a `<ViewTransition>`
    "activates" and add/remove the `view-transition-name`. This is also when
    React calls `startViewTransition` behind the scenes while it mutates the
    DOM.
    
    I've come up with a number of heuristics that I think will make a lot
    easier to coordinate this. The principle is that only if something that
    updates that particular boundary do we activate it. I hope that one day
    maybe browsers will have something like these built-in and we can remove
    our implementation.
    
    A `<ViewTransition>` only activates if:
    
    - If a mounted Component renders a `<ViewTransition>` within it outside
    the first DOM node, and it is within the viewport, then that
    ViewTransition activates as an "enter" animation. This avoids inner
    "enter" animations trigger when the parent mounts.
    - If an unmounted Component had a `<ViewTransition>` within it outside
    the first DOM node, and it was within the viewport, then that
    ViewTransition activates as an "exit" animation. This avoids inner
    "exit" animations triggering when the parent unmounts.
    - If an explicitly named `<ViewTransition name="...">` is deep within an
    unmounted tree and one with the same name appears in a mounted tree at
    the same time, then both are activated as a pair, but only if they're
    both in the viewport. This avoids these triggering "enter" or "exit"
    animations when going between parents that don't have a pair.
    - If an already mounted `<ViewTransition>` is visible and a DOM
    mutation, that might affect how it's painted, happens within its
    children but outside any nested `<ViewTransition>`. This allows it to
    "cross-fade" between its updates.
    - If an already mounted `<ViewTransition>` resizes or moves as the
    result of direct DOM nodes siblings changing or moving around. This
    allows insertion, deletion and reorders into a list to animate all
    children. It is only within one DOM node though, to avoid unrelated
    changes in the parent to trigger this. If an item is outside the
    viewport before and after, then it's skipped to avoid things flying
    across the screen.
    - If a `<ViewTransition>` boundary changes size, due to a DOM mutation
    within it, then the parent activates (or the root document if there are
    no more parents). This ensures that the container can cross-fade to
    avoid abrupt relayout. This can be avoided by using absolutely
    positioned children. When this can avoid bubbling to the root document,
    whatever is not animating is still responsive to clicks during the
    transition.
    
    Conceptually each DOM node has its own default that activates the parent
    `<ViewTransition>` or no transition if the parent is the root. That
    means that if you add a DOM node like `<div><ViewTransition><Component
    /></ViewTransition></div>` this won't trigger an "enter" animation since
    it was the div that was added, not the ViewTransition. Instead, it might
    cause a cross-fade of the parent ViewTransition or no transition if it
    had no parent. This ensures that only explicit boundaries perform coarse
    animations instead of every single node which is really the benefit of
    the View Transitions model. This ends up working out well for simple
    cases like switching between two pages immediately while transitioning
    one floating item that appears on both pages. Because only the floating
    item transitions by default.
    
    Note that it's possible to add manual `view-transition-name` with CSS or
    `style={{ viewTransitionName: 'auto' }}` that always transitions as long
    as something else has a `<ViewTransition>` that activates. For example a
    `<ViewTransition>` can wrap a whole page for a cross-fade but inside of
    it an explicit name can be added to something to ensure it animates as a
    move when something relates else changes its layout. Instead of just
    cross-fading it along with the Page which would be the default.
    
    There's more PRs coming with some optimizations, fixes and expanded
    APIs. This first PR explores the above core heuristic.
    
    ---------
    
    Co-authored-by: Sebastian "Sebbie" Silbermann <silbermann.sebastian@gmail.com>

diff --git a/packages/react/index.js b/packages/react/index.js
index 3e087509cc..7522a32d18 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -51,6 +51,7 @@ export {
   unstable_Scope,
   unstable_SuspenseList,
   unstable_TracingMarker,
+  unstable_ViewTransition,
   unstable_getCacheForType,
   unstable_useCacheRefresh,
   useId,

commit 028c8e6cf5ce2a87147a7e03e503ce94c7a7a0cf
Author: Sebastian MarkbÃ¥ge <sebastian@calyptus.eu>
Date:   Tue Jan 21 15:00:02 2025 -0500

    Add Transition Types (#32105)
    
    This adds an isomorphic API to add Transition Types, which represent the
    cause, to the current Transition. This is currently mainly for View
    Transitions but as a concept it's broader and we might expand it to more
    features and object types in the future.
    
    ```js
    import { unstable_addTransitionType as addTransitionType } from 'react';
    
    startTransition(() => {
      addTransitionType('my-transition-type');
      setState(...);
    });
    ```
    
    If multiple transitions get entangled this is additive and all
    Transition Types are collected. You can also add more than one type to a
    Transition (hence the `add` prefix).
    
    Transition Types are reset after each commit. Meaning that `<Suspense>`
    revealing after a `startTransition` does not get any View Transition
    types associated with it.
    
    Note that the scoping rules for this is a little "wrong" in this
    implementation. Ideally it would be scoped to the nearest outer
    `startTransition` and grouped with any `setState` inside of it.
    Including Actions. However, since we currently don't have AsyncContext
    on the client, it would be too easy to drop a Transition Type if there
    were no other `setState` in the same `await` task. Multiple Transitions
    are entangled together anyway right now as a result. So this just tracks
    a global of all pending Transition Types for the next Transition. An
    inherent tricky bit with this API is that you could update multiple
    roots. In that case it should ideally be associated with each root.
    Transition Tracing solves this by associating a Transition with any
    updates that are later collected but this suffers from the problem
    mentioned above. Therefore, I just associate Transition Types with one
    root - the first one to commit. Since the View Transitions across roots
    are sequential anyway it kind of makes sense that only one really is the
    cause and the other one is subsequent.
    
    Transition Types can be used to apply different animations based on what
    caused the Transition. You have three different ways to choose from for
    how to use them:
    
    ## CSS
    
    It integrates with [View Transition
    Types](https://www.w3.org/TR/css-view-transitions-2/#active-view-transition-pseudo-examples)
    so you can match different animations based on CSS scopes:
    
    ```css
    :root:active-view-transition-type(my-transition-type) {
      &::view-transition-...(...) {
        ...
      }
    }
    ```
    
    This is kind of a PITA to write though and if you have a CSS library
    that provide View Transition Classes it's difficult to import those into
    these scopes.
    
    ## Class per Type
    
    This PR also adds an object-as-map form that can be passed to all
    `className` properties:
    
    ```js
    <ViewTransition className={{
      'my-navigation-type': 'hello',
      'default': 'world',
    }}>
    ```
    
    If multiple types match, then they're joined together. If no types match
    then the special `"default"` entry is used instead. If any type has the
    value `"none"` then that wins and the ViewTransition is disabled (not
    assigned a name).
    
    These can be combined with `enter`/`exit`/`update`/`layout`/`share`
    props to match based on kind of trigger and Transition Type.
    
    ```js
    <ViewTransition enter={{
      'navigation-back': 'enter-right',
      'navigation-forward': 'enter-left',
    }}
    exit={{
      'navigation-back': 'exit-right',
      'navigation-forward': 'exit-left',
    }}>
    ```
    
    ## Events
    
    In addition, you can also observe the types in the View Transition Event
    callbacks as the second argument. That way you can pick different
    imperative Animations based on the cause.
    
    ```js
    <ViewTransition onUpdate={(inst, types) => {
      if (types.includes('navigation-back')) {
        ...
      } else if (types.includes('navigation-forward')) {
        ...
      } else {
        ...
      }
    }}>
    ```
    
    ## Future
    
    In the future we might expose types to `useEffect` for more general
    purpose usage. This would also allow non-View Transition based
    Animations such as existing libraries to use this same feature to
    coordinate the same concept.
    
    We might also allow richer objects to be passed along here. Only the
    strings would apply to View Transitions but the imperative code and
    effects could do something else with them.

diff --git a/packages/react/index.js b/packages/react/index.js
index 7522a32d18..711a044455 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -52,6 +52,7 @@ export {
   unstable_SuspenseList,
   unstable_TracingMarker,
   unstable_ViewTransition,
+  unstable_addTransitionType,
   unstable_getCacheForType,
   unstable_useCacheRefresh,
   useId,

commit ed8b68dd178af17a2dd36c8678f81f8b454559a9
Author: Sebastian "Sebbie" Silbermann <sebastian.silbermann@vercel.com>
Date:   Thu Feb 13 18:26:36 2025 +0100

    Stop exporting dev-only methods in OSS production builds (#32200)

diff --git a/packages/react/index.js b/packages/react/index.js
index 711a044455..af4cd4b0c1 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -23,8 +23,6 @@ export type ElementRef<C> = React$ElementRef<C>;
 export type Config<Props, DefaultProps> = React$Config<Props, DefaultProps>;
 export type ChildrenArray<+T> = $ReadOnlyArray<ChildrenArray<T>> | T;
 
-// Export all exports so that they're available in tests.
-// We can't use export * from in Flow for some reason.
 export {
   __CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,
   __COMPILER_RUNTIME,

commit 70f1d766e8ae7ca3701193abb8c8a9f2fdbdaa9d
Author: Sam Zhou <sam@developersam.com>
Date:   Thu Feb 20 12:42:33 2025 -0500

    [flow] Eliminate usage of global React types in ReactNativeTypes.js (#32330)

diff --git a/packages/react/index.js b/packages/react/index.js
index af4cd4b0c1..92e1cf181e 100644
--- a/packages/react/index.js
+++ b/packages/react/index.js
@@ -17,6 +17,7 @@ export type Key = React$Key;
 export type Node = React$Node;
 export type Context<T> = React$Context<T>;
 export type Portal = React$Portal;
+export type RefSetter<-I> = React$RefSetter<I>;
 export type ElementProps<C> = React$ElementProps<C>;
 export type ElementConfig<C> = React$ElementConfig<C>;
 export type ElementRef<C> = React$ElementRef<C>;

</code></pre>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
        });
    </script>
</body>
</html>
    