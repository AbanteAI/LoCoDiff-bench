<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt: lib/segment/src/vector_storage/mod.rs - Grok 3</title>
    <link rel="stylesheet" href="../../../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>
<body>
    <header>
        <h1>Prompt: lib/segment/src/vector_storage/mod.rs</h1>
        <p><a href="../../../cases/x-ai_grok-3-beta/qdrant_lib_segment_src_vector_storage_mod.rs.html">‚Üê Back to Case</a> | <a href="../../../index.html">Home</a></p>
    </header>
    <main>
        <section>
            <h2>Prompt Content</h2>
            <pre><code class="language-plaintext"># Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- lib/segment/src/vector_storage/mod.rs

commit 73913ea61badae80937d44f65593830b79570955
Author: Andrey Vasnetsov <vasnetsov93@gmail.com>
Date:   Tue Jun 23 17:26:20 2020 +0200

    move segment into separate crate

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
new file mode 100644
index 000000000..ab57a4acb
--- /dev/null
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -0,0 +1,2 @@
+pub mod vector_storage;
+pub mod simple_vector_storage;

commit 8125611b6f397662459eabe840cf4f72efbaf44d
Author: Andrey Vasnetsov <vasnetsov93@gmail.com>
Date:   Tue Sep 22 11:39:48 2020 +0200

    WIP: memmap vector storage

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index ab57a4acb..c678b1d1b 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,2 +1,3 @@
 pub mod vector_storage;
 pub mod simple_vector_storage;
+pub mod memmap_vector_storage;

commit eab0ac83baffa257d3ffa120253a2f6ec71362aa
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Tue Dec 8 16:55:09 2020 +0100

    attempt to replace sled for storing vectors

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index c678b1d1b..1d2ee0fad 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,3 +1,4 @@
 pub mod vector_storage;
 pub mod simple_vector_storage;
 pub mod memmap_vector_storage;
+mod persisted_vector_storage;

commit 0909b70c2cddee57a60559d1320bf1e01f99aed0
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Sun Dec 13 00:26:55 2020 +0100

    replace sled with rocksdb

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 1d2ee0fad..240c3683b 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,4 +1,3 @@
 pub mod vector_storage;
 pub mod simple_vector_storage;
-pub mod memmap_vector_storage;
-mod persisted_vector_storage;
+pub mod memmap_vector_storage;
\ No newline at end of file

commit 8a85c109345708b6af14604fa212567aaea61c2a
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Mon Jan 4 22:59:22 2021 +0100

    use BLAS for vector dot production

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 240c3683b..c678b1d1b 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,3 +1,3 @@
 pub mod vector_storage;
 pub mod simple_vector_storage;
-pub mod memmap_vector_storage;
\ No newline at end of file
+pub mod memmap_vector_storage;

commit 3616631300ab6d2b2a2cefb002ff567448710e06
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Sun May 30 17:14:42 2021 +0200

    Filtrable hnsw (#26)
    
    * raw points scorer
    
    * raw point scorer for memmap storage
    
    * search interface prepare
    
    * graph binary saving + store PointOffsetId as u32
    
    * WIP: entry points
    
    * connect new link method
    
    * update libs + search layer method + visited list + search context + update rust
    
    * implement Euclid metric + always use MinHeap for priority queue
    
    * small refactor
    
    * search for 0 level entry
    
    * update visited pool to be lock free and thread safe
    
    * use ef_construct from graph layer struct + limit visited links to M
    
    * add metric pre-processing before on vector upsert
    
    * old hnsw heuristic
    
    * save hnsw graph for export
    
    * search method + tests
    
    * small fixes
    
    * add benchmark and profiler
    
    * build time optimizations
    
    * use SeaHash
    
    * remove unsed benchmark
    
    * merge hnsw graph function
    
    * WIP:HNSW index build function
    
    * HNSW build_index with additional indexing
    
    * refactor fixtures
    
    * graph save and load test
    
    * test and fixes for filterable HNSW
    
    * enable hnsw index for query planning
    
    * fix cardinality estimation tests + remove query planner as class
    
    * small refactor
    
    * store full copy of collection settings with collection + allow partial override on creation #16
    
    * API for updating collection parameters #16
    
    * refactor: move collection error -> types
    
    * report collection status in info API #17
    
    * update OpenAPI Schema

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index c678b1d1b..d8d18037d 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,3 +1,4 @@
 pub mod vector_storage;
 pub mod simple_vector_storage;
 pub mod memmap_vector_storage;
+mod mmap_vectors;

commit a667747369deabec7ef719bad17b0941619b46b1
Author: Konstantin <kgrech@users.noreply.github.com>
Date:   Tue Jun 29 09:17:50 2021 +0100

    Applied and enforced rust fmt code formatting tool (#48)
    
    * Apply cargo fmt command
    
    * Enabled cargo fmt on build

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index d8d18037d..efc825ca9 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,4 +1,4 @@
-pub mod vector_storage;
-pub mod simple_vector_storage;
 pub mod memmap_vector_storage;
 mod mmap_vectors;
+pub mod simple_vector_storage;
+pub mod vector_storage;

commit 93e0fb5c2c8f85f232bef82f48ab2b80c43f76cc
Author: Konstantin <kgrech@users.noreply.github.com>
Date:   Sat Jul 3 12:12:21 2021 +0100

    [CLIPPY] Fix the last portion of rules and enable CI check (#53)
    
    * [CLIPPY] Fixed the warning for references of the user defined types
    
    * [CLIPPY] Fix module naming issue
    
    * [CLIPPY] Fix the last set of warnings and enable clippy check during CI
    
    * Moved cargo fmt and cargo clippy into it's own action

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index efc825ca9..5ac5be4a9 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,4 +1,6 @@
 pub mod memmap_vector_storage;
 mod mmap_vectors;
 pub mod simple_vector_storage;
-pub mod vector_storage;
+mod vector_storage_base;
+
+pub use vector_storage_base::*;

commit 757652c59e579b31ade9a10ff5878bcc586f6314
Author: Ivan Pleshkov <pleshkov.ivan@gmail.com>
Date:   Sat Apr 9 20:47:11 2022 +0400

    Use chunked vec in vector storage (#457)
    
    avoid vec of vec in simple storage
    
    Co-authored-by: Andrey Vasnetsov <andrey@vasnetsov.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 5ac5be4a9..1de30c9b5 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,3 +1,4 @@
+pub mod chunked_vectors;
 pub mod memmap_vector_storage;
 mod mmap_vectors;
 pub mod simple_vector_storage;

commit ef67a2ec59180ca599b0c61cc957c45a56454410
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Mon Apr 11 17:43:02 2022 +0200

    Condition search benchmark (#435)
    
    * decouple payload index and vector storage
    
    * wip: test fixtures
    
    * conditional search benchmark
    
    * fmt
    
    * use arc iterator for filtered queries
    
    * fmt
    
    * enable all benches
    
    * fix warn
    
    * upd tests
    
    * fmt
    
    * Update lib/segment/src/fixtures/payload_context_fixture.rs
    
    Co-authored-by: Egor Ivkov <e.o.ivkov@gmail.com>
    
    * Update lib/segment/src/payload_storage/query_checker.rs
    
    Co-authored-by: Egor Ivkov <e.o.ivkov@gmail.com>
    
    Co-authored-by: Egor Ivkov <e.o.ivkov@gmail.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 1de30c9b5..d98d35758 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -2,6 +2,7 @@ pub mod chunked_vectors;
 pub mod memmap_vector_storage;
 mod mmap_vectors;
 pub mod simple_vector_storage;
+pub mod storage_points_iterator;
 mod vector_storage_base;
 
 pub use vector_storage_base::*;

commit 850e937c2a883e87622b43b3603be9ee1aaf02af
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Mon Jun 27 15:17:09 2022 +0200

    Storage points tracking refactoring (#750)
    
    * segment refactoring
    
    * rm points iterator
    
    * fmt

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index d98d35758..1de30c9b5 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -2,7 +2,6 @@ pub mod chunked_vectors;
 pub mod memmap_vector_storage;
 mod mmap_vectors;
 pub mod simple_vector_storage;
-pub mod storage_points_iterator;
 mod vector_storage_base;
 
 pub use vector_storage_base::*;

commit 128e49fcc3633e361df33818de6cca0aab95da10
Author: Ivan Pleshkov <pleshkov.ivan@gmail.com>
Date:   Fri Mar 3 20:46:17 2023 +0400

    integrate quantized data to storages (#1311)
    
    * integrate quantized data to storages
    
    * revert gitignore
    
    * are you happy clippy
    
    * quantize in optimizer
    
    * provide flag
    
    * fix segfault
    
    * skip quantization flag, update scores
    
    * use quantization flag
    
    * are you happy fmt
    
    * use quantization flag
    
    * quantized search test
    
    * are you happy fmt
    
    * refactor test, refactor scorer choosing
    
    * are you happy fmt
    
    * run quantization on segment builder
    
    * decrease testing parameters
    
    * simplify segment
    
    * update version
    
    * remove use_quantization flag
    
    * provide quantization config
    
    * quantization version up
    
    * euclid dist
    
    * add euclid test
    
    * saveload
    
    * fix initialization bugs
    
    * quantization lib version up
    
    * fix arm build
    
    * refactor scorer selecting
    
    * quant lib version up
    
    * are you happy fmt
    
    * are you happy fmt
    
    * are you happy clippy
    
    * add save/load test for simple storage
    
    * add comments
    
    * quantiles
    
    * quantization mmap
    
    * remove f32
    
    * mmap test
    
    * fix mmap slice
    
    * fix mmap test
    
    * use chunks for quantization storage
    
    * fix build
    
    * are you happy fmt
    
    * update quantization library
    
    * update quantization lib
    
    * update quantization lib
    
    * integrate api changes
    
    * are you happy fmt
    
    * change quantization api
    
    * additional checks in tests
    
    * update quantization version
    
    * fix unit tests
    
    * add quantization to storage config
    
    * use quantization for all cardinality search cases
    
    * Integrate quantization suggestions 2 (#1520)
    
    * review api
    
    * wip: refactor quantization integrations
    
    * wip: refactor quantization integrations
    
    * wip: fmt
    
    * include quantization into snapshot
    
    * fmt
    
    ---------
    
    Co-authored-by: Andrey Vasnetsov <andrey@vasnetsov.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 1de30c9b5..a7d598140 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,6 +1,7 @@
 pub mod chunked_vectors;
 pub mod memmap_vector_storage;
 mod mmap_vectors;
+mod quantized;
 pub mod simple_vector_storage;
 mod vector_storage_base;
 

commit e3448c0056978a47fb9c1b0d95742bebd2ae99f0
Author: Ivan Pleshkov <pleshkov.ivan@gmail.com>
Date:   Wed Mar 15 17:05:07 2023 +0400

    Remove deleted flags from vector storage (#1561)
    
    * remove deleted flags from vector storage
    
    * remove deleted flags from mmap
    
    * new simple vector storage format
    
    * are you happy clippy
    
    * remove id_tracker from raw_scorer
    
    * revert vector storage format changes
    
    ---------
    
    Co-authored-by: Andrey Vasnetsov <andrey@vasnetsov.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index a7d598140..b51eaae87 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,8 +1,10 @@
 pub mod chunked_vectors;
 pub mod memmap_vector_storage;
 mod mmap_vectors;
-mod quantized;
+pub mod quantized;
+pub mod raw_scorer;
 pub mod simple_vector_storage;
 mod vector_storage_base;
 
+pub use raw_scorer::*;
 pub use vector_storage_base::*;

commit 511704d88d8f915eb142e5873edbf20d249c3132
Author: Tim Vis√©e <tim+github@visee.me>
Date:   Thu Apr 20 12:06:29 2023 +0200

    Add support for deleted vectors in segments (#1724)
    
    * Use resize rather than while-push loop
    
    * Add deleted flags to simple vector storage
    
    * Add deleted flag to memmap vector storage
    
    * Map BitSlice on mmap file for deleted flags
    
    * Use vector specific deletion BitSlice in RawScorer
    
    * Use BitSlice for deleted points, fix check point logic, clarify names
    
    * Extract div_ceil function to shared module
    
    * We can use unchecked set and replace because we just checked the length
    
    * Add deleted count function to vector storage
    
    * Add vector storage point deletion tests
    
    * Keep deleted state in simple vector storage with update_from, add test
    
    * Keep deleted state in memmap vector storage with update_from, add test
    
    * Simplify div_ceil
    
    * Improve deletion handling in update_from in mmap vector storage
    
    * Improve performance, use trickery to get BitSlice view over deleted mmap
    
    * Use BitSlice where possible, construct BitVec more efficiently
    
    * Incorporate vector specific delete flags in quantized raw scorer
    
    * Don't pin MmapMut, it is not required
    
    * With quantization, keep mmap deleted flags in RAM for better performance
    
    * Advice the kernel to prepare deleted flags mmap for faster future access
    
    * Simplify deleted bitslice access, add bound check, remove unused function
    
    * Fix compilation on Windows
    
    * Cleanup
    
    * Rename delete functions to delete_{point,vec} to prevent confusion
    
    * Use then_some rather than match a boolean
    
    * Lock deleted flags in memory only when quantization is available
    
    * Add docs and stabilize issue link to dev_ceil
    
    * Flush deleted mmap when closing segment
    
    This requires us to to wrap the memory map struct in an Arc and Mutex.
    Though this may look inefficient, it doesn't have a negative side effect
    on deleted flag performance, because the flags are accessed through a
    BitSlice that is separate and doesn't use locking.
    
    * Rename some point functions to vec because that makes more sense
    
    * Simplify delete flag fetching option, use deref func instead of asterisk
    
    * Do not calculate slice size manually, use size_of_val
    
    * remove test raw scorer
    
    * use deref in check
    
    ---------
    
    Co-authored-by: Andrey Vasnetsov <andrey@vasnetsov.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index b51eaae87..46f932b57 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -8,3 +8,21 @@ mod vector_storage_base;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;
+
+/// Calculates the quotient of self and rhs, rounding the result towards positive infinity.
+///
+/// # Panics
+///
+/// This function will panic if rhs is zero.
+///
+/// # Overflow behavior
+///
+/// On overflow, this function will panic if overflow checks are enabled (default in debug mode)
+/// and wrap if overflow checks are disabled (default in release mode).
+// Can be replaced with stdlib once it stabilizes:
+// - <https://github.com/rust-lang/rust/issues/88581>
+// - <https://doc.rust-lang.org/std/primitive.usize.html#method.div_ceil>
+#[inline]
+const fn div_ceil(a: usize, b: usize) -> usize {
+    (a + b - 1) / b
+}

commit 45ae3e048b15f10e71b5825a9fc00ee7b7676390
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Tue May 9 18:01:01 2023 +0200

    Dynamic mmap vector storage (#1838)
    
    * wip: chunked mmap
    
    * Fix typo
    
    * insert and get methods
    
    * dynamic bitvec
    
    * clippy
    
    * wip: vector storage
    
    * wip: fmt
    
    * wip: mmap chunks
    
    * wip: mmap problems
    
    * Share transmuted mutable reference over mmap
    
    * option to enable appendable mmap vectors
    
    * fmt
    
    * rename storage status file
    
    * update tests
    
    * fix get deleted value range
    
    * add recovery to vector storage tests
    
    * add flush to tests
    
    * fix transmute from immutable to mutable
    
    * make transmuted pointer private
    
    * remove unused unsafe functions
    
    * force WAL flush if wait=true
    
    * move wal flush into updater thread
    
    * remove flush from update api
    
    * Minimize pub visibility for specialized/dangerous functions
    
    * Allocate vector with predefined capacity
    
    * Inline format parameters
    
    * Assert we have multiple chunks while testing, test is useless otherwise
    
    * Remove unnecessary scope
    
    * Remove unnecessary dereference
    
    * Random bool has 0.5 as standard distribution, use iter::repeat_with
    
    * Replace RemovableMmap::new with Default derive
    
    * Rename len to num_flags
    
    * Use Option replace as it is convention alongside take
    
    * Add FileId enum to replace error prone manual ID rotating
    
    * Use debug_assert_eq where applicable
    
    * Refactor drop and set to replace
    
    * Change default chunk size for chunked mmap vectors to 32MB
    
    This change is made as per GitHub review, because allocating a few
    storages with 128MB would take a significant amount of time and storage.
    
    See: https://github.com/qdrant/qdrant/pull/1838#discussion_r1187215475
    
    * Replace for-loops with iterators
    
    * Draft: add typed mmap to improve code safety (#1860)
    
    * Add typed mmap
    
    * Replace some crude mmap usages with typed mmap
    
    * Use typed mmap for deleted flags
    
    * Simplify dynamic mmap flags a lot with new typed mmap, remove flags option
    
    * Reformat
    
    * Remove old mmap functions that are now unused
    
    * Reimplement mmap locking for mmap_vectors
    
    * Add MmapBitSlice tests
    
    * Replace MmapChunk with new typed mmap
    
    * Update docs
    
    * Clean-up
    
    * Disable alignment assertions on Windows for now
    
    * Rename mmap lock to mlock to prevent confusion with lockable types
    
    * one more small test
    
    * Some review fixes
    
    * Add aliasing note
    
    * Add basic error handling in typed mmap constructors
    
    * Use typed mmap error handling throughout project
    
    * Move mmap type module to common
    
    * Fix transmute functions being unsound
    
    See https://github.com/qdrant/qdrant/pull/1860#discussion_r1188593854
    
    ---------
    
    Co-authored-by: Andrey Vasnetsov <andrey@vasnetsov.com>
    
    ---------
    
    Co-authored-by: timvisee <tim@visee.me>
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 46f932b57..f977a4a75 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,4 +1,8 @@
+pub mod appendable_mmap_vector_storage;
+mod chunked_mmap_vectors;
+mod chunked_utils;
 pub mod chunked_vectors;
+mod dynamic_mmap_flags;
 pub mod memmap_vector_storage;
 mod mmap_vectors;
 pub mod quantized;
@@ -6,6 +10,9 @@ pub mod raw_scorer;
 pub mod simple_vector_storage;
 mod vector_storage_base;
 
+#[cfg(test)]
+mod tests;
+
 pub use raw_scorer::*;
 pub use vector_storage_base::*;
 

commit f5dfeeff4c4baf35045bc6904d88076f2e58d094
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Mon May 22 20:32:35 2023 +0200

    Fixes for group-by (#1938)
    
    * fix payload seletor
    
    * clippy
    
    * except cardinality estimation
    
    * implement match except iterator and api
    
    * use except instead of must-not + test
    
    * Fix doc error
    
    * Update lib/collection/src/grouping/group_by.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/segment/src/index/field_index/map_index.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/segment/src/index/field_index/map_index.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/segment/src/index/field_index/map_index.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/segment/src/index/query_optimization/condition_converter.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/segment/src/index/query_optimization/condition_converter.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/segment/src/index/query_optimization/condition_converter.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/segment/src/vector_storage/mod.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/segment/src/index/field_index/map_index.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    * Update lib/collection/src/grouping/group_by.rs
    
    Co-authored-by: Arnaud Gourlay <arnaud.gourlay@gmail.com>
    
    * Update lib/segment/src/index/field_index/map_index.rs
    
    Co-authored-by: Arnaud Gourlay <arnaud.gourlay@gmail.com>
    
    * Update lib/segment/src/index/field_index/map_index.rs [skip ci]
    
    Co-authored-by: Luis Coss√≠o <luis.cossio@qdrant.com>
    
    * fix: `except_on` and `match_on` now produce `Vec<Condition>`s
    
    * Apply suggestions from code review (lib/segment/src/index/field_index/map_index.rs)
    
    * fix: reset review suggestion
    
    * Remove unnecessary move
    
    * Use Rust idiomatic map_else rather than match-none-false
    
    * is-null -> is-empty
    
    * de-comment drop_collection
    
    ---------
    
    Co-authored-by: timvisee <tim@visee.me>
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    Co-authored-by: Arnaud Gourlay <arnaud.gourlay@gmail.com>
    Co-authored-by: Luis Coss√≠o <luis.cossio@qdrant.com>
    Co-authored-by: Luis Coss√≠o <luis.cossio@outlook.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index f977a4a75..cdca2f279 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -30,6 +30,6 @@ pub use vector_storage_base::*;
 // - <https://github.com/rust-lang/rust/issues/88581>
 // - <https://doc.rust-lang.org/std/primitive.usize.html#method.div_ceil>
 #[inline]
-const fn div_ceil(a: usize, b: usize) -> usize {
+pub(crate) const fn div_ceil(a: usize, b: usize) -> usize {
     (a + b - 1) / b
 }

commit 3867bf85c75c290128a83477c76415093c8c4dac
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Mon Jun 12 19:53:23 2023 +0200

    WIP: Async uring vector storage (#2024)
    
    * async raw scorer
    
    * fmt
    
    * Disable `async_raw_scorer` on non-Linux platforms
    
    * Refactor `async_raw_scorer.rs`
    
    * Conditionally enable `async_raw_scorer` in `segment` crate
    
    * Add `async_scorer` config parameter to the config...
    
    ...and enable `async_raw_scorer`, if config parameter is set to `true`
    
    * fixup! Add `async_scorer` config parameter to the config...
    
    Fix tests
    
    * Add basic `async_raw_scorer` test
    
    * Extend `async_raw_scorer` tests to be more extensive
    
    * Async uring vector storage io uring (#2041)
    
    * replace tokio-uring with just low level io-uring
    
    * fnt
    
    * minor fixes
    
    * add sync
    
    * wip: try to use less submissions
    
    * fmt
    
    * fix uring size
    
    * larger buffer
    
    * check for overflow
    
    * submit with re-try
    
    * mmap owns uring context
    
    * large disk parallelism
    
    * rollbacK: large disk parallelism
    
    * fix windows build
    
    * explicitly panic on uring fail
    
    * fix windows build again
    
    * use async scorer in the quantization re-scoring
    
    * refactor
    
    * rename UringReader
    
    * refactor buffers
    
    * fix for windows
    
    * error checking
    
    * fix handing
    
    ---------
    
    Co-authored-by: Roman Titov <ffuugoo@users.noreply.github.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index cdca2f279..ec1e6767c 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,4 +1,6 @@
 pub mod appendable_mmap_vector_storage;
+#[cfg(target_os = "linux")]
+pub mod async_raw_scorer;
 mod chunked_mmap_vectors;
 mod chunked_utils;
 pub mod chunked_vectors;
@@ -13,6 +15,10 @@ mod vector_storage_base;
 #[cfg(test)]
 mod tests;
 
+#[cfg(target_os = "linux")]
+mod async_io;
+mod async_io_mock;
+
 pub use raw_scorer::*;
 pub use vector_storage_base::*;
 

commit 3839e75081fd22f607b83df70b580c3af8d6cdde
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Wed Aug 2 12:46:26 2023 +0200

    do not initialize io-uring object if async scorer is not enabled (#2372)
    
    * do not initialize io-uring object if async scorer is not enabled
    
    * explicilty example async scorer in test
    
    * fmt

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index ec1e6767c..6916edf24 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -18,6 +18,7 @@ mod tests;
 #[cfg(target_os = "linux")]
 mod async_io;
 mod async_io_mock;
+pub mod common;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;

commit 47274b2e634244b3af6bac131eee2dc885f112fe
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Tue Aug 15 11:57:20 2023 +0200

    Query scorer refactoring (#2430)
    
    * refactor query_scorer for simple raw_scorer impl
    
    * fmt
    
    * refactor query_scorer for simple raw_scorer impl
    
    * refactor query_scorer for simple raw_scorer impl
    
    * decouple scorer and storage, move storage into query scorer
    
    * eliminate quantized raw scorer
    
    * Update lib/api/src/grpc/google.protobuf.rs
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>
    
    ---------
    
    Co-authored-by: Tim Vis√©e <tim+github@visee.me>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 6916edf24..563dc6296 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -19,6 +19,7 @@ mod tests;
 mod async_io;
 mod async_io_mock;
 pub mod common;
+mod query_scorer;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;

commit 67c2a414d67318ff0528e3374e41f96b7d6874fb
Author: Luis Coss√≠o <luis.cossio@qdrant.com>
Date:   Thu Sep 14 12:37:14 2023 -0300

    Recommendation scorer internals (#2538)
    
    * use enum_dispatch on vector_index_base.rs
    
    * add reco_query_scorer.rs
    
    * smol refactor on reco_query_scorer
    
    * add PositiveNegative variant
    
    * recommend query scorer internals
    
    - missing tests
    
    * add test for RecoQuery
    
    * Revert "use enum_dispatch on vector_index_base.rs"
    
    This reverts commit 016e831d00d67ef01e64b4f7a76854e555cd9697.
    
    * remove enum_dispatch usage
    
    * disable score_internal implementation for QuantizedRecoQueryScorer
    
    * refactor test
    
    * refactor with latest preprocess changes
    
    * add reco scorer for async scorer
    
    * add iter_all() helper for RecoQuery
    
    * rename PositiveNegative -> Recommend,
    change variable names,
    refactor quantized query scorer
    
    * refactor new raw scorer
    
    * add tests for comparison raw against async and u8 quant
    
    * smol test improvements
    
    * fix error after rebase
    
    * fmt
    
    * finish score equivalency test, remove dbgs
    
    * make scorer builder for quantized storage
    
    * move query preprocessing to `new()` of quantized query scorers
    
    * self review
    
    * review suggestions
    
    ---------
    
    Co-authored-by: generall <andrey@vasnetsov.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 563dc6296..4b8ba00d7 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -19,6 +19,7 @@ mod tests;
 mod async_io;
 mod async_io_mock;
 pub mod common;
+pub mod query;
 mod query_scorer;
 
 pub use raw_scorer::*;

commit cc69ec7fec5b8ec3d1b2cf4f63fdac33bf1c50da
Author: Arnaud Gourlay <arnaud.gourlay@gmail.com>
Date:   Mon Oct 30 11:27:36 2023 +0100

    Simple sparse vector storage (#2806)
    
    * Simple sparse vector storage
    
    * better todo

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 4b8ba00d7..9fc941907 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -18,9 +18,11 @@ mod tests;
 #[cfg(target_os = "linux")]
 mod async_io;
 mod async_io_mock;
+mod bitvec;
 pub mod common;
 pub mod query;
 mod query_scorer;
+mod simple_sparse_vector_storage;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;

commit cbf1811eaa3e2e0de68c07fb2cd484a16faf8b3d
Author: Arnaud Gourlay <arnaud.gourlay@gmail.com>
Date:   Thu Nov 2 14:59:18 2023 +0100

    Raw scorer for sparse vectors (#2915)
    
    * Raw scorer for sparse vectors
    
    * sparse vector storage trait
    
    * use get sparse vector fn
    
    * remove dedicated types
    
    ---------
    
    Co-authored-by: Ivan Pleshkov <pleshkov.ivan@gmail.com>

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 9fc941907..5d4bab946 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -23,6 +23,7 @@ pub mod common;
 pub mod query;
 mod query_scorer;
 mod simple_sparse_vector_storage;
+mod sparse_raw_scorer;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;

commit d5f98d8205f61dcfa53d0ecbd6c363c7d7aa501e
Author: Arnaud Gourlay <arnaud.gourlay@gmail.com>
Date:   Fri Nov 3 16:23:05 2023 +0100

    SparseVectorIndex implements VectorIndex (#2900)
    
    * SparseVector implements VectorIndex
    
    * dedicated telemetry
    
    * conflict
    
    * easy code reviews
    
    * simplify tracking indexed points count
    
    * move telemetry conversion to sparse file
    
    * move max_result_count out of inverted index trait
    
    * unify sparse vector fixtures
    
    * simpler conversion
    
    * add todo regarding OOM potential
    
    * reuse check deleted from raw scorer with TODO
    
    * change new to open to handle mmap index

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 5d4bab946..5de77b8d5 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -22,8 +22,8 @@ mod bitvec;
 pub mod common;
 pub mod query;
 mod query_scorer;
-mod simple_sparse_vector_storage;
-mod sparse_raw_scorer;
+pub mod simple_sparse_vector_storage;
+pub mod sparse_raw_scorer;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;

commit 6534ea9af9fc51ab94c83af81c65dcb0b429827b
Author: Tim Vis√©e <tim+github@visee.me>
Date:   Fri Nov 17 12:55:25 2023 +0100

    Use stabilized `div_ceil` from from `std` (#2770)

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 5de77b8d5..24fb81bdb 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -27,21 +27,3 @@ pub mod sparse_raw_scorer;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;
-
-/// Calculates the quotient of self and rhs, rounding the result towards positive infinity.
-///
-/// # Panics
-///
-/// This function will panic if rhs is zero.
-///
-/// # Overflow behavior
-///
-/// On overflow, this function will panic if overflow checks are enabled (default in debug mode)
-/// and wrap if overflow checks are disabled (default in release mode).
-// Can be replaced with stdlib once it stabilizes:
-// - <https://github.com/rust-lang/rust/issues/88581>
-// - <https://doc.rust-lang.org/std/primitive.usize.html#method.div_ceil>
-#[inline]
-pub(crate) const fn div_ceil(a: usize, b: usize) -> usize {
-    (a + b - 1) / b
-}

commit d5a705e0faaf667641b82e53708fb2119a44d272
Author: Ivan Pleshkov <pleshkov.ivan@gmail.com>
Date:   Tue Dec 5 20:32:23 2023 +0100

    Sparse vectors advanced search api support (#3128)
    
    * sparse vectors query scorer
    
    plain search test without internals
    
    fix sparse_vector_index_plain_search
    
    fix async scorer build
    
    fix unit tests
    
    are you happy fmt
    
    sparse index with full query support
    
    fix benches, use exact flag to force plain search
    
    add alias and comment to exact flag
    
    fix tests
    
    recommendations TODOs fix
    
    add simple test
    
    add todo
    
    refactor index
    
    test vs comparison dense and sparse discovery
    
    are you happy fmt
    
    propogate error from avg negatives
    
    reuse filtered points list
    
    rollback api changes
    
    better discovery test
    
    are you happy fmt
    
    rollback openapi
    
    fix build
    
    fix tests
    
    review remark recommendations
    
    review remarks
    
    review remarks
    
    codespell
    
    integrate plain search
    
    Update lib/collection/src/recommendations.rs
    
    Co-authored-by: Luis Coss√≠o <luis.cossio@qdrant.com>
    
    Update lib/collection/src/recommendations.rs
    
    Co-authored-by: Luis Coss√≠o <luis.cossio@qdrant.com>
    
    Update lib/collection/src/recommendations.rs
    
    Co-authored-by: Luis Coss√≠o <luis.cossio@qdrant.com>
    
    fix comment of plain search
    
    Update lib/collection/src/recommendations.rs
    
    Co-authored-by: Luis Coss√≠o <luis.cossio@qdrant.com>
    
    fix tests
    
    * simplify search query function

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 24fb81bdb..6187104e8 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -23,7 +23,6 @@ pub mod common;
 pub mod query;
 mod query_scorer;
 pub mod simple_sparse_vector_storage;
-pub mod sparse_raw_scorer;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;

commit 8c93500998e7fb1fa8d6435d6561dd4316ab7b2d
Author: Arnaud Gourlay <arnaud.gourlay@gmail.com>
Date:   Wed Dec 13 17:08:37 2023 +0000

    Rename SimpleDenseVectorStorage (#3223)

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 6187104e8..3081765c8 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -9,7 +9,7 @@ pub mod memmap_vector_storage;
 mod mmap_vectors;
 pub mod quantized;
 pub mod raw_scorer;
-pub mod simple_vector_storage;
+pub mod simple_dense_vector_storage;
 mod vector_storage_base;
 
 #[cfg(test)]

commit d1d69d12e6d9b8c0f8d2302c494bc7c1e2601e40
Author: Arnaud Gourlay <arnaud.gourlay@gmail.com>
Date:   Wed Feb 28 12:30:44 2024 +0100

    Clearer names for dense storage implementations (#3712)

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 3081765c8..3c5dee030 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,12 +1,12 @@
-pub mod appendable_mmap_vector_storage;
+pub mod appendable_mmap_dense_vector_storage;
 #[cfg(target_os = "linux")]
 pub mod async_raw_scorer;
 mod chunked_mmap_vectors;
 mod chunked_utils;
 pub mod chunked_vectors;
 mod dynamic_mmap_flags;
-pub mod memmap_vector_storage;
-mod mmap_vectors;
+pub mod memmap_dense_vector_storage;
+mod mmap_dense_vectors;
 pub mod quantized;
 pub mod raw_scorer;
 pub mod simple_dense_vector_storage;

commit 1808d2a9c11c1d67aaa43febbe0191681c4b48ae
Author: Arnaud Gourlay <arnaud.gourlay@gmail.com>
Date:   Wed Mar 20 19:11:22 2024 +0100

    Multi dense vector simple storage (#3718)
    
    * Multi dense vector simple storage
    
    * code review first pass
    
    * fix in-memory storage
    
    * comment type
    
    * fix vector insertion for open as well

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 3c5dee030..c9fed5211 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -22,6 +22,7 @@ mod bitvec;
 pub mod common;
 pub mod query;
 mod query_scorer;
+mod simple_multi_dense_vector_storage;
 pub mod simple_sparse_vector_storage;
 
 pub use raw_scorer::*;

commit 1e6998e2508bd141f5b606dbcd192e97b0ef242c
Author: Ivan Pleshkov <pleshkov.ivan@gmail.com>
Date:   Thu Mar 21 13:58:02 2024 +0100

    Multivector hnsw test (#3880)
    
    * colbert query scorers (#3713)
    
    * colbert query scorers
    
    fix build after rebase
    
    * review remarks
    
    multivector hnsw test
    
    * fixes after rebase
    
    * fix test
    
    * fix build after rebase
    
    * review remark

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index c9fed5211..060a27f0d 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -22,7 +22,7 @@ mod bitvec;
 pub mod common;
 pub mod query;
 mod query_scorer;
-mod simple_multi_dense_vector_storage;
+pub mod simple_multi_dense_vector_storage;
 pub mod simple_sparse_vector_storage;
 
 pub use raw_scorer::*;

commit 6b3629e2fc77aee1aa63b361ed827916497289b3
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Mon Mar 25 13:21:21 2024 +0100

    Refactor vector storage infra to be generic over vector element type (#3900)
    
    * make SimpleDenseVectorStorage generic against VectorElementType
    
    * make generic loading of the simple dense storage
    
    * move memmap_dense_vector_storage
    
    * move mmap_dense_vectors
    
    * move appendable_mmap_dense_vector_storage
    
    * fmt
    
    * move dynamic_mmap_flags
    
    * move simple_dense_vector_storage
    
    * move PrimitiveVectorElement
    
    * fmt
    
    * make MmapDenseVectors generic
    
    * make MemmapDenseVectorStorage generic to data type
    
    * fix UringReader on non-linux platform
    
    * make ChunkedMmapVectors generic of the vector element type
    
    * make AppendableMmapDenseVectorStorage generic of the vector element type
    
    * make PrimitiveVectorElement trait even more global
    
    * make Metric generic over vector element type and refactor it into GenericMetric
    
    * make DenseVectorStorage generic over vector element
    
    * remove temorary trait for migrating Metric
    
    * make CustomQueryScorer generic against vector element type
    
    * refactor PrimitiveVectorElement to use Cow and allow owned conversions
    
    * Move score post-processing out of metric object
    
    * naive implementation of metrics for byte vectors

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 060a27f0d..7bb285751 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,15 +1,10 @@
-pub mod appendable_mmap_dense_vector_storage;
 #[cfg(target_os = "linux")]
 pub mod async_raw_scorer;
 mod chunked_mmap_vectors;
 mod chunked_utils;
 pub mod chunked_vectors;
-mod dynamic_mmap_flags;
-pub mod memmap_dense_vector_storage;
-mod mmap_dense_vectors;
 pub mod quantized;
 pub mod raw_scorer;
-pub mod simple_dense_vector_storage;
 mod vector_storage_base;
 
 #[cfg(test)]
@@ -20,6 +15,7 @@ mod async_io;
 mod async_io_mock;
 mod bitvec;
 pub mod common;
+pub mod dense;
 pub mod query;
 mod query_scorer;
 pub mod simple_multi_dense_vector_storage;

commit 8bdc8a3caf49d34f7bd6f90239f791684a473a5a
Author: Ivan Pleshkov <pleshkov.ivan@gmail.com>
Date:   Tue May 7 10:28:31 2024 +0200

    Mmap multivector storage (#4106)
    
    * mmap multivector storage
    
    update_from
    
    fix build
    
    are you happy fmt
    
    fix bug
    
    share multivector storages tests
    
    * review remarks

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 7bb285751..69fb0a824 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -16,9 +16,9 @@ mod async_io_mock;
 mod bitvec;
 pub mod common;
 pub mod dense;
+pub mod multi_dense;
 pub mod query;
 mod query_scorer;
-pub mod simple_multi_dense_vector_storage;
 pub mod simple_sparse_vector_storage;
 
 pub use raw_scorer::*;

commit 649560fefd0cce811d8ada7d5c280991bfbb233f
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Wed Aug 7 16:34:58 2024 +0200

    Use mmap lock as default vector storage (#4828)
    
    * add force_ram parameter to chuncked mmap vector storage
    
    * enable mlocked mmap vector storage on unix by default
    
    * regen openapi
    
    * add mlock on creation of chunck
    
    * minor unrelated renaming
    
    * rollback changes in LockedChunkedMmap
    
    * fmt
    
    * make AppendableMmapDenseVectorStorage generic of storage type
    
    * make AppendableMmapMultiDenseVectorStorage generic of storage type
    
    * implement initialization of InRamChunkedMmap
    
    * implement MultiDenseAppendableInRam and variations
    
    * enable InRamChunkedMmap for multivectors
    
    * use same CHUNK_SIZE for mmap and regular chuncked vectors
    
    * enable InRamChunkedMmap by default
    
    * fix tests
    
    * rollback usage of InRamChunkedMmap by default
    
    * review changes
    
    * add assertion on chunk_capacity [skip-ci]

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 69fb0a824..95e1c608d 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -14,8 +14,10 @@ mod tests;
 mod async_io;
 mod async_io_mock;
 mod bitvec;
+pub mod chunked_vector_storage;
 pub mod common;
 pub mod dense;
+mod in_ram_persisted_vectors;
 pub mod multi_dense;
 pub mod query;
 mod query_scorer;

commit 7c5b8a0e16ab9115cc72a14ffcd331a09280371e
Author: Andrey Vasnetsov <andrey@vasnetsov.com>
Date:   Thu Aug 15 12:04:39 2024 +0200

    Refactor chunked mmaps (#4888)
    
    * remove dependency on segment in chunked mmap
    
    * move chunked utils to memory subcrate

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 95e1c608d..dd83b5493 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -1,7 +1,6 @@
 #[cfg(target_os = "linux")]
 pub mod async_raw_scorer;
 mod chunked_mmap_vectors;
-mod chunked_utils;
 pub mod chunked_vectors;
 pub mod quantized;
 pub mod raw_scorer;

commit c10c145a754b3825a60aaaa143fe91b5b98502b0
Author: Luis Coss√≠o <luis.cossio@qdrant.com>
Date:   Wed Nov 27 11:45:16 2024 -0600

    Compatibility for mmap sparse vectors (#5454)
    
    * implement mmap sparse vector storage
    
    * add to VectorStorageEnum
    
    * clippy
    
    * add tests, fix both simple and mmap storages
    
    * smol correction on total_vector_count
    
    * add sparse storage type to config
    
    * fix reading config without storage type
    
    * generate openapi
    
    * use blob_store by path
    
    * hidden setting to enable new storage
    
    * validate existing path in `BlobStore::open()`
    
    * use new dir for each sparse vector name
    
    * fix and rename `max_point_offset`
    
    Plus some extra refactors
    
    * add storage compat test, to always check both storages work
    
    * fix opening of storage + other misc fixes
    
    * FIX!!!
    
    `Unset` operations in the Tracker weren't updating the
    `next_pointer_id`. So, when reopening the storage, those points wouldn't
    get marked as deleted in the bitslice, thus creating the illusion that
    they should exist, when they did not.
    
    * refactor naming from `iter_*` to `for_each_*`
    
    * fix checking for BlobStore existance
    
    * fix typo
    
    * fix error message
    
    * better docs for open_or_create
    
    * fix after rebase

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index dd83b5493..8741200e6 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -17,6 +17,7 @@ pub mod chunked_vector_storage;
 pub mod common;
 pub mod dense;
 mod in_ram_persisted_vectors;
+pub mod mmap_sparse_vector_storage;
 pub mod multi_dense;
 pub mod query;
 mod query_scorer;

commit 443358dbe71139d5f6fe5fdf17531c5b005396ce
Author: Luis Coss√≠o <luis.cossio@qdrant.com>
Date:   Wed Nov 27 13:46:57 2024 -0600

    restructure sparse storages module (#5532)

diff --git a/lib/segment/src/vector_storage/mod.rs b/lib/segment/src/vector_storage/mod.rs
index 8741200e6..46f1fea99 100644
--- a/lib/segment/src/vector_storage/mod.rs
+++ b/lib/segment/src/vector_storage/mod.rs
@@ -17,11 +17,10 @@ pub mod chunked_vector_storage;
 pub mod common;
 pub mod dense;
 mod in_ram_persisted_vectors;
-pub mod mmap_sparse_vector_storage;
 pub mod multi_dense;
 pub mod query;
 mod query_scorer;
-pub mod simple_sparse_vector_storage;
+pub mod sparse;
 
 pub use raw_scorer::*;
 pub use vector_storage_base::*;

</code></pre>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
        });
    </script>
</body>
</html>
    