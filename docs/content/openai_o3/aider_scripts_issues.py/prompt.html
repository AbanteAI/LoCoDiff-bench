<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt: scripts/issues.py - o3</title>
    <link rel="stylesheet" href="../../../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>
<body>
    <header>
        <h1>Prompt: scripts/issues.py</h1>
        <p><a href="../../../cases/openai_o3/aider_scripts_issues.py.html">‚Üê Back to Case</a> | <a href="../../../index.html">Home</a></p>
    </header>
    <main>
        <section>
            <h2>Prompt Content</h2>
            <pre><code class="language-plaintext"># Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- scripts/issues.py

commit eb078906b309e5d730b1bca7a0c738a511595445
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Sep 20 11:09:43 2024 -0700

    feat: Add issues.py script

diff --git a/scripts/issues.py b/scripts/issues.py
new file mode 100644
index 00000000..e69de29b

commit 1ede98bc07d8cad07d155e439f35ab602825d2f3
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:09:44 2024 -0700

    feat: Implement GitHub issue analysis script

diff --git a/scripts/issues.py b/scripts/issues.py
index e69de29b..1d00bb74 100644
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -0,0 +1,80 @@
+import os
+import requests
+from collections import defaultdict
+from datetime import datetime
+from dotenv import load_dotenv
+
+# Load environment variables from .env file
+load_dotenv()
+
+# GitHub API configuration
+GITHUB_API_URL = "https://api.github.com"
+REPO_OWNER = os.getenv("GITHUB_REPO_OWNER")
+REPO_NAME = os.getenv("GITHUB_REPO_NAME")
+TOKEN = os.getenv("GITHUB_TOKEN")
+
+headers = {
+    "Authorization": f"token {TOKEN}",
+    "Accept": "application/vnd.github.v3+json"
+}
+
+def get_issues(state="open"):
+    issues = []
+    page = 1
+    while True:
+        response = requests.get(
+            f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues",
+            headers=headers,
+            params={"state": state, "page": page, "per_page": 100}
+        )
+        response.raise_for_status()
+        page_issues = response.json()
+        if not page_issues:
+            break
+        issues.extend(page_issues)
+        page += 1
+    return issues
+
+def group_issues_by_subject(issues):
+    grouped_issues = defaultdict(list)
+    for issue in issues:
+        subject = issue['title'].split(':')[0].strip()  # Assuming subject is before the first colon
+        grouped_issues[subject].append(issue)
+    return grouped_issues
+
+def find_oldest_issue(subject):
+    all_issues = get_issues("all")
+    oldest_issue = None
+    oldest_date = datetime.now()
+    
+    for issue in all_issues:
+        if issue['title'].split(':')[0].strip() == subject:
+            created_at = datetime.strptime(issue['created_at'], "%Y-%m-%dT%H:%M:%SZ")
+            if created_at < oldest_date:
+                oldest_date = created_at
+                oldest_issue = issue
+    
+    return oldest_issue
+
+def main():
+    if not all([REPO_OWNER, REPO_NAME, TOKEN]):
+        print("Error: Missing environment variables. Please check your .env file.")
+        return
+
+    open_issues = get_issues()
+    grouped_open_issues = group_issues_by_subject(open_issues)
+    
+    for subject, issues in grouped_open_issues.items():
+        print(f"\nSubject: {subject}")
+        print(f"Open issues: {len(issues)}")
+        for issue in issues:
+            print(f"  - #{issue['number']}: {issue['title']}")
+        
+        oldest_issue = find_oldest_issue(subject)
+        if oldest_issue:
+            print(f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})")
+        else:
+            print("No oldest issue found")
+
+if __name__ == "__main__":
+    main()

commit 6b9fc86e9947d6f5d70b798663a71ffb364fa578
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:09:48 2024 -0700

    style: Run linter on Python script

diff --git a/scripts/issues.py b/scripts/issues.py
index 1d00bb74..4b7750d8 100644
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -1,7 +1,8 @@
 import os
-import requests
 from collections import defaultdict
 from datetime import datetime
+
+import requests
 from dotenv import load_dotenv
 
 # Load environment variables from .env file
@@ -13,10 +14,8 @@ REPO_OWNER = os.getenv("GITHUB_REPO_OWNER")
 REPO_NAME = os.getenv("GITHUB_REPO_NAME")
 TOKEN = os.getenv("GITHUB_TOKEN")
 
-headers = {
-    "Authorization": f"token {TOKEN}",
-    "Accept": "application/vnd.github.v3+json"
-}
+headers = {"Authorization": f"token {TOKEN}", "Accept": "application/vnd.github.v3+json"}
+
 
 def get_issues(state="open"):
     issues = []
@@ -25,7 +24,7 @@ def get_issues(state="open"):
         response = requests.get(
             f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues",
             headers=headers,
-            params={"state": state, "page": page, "per_page": 100}
+            params={"state": state, "page": page, "per_page": 100},
         )
         response.raise_for_status()
         page_issues = response.json()
@@ -35,27 +34,30 @@ def get_issues(state="open"):
         page += 1
     return issues
 
+
 def group_issues_by_subject(issues):
     grouped_issues = defaultdict(list)
     for issue in issues:
-        subject = issue['title'].split(':')[0].strip()  # Assuming subject is before the first colon
+        subject = issue["title"].split(":")[0].strip()  # Assuming subject is before the first colon
         grouped_issues[subject].append(issue)
     return grouped_issues
 
+
 def find_oldest_issue(subject):
     all_issues = get_issues("all")
     oldest_issue = None
     oldest_date = datetime.now()
-    
+
     for issue in all_issues:
-        if issue['title'].split(':')[0].strip() == subject:
-            created_at = datetime.strptime(issue['created_at'], "%Y-%m-%dT%H:%M:%SZ")
+        if issue["title"].split(":")[0].strip() == subject:
+            created_at = datetime.strptime(issue["created_at"], "%Y-%m-%dT%H:%M:%SZ")
             if created_at < oldest_date:
                 oldest_date = created_at
                 oldest_issue = issue
-    
+
     return oldest_issue
 
+
 def main():
     if not all([REPO_OWNER, REPO_NAME, TOKEN]):
         print("Error: Missing environment variables. Please check your .env file.")
@@ -63,18 +65,21 @@ def main():
 
     open_issues = get_issues()
     grouped_open_issues = group_issues_by_subject(open_issues)
-    
+
     for subject, issues in grouped_open_issues.items():
         print(f"\nSubject: {subject}")
         print(f"Open issues: {len(issues)}")
         for issue in issues:
             print(f"  - #{issue['number']}: {issue['title']}")
-        
+
         oldest_issue = find_oldest_issue(subject)
         if oldest_issue:
-            print(f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})")
+            print(
+                f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})"
+            )
         else:
             print("No oldest issue found")
 
+
 if __name__ == "__main__":
     main()

commit 04aecbe9a907396ce13aac212d05d47f4ef551af
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:10:54 2024 -0700

    chore: add shebang and chmod

diff --git a/scripts/issues.py b/scripts/issues.py
index 4b7750d8..7d348c40 100644
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -1,3 +1,5 @@
+#!/usr/bin/env python3
+
 import os
 from collections import defaultdict
 from datetime import datetime

commit ada7b3d7ab7a645f2117236371cfd488724e388e
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Sep 20 11:12:01 2024 -0700

    fix: make issues.py executable

diff --git a/scripts/issues.py b/scripts/issues.py
old mode 100644
new mode 100755

commit 81bad77fa9c3293c726e14d8bbba060039919319
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:12:02 2024 -0700

    refactor: Simplify script by hardcoding repository details

diff --git a/scripts/issues.py b/scripts/issues.py
index 7d348c40..588979bc 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -12,8 +12,8 @@ load_dotenv()
 
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"
-REPO_OWNER = os.getenv("GITHUB_REPO_OWNER")
-REPO_NAME = os.getenv("GITHUB_REPO_NAME")
+REPO_OWNER = "paul-gauthier"
+REPO_NAME = "aider"
 TOKEN = os.getenv("GITHUB_TOKEN")
 
 headers = {"Authorization": f"token {TOKEN}", "Accept": "application/vnd.github.v3+json"}
@@ -61,8 +61,8 @@ def find_oldest_issue(subject):
 
 
 def main():
-    if not all([REPO_OWNER, REPO_NAME, TOKEN]):
-        print("Error: Missing environment variables. Please check your .env file.")
+    if not TOKEN:
+        print("Error: Missing GITHUB_TOKEN environment variable. Please check your .env file.")
         return
 
     open_issues = get_issues()

commit 08d465c25230d103f73c936c03d1d5cb82ff702a
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:16:53 2024 -0700

    refactor: Improve efficiency by fetching all issues once and reusing the data

diff --git a/scripts/issues.py b/scripts/issues.py
index 588979bc..5031c0d3 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -45,8 +45,7 @@ def group_issues_by_subject(issues):
     return grouped_issues
 
 
-def find_oldest_issue(subject):
-    all_issues = get_issues("all")
+def find_oldest_issue(subject, all_issues):
     oldest_issue = None
     oldest_date = datetime.now()
 
@@ -65,7 +64,8 @@ def main():
         print("Error: Missing GITHUB_TOKEN environment variable. Please check your .env file.")
         return
 
-    open_issues = get_issues()
+    all_issues = get_issues("all")
+    open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
 
     for subject, issues in grouped_open_issues.items():
@@ -74,7 +74,7 @@ def main():
         for issue in issues:
             print(f"  - #{issue['number']}: {issue['title']}")
 
-        oldest_issue = find_oldest_issue(subject)
+        oldest_issue = find_oldest_issue(subject, all_issues)
         if oldest_issue:
             print(
                 f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})"

commit 40202a9cb8f0f72d6d440f69d203a3029c4f7955
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:18:09 2024 -0700

    chore: only print out issues with >1 in the group

diff --git a/scripts/issues.py b/scripts/issues.py
index 5031c0d3..0f3d3955 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -69,18 +69,19 @@ def main():
     grouped_open_issues = group_issues_by_subject(open_issues)
 
     for subject, issues in grouped_open_issues.items():
-        print(f"\nSubject: {subject}")
-        print(f"Open issues: {len(issues)}")
-        for issue in issues:
-            print(f"  - #{issue['number']}: {issue['title']}")
-
-        oldest_issue = find_oldest_issue(subject, all_issues)
-        if oldest_issue:
-            print(
-                f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})"
-            )
-        else:
-            print("No oldest issue found")
+        if len(issues) > 1:
+            print(f"\nSubject: {subject}")
+            print(f"Open issues: {len(issues)}")
+            for issue in issues:
+                print(f"  - #{issue['number']}: {issue['title']}")
+
+            oldest_issue = find_oldest_issue(subject, all_issues)
+            if oldest_issue:
+                print(
+                    f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})"
+                )
+            else:
+                print("No oldest issue found")
 
 
 if __name__ == "__main__":

commit dd1ae5bd3ae0ac577bf6250d09efe886893ab061
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:18:13 2024 -0700

    style: Wrap long lines in f-strings

diff --git a/scripts/issues.py b/scripts/issues.py
index 0f3d3955..4b1c9384 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -78,7 +78,8 @@ def main():
             oldest_issue = find_oldest_issue(subject, all_issues)
             if oldest_issue:
                 print(
-                    f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})"
+                    f"Oldest issue: #{oldest_issue['number']} (created on"
+                    f" {oldest_issue['created_at']})"
                 )
             else:
                 print("No oldest issue found")

commit 86dc25d3420d5bdf001f481ecd014ae296876632
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Sep 20 11:20:38 2024 -0700

    fix: Improve handling of issues with single subject

diff --git a/scripts/issues.py b/scripts/issues.py
index 4b1c9384..eb3ec524 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -69,20 +69,22 @@ def main():
     grouped_open_issues = group_issues_by_subject(open_issues)
 
     for subject, issues in grouped_open_issues.items():
-        if len(issues) > 1:
-            print(f"\nSubject: {subject}")
-            print(f"Open issues: {len(issues)}")
-            for issue in issues:
-                print(f"  - #{issue['number']}: {issue['title']}")
-
-            oldest_issue = find_oldest_issue(subject, all_issues)
-            if oldest_issue:
-                print(
-                    f"Oldest issue: #{oldest_issue['number']} (created on"
-                    f" {oldest_issue['created_at']})"
-                )
-            else:
-                print("No oldest issue found")
+        if len(issues) <= 1:
+            continue
+
+        print(f"\nSubject: {subject}")
+        print(f"Open issues: {len(issues)}")
+        for issue in issues:
+            print(f"  - #{issue['number']}: {issue['title']}")
+
+        oldest_issue = find_oldest_issue(subject, all_issues)
+        if oldest_issue:
+            print(
+                f"Oldest issue: #{oldest_issue['number']} (created on"
+                f" {oldest_issue['created_at']})"
+            )
+        else:
+            print("No oldest issue found")
 
 
 if __name__ == "__main__":

commit 619127925d06ae0a841f549a47953af50cb50b4c
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:20:39 2024 -0700

    feat: Add filter to only print issues matching "Uncaught xxx in xxx line ###" pattern

diff --git a/scripts/issues.py b/scripts/issues.py
index eb3ec524..7965ef3c 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -37,11 +37,15 @@ def get_issues(state="open"):
     return issues
 
 
+import re
+
 def group_issues_by_subject(issues):
     grouped_issues = defaultdict(list)
+    pattern = r"Uncaught .+ in .+ line \d+"
     for issue in issues:
-        subject = issue["title"].split(":")[0].strip()  # Assuming subject is before the first colon
-        grouped_issues[subject].append(issue)
+        if re.search(pattern, issue["title"]):
+            subject = issue["title"]
+            grouped_issues[subject].append(issue)
     return grouped_issues
 
 
@@ -50,7 +54,7 @@ def find_oldest_issue(subject, all_issues):
     oldest_date = datetime.now()
 
     for issue in all_issues:
-        if issue["title"].split(":")[0].strip() == subject:
+        if issue["title"] == subject:
             created_at = datetime.strptime(issue["created_at"], "%Y-%m-%dT%H:%M:%SZ")
             if created_at < oldest_date:
                 oldest_date = created_at
@@ -69,13 +73,10 @@ def main():
     grouped_open_issues = group_issues_by_subject(open_issues)
 
     for subject, issues in grouped_open_issues.items():
-        if len(issues) <= 1:
-            continue
-
-        print(f"\nSubject: {subject}")
+        print(f"\nIssue: {subject}")
         print(f"Open issues: {len(issues)}")
         for issue in issues:
-            print(f"  - #{issue['number']}: {issue['title']}")
+            print(f"  - #{issue['number']}")
 
         oldest_issue = find_oldest_issue(subject, all_issues)
         if oldest_issue:

commit 99d196d06e212188d6d01f47ba2be43101b92e68
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:20:42 2024 -0700

    style: format code

diff --git a/scripts/issues.py b/scripts/issues.py
index 7965ef3c..bb4dbf4b 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -39,6 +39,7 @@ def get_issues(state="open"):
 
 import re
 
+
 def group_issues_by_subject(issues):
     grouped_issues = defaultdict(list)
     pattern = r"Uncaught .+ in .+ line \d+"
@@ -81,8 +82,7 @@ def main():
         oldest_issue = find_oldest_issue(subject, all_issues)
         if oldest_issue:
             print(
-                f"Oldest issue: #{oldest_issue['number']} (created on"
-                f" {oldest_issue['created_at']})"
+                f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})"
             )
         else:
             print("No oldest issue found")

commit ba257d653cbeae6f337c6a8edfe87492f9a0fa66
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:21:34 2024 -0700

    fix: Move import re statement to top of file

diff --git a/scripts/issues.py b/scripts/issues.py
index bb4dbf4b..9b2053ff 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -1,6 +1,7 @@
 #!/usr/bin/env python3
 
 import os
+import re
 from collections import defaultdict
 from datetime import datetime
 
@@ -37,9 +38,6 @@ def get_issues(state="open"):
     return issues
 
 
-import re
-
-
 def group_issues_by_subject(issues):
     grouped_issues = defaultdict(list)
     pattern = r"Uncaught .+ in .+ line \d+"

commit 215833d32635ee4308175556ee99a7fd656e0c84
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:23:50 2024 -0700

    feat: Print issue URLs instead of issue numbers

diff --git a/scripts/issues.py b/scripts/issues.py
index 9b2053ff..8c8d21a9 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -75,12 +75,12 @@ def main():
         print(f"\nIssue: {subject}")
         print(f"Open issues: {len(issues)}")
         for issue in issues:
-            print(f"  - #{issue['number']}")
+            print(f"  - {issue['html_url']}")
 
         oldest_issue = find_oldest_issue(subject, all_issues)
         if oldest_issue:
             print(
-                f"Oldest issue: #{oldest_issue['number']} (created on {oldest_issue['created_at']})"
+                f"Oldest issue: {oldest_issue['html_url']} (created on {oldest_issue['created_at']})"
             )
         else:
             print("No oldest issue found")

commit 3d70f88bcc09e8775a73a090483ced82ad4b4e8f
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:23:53 2024 -0700

    style: Wrap long lines in f-strings

diff --git a/scripts/issues.py b/scripts/issues.py
index 8c8d21a9..6cc23ae6 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -80,7 +80,8 @@ def main():
         oldest_issue = find_oldest_issue(subject, all_issues)
         if oldest_issue:
             print(
-                f"Oldest issue: {oldest_issue['html_url']} (created on {oldest_issue['created_at']})"
+                f"Oldest issue: {oldest_issue['html_url']} (created on"
+                f" {oldest_issue['created_at']})"
             )
         else:
             print("No oldest issue found")

commit 7dd0a0f34898de6161a1d6f462785a7e0175667c
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Sep 20 11:32:30 2024 -0700

    fix: Handle cases where there are no related issues for a subject

diff --git a/scripts/issues.py b/scripts/issues.py
index 6cc23ae6..b181661b 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -72,19 +72,26 @@ def main():
     grouped_open_issues = group_issues_by_subject(open_issues)
 
     for subject, issues in grouped_open_issues.items():
+        oldest_issue = find_oldest_issue(subject, all_issues)
+        if not oldest_issue:
+            continue
+
+        related_issues = set(
+            issue['number'] for issue in issues
+        )
+        related_issues.add(oldest_issue['number'])
+        if len(related_issues) <= 1:
+            continue
+
         print(f"\nIssue: {subject}")
         print(f"Open issues: {len(issues)}")
         for issue in issues:
             print(f"  - {issue['html_url']}")
 
-        oldest_issue = find_oldest_issue(subject, all_issues)
-        if oldest_issue:
-            print(
-                f"Oldest issue: {oldest_issue['html_url']} (created on"
-                f" {oldest_issue['created_at']})"
-            )
-        else:
-            print("No oldest issue found")
+        print(
+            f"Oldest issue: {oldest_issue['html_url']} (created on"
+            f" {oldest_issue['created_at']})"
+        )
 
 
 if __name__ == "__main__":

commit c111e7a30ee4cad921ff8a5d164490a8fdef2eab
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:32:49 2024 -0700

    feat: Add confirmation prompt and logic to comment and close duplicate issues

diff --git a/scripts/issues.py b/scripts/issues.py
index b181661b..8e13c99e 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -62,6 +62,23 @@ def find_oldest_issue(subject, all_issues):
     return oldest_issue
 
 
+def comment_and_close_duplicate(issue, oldest_issue):
+    comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+    close_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
+    
+    comment_body = f"This looks like a duplicate of #{oldest_issue['number']}, so I'm going to close it so discussion can happen there. Please let me know if you think it's actually a distinct issue."
+    
+    # Post comment
+    response = requests.post(comment_url, headers=headers, json={"body": comment_body})
+    response.raise_for_status()
+    
+    # Close issue
+    response = requests.patch(close_url, headers=headers, json={"state": "closed"})
+    response.raise_for_status()
+    
+    print(f"  - Commented and closed issue #{issue['number']}")
+
+
 def main():
     if not TOKEN:
         print("Error: Missing GITHUB_TOKEN environment variable. Please check your .env file.")
@@ -93,6 +110,19 @@ def main():
             f" {oldest_issue['created_at']})"
         )
 
+        # Confirmation prompt
+        confirm = input("Do you want to comment and close duplicate issues? (y/n): ")
+        if confirm.lower() != 'y':
+            print("Skipping this group of issues.")
+            continue
+
+        # Comment and close duplicate issues
+        for issue in issues:
+            if issue['number'] != oldest_issue['number']:
+                comment_and_close_duplicate(issue, oldest_issue)
+
+        print(f"Oldest issue #{oldest_issue['number']} left open")
+
 
 if __name__ == "__main__":
     main()

commit 851f0653d66c22b558627eb1d842d4d81d73188e
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:32:53 2024 -0700

    style: Run linter on Python script

diff --git a/scripts/issues.py b/scripts/issues.py
index 8e13c99e..6c6ba52c 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -63,19 +63,25 @@ def find_oldest_issue(subject, all_issues):
 
 
 def comment_and_close_duplicate(issue, oldest_issue):
-    comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+    comment_url = (
+        f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+    )
     close_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
-    
-    comment_body = f"This looks like a duplicate of #{oldest_issue['number']}, so I'm going to close it so discussion can happen there. Please let me know if you think it's actually a distinct issue."
-    
+
+    comment_body = (
+        f"This looks like a duplicate of #{oldest_issue['number']}, so I'm going to close it so"
+        " discussion can happen there. Please let me know if you think it's actually a distinct"
+        " issue."
+    )
+
     # Post comment
     response = requests.post(comment_url, headers=headers, json={"body": comment_body})
     response.raise_for_status()
-    
+
     # Close issue
     response = requests.patch(close_url, headers=headers, json={"state": "closed"})
     response.raise_for_status()
-    
+
     print(f"  - Commented and closed issue #{issue['number']}")
 
 
@@ -93,10 +99,8 @@ def main():
         if not oldest_issue:
             continue
 
-        related_issues = set(
-            issue['number'] for issue in issues
-        )
-        related_issues.add(oldest_issue['number'])
+        related_issues = set(issue["number"] for issue in issues)
+        related_issues.add(oldest_issue["number"])
         if len(related_issues) <= 1:
             continue
 
@@ -105,20 +109,17 @@ def main():
         for issue in issues:
             print(f"  - {issue['html_url']}")
 
-        print(
-            f"Oldest issue: {oldest_issue['html_url']} (created on"
-            f" {oldest_issue['created_at']})"
-        )
+        print(f"Oldest issue: {oldest_issue['html_url']} (created on {oldest_issue['created_at']})")
 
         # Confirmation prompt
         confirm = input("Do you want to comment and close duplicate issues? (y/n): ")
-        if confirm.lower() != 'y':
+        if confirm.lower() != "y":
             print("Skipping this group of issues.")
             continue
 
         # Comment and close duplicate issues
         for issue in issues:
-            if issue['number'] != oldest_issue['number']:
+            if issue["number"] != oldest_issue["number"]:
                 comment_and_close_duplicate(issue, oldest_issue)
 
         print(f"Oldest issue #{oldest_issue['number']} left open")

commit 31655889cfea164a4f0997aadc4856e152a6b34d
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:38:54 2024 -0700

    feat: List open issues in descending order by number

diff --git a/scripts/issues.py b/scripts/issues.py
index 6c6ba52c..a1c5c958 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -106,10 +106,11 @@ def main():
 
         print(f"\nIssue: {subject}")
         print(f"Open issues: {len(issues)}")
-        for issue in issues:
-            print(f"  - {issue['html_url']}")
+        sorted_issues = sorted(issues, key=lambda x: x['number'], reverse=True)
+        for issue in sorted_issues:
+            print(f"  - #{issue['number']}: {issue['html_url']}")
 
-        print(f"Oldest issue: {oldest_issue['html_url']} (created on {oldest_issue['created_at']})")
+        print(f"Oldest issue: #{oldest_issue['number']}: {oldest_issue['html_url']} (created on {oldest_issue['created_at']})")
 
         # Confirmation prompt
         confirm = input("Do you want to comment and close duplicate issues? (y/n): ")

commit 0030d11ac79b6107d749d34a7e55702a69c5ba1e
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:38:57 2024 -0700

    style: Improve formatting and readability of issues.py script

diff --git a/scripts/issues.py b/scripts/issues.py
index a1c5c958..694ec342 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -106,11 +106,14 @@ def main():
 
         print(f"\nIssue: {subject}")
         print(f"Open issues: {len(issues)}")
-        sorted_issues = sorted(issues, key=lambda x: x['number'], reverse=True)
+        sorted_issues = sorted(issues, key=lambda x: x["number"], reverse=True)
         for issue in sorted_issues:
             print(f"  - #{issue['number']}: {issue['html_url']}")
 
-        print(f"Oldest issue: #{oldest_issue['number']}: {oldest_issue['html_url']} (created on {oldest_issue['created_at']})")
+        print(
+            f"Oldest issue: #{oldest_issue['number']}: {oldest_issue['html_url']} (created on"
+            f" {oldest_issue['created_at']})"
+        )
 
         # Confirmation prompt
         confirm = input("Do you want to comment and close duplicate issues? (y/n): ")

commit 2cabf9718c435f398f2c82cabe9deacf2f1dcb07
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:40:25 2024 -0700

    feat: Add comment count to issue output

diff --git a/scripts/issues.py b/scripts/issues.py
index 694ec342..8456988e 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -108,10 +108,10 @@ def main():
         print(f"Open issues: {len(issues)}")
         sorted_issues = sorted(issues, key=lambda x: x["number"], reverse=True)
         for issue in sorted_issues:
-            print(f"  - #{issue['number']}: {issue['html_url']}")
+            print(f"  - #{issue['number']}: {issue['comments']} comments {issue['html_url']}")
 
         print(
-            f"Oldest issue: #{oldest_issue['number']}: {oldest_issue['html_url']} (created on"
+            f"Oldest issue: #{oldest_issue['number']}: {oldest_issue['comments']} comments {oldest_issue['html_url']} (created on"
             f" {oldest_issue['created_at']})"
         )
 

commit 7d766d53eea9cf37e02564329177c2b9628712aa
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Sep 20 11:40:28 2024 -0700

    style: format code for better readability

diff --git a/scripts/issues.py b/scripts/issues.py
index 8456988e..2065a939 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -111,8 +111,8 @@ def main():
             print(f"  - #{issue['number']}: {issue['comments']} comments {issue['html_url']}")
 
         print(
-            f"Oldest issue: #{oldest_issue['number']}: {oldest_issue['comments']} comments {oldest_issue['html_url']} (created on"
-            f" {oldest_issue['created_at']})"
+            f"Oldest issue: #{oldest_issue['number']}: {oldest_issue['comments']} comments"
+            f" {oldest_issue['html_url']} (created on {oldest_issue['created_at']})"
         )
 
         # Confirmation prompt

commit 88eaf8cf1d9a5e7b93ccf49c2e71a53fd2d39bbb
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Sep 20 11:52:28 2024 -0700

    copy

diff --git a/scripts/issues.py b/scripts/issues.py
index 2065a939..afc7ce9e 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -112,7 +112,7 @@ def main():
 
         print(
             f"Oldest issue: #{oldest_issue['number']}: {oldest_issue['comments']} comments"
-            f" {oldest_issue['html_url']} (created on {oldest_issue['created_at']})"
+            f" {oldest_issue['html_url']} ({oldest_issue['state']})"
         )
 
         # Confirmation prompt

commit 10fee78dddcb5350ddef61cb5ab792b435595433
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 16:04:26 2024 -0700

    feat: Add progress bar while collecting the groups

diff --git a/scripts/issues.py b/scripts/issues.py
index afc7ce9e..bdef877b 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -4,6 +4,7 @@ import os
 import re
 from collections import defaultdict
 from datetime import datetime
+from tqdm import tqdm
 
 import requests
 from dotenv import load_dotenv
@@ -94,7 +95,8 @@ def main():
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
 
-    for subject, issues in grouped_open_issues.items():
+    print("Analyzing issues...")
+    for subject, issues in tqdm(grouped_open_issues.items(), desc="Processing issue groups"):
         oldest_issue = find_oldest_issue(subject, all_issues)
         if not oldest_issue:
             continue
@@ -122,7 +124,7 @@ def main():
             continue
 
         # Comment and close duplicate issues
-        for issue in issues:
+        for issue in tqdm(issues, desc="Closing duplicate issues"):
             if issue["number"] != oldest_issue["number"]:
                 comment_and_close_duplicate(issue, oldest_issue)
 

commit de87418647dd69ed6d4c0ed6c47542dcf7ee81c4
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 16:05:16 2024 -0700

    feat: add progress bar while collecting issues

diff --git a/scripts/issues.py b/scripts/issues.py
index bdef877b..7d9bc24d 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -24,18 +24,20 @@ headers = {"Authorization": f"token {TOKEN}", "Accept": "application/vnd.github.
 def get_issues(state="open"):
     issues = []
     page = 1
-    while True:
-        response = requests.get(
-            f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues",
-            headers=headers,
-            params={"state": state, "page": page, "per_page": 100},
-        )
-        response.raise_for_status()
-        page_issues = response.json()
-        if not page_issues:
-            break
-        issues.extend(page_issues)
-        page += 1
+    with tqdm(desc="Collecting issues", unit="page") as pbar:
+        while True:
+            response = requests.get(
+                f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues",
+                headers=headers,
+                params={"state": state, "page": page, "per_page": 100},
+            )
+            response.raise_for_status()
+            page_issues = response.json()
+            if not page_issues:
+                break
+            issues.extend(page_issues)
+            page += 1
+            pbar.update(1)
     return issues
 
 

commit 5606791df2e0e9b9d43cc708d943c1b7baab7a58
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 16:05:19 2024 -0700

    style: Fix import order in scripts/issues.py

diff --git a/scripts/issues.py b/scripts/issues.py
index 7d9bc24d..00a2a8ff 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -4,10 +4,10 @@ import os
 import re
 from collections import defaultdict
 from datetime import datetime
-from tqdm import tqdm
 
 import requests
 from dotenv import load_dotenv
+from tqdm import tqdm
 
 # Load environment variables from .env file
 load_dotenv()

commit 26dcdcc1d2242a8b8460a6f3f8c53e69aa74fc46
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 16:05:55 2024 -0700

    feat: add total page count to progress bar in get_issues function

diff --git a/scripts/issues.py b/scripts/issues.py
index 00a2a8ff..27bd64c3 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -24,12 +24,24 @@ headers = {"Authorization": f"token {TOKEN}", "Accept": "application/vnd.github.
 def get_issues(state="open"):
     issues = []
     page = 1
-    with tqdm(desc="Collecting issues", unit="page") as pbar:
+    per_page = 100
+
+    # First, get the total count of issues
+    response = requests.get(
+        f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues",
+        headers=headers,
+        params={"state": state, "per_page": 1},
+    )
+    response.raise_for_status()
+    total_count = int(response.headers.get('Link', '').split('page=')[-1].split('>')[0])
+    total_pages = (total_count + per_page - 1) // per_page
+
+    with tqdm(total=total_pages, desc="Collecting issues", unit="page") as pbar:
         while True:
             response = requests.get(
                 f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues",
                 headers=headers,
-                params={"state": state, "page": page, "per_page": 100},
+                params={"state": state, "page": page, "per_page": per_page},
             )
             response.raise_for_status()
             page_issues = response.json()

commit 8cc747da3aebbb67cc6691262ee1ac518dc51c4c
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 16:05:59 2024 -0700

    style: Fix linting issues in scripts/issues.py

diff --git a/scripts/issues.py b/scripts/issues.py
index 27bd64c3..d5467c3e 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -33,7 +33,7 @@ def get_issues(state="open"):
         params={"state": state, "per_page": 1},
     )
     response.raise_for_status()
-    total_count = int(response.headers.get('Link', '').split('page=')[-1].split('>')[0])
+    total_count = int(response.headers.get("Link", "").split("page=")[-1].split(">")[0])
     total_pages = (total_count + per_page - 1) // per_page
 
     with tqdm(total=total_pages, desc="Collecting issues", unit="page") as pbar:

commit aca60a9127de134ff10d3635abc8eed89818f414
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Sep 21 16:26:45 2024 -0700

    no tqdm for groups

diff --git a/scripts/issues.py b/scripts/issues.py
index d5467c3e..2dd8c883 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -110,7 +110,7 @@ def main():
     grouped_open_issues = group_issues_by_subject(open_issues)
 
     print("Analyzing issues...")
-    for subject, issues in tqdm(grouped_open_issues.items(), desc="Processing issue groups"):
+    for subject, issues in grouped_open_issues.items():
         oldest_issue = find_oldest_issue(subject, all_issues)
         if not oldest_issue:
             continue

commit b4fdb72a3aeda7787964566c5f3a5e31565817a9
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 18:30:35 2024 -0700

    fix: Only print Oldest issue #{oldest_issue['number']} left open if it is open

diff --git a/scripts/issues.py b/scripts/issues.py
index 2dd8c883..74b929bd 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -142,7 +142,8 @@ def main():
             if issue["number"] != oldest_issue["number"]:
                 comment_and_close_duplicate(issue, oldest_issue)
 
-        print(f"Oldest issue #{oldest_issue['number']} left open")
+        if oldest_issue['state'] == 'open':
+            print(f"Oldest issue #{oldest_issue['number']} left open")
 
 
 if __name__ == "__main__":

commit 6731815251386ab57e432d4a72fbe8a9bd9bd00c
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 18:30:39 2024 -0700

    style: Fix formatting in issues.py

diff --git a/scripts/issues.py b/scripts/issues.py
index 74b929bd..2d5345c3 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -142,7 +142,7 @@ def main():
             if issue["number"] != oldest_issue["number"]:
                 comment_and_close_duplicate(issue, oldest_issue)
 
-        if oldest_issue['state'] == 'open':
+        if oldest_issue["state"] == "open":
             print(f"Oldest issue #{oldest_issue['number']} left open")
 
 

commit 26f9a1032440602497d2b7d64bf94fe754456507
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Sep 21 18:36:33 2024 -0700

    fix: Add greeting to comment when closing duplicate issue

diff --git a/scripts/issues.py b/scripts/issues.py
index 2d5345c3..c4d0f858 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -84,6 +84,7 @@ def comment_and_close_duplicate(issue, oldest_issue):
     close_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
 
     comment_body = (
+        "Thanks for trying aider and filing this issue.\n\n"
         f"This looks like a duplicate of #{oldest_issue['number']}, so I'm going to close it so"
         " discussion can happen there. Please let me know if you think it's actually a distinct"
         " issue."

commit 0101ae76d17a42531bb77f0a4a92813a92ac1634
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 18:37:59 2024 -0700

    refactor: Move comment_body to a global multiline string

diff --git a/scripts/issues.py b/scripts/issues.py
index c4d0f858..89f7bfaa 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -12,6 +12,10 @@ from tqdm import tqdm
 # Load environment variables from .env file
 load_dotenv()
 
+DUPLICATE_COMMENT = """Thanks for trying aider and filing this issue.
+
+This looks like a duplicate of #{oldest_issue_number}, so I'm going to close it so discussion can happen there. Please let me know if you think it's actually a distinct issue."""
+
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"
 REPO_OWNER = "paul-gauthier"
@@ -83,12 +87,7 @@ def comment_and_close_duplicate(issue, oldest_issue):
     )
     close_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
 
-    comment_body = (
-        "Thanks for trying aider and filing this issue.\n\n"
-        f"This looks like a duplicate of #{oldest_issue['number']}, so I'm going to close it so"
-        " discussion can happen there. Please let me know if you think it's actually a distinct"
-        " issue."
-    )
+    comment_body = DUPLICATE_COMMENT.format(oldest_issue_number=oldest_issue['number'])
 
     # Post comment
     response = requests.post(comment_url, headers=headers, json={"body": comment_body})

commit eff9325f2be6bb097b4c9a2dcbde030d57cd126c
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sat Sep 21 18:38:03 2024 -0700

    style: Fix formatting in issue comment

diff --git a/scripts/issues.py b/scripts/issues.py
index 89f7bfaa..657d56ec 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -87,7 +87,7 @@ def comment_and_close_duplicate(issue, oldest_issue):
     )
     close_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
 
-    comment_body = DUPLICATE_COMMENT.format(oldest_issue_number=oldest_issue['number'])
+    comment_body = DUPLICATE_COMMENT.format(oldest_issue_number=oldest_issue["number"])
 
     # Post comment
     response = requests.post(comment_url, headers=headers, json={"body": comment_body})

commit a77c8ccfa9f9852612c5644eb25dcadc97ab9569
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Sep 21 18:43:02 2024 -0700

    copy

diff --git a/scripts/issues.py b/scripts/issues.py
index 657d56ec..fad0fd7f 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -14,7 +14,9 @@ load_dotenv()
 
 DUPLICATE_COMMENT = """Thanks for trying aider and filing this issue.
 
-This looks like a duplicate of #{oldest_issue_number}, so I'm going to close it so discussion can happen there. Please let me know if you think it's actually a distinct issue."""
+This looks like a duplicate of #{oldest_issue_number}. Please see the comments there for more information, and feel free to continue the discussion within that issue.
+
+I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""  # noqa
 
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"

commit edf8fc632724f19c75f0c13723041059d793a9db
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Sep 21 19:06:08 2024 -0700

    fix: Remove progress bar when closing duplicate issues

diff --git a/scripts/issues.py b/scripts/issues.py
index fad0fd7f..82763e3a 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -140,7 +140,7 @@ def main():
             continue
 
         # Comment and close duplicate issues
-        for issue in tqdm(issues, desc="Closing duplicate issues"):
+        for issue in issues:
             if issue["number"] != oldest_issue["number"]:
                 comment_and_close_duplicate(issue, oldest_issue)
 

commit 8422441f74e6c33cd8acabb96b5b30dc4829ea95
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Sep 24 08:25:28 2024 -0700

    fix: Skip processing open issues that have been closed and re-opened

diff --git a/scripts/issues.py b/scripts/issues.py
index 82763e3a..2a4f3a10 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -9,6 +9,13 @@ import requests
 from dotenv import load_dotenv
 from tqdm import tqdm
 
+def has_been_reopened(issue_number):
+    timeline_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue_number}/timeline"
+    response = requests.get(timeline_url, headers=headers)
+    response.raise_for_status()
+    events = response.json()
+    return any(event['event'] == 'reopened' for event in events if 'event' in event)
+
 # Load environment variables from .env file
 load_dotenv()
 
@@ -63,7 +70,7 @@ def group_issues_by_subject(issues):
     grouped_issues = defaultdict(list)
     pattern = r"Uncaught .+ in .+ line \d+"
     for issue in issues:
-        if re.search(pattern, issue["title"]):
+        if re.search(pattern, issue["title"]) and not has_been_reopened(issue["number"]):
             subject = issue["title"]
             grouped_issues[subject].append(issue)
     return grouped_issues
@@ -74,7 +81,7 @@ def find_oldest_issue(subject, all_issues):
     oldest_date = datetime.now()
 
     for issue in all_issues:
-        if issue["title"] == subject:
+        if issue["title"] == subject and not has_been_reopened(issue["number"]):
             created_at = datetime.strptime(issue["created_at"], "%Y-%m-%dT%H:%M:%SZ")
             if created_at < oldest_date:
                 oldest_date = created_at
@@ -111,7 +118,7 @@ def main():
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
 
-    print("Analyzing issues...")
+    print("Analyzing issues (skipping reopened issues)...")
     for subject, issues in grouped_open_issues.items():
         oldest_issue = find_oldest_issue(subject, all_issues)
         if not oldest_issue:

commit 6b5fe9bee342754ffa83222d4919dc3f72cfa465
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Sep 24 08:25:31 2024 -0700

    style: Run linter on scripts/issues.py

diff --git a/scripts/issues.py b/scripts/issues.py
index 2a4f3a10..fe282676 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -9,12 +9,14 @@ import requests
 from dotenv import load_dotenv
 from tqdm import tqdm
 
+
 def has_been_reopened(issue_number):
     timeline_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue_number}/timeline"
     response = requests.get(timeline_url, headers=headers)
     response.raise_for_status()
     events = response.json()
-    return any(event['event'] == 'reopened' for event in events if 'event' in event)
+    return any(event["event"] == "reopened" for event in events if "event" in event)
+
 
 # Load environment variables from .env file
 load_dotenv()

commit 2b4206fd579036b5974a056fa4f6dd0665687aaa
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Oct 4 13:05:12 2024 -0700

    paul-gauthier -> Aider-AI

diff --git a/scripts/issues.py b/scripts/issues.py
index fe282676..227634a1 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -29,7 +29,7 @@ I'm going to close this issue for now. But please let me know if you think this
 
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"
-REPO_OWNER = "paul-gauthier"
+REPO_OWNER = "Aider-AI"
 REPO_NAME = "aider"
 TOKEN = os.getenv("GITHUB_TOKEN")
 

commit eb8fdf483e23787f42e11e78918229349af14f93
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Oct 24 12:33:59 2024 -0700

    feat: add --yes flag to issues script

diff --git a/scripts/issues.py b/scripts/issues.py
index 227634a1..8c56dead 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -1,5 +1,7 @@
 #!/usr/bin/env python3
 
+add a --yes switch @ai
+
 import os
 import re
 from collections import defaultdict

commit e9627cb3c6b9aa39bae2403492d7ae9139634e65
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Thu Oct 24 12:34:01 2024 -0700

    feat: add --yes flag to auto-close duplicate issues without prompting

diff --git a/scripts/issues.py b/scripts/issues.py
index 8c56dead..bb9416bf 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -1,7 +1,6 @@
 #!/usr/bin/env python3
 
-add a --yes switch @ai
-
+import argparse
 import os
 import re
 from collections import defaultdict
@@ -114,6 +113,10 @@ def comment_and_close_duplicate(issue, oldest_issue):
 
 
 def main():
+    parser = argparse.ArgumentParser(description='Handle duplicate GitHub issues')
+    parser.add_argument('--yes', action='store_true', help='Automatically close duplicates without prompting')
+    args = parser.parse_args()
+
     if not TOKEN:
         print("Error: Missing GITHUB_TOKEN environment variable. Please check your .env file.")
         return
@@ -144,11 +147,12 @@ def main():
             f" {oldest_issue['html_url']} ({oldest_issue['state']})"
         )
 
-        # Confirmation prompt
-        confirm = input("Do you want to comment and close duplicate issues? (y/n): ")
-        if confirm.lower() != "y":
-            print("Skipping this group of issues.")
-            continue
+        if not args.yes:
+            # Confirmation prompt
+            confirm = input("Do you want to comment and close duplicate issues? (y/n): ")
+            if confirm.lower() != "y":
+                print("Skipping this group of issues.")
+                continue
 
         # Comment and close duplicate issues
         for issue in issues:

commit b46de7127d53f477ddcfd720507ca1697c2cc50c
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Thu Oct 24 12:34:04 2024 -0700

    style: format Python code with black linter

diff --git a/scripts/issues.py b/scripts/issues.py
index bb9416bf..149ec452 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -113,8 +113,10 @@ def comment_and_close_duplicate(issue, oldest_issue):
 
 
 def main():
-    parser = argparse.ArgumentParser(description='Handle duplicate GitHub issues')
-    parser.add_argument('--yes', action='store_true', help='Automatically close duplicates without prompting')
+    parser = argparse.ArgumentParser(description="Handle duplicate GitHub issues")
+    parser.add_argument(
+        "--yes", action="store_true", help="Automatically close duplicates without prompting"
+    )
     args = parser.parse_args()
 
     if not TOKEN:

commit 46251c6a1ce343926fa5d854b1d7aec6e9015108
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 5 06:58:40 2024 -0800

    feat: add function to find unlabeled issues with paul-gauthier comments

diff --git a/scripts/issues.py b/scripts/issues.py
index 149ec452..165dc074 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -112,11 +112,29 @@ def comment_and_close_duplicate(issue, oldest_issue):
     print(f"  - Commented and closed issue #{issue['number']}")
 
 
+def find_unlabeled_with_paul_comments(issues):
+    unlabeled_issues = []
+    for issue in issues:
+        if not issue['labels'] and issue['state'] == 'open':
+            # Get comments for this issue
+            comments_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            response = requests.get(comments_url, headers=headers)
+            response.raise_for_status()
+            comments = response.json()
+            
+            # Check if paul-gauthier has commented
+            if any(comment['user']['login'] == 'paul-gauthier' for comment in comments):
+                unlabeled_issues.append(issue)
+    return unlabeled_issues
+
 def main():
     parser = argparse.ArgumentParser(description="Handle duplicate GitHub issues")
     parser.add_argument(
         "--yes", action="store_true", help="Automatically close duplicates without prompting"
     )
+    parser.add_argument(
+        "--find-unlabeled", action="store_true", help="Find unlabeled issues with paul-gauthier comments"
+    )
     args = parser.parse_args()
 
     if not TOKEN:
@@ -124,6 +142,32 @@ def main():
         return
 
     all_issues = get_issues("all")
+    
+    if args.find_unlabeled:
+        print("\nFinding unlabeled issues with paul-gauthier comments...")
+        unlabeled_issues = find_unlabeled_with_paul_comments(all_issues)
+        
+        if not unlabeled_issues:
+            print("No unlabeled issues with paul-gauthier comments found.")
+            return
+            
+        print(f"\nFound {len(unlabeled_issues)} unlabeled issues with paul-gauthier comments:")
+        for issue in unlabeled_issues:
+            print(f"  - #{issue['number']}: {issue['title']} {issue['html_url']}")
+            
+        if not args.yes:
+            confirm = input("\nDo you want to add the 'question' label to these issues? (y/n): ")
+            if confirm.lower() != 'y':
+                print("Skipping labeling.")
+                return
+                
+        print("\nAdding 'question' label to issues...")
+        for issue in unlabeled_issues:
+            url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
+            response = requests.patch(url, headers=headers, json={"labels": ["question"]})
+            response.raise_for_status()
+            print(f"  - Added 'question' label to #{issue['number']}")
+        return
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
 

commit ddfd1276c51d871169de031ce2bb3dc3cd741290
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 5 06:58:44 2024 -0800

    style: Format issues.py with black linter

diff --git a/scripts/issues.py b/scripts/issues.py
index 165dc074..a02fd235 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -115,25 +115,30 @@ def comment_and_close_duplicate(issue, oldest_issue):
 def find_unlabeled_with_paul_comments(issues):
     unlabeled_issues = []
     for issue in issues:
-        if not issue['labels'] and issue['state'] == 'open':
+        if not issue["labels"] and issue["state"] == "open":
             # Get comments for this issue
-            comments_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            comments_url = (
+                f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            )
             response = requests.get(comments_url, headers=headers)
             response.raise_for_status()
             comments = response.json()
-            
+
             # Check if paul-gauthier has commented
-            if any(comment['user']['login'] == 'paul-gauthier' for comment in comments):
+            if any(comment["user"]["login"] == "paul-gauthier" for comment in comments):
                 unlabeled_issues.append(issue)
     return unlabeled_issues
 
+
 def main():
     parser = argparse.ArgumentParser(description="Handle duplicate GitHub issues")
     parser.add_argument(
         "--yes", action="store_true", help="Automatically close duplicates without prompting"
     )
     parser.add_argument(
-        "--find-unlabeled", action="store_true", help="Find unlabeled issues with paul-gauthier comments"
+        "--find-unlabeled",
+        action="store_true",
+        help="Find unlabeled issues with paul-gauthier comments",
     )
     args = parser.parse_args()
 
@@ -142,25 +147,25 @@ def main():
         return
 
     all_issues = get_issues("all")
-    
+
     if args.find_unlabeled:
         print("\nFinding unlabeled issues with paul-gauthier comments...")
         unlabeled_issues = find_unlabeled_with_paul_comments(all_issues)
-        
+
         if not unlabeled_issues:
             print("No unlabeled issues with paul-gauthier comments found.")
             return
-            
+
         print(f"\nFound {len(unlabeled_issues)} unlabeled issues with paul-gauthier comments:")
         for issue in unlabeled_issues:
             print(f"  - #{issue['number']}: {issue['title']} {issue['html_url']}")
-            
+
         if not args.yes:
             confirm = input("\nDo you want to add the 'question' label to these issues? (y/n): ")
-            if confirm.lower() != 'y':
+            if confirm.lower() != "y":
                 print("Skipping labeling.")
                 return
-                
+
         print("\nAdding 'question' label to issues...")
         for issue in unlabeled_issues:
             url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"

commit e8c153f72f54cc5ac91bdbb8f45208c58be64dec
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 5 07:02:22 2024 -0800

    docs: add refactoring comments for issue handling functions

diff --git a/scripts/issues.py b/scripts/issues.py
index a02fd235..8677ce36 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -149,6 +149,7 @@ def main():
     all_issues = get_issues("all")
 
     if args.find_unlabeled:
+        #ai refactor this into a function...
         print("\nFinding unlabeled issues with paul-gauthier comments...")
         unlabeled_issues = find_unlabeled_with_paul_comments(all_issues)
 
@@ -173,6 +174,9 @@ def main():
             response.raise_for_status()
             print(f"  - Added 'question' label to #{issue['number']}")
         return
+        # ... to here
+
+    # ai also refactor this into its own function...
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
 
@@ -212,6 +216,7 @@ def main():
 
         if oldest_issue["state"] == "open":
             print(f"Oldest issue #{oldest_issue['number']} left open")
+    # ai ... to here!
 
 
 if __name__ == "__main__":

commit 17351e8f91e69abbdc63f76435a67758f7cd1309
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 5 07:02:24 2024 -0800

    refactor: extract issue handling into dedicated functions

diff --git a/scripts/issues.py b/scripts/issues.py
index 8677ce36..90f95ddc 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -130,53 +130,33 @@ def find_unlabeled_with_paul_comments(issues):
     return unlabeled_issues
 
 
-def main():
-    parser = argparse.ArgumentParser(description="Handle duplicate GitHub issues")
-    parser.add_argument(
-        "--yes", action="store_true", help="Automatically close duplicates without prompting"
-    )
-    parser.add_argument(
-        "--find-unlabeled",
-        action="store_true",
-        help="Find unlabeled issues with paul-gauthier comments",
-    )
-    args = parser.parse_args()
+def handle_unlabeled_issues(all_issues, auto_yes):
+    print("\nFinding unlabeled issues with paul-gauthier comments...")
+    unlabeled_issues = find_unlabeled_with_paul_comments(all_issues)
 
-    if not TOKEN:
-        print("Error: Missing GITHUB_TOKEN environment variable. Please check your .env file.")
+    if not unlabeled_issues:
+        print("No unlabeled issues with paul-gauthier comments found.")
         return
 
-    all_issues = get_issues("all")
-
-    if args.find_unlabeled:
-        #ai refactor this into a function...
-        print("\nFinding unlabeled issues with paul-gauthier comments...")
-        unlabeled_issues = find_unlabeled_with_paul_comments(all_issues)
+    print(f"\nFound {len(unlabeled_issues)} unlabeled issues with paul-gauthier comments:")
+    for issue in unlabeled_issues:
+        print(f"  - #{issue['number']}: {issue['title']} {issue['html_url']}")
 
-        if not unlabeled_issues:
-            print("No unlabeled issues with paul-gauthier comments found.")
+    if not auto_yes:
+        confirm = input("\nDo you want to add the 'question' label to these issues? (y/n): ")
+        if confirm.lower() != "y":
+            print("Skipping labeling.")
             return
 
-        print(f"\nFound {len(unlabeled_issues)} unlabeled issues with paul-gauthier comments:")
-        for issue in unlabeled_issues:
-            print(f"  - #{issue['number']}: {issue['title']} {issue['html_url']}")
+    print("\nAdding 'question' label to issues...")
+    for issue in unlabeled_issues:
+        url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
+        response = requests.patch(url, headers=headers, json={"labels": ["question"]})
+        response.raise_for_status()
+        print(f"  - Added 'question' label to #{issue['number']}")
 
-        if not args.yes:
-            confirm = input("\nDo you want to add the 'question' label to these issues? (y/n): ")
-            if confirm.lower() != "y":
-                print("Skipping labeling.")
-                return
 
-        print("\nAdding 'question' label to issues...")
-        for issue in unlabeled_issues:
-            url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
-            response = requests.patch(url, headers=headers, json={"labels": ["question"]})
-            response.raise_for_status()
-            print(f"  - Added 'question' label to #{issue['number']}")
-        return
-        # ... to here
-
-    # ai also refactor this into its own function...
+def handle_duplicate_issues(all_issues, auto_yes):
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
 
@@ -202,21 +182,43 @@ def main():
             f" {oldest_issue['html_url']} ({oldest_issue['state']})"
         )
 
-        if not args.yes:
-            # Confirmation prompt
+        if not auto_yes:
             confirm = input("Do you want to comment and close duplicate issues? (y/n): ")
             if confirm.lower() != "y":
                 print("Skipping this group of issues.")
                 continue
 
-        # Comment and close duplicate issues
         for issue in issues:
             if issue["number"] != oldest_issue["number"]:
                 comment_and_close_duplicate(issue, oldest_issue)
 
         if oldest_issue["state"] == "open":
             print(f"Oldest issue #{oldest_issue['number']} left open")
-    # ai ... to here!
+
+
+def main():
+    parser = argparse.ArgumentParser(description="Handle duplicate GitHub issues")
+    parser.add_argument(
+        "--yes", action="store_true", help="Automatically close duplicates without prompting"
+    )
+    parser.add_argument(
+        "--find-unlabeled",
+        action="store_true",
+        help="Find unlabeled issues with paul-gauthier comments",
+    )
+    args = parser.parse_args()
+
+    if not TOKEN:
+        print("Error: Missing GITHUB_TOKEN environment variable. Please check your .env file.")
+        return
+
+    all_issues = get_issues("all")
+
+    if args.find_unlabeled:
+        handle_unlabeled_issues(all_issues, args.yes)
+        return
+
+    handle_duplicate_issues(all_issues, args.yes)
 
 
 if __name__ == "__main__":

commit 2dd83e7dbeccba240db0354a82c3ec332b7e5a67
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 5 07:04:11 2024 -0800

    feat: exclude pull requests from unlabeled issues search

diff --git a/scripts/issues.py b/scripts/issues.py
index 90f95ddc..873a8580 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -115,6 +115,10 @@ def comment_and_close_duplicate(issue, oldest_issue):
 def find_unlabeled_with_paul_comments(issues):
     unlabeled_issues = []
     for issue in issues:
+        # Skip pull requests
+        if "pull_request" in issue:
+            continue
+            
         if not issue["labels"] and issue["state"] == "open":
             # Get comments for this issue
             comments_url = (

commit 54b9c46b96cabbb2963787e32b42be9a6f3315f1
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 5 07:04:15 2024 -0800

    style: Fix whitespace in issues.py script

diff --git a/scripts/issues.py b/scripts/issues.py
index 873a8580..063c29fc 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -118,7 +118,7 @@ def find_unlabeled_with_paul_comments(issues):
         # Skip pull requests
         if "pull_request" in issue:
             continue
-            
+
         if not issue["labels"] and issue["state"] == "open":
             # Get comments for this issue
             comments_url = (

commit 6177856baff8166e1d489ef2bb8430517f081161
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 5 08:45:48 2024 -0800

    refactor: simplify issues script by removing redundant flag

diff --git a/scripts/issues.py b/scripts/issues.py
index 063c29fc..f41e53ba 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -205,11 +205,6 @@ def main():
     parser.add_argument(
         "--yes", action="store_true", help="Automatically close duplicates without prompting"
     )
-    parser.add_argument(
-        "--find-unlabeled",
-        action="store_true",
-        help="Find unlabeled issues with paul-gauthier comments",
-    )
     args = parser.parse_args()
 
     if not TOKEN:
@@ -218,10 +213,7 @@ def main():
 
     all_issues = get_issues("all")
 
-    if args.find_unlabeled:
-        handle_unlabeled_issues(all_issues, args.yes)
-        return
-
+    handle_unlabeled_issues(all_issues, args.yes)
     handle_duplicate_issues(all_issues, args.yes)
 
 

commit 434dc27557a64acd41df49eba6aadcee4b0adbbb
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:11:19 2024 -0800

    feat: Add stale issue detection for question-labeled issues with no activity

diff --git a/scripts/issues.py b/scripts/issues.py
index f41e53ba..544be2f7 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -28,6 +28,8 @@ This looks like a duplicate of #{oldest_issue_number}. Please see the comments t
 
 I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""  # noqa
 
+STALE_COMMENT = """This issue has been labelled stale because it has been open for 2 weeks with no activity. Remove stale label or add a comment to keep this issue open. Otherwise, it will be closed in 7 days."""
+
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"
 REPO_OWNER = "Aider-AI"
@@ -160,6 +162,45 @@ def handle_unlabeled_issues(all_issues, auto_yes):
         print(f"  - Added 'question' label to #{issue['number']}")
 
 
+def handle_stale_issues(all_issues, auto_yes):
+    print("\nChecking for stale question issues...")
+    
+    for issue in all_issues:
+        # Skip if not open, not a question, already stale, or has been reopened
+        if (issue["state"] != "open" or
+            "question" not in [label["name"] for label in issue["labels"]] or
+            "stale" in [label["name"] for label in issue["labels"]] or
+            has_been_reopened(issue["number"])):
+            continue
+
+        # Get latest activity timestamp from issue or its comments
+        latest_activity = datetime.strptime(issue["updated_at"], "%Y-%m-%dT%H:%M:%SZ")
+        
+        # Check if issue is stale (no activity for 14 days)
+        days_inactive = (datetime.now() - latest_activity).days
+        if days_inactive >= 14:
+            print(f"\nStale issue found: #{issue['number']}: {issue['title']}")
+            print(f"  No activity for {days_inactive} days")
+            
+            if not auto_yes:
+                confirm = input("Add stale label and comment? (y/n): ")
+                if confirm.lower() != "y":
+                    print("Skipping this issue.")
+                    continue
+
+            # Add stale label
+            url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
+            response = requests.patch(url, headers=headers, json={"labels": ["question", "stale"]})
+            response.raise_for_status()
+
+            # Add comment
+            comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            response = requests.post(comment_url, headers=headers, json={"body": STALE_COMMENT})
+            response.raise_for_status()
+            
+            print(f"  Added stale label and comment to #{issue['number']}")
+
+
 def handle_duplicate_issues(all_issues, auto_yes):
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
@@ -214,6 +255,7 @@ def main():
     all_issues = get_issues("all")
 
     handle_unlabeled_issues(all_issues, args.yes)
+    handle_stale_issues(all_issues, args.yes)
     handle_duplicate_issues(all_issues, args.yes)
 
 

commit e578655653e30fd4a43e0b3861794e8d5919d028
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:11:24 2024 -0800

    style: Format Python code with linter

diff --git a/scripts/issues.py b/scripts/issues.py
index 544be2f7..ff9a5c96 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -164,24 +164,26 @@ def handle_unlabeled_issues(all_issues, auto_yes):
 
 def handle_stale_issues(all_issues, auto_yes):
     print("\nChecking for stale question issues...")
-    
+
     for issue in all_issues:
         # Skip if not open, not a question, already stale, or has been reopened
-        if (issue["state"] != "open" or
-            "question" not in [label["name"] for label in issue["labels"]] or
-            "stale" in [label["name"] for label in issue["labels"]] or
-            has_been_reopened(issue["number"])):
+        if (
+            issue["state"] != "open"
+            or "question" not in [label["name"] for label in issue["labels"]]
+            or "stale" in [label["name"] for label in issue["labels"]]
+            or has_been_reopened(issue["number"])
+        ):
             continue
 
         # Get latest activity timestamp from issue or its comments
         latest_activity = datetime.strptime(issue["updated_at"], "%Y-%m-%dT%H:%M:%SZ")
-        
+
         # Check if issue is stale (no activity for 14 days)
         days_inactive = (datetime.now() - latest_activity).days
         if days_inactive >= 14:
             print(f"\nStale issue found: #{issue['number']}: {issue['title']}")
             print(f"  No activity for {days_inactive} days")
-            
+
             if not auto_yes:
                 confirm = input("Add stale label and comment? (y/n): ")
                 if confirm.lower() != "y":
@@ -194,10 +196,12 @@ def handle_stale_issues(all_issues, auto_yes):
             response.raise_for_status()
 
             # Add comment
-            comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            comment_url = (
+                f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            )
             response = requests.post(comment_url, headers=headers, json={"body": STALE_COMMENT})
             response.raise_for_status()
-            
+
             print(f"  Added stale label and comment to #{issue['number']}")
 
 

commit d44cd01493292fb95d55b9b6fd14761785491756
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:11:41 2024 -0800

    refactor: Add noqa comment to stale comment line to resolve flake8 warning

diff --git a/scripts/issues.py b/scripts/issues.py
index ff9a5c96..346196a1 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -28,7 +28,7 @@ This looks like a duplicate of #{oldest_issue_number}. Please see the comments t
 
 I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""  # noqa
 
-STALE_COMMENT = """This issue has been labelled stale because it has been open for 2 weeks with no activity. Remove stale label or add a comment to keep this issue open. Otherwise, it will be closed in 7 days."""
+STALE_COMMENT = """This issue has been labelled stale because it has been open for 2 weeks with no activity. Remove stale label or add a comment to keep this issue open. Otherwise, it will be closed in 7 days."""  # noqa
 
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"

commit cefea38ee54344d84cb7a7928717970f1fed5202
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:17:55 2024 -0800

    feat: Add issue URL to stale issue output for easier navigation

diff --git a/scripts/issues.py b/scripts/issues.py
index 346196a1..d1fc10cb 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -181,7 +181,7 @@ def handle_stale_issues(all_issues, auto_yes):
         # Check if issue is stale (no activity for 14 days)
         days_inactive = (datetime.now() - latest_activity).days
         if days_inactive >= 14:
-            print(f"\nStale issue found: #{issue['number']}: {issue['title']}")
+            print(f"\nStale issue found: #{issue['number']}: {issue['title']} {issue['html_url']}")
             print(f"  No activity for {days_inactive} days")
 
             if not auto_yes:

commit 22dbcb75909ae31b38b9530c19770213471a3caa
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Nov 8 09:25:09 2024 -0800

    refactor: Update stale issue comment text for clarity and conciseness

diff --git a/scripts/issues.py b/scripts/issues.py
index d1fc10cb..7103eede 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -28,7 +28,7 @@ This looks like a duplicate of #{oldest_issue_number}. Please see the comments t
 
 I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""  # noqa
 
-STALE_COMMENT = """This issue has been labelled stale because it has been open for 2 weeks with no activity. Remove stale label or add a comment to keep this issue open. Otherwise, it will be closed in 7 days."""  # noqa
+STALE_COMMENT = """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, it will be closed in 7 days."""  # noqa
 
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"

commit 63621993636270ba0abffaaa051b9aeb9927fc64
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:25:11 2024 -0800

    fix: Reorder stale label and comment operations in handle_stale_issues

diff --git a/scripts/issues.py b/scripts/issues.py
index 7103eede..ce5289a5 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -190,11 +190,6 @@ def handle_stale_issues(all_issues, auto_yes):
                     print("Skipping this issue.")
                     continue
 
-            # Add stale label
-            url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
-            response = requests.patch(url, headers=headers, json={"labels": ["question", "stale"]})
-            response.raise_for_status()
-
             # Add comment
             comment_url = (
                 f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
@@ -202,6 +197,11 @@ def handle_stale_issues(all_issues, auto_yes):
             response = requests.post(comment_url, headers=headers, json={"body": STALE_COMMENT})
             response.raise_for_status()
 
+            # Add stale label
+            url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
+            response = requests.patch(url, headers=headers, json={"labels": ["question", "stale"]})
+            response.raise_for_status()
+
             print(f"  Added stale label and comment to #{issue['number']}")
 
 

commit d406636878e92604f34cc94001d9d1bea6879850
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Nov 8 09:55:35 2024 -0800

    refactor: Improve issue output formatting and message clarity

diff --git a/scripts/issues.py b/scripts/issues.py
index ce5289a5..237dff99 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -181,7 +181,7 @@ def handle_stale_issues(all_issues, auto_yes):
         # Check if issue is stale (no activity for 14 days)
         days_inactive = (datetime.now() - latest_activity).days
         if days_inactive >= 14:
-            print(f"\nStale issue found: #{issue['number']}: {issue['title']} {issue['html_url']}")
+            print(f"\nStale issue found: #{issue['number']}: {issue['title']}\n{issue['html_url']}")
             print(f"  No activity for {days_inactive} days")
 
             if not auto_yes:
@@ -209,7 +209,7 @@ def handle_duplicate_issues(all_issues, auto_yes):
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
 
-    print("Analyzing issues (skipping reopened issues)...")
+    print("Looking for duplicate issues (skipping reopened issues)...")
     for subject, issues in grouped_open_issues.items():
         oldest_issue = find_oldest_issue(subject, all_issues)
         if not oldest_issue:

commit 92bbec185276b49f04575012c6e35211708ac91c
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:55:37 2024 -0800

    feat: Add function to process and close stale issues after 7 days of inactivity

diff --git a/scripts/issues.py b/scripts/issues.py
index 237dff99..a422d3f3 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -30,6 +30,8 @@ I'm going to close this issue for now. But please let me know if you think this
 
 STALE_COMMENT = """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, it will be closed in 7 days."""  # noqa
 
+CLOSE_STALE_COMMENT = """I'm closing this issue because it has been stalled for 3 weeks with no activity. Feel free to add a comment here and we can re-open it. Or feel free to file a new issue at any time."""  # noqa
+
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"
 REPO_OWNER = "Aider-AI"
@@ -205,6 +207,87 @@ def handle_stale_issues(all_issues, auto_yes):
             print(f"  Added stale label and comment to #{issue['number']}")
 
 
+def handle_stale_closing(all_issues, auto_yes):
+    print("\nChecking for issues to close or unstale...")
+
+    for issue in all_issues:
+        # Skip if not open or not stale
+        if (
+            issue["state"] != "open"
+            or "stale" not in [label["name"] for label in issue["labels"]]
+        ):
+            continue
+
+        # Get the timeline to find when the stale label was last added
+        timeline_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/timeline"
+        response = requests.get(timeline_url, headers=headers)
+        response.raise_for_status()
+        events = response.json()
+
+        # Find the most recent stale label addition
+        stale_events = [
+            event for event in events
+            if event.get("event") == "labeled" 
+            and event.get("label", {}).get("name") == "stale"
+        ]
+        
+        if not stale_events:
+            continue
+
+        latest_stale = datetime.strptime(stale_events[-1]["created_at"], "%Y-%m-%dT%H:%M:%SZ")
+
+        # Get comments since the stale label
+        comments_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+        response = requests.get(comments_url, headers=headers)
+        response.raise_for_status()
+        comments = response.json()
+
+        # Check for comments newer than the stale label
+        new_comments = [
+            comment for comment in comments
+            if datetime.strptime(comment["created_at"], "%Y-%m-%dT%H:%M:%SZ") > latest_stale
+        ]
+
+        if new_comments:
+            print(f"\nFound new activity on stale issue #{issue['number']}: {issue['title']}")
+            print(f"  {len(new_comments)} new comments since stale label")
+            
+            if not auto_yes:
+                confirm = input("Remove stale label? (y/n): ")
+                if confirm.lower() != "y":
+                    print("Skipping this issue.")
+                    continue
+
+            # Remove stale label but keep question label
+            url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
+            response = requests.patch(url, headers=headers, json={"labels": ["question"]})
+            response.raise_for_status()
+            print(f"  Removed stale label from #{issue['number']}")
+        else:
+            # Check if it's been 7 days since stale label
+            days_stale = (datetime.now() - latest_stale).days
+            if days_stale >= 7:
+                print(f"\nStale issue ready for closing #{issue['number']}: {issue['title']}")
+                print(f"  No activity for {days_stale} days since stale label")
+
+                if not auto_yes:
+                    confirm = input("Close this issue? (y/n): ")
+                    if confirm.lower() != "y":
+                        print("Skipping this issue.")
+                        continue
+
+                # Add closing comment
+                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+                response = requests.post(comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT})
+                response.raise_for_status()
+
+                # Close the issue
+                url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
+                response = requests.patch(url, headers=headers, json={"state": "closed"})
+                response.raise_for_status()
+                print(f"  Closed issue #{issue['number']}")
+
+
 def handle_duplicate_issues(all_issues, auto_yes):
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
@@ -260,6 +343,7 @@ def main():
 
     handle_unlabeled_issues(all_issues, args.yes)
     handle_stale_issues(all_issues, args.yes)
+    handle_stale_closing(all_issues, args.yes)
     handle_duplicate_issues(all_issues, args.yes)
 
 

commit 479d47687826dfdbefb8e0d9c8b7a8c9a823a35c
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:55:42 2024 -0800

    style: Format code with consistent indentation and line breaks

diff --git a/scripts/issues.py b/scripts/issues.py
index a422d3f3..70ded8ca 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -212,46 +212,48 @@ def handle_stale_closing(all_issues, auto_yes):
 
     for issue in all_issues:
         # Skip if not open or not stale
-        if (
-            issue["state"] != "open"
-            or "stale" not in [label["name"] for label in issue["labels"]]
-        ):
+        if issue["state"] != "open" or "stale" not in [label["name"] for label in issue["labels"]]:
             continue
 
         # Get the timeline to find when the stale label was last added
-        timeline_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/timeline"
+        timeline_url = (
+            f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/timeline"
+        )
         response = requests.get(timeline_url, headers=headers)
         response.raise_for_status()
         events = response.json()
 
         # Find the most recent stale label addition
         stale_events = [
-            event for event in events
-            if event.get("event") == "labeled" 
-            and event.get("label", {}).get("name") == "stale"
+            event
+            for event in events
+            if event.get("event") == "labeled" and event.get("label", {}).get("name") == "stale"
         ]
-        
+
         if not stale_events:
             continue
 
         latest_stale = datetime.strptime(stale_events[-1]["created_at"], "%Y-%m-%dT%H:%M:%SZ")
 
         # Get comments since the stale label
-        comments_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+        comments_url = (
+            f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+        )
         response = requests.get(comments_url, headers=headers)
         response.raise_for_status()
         comments = response.json()
 
         # Check for comments newer than the stale label
         new_comments = [
-            comment for comment in comments
+            comment
+            for comment in comments
             if datetime.strptime(comment["created_at"], "%Y-%m-%dT%H:%M:%SZ") > latest_stale
         ]
 
         if new_comments:
             print(f"\nFound new activity on stale issue #{issue['number']}: {issue['title']}")
             print(f"  {len(new_comments)} new comments since stale label")
-            
+
             if not auto_yes:
                 confirm = input("Remove stale label? (y/n): ")
                 if confirm.lower() != "y":
@@ -278,7 +280,9 @@ def handle_stale_closing(all_issues, auto_yes):
 
                 # Add closing comment
                 comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
-                response = requests.post(comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT})
+                response = requests.post(
+                    comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT}
+                )
                 response.raise_for_status()
 
                 # Close the issue

commit 7edc9603d01da6c26479ebe59dc6ee56b060a4cd
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:55:59 2024 -0800

    fix: Break long line to resolve flake8 line length error

diff --git a/scripts/issues.py b/scripts/issues.py
index 70ded8ca..49f76d29 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -279,7 +279,9 @@ def handle_stale_closing(all_issues, auto_yes):
                         continue
 
                 # Add closing comment
-                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+                comment_url = (
+                    f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+                )
                 response = requests.post(
                     comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT}
                 )

commit 34dc684867dfd39d0cdb3707f9986779b4a30e06
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:56:06 2024 -0800

    style: Remove unnecessary line breaks in comment_url assignment

diff --git a/scripts/issues.py b/scripts/issues.py
index 49f76d29..70ded8ca 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -279,9 +279,7 @@ def handle_stale_closing(all_issues, auto_yes):
                         continue
 
                 # Add closing comment
-                comment_url = (
-                    f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
-                )
+                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
                 response = requests.post(
                     comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT}
                 )

commit 8065e387976760995f029abb6a0f00825eb85332
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:56:15 2024 -0800

    style: Wrap long comment_url line to fix flake8 line length error

diff --git a/scripts/issues.py b/scripts/issues.py
index 70ded8ca..49f76d29 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -279,7 +279,9 @@ def handle_stale_closing(all_issues, auto_yes):
                         continue
 
                 # Add closing comment
-                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+                comment_url = (
+                    f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+                )
                 response = requests.post(
                     comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT}
                 )

commit 007305962a31b96cecc41f4507db4192dcfeb969
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Fri Nov 8 09:56:20 2024 -0800

    style: Remove unnecessary line breaks in comment_url assignment

diff --git a/scripts/issues.py b/scripts/issues.py
index 49f76d29..70ded8ca 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -279,9 +279,7 @@ def handle_stale_closing(all_issues, auto_yes):
                         continue
 
                 # Add closing comment
-                comment_url = (
-                    f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
-                )
+                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
                 response = requests.post(
                     comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT}
                 )

commit 1f8fdc6f5c3e407505877a9f06d28e312b44281e
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Nov 18 07:44:48 2024 -0800

    refactor: Update issue script comments and add bot suffix

diff --git a/scripts/issues.py b/scripts/issues.py
index 70ded8ca..999f5d0d 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -22,13 +22,15 @@ def has_been_reopened(issue_number):
 # Load environment variables from .env file
 load_dotenv()
 
+BOT_SUFFIX = "\n\nNote: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made these updates to the issue."
+
 DUPLICATE_COMMENT = """Thanks for trying aider and filing this issue.
 
 This looks like a duplicate of #{oldest_issue_number}. Please see the comments there for more information, and feel free to continue the discussion within that issue.
 
 I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""  # noqa
 
-STALE_COMMENT = """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, it will be closed in 7 days."""  # noqa
+STALE_COMMENT = """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, I will close it in 7 days."""  # noqa
 
 CLOSE_STALE_COMMENT = """I'm closing this issue because it has been stalled for 3 weeks with no activity. Feel free to add a comment here and we can re-open it. Or feel free to file a new issue at any time."""  # noqa
 

commit 4613bf78d568b7fa935c1aaab99408a9951b5d28
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Nov 18 07:44:50 2024 -0800

    feat: Add BOT_SUFFIX to issue comment templates

diff --git a/scripts/issues.py b/scripts/issues.py
index 999f5d0d..884360fd 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -28,11 +28,11 @@ DUPLICATE_COMMENT = """Thanks for trying aider and filing this issue.
 
 This looks like a duplicate of #{oldest_issue_number}. Please see the comments there for more information, and feel free to continue the discussion within that issue.
 
-I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""  # noqa
+I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue.""" + BOT_SUFFIX  # noqa
 
-STALE_COMMENT = """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, I will close it in 7 days."""  # noqa
+STALE_COMMENT = """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, I will close it in 7 days.""" + BOT_SUFFIX  # noqa
 
-CLOSE_STALE_COMMENT = """I'm closing this issue because it has been stalled for 3 weeks with no activity. Feel free to add a comment here and we can re-open it. Or feel free to file a new issue at any time."""  # noqa
+CLOSE_STALE_COMMENT = """I'm closing this issue because it has been stalled for 3 weeks with no activity. Feel free to add a comment here and we can re-open it. Or feel free to file a new issue at any time.""" + BOT_SUFFIX  # noqa
 
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"

commit 6d26051d1125919ba4c3cb0a1a60b1cd3eaf1383
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Nov 18 07:44:54 2024 -0800

    style: Reformat long string literals using parentheses

diff --git a/scripts/issues.py b/scripts/issues.py
index 884360fd..dc277e5b 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -22,17 +22,29 @@ def has_been_reopened(issue_number):
 # Load environment variables from .env file
 load_dotenv()
 
-BOT_SUFFIX = "\n\nNote: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made these updates to the issue."
+BOT_SUFFIX = (
+    "\n\nNote: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made"
+    " these updates to the issue."
+)
 
-DUPLICATE_COMMENT = """Thanks for trying aider and filing this issue.
+DUPLICATE_COMMENT = (
+    """Thanks for trying aider and filing this issue.
 
 This looks like a duplicate of #{oldest_issue_number}. Please see the comments there for more information, and feel free to continue the discussion within that issue.
 
-I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue.""" + BOT_SUFFIX  # noqa
+I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""
+    + BOT_SUFFIX
+)  # noqa
 
-STALE_COMMENT = """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, I will close it in 7 days.""" + BOT_SUFFIX  # noqa
+STALE_COMMENT = (
+    """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, I will close it in 7 days."""
+    + BOT_SUFFIX
+)  # noqa
 
-CLOSE_STALE_COMMENT = """I'm closing this issue because it has been stalled for 3 weeks with no activity. Feel free to add a comment here and we can re-open it. Or feel free to file a new issue at any time.""" + BOT_SUFFIX  # noqa
+CLOSE_STALE_COMMENT = (
+    """I'm closing this issue because it has been stalled for 3 weeks with no activity. Feel free to add a comment here and we can re-open it. Or feel free to file a new issue at any time."""
+    + BOT_SUFFIX
+)  # noqa
 
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"

commit 201abe152445ffc14233c5ae92bee6eabe93b86e
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Nov 18 07:46:00 2024 -0800

    refactor: Improve code formatting and add noqa comment in issues.py script

diff --git a/scripts/issues.py b/scripts/issues.py
index dc277e5b..9251d9cc 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -23,8 +23,9 @@ def has_been_reopened(issue_number):
 load_dotenv()
 
 BOT_SUFFIX = (
-    "\n\nNote: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made"
-    " these updates to the issue."
+    """
+Note: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made these updates to the issue.
+""" # noqa
 )
 
 DUPLICATE_COMMENT = (
@@ -293,7 +294,9 @@ def handle_stale_closing(all_issues, auto_yes):
                         continue
 
                 # Add closing comment
-                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+                comment_url = (
+                    f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+                )
                 response = requests.post(
                     comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT}
                 )

commit 5295abbb833edb06dd7794eaedbdd6c28cb5081d
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Nov 18 07:46:23 2024 -0800

    style: Move #noqa comments to triple-quoted strings in issues.py

diff --git a/scripts/issues.py b/scripts/issues.py
index 9251d9cc..a03696f9 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -38,14 +38,14 @@ I'm going to close this issue for now. But please let me know if you think this
 )  # noqa
 
 STALE_COMMENT = (
-    """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, I will close it in 7 days."""
+    """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, I will close it in 7 days."""  # noqa
     + BOT_SUFFIX
-)  # noqa
+)
 
 CLOSE_STALE_COMMENT = (
-    """I'm closing this issue because it has been stalled for 3 weeks with no activity. Feel free to add a comment here and we can re-open it. Or feel free to file a new issue at any time."""
+    """I'm closing this issue because it has been stalled for 3 weeks with no activity. Feel free to add a comment here and we can re-open it. Or feel free to file a new issue at any time."""  # noqa
     + BOT_SUFFIX
-)  # noqa
+)
 
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"

commit 5f40aaabb5e27262f2869c5b8d5f9a9ea0bafdf7
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Nov 18 07:46:28 2024 -0800

    style: Lint and clean up code formatting in issues.py script

diff --git a/scripts/issues.py b/scripts/issues.py
index a03696f9..35685985 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -22,11 +22,9 @@ def has_been_reopened(issue_number):
 # Load environment variables from .env file
 load_dotenv()
 
-BOT_SUFFIX = (
-    """
+BOT_SUFFIX = """
 Note: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made these updates to the issue.
-""" # noqa
-)
+"""  # noqa
 
 DUPLICATE_COMMENT = (
     """Thanks for trying aider and filing this issue.
@@ -294,9 +292,7 @@ def handle_stale_closing(all_issues, auto_yes):
                         continue
 
                 # Add closing comment
-                comment_url = (
-                    f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
-                )
+                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
                 response = requests.post(
                     comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT}
                 )

commit 8adf42216d2b0fb9f9e53562eaf1ed1f274e70cc
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Nov 18 07:47:30 2024 -0800

    copy

diff --git a/scripts/issues.py b/scripts/issues.py
index 35685985..721178fa 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -22,8 +22,7 @@ def has_been_reopened(issue_number):
 # Load environment variables from .env file
 load_dotenv()
 
-BOT_SUFFIX = """
-Note: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made these updates to the issue.
+BOT_SUFFIX = """Note: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made these updates to the issue.
 """  # noqa
 
 DUPLICATE_COMMENT = (
@@ -31,9 +30,9 @@ DUPLICATE_COMMENT = (
 
 This looks like a duplicate of #{oldest_issue_number}. Please see the comments there for more information, and feel free to continue the discussion within that issue.
 
-I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""
+I'm going to close this issue for now. But please let me know if you think this is actually a distinct issue and I will reopen this issue."""  # noqa
     + BOT_SUFFIX
-)  # noqa
+)
 
 STALE_COMMENT = (
     """I'm labeling this issue as stale because it has been open for 2 weeks with no activity. If there are no additional comments, I will close it in 7 days."""  # noqa
@@ -292,7 +291,7 @@ def handle_stale_closing(all_issues, auto_yes):
                         continue
 
                 # Add closing comment
-                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+                comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"  # noqa
                 response = requests.post(
                     comment_url, headers=headers, json={"body": CLOSE_STALE_COMMENT}
                 )

commit 7b34d9e4f4d1b67a516032ed6bded8c1771fd22e
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Nov 28 15:52:40 2024 -0800

    copy

diff --git a/scripts/issues.py b/scripts/issues.py
index 721178fa..3750f64d 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -22,7 +22,9 @@ def has_been_reopened(issue_number):
 # Load environment variables from .env file
 load_dotenv()
 
-BOT_SUFFIX = """Note: A [bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made these updates to the issue.
+BOT_SUFFIX = """
+
+Note: [A bot script](https://github.com/Aider-AI/aider/blob/main/scripts/issues.py) made these updates to the issue.
 """  # noqa
 
 DUPLICATE_COMMENT = (

commit bc0b11e1ef72d6a9b8c32b4b7110aa35dfe971bf
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Dec 13 08:45:43 2024 -0800

    feat: Add fixed enhancement issue closing

diff --git a/scripts/issues.py b/scripts/issues.py
index 3750f64d..79116060 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -46,6 +46,13 @@ CLOSE_STALE_COMMENT = (
     + BOT_SUFFIX
 )
 
+CLOSE_FIXED_ENHANCEMENT_COMMENT = (
+    """I'm closing this enhancement request since it has been marked as 'fixed' for over 3 weeks. The requested feature should now be available in recent versions of aider.
+
+If you find that this enhancement is still needed, please feel free to reopen this issue or create a new one."""
+    + BOT_SUFFIX
+)
+
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"
 REPO_OWNER = "Aider-AI"
@@ -306,6 +313,63 @@ def handle_stale_closing(all_issues, auto_yes):
                 print(f"  Closed issue #{issue['number']}")
 
 
+def handle_fixed_enhancements(all_issues, auto_yes):
+    print("\nChecking for fixed enhancement issues to close...")
+
+    for issue in all_issues:
+        # Skip if not open or doesn't have both required labels
+        labels = [label["name"] for label in issue["labels"]]
+        if (
+            issue["state"] != "open"
+            or "enhancement" not in labels
+            or "fixed" not in labels
+        ):
+            continue
+
+        # Find when the fixed label was added
+        timeline_url = (
+            f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/timeline"
+        )
+        response = requests.get(timeline_url, headers=headers)
+        response.raise_for_status()
+        events = response.json()
+
+        # Find the most recent fixed label addition
+        fixed_events = [
+            event
+            for event in events
+            if event.get("event") == "labeled" and event.get("label", {}).get("name") == "fixed"
+        ]
+
+        if not fixed_events:
+            continue
+
+        latest_fixed = datetime.strptime(fixed_events[-1]["created_at"], "%Y-%m-%dT%H:%M:%SZ")
+        days_fixed = (datetime.now() - latest_fixed).days
+
+        if days_fixed >= 21:
+            print(f"\nFixed enhancement ready for closing #{issue['number']}: {issue['title']}")
+            print(f"  Has been marked fixed for {days_fixed} days")
+
+            if not auto_yes:
+                confirm = input("Close this issue? (y/n): ")
+                if confirm.lower() != "y":
+                    print("Skipping this issue.")
+                    continue
+
+            # Add closing comment
+            comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            response = requests.post(
+                comment_url, headers=headers, json={"body": CLOSE_FIXED_ENHANCEMENT_COMMENT}
+            )
+            response.raise_for_status()
+
+            # Close the issue
+            url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}"
+            response = requests.patch(url, headers=headers, json={"state": "closed"})
+            response.raise_for_status()
+            print(f"  Closed issue #{issue['number']}")
+
 def handle_duplicate_issues(all_issues, auto_yes):
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)
@@ -363,6 +427,7 @@ def main():
     handle_stale_issues(all_issues, args.yes)
     handle_stale_closing(all_issues, args.yes)
     handle_duplicate_issues(all_issues, args.yes)
+    handle_fixed_enhancements(all_issues, args.yes)
 
 
 if __name__ == "__main__":

commit 6778c336282da2499ab07f8e8cb4b82afe07cc78
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Dec 13 08:45:47 2024 -0800

    style: Apply linter fixes

diff --git a/scripts/issues.py b/scripts/issues.py
index 79116060..e1eaf784 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -319,11 +319,7 @@ def handle_fixed_enhancements(all_issues, auto_yes):
     for issue in all_issues:
         # Skip if not open or doesn't have both required labels
         labels = [label["name"] for label in issue["labels"]]
-        if (
-            issue["state"] != "open"
-            or "enhancement" not in labels
-            or "fixed" not in labels
-        ):
+        if issue["state"] != "open" or "enhancement" not in labels or "fixed" not in labels:
             continue
 
         # Find when the fixed label was added
@@ -358,7 +354,9 @@ def handle_fixed_enhancements(all_issues, auto_yes):
                     continue
 
             # Add closing comment
-            comment_url = f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            comment_url = (
+                f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
+            )
             response = requests.post(
                 comment_url, headers=headers, json={"body": CLOSE_FIXED_ENHANCEMENT_COMMENT}
             )
@@ -370,6 +368,7 @@ def handle_fixed_enhancements(all_issues, auto_yes):
             response.raise_for_status()
             print(f"  Closed issue #{issue['number']}")
 
+
 def handle_duplicate_issues(all_issues, auto_yes):
     open_issues = [issue for issue in all_issues if issue["state"] == "open"]
     grouped_open_issues = group_issues_by_subject(open_issues)

commit 517b2b42a6bed43ba2725241096159268dea4229
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Dec 13 08:45:58 2024 -0800

    fix: Fix long lines in closing comment

diff --git a/scripts/issues.py b/scripts/issues.py
index e1eaf784..1b98035a 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -47,9 +47,10 @@ CLOSE_STALE_COMMENT = (
 )
 
 CLOSE_FIXED_ENHANCEMENT_COMMENT = (
-    """I'm closing this enhancement request since it has been marked as 'fixed' for over 3 weeks. The requested feature should now be available in recent versions of aider.
-
-If you find that this enhancement is still needed, please feel free to reopen this issue or create a new one."""
+    """I'm closing this enhancement request since it has been marked as 'fixed' for over """
+    """3 weeks. The requested feature should now be available in recent versions of aider.\n\n"""
+    """If you find that this enhancement is still needed, please feel free to reopen this """
+    """issue or create a new one."""
     + BOT_SUFFIX
 )
 

commit b982626ac48e4a582f641fc7bbaaefb8de623e0e
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Dec 13 08:46:02 2024 -0800

    style: Fix line length in comment

diff --git a/scripts/issues.py b/scripts/issues.py
index 1b98035a..06356ca0 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -50,8 +50,7 @@ CLOSE_FIXED_ENHANCEMENT_COMMENT = (
     """I'm closing this enhancement request since it has been marked as 'fixed' for over """
     """3 weeks. The requested feature should now be available in recent versions of aider.\n\n"""
     """If you find that this enhancement is still needed, please feel free to reopen this """
-    """issue or create a new one."""
-    + BOT_SUFFIX
+    """issue or create a new one.""" + BOT_SUFFIX
 )
 
 # GitHub API configuration

commit 844e12769cd4821f153586a2cea0d5a6ccd7cd7c
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Dec 13 08:46:53 2024 -0800

    feat: Handle "bug" label like "enhancement" for closing

diff --git a/scripts/issues.py b/scripts/issues.py
index 06356ca0..34cf5fee 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -53,6 +53,13 @@ CLOSE_FIXED_ENHANCEMENT_COMMENT = (
     """issue or create a new one.""" + BOT_SUFFIX
 )
 
+CLOSE_FIXED_BUG_COMMENT = (
+    """I'm closing this bug report since it has been marked as 'fixed' for over """
+    """3 weeks. This issue should be resolved in recent versions of aider.\n\n"""
+    """If you find that this bug is still present, please feel free to reopen this """
+    """issue or create a new one with steps to reproduce.""" + BOT_SUFFIX
+)
+
 # GitHub API configuration
 GITHUB_API_URL = "https://api.github.com"
 REPO_OWNER = "Aider-AI"
@@ -313,13 +320,19 @@ def handle_stale_closing(all_issues, auto_yes):
                 print(f"  Closed issue #{issue['number']}")
 
 
-def handle_fixed_enhancements(all_issues, auto_yes):
-    print("\nChecking for fixed enhancement issues to close...")
+def handle_fixed_issues(all_issues, auto_yes):
+    print("\nChecking for fixed enhancement and bug issues to close...")
 
     for issue in all_issues:
-        # Skip if not open or doesn't have both required labels
+        # Skip if not open or doesn't have fixed label
         labels = [label["name"] for label in issue["labels"]]
-        if issue["state"] != "open" or "enhancement" not in labels or "fixed" not in labels:
+        if issue["state"] != "open" or "fixed" not in labels:
+            continue
+
+        # Check if it's an enhancement or bug
+        is_enhancement = "enhancement" in labels
+        is_bug = "bug" in labels
+        if not (is_enhancement or is_bug):
             continue
 
         # Find when the fixed label was added
@@ -344,7 +357,8 @@ def handle_fixed_enhancements(all_issues, auto_yes):
         days_fixed = (datetime.now() - latest_fixed).days
 
         if days_fixed >= 21:
-            print(f"\nFixed enhancement ready for closing #{issue['number']}: {issue['title']}")
+            issue_type = "enhancement" if is_enhancement else "bug"
+            print(f"\nFixed {issue_type} ready for closing #{issue['number']}: {issue['title']}")
             print(f"  Has been marked fixed for {days_fixed} days")
 
             if not auto_yes:
@@ -357,9 +371,10 @@ def handle_fixed_enhancements(all_issues, auto_yes):
             comment_url = (
                 f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
             )
-            response = requests.post(
-                comment_url, headers=headers, json={"body": CLOSE_FIXED_ENHANCEMENT_COMMENT}
+            comment = (
+                CLOSE_FIXED_ENHANCEMENT_COMMENT if is_enhancement else CLOSE_FIXED_BUG_COMMENT
             )
+            response = requests.post(comment_url, headers=headers, json={"body": comment})
             response.raise_for_status()
 
             # Close the issue
@@ -426,7 +441,7 @@ def main():
     handle_stale_issues(all_issues, args.yes)
     handle_stale_closing(all_issues, args.yes)
     handle_duplicate_issues(all_issues, args.yes)
-    handle_fixed_enhancements(all_issues, args.yes)
+    handle_fixed_issues(all_issues, args.yes)
 
 
 if __name__ == "__main__":

commit df8c88cef462e055324fbd5d67589eb243b0a68e
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Dec 13 08:46:57 2024 -0800

    style: Fix line length in issues.py

diff --git a/scripts/issues.py b/scripts/issues.py
index 34cf5fee..b474d6f4 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -371,9 +371,7 @@ def handle_fixed_issues(all_issues, auto_yes):
             comment_url = (
                 f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
             )
-            comment = (
-                CLOSE_FIXED_ENHANCEMENT_COMMENT if is_enhancement else CLOSE_FIXED_BUG_COMMENT
-            )
+            comment = CLOSE_FIXED_ENHANCEMENT_COMMENT if is_enhancement else CLOSE_FIXED_BUG_COMMENT
             response = requests.post(comment_url, headers=headers, json={"body": comment})
             response.raise_for_status()
 

commit 17919d7503cd5bee8e63c259427682cc419d97dd
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Mon Feb 10 11:37:30 2025 -0800

    refactor: Add priority label check to prevent bot actions on priority issues

diff --git a/scripts/issues.py b/scripts/issues.py
index b474d6f4..0603317d 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -126,6 +126,11 @@ def find_oldest_issue(subject, all_issues):
 
 
 def comment_and_close_duplicate(issue, oldest_issue):
+    # Skip if issue is labeled as priority
+    if "priority" in [label["name"] for label in issue["labels"]]:
+        print(f"  - Skipping priority issue #{issue['number']}")
+        return
+
     comment_url = (
         f"{GITHUB_API_URL}/repos/{REPO_OWNER}/{REPO_NAME}/issues/{issue['number']}/comments"
     )
@@ -168,7 +173,10 @@ def find_unlabeled_with_paul_comments(issues):
 
 def handle_unlabeled_issues(all_issues, auto_yes):
     print("\nFinding unlabeled issues with paul-gauthier comments...")
-    unlabeled_issues = find_unlabeled_with_paul_comments(all_issues)
+    unlabeled_issues = [
+        issue for issue in find_unlabeled_with_paul_comments(all_issues)
+        if "priority" not in [label["name"] for label in issue["labels"]]
+    ]
 
     if not unlabeled_issues:
         print("No unlabeled issues with paul-gauthier comments found.")
@@ -197,10 +205,12 @@ def handle_stale_issues(all_issues, auto_yes):
 
     for issue in all_issues:
         # Skip if not open, not a question, already stale, or has been reopened
+        labels = [label["name"] for label in issue["labels"]]
         if (
             issue["state"] != "open"
-            or "question" not in [label["name"] for label in issue["labels"]]
-            or "stale" in [label["name"] for label in issue["labels"]]
+            or "question" not in labels
+            or "stale" in labels
+            or "priority" in labels
             or has_been_reopened(issue["number"])
         ):
             continue
@@ -239,8 +249,9 @@ def handle_stale_closing(all_issues, auto_yes):
     print("\nChecking for issues to close or unstale...")
 
     for issue in all_issues:
-        # Skip if not open or not stale
-        if issue["state"] != "open" or "stale" not in [label["name"] for label in issue["labels"]]:
+        # Skip if not open, not stale, or is priority
+        labels = [label["name"] for label in issue["labels"]]
+        if issue["state"] != "open" or "stale" not in labels or "priority" in labels:
             continue
 
         # Get the timeline to find when the stale label was last added
@@ -324,9 +335,9 @@ def handle_fixed_issues(all_issues, auto_yes):
     print("\nChecking for fixed enhancement and bug issues to close...")
 
     for issue in all_issues:
-        # Skip if not open or doesn't have fixed label
+        # Skip if not open, doesn't have fixed label, or is priority
         labels = [label["name"] for label in issue["labels"]]
-        if issue["state"] != "open" or "fixed" not in labels:
+        if issue["state"] != "open" or "fixed" not in labels or "priority" in labels:
             continue
 
         # Check if it's an enhancement or bug

commit 30332c2ba5db6d08b190be78f9741ba2a0fee730
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Mon Feb 10 11:37:35 2025 -0800

    style: Apply linter formatting to issues.py script

diff --git a/scripts/issues.py b/scripts/issues.py
index 0603317d..17e38170 100755
--- a/scripts/issues.py
+++ b/scripts/issues.py
@@ -174,7 +174,8 @@ def find_unlabeled_with_paul_comments(issues):
 def handle_unlabeled_issues(all_issues, auto_yes):
     print("\nFinding unlabeled issues with paul-gauthier comments...")
     unlabeled_issues = [
-        issue for issue in find_unlabeled_with_paul_comments(all_issues)
+        issue
+        for issue in find_unlabeled_with_paul_comments(all_issues)
         if "priority" not in [label["name"] for label in issue["labels"]]
     ]
 

</code></pre>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
        });
    </script>
</body>
</html>
    