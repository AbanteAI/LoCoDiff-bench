<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt: src/build/Config.zig - Sonnet 3.5</title>
    <link rel="stylesheet" href="../../../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>
<body>
    <header>
        <h1>Prompt: src/build/Config.zig</h1>
        <h2>Model: Sonnet 3.5</h2>
        <p><a href="../../../cases/anthropic_claude-3.5-sonnet-20240620/ghostty_src_build_Config.zig.html">Back to Case</a> | <a href="../../../cases.html">All Cases</a> | <a href="../../../index.html">Home</a></p>
    </header>
    <main>
        <section>
            <h2>Prompt Content</h2>
            <pre><code class="language-plaintext"># Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- src/build/Config.zig

commit 8bf5c4ed7f8e39ca6dcadd036c8c72924590b200
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Tue Jan 7 07:14:32 2025 -0800

    This is a major refactor of `build.zig`.
    
    The major idea behind the refactor is to split the `build.zig` file up into
    distinct `src/build/*.zig` files. By doing so, we can improve readability of
    the primary `build.zig` while also enabling better reuse of steps. Our
    `build.zig` is now less than 150 lines of code (of course, it calls into a lot
    more lines but they're neatly organized now).
    
    Improvements:
    
      * `build.zig` is less than 150 lines of readable code.
      * Help strings and unicode table generators are only run once when multiple
        artifacts are built since the results are the same regardless of target.
      * Metal lib is only built once per architecture (rather than once per artifact)
      * Resources (shell integration, terminfo, etc.) and docs are only
        built/installed for artifacts that need them
    
    Breaking changes:
    
      * Removed broken wasm build (@gabydd will re-add)
      * Removed conformance files, shell scripts are better and we don't run
        these anymore
      * Removed macOS app bundle creation, we don't use this anymore since we
        use Xcode
    
    ## Some History
    
    Our `build.zig` hasn't been significantly refactored since the project started,
    when Zig was _version 0.10_. Since then, the build system has changed
    significantly. We've only ever duct taped the `build.zig` as we needed to
    support new Zig versions, new features, etc. It was a mess.
    
    The major improvement is adapting the entire Ghostty `build.zig` to the Step
    and LazyPath changes introduced way back in Zig 0.12. This lets us better take
    advantage of parallelism and the dependency graph so that steps are only
    executed as they're needed.
    
    As such, you can see in the build.zig that we initialize a lot of things, but
    unless a final target (i.e. install, run) references those steps, _they'll
    never be executed_. This lets us clean up a lot.

diff --git a/src/build/Config.zig b/src/build/Config.zig
new file mode 100644
index 00000000..71dffce4
--- /dev/null
+++ b/src/build/Config.zig
@@ -0,0 +1,503 @@
+/// Build configuration. This is the configuration that is populated
+/// during `zig build` to control the rest of the build process.
+const Config = @This();
+
+const std = @import("std");
+const builtin = @import("builtin");
+
+const apprt = @import("../apprt.zig");
+const font = @import("../font/main.zig");
+const renderer = @import("../renderer.zig");
+const Command = @import("../Command.zig");
+const WasmTarget = @import("../os/wasm/target.zig").Target;
+
+const gtk = @import("gtk.zig");
+const GitVersion = @import("GitVersion.zig");
+
+/// The version of the next release.
+///
+/// TODO: When Zig 0.14 is released, derive this from build.zig.zon directly.
+/// Until then this MUST match build.zig.zon and should always be the
+/// _next_ version to release.
+const app_version: std.SemanticVersion = .{ .major = 1, .minor = 0, .patch = 2 };
+
+/// Standard build configuration options.
+optimize: std.builtin.OptimizeMode,
+target: std.Build.ResolvedTarget,
+wasm_target: WasmTarget,
+
+/// Comptime interfaces
+app_runtime: apprt.Runtime = .none,
+renderer: renderer.Impl = .opengl,
+font_backend: font.Backend = .freetype,
+
+/// Feature flags
+adwaita: bool = false,
+x11: bool = false,
+wayland: bool = false,
+sentry: bool = true,
+wasm_shared: bool = true,
+
+/// Ghostty exe properties
+exe_entrypoint: ExeEntrypoint = .ghostty,
+version: std.SemanticVersion = .{ .major = 0, .minor = 0, .patch = 0 },
+
+/// Binary properties
+pie: bool = false,
+strip: bool = false,
+patch_rpath: ?[]const u8 = null,
+
+/// Artifacts
+flatpak: bool = false,
+emit_test_exe: bool = false,
+emit_bench: bool = false,
+emit_helpgen: bool = false,
+emit_docs: bool = false,
+emit_webdata: bool = false,
+emit_xcframework: bool = false,
+
+/// Environmental properties
+env: std.process.EnvMap,
+
+pub fn init(b: *std.Build) !Config {
+    // Setup our standard Zig target and optimize options, i.e.
+    // `-Doptimize` and `-Dtarget`.
+    const optimize = b.standardOptimizeOption(.{});
+    const target = target: {
+        var result = b.standardTargetOptions(.{});
+
+        // If we're building for macOS and we're on macOS, we need to
+        // use a generic target to workaround compilation issues.
+        if (result.result.os.tag == .macos and builtin.target.isDarwin()) {
+            result = genericMacOSTarget(b, null);
+        }
+
+        // If we have no minimum OS version, we set the default based on
+        // our tag. Not all tags have a minimum so this may be null.
+        if (result.query.os_version_min == null) {
+            result.query.os_version_min = osVersionMin(result.result.os.tag);
+        }
+
+        break :target result;
+    };
+
+    // This is set to true when we're building a system package. For now
+    // this is trivially detected using the "system_package_mode" bool
+    // but we may want to make this more sophisticated in the future.
+    const system_package: bool = b.graph.system_package_mode;
+
+    // This specifies our target wasm runtime. For now only one semi-usable
+    // one exists so this is hardcoded.
+    const wasm_target: WasmTarget = .browser;
+
+    // Determine whether GTK supports X11 and Wayland. This is always safe
+    // to run even on non-Linux platforms because any failures result in
+    // defaults.
+    const gtk_targets = gtk.targets(b);
+
+    // We use env vars throughout the build so we grab them immediately here.
+    var env = try std.process.getEnvMap(b.allocator);
+    errdefer env.deinit();
+
+    var config: Config = .{
+        .optimize = optimize,
+        .target = target,
+        .wasm_target = wasm_target,
+        .env = env,
+    };
+
+    //---------------------------------------------------------------
+    // Comptime Interfaces
+
+    config.font_backend = b.option(
+        font.Backend,
+        "font-backend",
+        "The font backend to use for discovery and rasterization.",
+    ) orelse font.Backend.default(target.result, wasm_target);
+
+    config.app_runtime = b.option(
+        apprt.Runtime,
+        "app-runtime",
+        "The app runtime to use. Not all values supported on all platforms.",
+    ) orelse apprt.Runtime.default(target.result);
+
+    config.renderer = b.option(
+        renderer.Impl,
+        "renderer",
+        "The app runtime to use. Not all values supported on all platforms.",
+    ) orelse renderer.Impl.default(target.result, wasm_target);
+
+    //---------------------------------------------------------------
+    // Feature Flags
+
+    config.adwaita = b.option(
+        bool,
+        "gtk-adwaita",
+        "Enables the use of Adwaita when using the GTK rendering backend.",
+    ) orelse true;
+
+    config.flatpak = b.option(
+        bool,
+        "flatpak",
+        "Build for Flatpak (integrates with Flatpak APIs). Only has an effect targeting Linux.",
+    ) orelse false;
+
+    config.sentry = b.option(
+        bool,
+        "sentry",
+        "Build with Sentry crash reporting. Default for macOS is true, false for any other system.",
+    ) orelse sentry: {
+        switch (target.result.os.tag) {
+            .macos, .ios => break :sentry true,
+
+            // Note its false for linux because the crash reports on Linux
+            // don't have much useful information.
+            else => break :sentry false,
+        }
+    };
+
+    config.wayland = b.option(
+        bool,
+        "gtk-wayland",
+        "Enables linking against Wayland libraries when using the GTK rendering backend.",
+    ) orelse gtk_targets.wayland;
+
+    config.x11 = b.option(
+        bool,
+        "gtk-x11",
+        "Enables linking against X11 libraries when using the GTK rendering backend.",
+    ) orelse gtk_targets.x11;
+
+    //---------------------------------------------------------------
+    // Ghostty Exe Properties
+
+    const version_string = b.option(
+        []const u8,
+        "version-string",
+        "A specific version string to use for the build. " ++
+            "If not specified, git will be used. This must be a semantic version.",
+    );
+
+    config.version = if (version_string) |v|
+        // If an explicit version is given, we always use it.
+        try std.SemanticVersion.parse(v)
+    else version: {
+        // If no explicit version is given, we try to detect it from git.
+        const vsn = GitVersion.detect(b) catch |err| switch (err) {
+            // If Git isn't available we just make an unknown dev version.
+            error.GitNotFound,
+            error.GitNotRepository,
+            => break :version .{
+                .major = app_version.major,
+                .minor = app_version.minor,
+                .patch = app_version.patch,
+                .pre = "dev",
+                .build = "0000000",
+            },
+
+            else => return err,
+        };
+        if (vsn.tag) |tag| {
+            // Tip releases behave just like any other pre-release so we skip.
+            if (!std.mem.eql(u8, tag, "tip")) {
+                const expected = b.fmt("v{d}.{d}.{d}", .{
+                    app_version.major,
+                    app_version.minor,
+                    app_version.patch,
+                });
+
+                if (!std.mem.eql(u8, tag, expected)) {
+                    @panic("tagged releases must be in vX.Y.Z format matching build.zig");
+                }
+
+                break :version .{
+                    .major = app_version.major,
+                    .minor = app_version.minor,
+                    .patch = app_version.patch,
+                };
+            }
+        }
+
+        break :version .{
+            .major = app_version.major,
+            .minor = app_version.minor,
+            .patch = app_version.patch,
+            .pre = vsn.branch,
+            .build = vsn.short_hash,
+        };
+    };
+
+    //---------------------------------------------------------------
+    // Binary Properties
+
+    // On NixOS, the built binary from `zig build` needs to patch the rpath
+    // into the built binary for it to be portable across the NixOS system
+    // it was built for. We default this to true if we can detect we're in
+    // a Nix shell and have LD_LIBRARY_PATH set.
+    config.patch_rpath = b.option(
+        []const u8,
+        "patch-rpath",
+        "Inject the LD_LIBRARY_PATH as the rpath in the built binary. " ++
+            "This defaults to LD_LIBRARY_PATH if we're in a Nix shell environment on NixOS.",
+    ) orelse patch_rpath: {
+        // We only do the patching if we're targeting our own CPU and its Linux.
+        if (!(target.result.os.tag == .linux) or !target.query.isNativeCpu()) break :patch_rpath null;
+
+        // If we're in a nix shell we default to doing this.
+        // Note: we purposely never deinit envmap because we leak the strings
+        if (env.get("IN_NIX_SHELL") == null) break :patch_rpath null;
+        break :patch_rpath env.get("LD_LIBRARY_PATH");
+    };
+
+    config.pie = b.option(
+        bool,
+        "pie",
+        "Build a Position Independent Executable. Default true for system packages.",
+    ) orelse system_package;
+
+    config.strip = b.option(
+        bool,
+        "strip",
+        "Strip the final executable. Default true for fast and small releases",
+    ) orelse switch (optimize) {
+        .Debug => false,
+        .ReleaseSafe => false,
+        .ReleaseFast, .ReleaseSmall => true,
+    };
+
+    //---------------------------------------------------------------
+    // Artifacts to Emit
+
+    config.emit_test_exe = b.option(
+        bool,
+        "emit-test-exe",
+        "Build and install test executables with 'build'",
+    ) orelse false;
+
+    config.emit_bench = b.option(
+        bool,
+        "emit-bench",
+        "Build and install the benchmark executables.",
+    ) orelse false;
+
+    config.emit_helpgen = b.option(
+        bool,
+        "emit-helpgen",
+        "Build and install the helpgen executable.",
+    ) orelse false;
+
+    config.emit_docs = b.option(
+        bool,
+        "emit-docs",
+        "Build and install auto-generated documentation (requires pandoc)",
+    ) orelse emit_docs: {
+        // If we are emitting any other artifacts then we default to false.
+        if (config.emit_bench or
+            config.emit_test_exe or
+            config.emit_helpgen) break :emit_docs false;
+
+        // We always emit docs in system package mode.
+        if (system_package) break :emit_docs true;
+
+        // We only default to true if we can find pandoc.
+        const path = Command.expandPath(b.allocator, "pandoc") catch
+            break :emit_docs false;
+        defer if (path) |p| b.allocator.free(p);
+        break :emit_docs path != null;
+    };
+
+    config.emit_webdata = b.option(
+        bool,
+        "emit-webdata",
+        "Build the website data for the website.",
+    ) orelse false;
+
+    config.emit_xcframework = b.option(
+        bool,
+        "emit-xcframework",
+        "Build and install the xcframework for the macOS library.",
+    ) orelse builtin.target.isDarwin() and
+        target.result.os.tag == .macos and
+        config.app_runtime == .none and
+        (!config.emit_bench and
+        !config.emit_test_exe and
+        !config.emit_helpgen);
+
+    //---------------------------------------------------------------
+    // System Packages
+
+    // These are all our dependencies that can be used with system
+    // packages if they exist. We set them up here so that we can set
+    // their defaults early. The first call configures the integration and
+    // subsequent calls just return the configured value. This lets them
+    // show up properly in `--help`.
+
+    {
+        // These dependencies we want to default false if we're on macOS.
+        // On macOS we don't want to use system libraries because we
+        // generally want a fat binary. This can be overridden with the
+        // `-fsys` flag.
+        for (&[_][]const u8{
+            "freetype",
+            "harfbuzz",
+            "fontconfig",
+            "libpng",
+            "zlib",
+            "oniguruma",
+        }) |dep| {
+            _ = b.systemIntegrationOption(
+                dep,
+                .{
+                    // If we're not on darwin we want to use whatever the
+                    // default is via the system package mode
+                    .default = if (target.result.isDarwin()) false else null,
+                },
+            );
+        }
+
+        // These default to false because they're rarely available as
+        // system packages so we usually want to statically link them.
+        for (&[_][]const u8{
+            "glslang",
+            "spirv-cross",
+            "simdutf",
+        }) |dep| {
+            _ = b.systemIntegrationOption(dep, .{ .default = false });
+        }
+    }
+
+    return config;
+}
+
+/// Configure the build options with our values.
+pub fn addOptions(self: *const Config, step: *std.Build.Step.Options) !void {
+    // We need to break these down individual because addOption doesn't
+    // support all types.
+    step.addOption(bool, "flatpak", self.flatpak);
+    step.addOption(bool, "adwaita", self.adwaita);
+    step.addOption(bool, "x11", self.x11);
+    step.addOption(bool, "wayland", self.wayland);
+    step.addOption(bool, "sentry", self.sentry);
+    step.addOption(apprt.Runtime, "app_runtime", self.app_runtime);
+    step.addOption(font.Backend, "font_backend", self.font_backend);
+    step.addOption(renderer.Impl, "renderer", self.renderer);
+    step.addOption(ExeEntrypoint, "exe_entrypoint", self.exe_entrypoint);
+    step.addOption(WasmTarget, "wasm_target", self.wasm_target);
+    step.addOption(bool, "wasm_shared", self.wasm_shared);
+
+    // Our version. We also add the string version so we don't need
+    // to do any allocations at runtime. This has to be long enough to
+    // accommodate realistic large branch names for dev versions.
+    var buf: [1024]u8 = undefined;
+    step.addOption(std.SemanticVersion, "app_version", self.version);
+    step.addOption([:0]const u8, "app_version_string", try std.fmt.bufPrintZ(
+        &buf,
+        "{}",
+        .{self.version},
+    ));
+    step.addOption(
+        ReleaseChannel,
+        "release_channel",
+        channel: {
+            const pre = self.version.pre orelse break :channel .stable;
+            if (pre.len == 0) break :channel .stable;
+            break :channel .tip;
+        },
+    );
+}
+
+/// Rehydrate our Config from the comptime options. Note that not all
+/// options are available at comptime, so look closely at this implementation
+/// to see what is and isn't available.
+pub fn fromOptions() Config {
+    const options = @import("build_options");
+    return .{
+        // Unused at runtime.
+        .optimize = undefined,
+        .target = undefined,
+        .env = undefined,
+
+        .version = options.app_version,
+        .flatpak = options.flatpak,
+        .adwaita = options.adwaita,
+        .app_runtime = std.meta.stringToEnum(apprt.Runtime, @tagName(options.app_runtime)).?,
+        .font_backend = std.meta.stringToEnum(font.Backend, @tagName(options.font_backend)).?,
+        .renderer = std.meta.stringToEnum(renderer.Impl, @tagName(options.renderer)).?,
+        .exe_entrypoint = std.meta.stringToEnum(ExeEntrypoint, @tagName(options.exe_entrypoint)).?,
+        .wasm_target = std.meta.stringToEnum(WasmTarget, @tagName(options.wasm_target)).?,
+        .wasm_shared = options.wasm_shared,
+    };
+}
+
+/// Returns the minimum OS version for the given OS tag. This shouldn't
+/// be used generally, it should only be used for Darwin-based OS currently.
+pub fn osVersionMin(tag: std.Target.Os.Tag) ?std.Target.Query.OsVersion {
+    return switch (tag) {
+        // We support back to the earliest officially supported version
+        // of macOS by Apple. EOL versions are not supported.
+        .macos => .{ .semver = .{
+            .major = 13,
+            .minor = 0,
+            .patch = 0,
+        } },
+
+        // iOS 17 picked arbitrarily
+        .ios => .{ .semver = .{
+            .major = 17,
+            .minor = 0,
+            .patch = 0,
+        } },
+
+        // This should never happen currently. If we add a new target then
+        // we should add a new case here.
+        else => null,
+    };
+}
+
+// Returns a ResolvedTarget for a mac with a `target.result.cpu.model.name` of `generic`.
+// `b.standardTargetOptions()` returns a more specific cpu like `apple_a15`.
+//
+// This is used to workaround compilation issues on macOS.
+// (see for example https://github.com/mitchellh/ghostty/issues/1640).
+pub fn genericMacOSTarget(
+    b: *std.Build,
+    arch: ?std.Target.Cpu.Arch,
+) std.Build.ResolvedTarget {
+    return b.resolveTargetQuery(.{
+        .cpu_arch = arch orelse builtin.target.cpu.arch,
+        .os_tag = .macos,
+        .os_version_min = osVersionMin(.macos),
+    });
+}
+
+/// The possible entrypoints for the exe artifact. This has no effect on
+/// other artifact types (i.e. lib, wasm_module).
+///
+/// The whole existence of this enum is to workaround the fact that Zig
+/// doesn't allow the main function to be in a file in a subdirctory
+/// from the "root" of the module, and I don't want to pollute our root
+/// directory with a bunch of individual zig files for each entrypoint.
+///
+/// Therefore, main.zig uses this to switch between the different entrypoints.
+pub const ExeEntrypoint = enum {
+    ghostty,
+    helpgen,
+    mdgen_ghostty_1,
+    mdgen_ghostty_5,
+    webgen_config,
+    webgen_actions,
+    bench_parser,
+    bench_stream,
+    bench_codepoint_width,
+    bench_grapheme_break,
+    bench_page_init,
+};
+
+/// The release channel for the build.
+pub const ReleaseChannel = enum {
+    /// Unstable builds on every commit.
+    tip,
+
+    /// Stable tagged releases.
+    stable,
+};

commit 098a46f0773c544b07e8d812247719893f1b6b6d
Author: Anund <anundm@gmail.com>
Date:   Wed Jan 8 17:32:11 2025 +1100

    docs: generate mdx file for cli actions

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 71dffce4..b65a8d56 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -486,6 +486,7 @@ pub const ExeEntrypoint = enum {
     mdgen_ghostty_5,
     webgen_config,
     webgen_actions,
+    webgen_commands,
     bench_parser,
     bench_stream,
     bench_codepoint_width,

commit 8f49a227b7c352083b0815e7818db900402513e0
Author: Jeffrey C. Ollie <jeff@ocjtech.us>
Date:   Wed Jan 22 22:29:25 2025 -0600

    build: options to enable/disable terminfo & termcap install
    
    Fixes #5253
    
    Add `-Demit-terminfo` and `-Demit-termcap` build options to
    enable/disable installtion of source terminfo and termcap files.

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 71dffce4..1d51525d 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -55,6 +55,8 @@ emit_helpgen: bool = false,
 emit_docs: bool = false,
 emit_webdata: bool = false,
 emit_xcframework: bool = false,
+emit_terminfo: bool = false,
+emit_termcap: bool = false,
 
 /// Environmental properties
 env: std.process.EnvMap,
@@ -306,11 +308,32 @@ pub fn init(b: *std.Build) !Config {
         break :emit_docs path != null;
     };
 
+    config.emit_terminfo = b.option(
+        bool,
+        "emit-terminfo",
+        "Install Ghostty terminfo source file",
+    ) orelse switch (target.result.os.tag) {
+        .windows => true,
+        else => switch (optimize) {
+            .Debug => true,
+            .ReleaseSafe, .ReleaseFast, .ReleaseSmall => false,
+        },
+    };
+
+    config.emit_termcap = b.option(
+        bool,
+        "emit-termcap",
+        "Install Ghostty termcap file",
+    ) orelse false;
+
     config.emit_webdata = b.option(
         bool,
         "emit-webdata",
         "Build the website data for the website.",
-    ) orelse false;
+    ) orelse switch (optimize) {
+        .Debug => true,
+        .ReleaseSafe, .ReleaseFast, .ReleaseSmall => false,
+    };
 
     config.emit_xcframework = b.option(
         bool,

commit 4c277439317cddc53b87b6189056d031a2b77e78
Merge: deb90337 8f49a227
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Thu Jan 23 16:14:53 2025 -0800

    build: options to enable/disable terminfo & termcap install (#5311)
    
    Fixes #5253
    
    Add `-Demit-terminfo` and `-Demit-termcap` build options to
    enable/disable installtion of source terminfo and termcap files.


commit c0eb6985ee6adaeb031751fddb0d0448533d68c6
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Thu Jan 23 19:38:13 2025 -0800

    Revert "build: options to enable/disable terminfo & termcap install"
    
    This reverts commit 8f49a227b7c352083b0815e7818db900402513e0.

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 8b28a6a0..b65a8d56 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -55,8 +55,6 @@ emit_helpgen: bool = false,
 emit_docs: bool = false,
 emit_webdata: bool = false,
 emit_xcframework: bool = false,
-emit_terminfo: bool = false,
-emit_termcap: bool = false,
 
 /// Environmental properties
 env: std.process.EnvMap,
@@ -308,32 +306,11 @@ pub fn init(b: *std.Build) !Config {
         break :emit_docs path != null;
     };
 
-    config.emit_terminfo = b.option(
-        bool,
-        "emit-terminfo",
-        "Install Ghostty terminfo source file",
-    ) orelse switch (target.result.os.tag) {
-        .windows => true,
-        else => switch (optimize) {
-            .Debug => true,
-            .ReleaseSafe, .ReleaseFast, .ReleaseSmall => false,
-        },
-    };
-
-    config.emit_termcap = b.option(
-        bool,
-        "emit-termcap",
-        "Install Ghostty termcap file",
-    ) orelse false;
-
     config.emit_webdata = b.option(
         bool,
         "emit-webdata",
         "Build the website data for the website.",
-    ) orelse switch (optimize) {
-        .Debug => true,
-        .ReleaseSafe, .ReleaseFast, .ReleaseSmall => false,
-    };
+    ) orelse false;
 
     config.emit_xcframework = b.option(
         bool,

commit 2f8b0dc899dd197f1e018ccedcfadbe6d82994ad
Author: Jeffrey C. Ollie <jeff@ocjtech.us>
Date:   Thu Jan 23 22:29:47 2025 -0600

    build: options to enable/disable terminfo & termcap install (take 2)
    
    Fixes #5253
    
    Add -Demit-terminfo and -Demit-termcap build options to enable/disable
    installation of source terminfo and termcap files.

diff --git a/src/build/Config.zig b/src/build/Config.zig
index b65a8d56..c6f0e6d0 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -55,6 +55,8 @@ emit_helpgen: bool = false,
 emit_docs: bool = false,
 emit_webdata: bool = false,
 emit_xcframework: bool = false,
+emit_terminfo: bool = false,
+emit_termcap: bool = false,
 
 /// Environmental properties
 env: std.process.EnvMap,
@@ -306,6 +308,27 @@ pub fn init(b: *std.Build) !Config {
         break :emit_docs path != null;
     };
 
+    config.emit_terminfo = b.option(
+        bool,
+        "emit-terminfo",
+        "Install Ghostty terminfo source file",
+    ) orelse switch (target.result.os.tag) {
+        .windows => true,
+        else => switch (optimize) {
+            .Debug => true,
+            .ReleaseSafe, .ReleaseFast, .ReleaseSmall => false,
+        },
+    };
+
+    config.emit_termcap = b.option(
+        bool,
+        "emit-termcap",
+        "Install Ghostty termcap file",
+    ) orelse switch (optimize) {
+        .Debug => true,
+        .ReleaseSafe, .ReleaseFast, .ReleaseSmall => false,
+    };
+
     config.emit_webdata = b.option(
         bool,
         "emit-webdata",

commit a62b26cd2fac4d3685aeec6aeebeaf2ad5300fc9
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Thu Jan 30 07:18:07 2025 -0800

    next version will be 1.1.0

diff --git a/src/build/Config.zig b/src/build/Config.zig
index c6f0e6d0..c832b77a 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -19,7 +19,7 @@ const GitVersion = @import("GitVersion.zig");
 /// TODO: When Zig 0.14 is released, derive this from build.zig.zon directly.
 /// Until then this MUST match build.zig.zon and should always be the
 /// _next_ version to release.
-const app_version: std.SemanticVersion = .{ .major = 1, .minor = 0, .patch = 2 };
+const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 0 };
 
 /// Standard build configuration options.
 optimize: std.builtin.OptimizeMode,

commit c5508e7d1922842ecd3160ea73b97da1282168b3
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Thu Jan 30 14:23:17 2025 -0800

    update version for development

diff --git a/src/build/Config.zig b/src/build/Config.zig
index c832b77a..0ff0fc91 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -19,7 +19,7 @@ const GitVersion = @import("GitVersion.zig");
 /// TODO: When Zig 0.14 is released, derive this from build.zig.zon directly.
 /// Until then this MUST match build.zig.zon and should always be the
 /// _next_ version to release.
-const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 0 };
+const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 1 };
 
 /// Standard build configuration options.
 optimize: std.builtin.OptimizeMode,

commit 710ea1c8d9a1005a9f7f03fe98297b13a21b8e44
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Thu Feb 13 13:02:01 2025 -0800

    up all the metadata to 1.1.2

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 0ff0fc91..140fddbc 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -19,7 +19,7 @@ const GitVersion = @import("GitVersion.zig");
 /// TODO: When Zig 0.14 is released, derive this from build.zig.zon directly.
 /// Until then this MUST match build.zig.zon and should always be the
 /// _next_ version to release.
-const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 1 };
+const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 2 };
 
 /// Standard build configuration options.
 optimize: std.builtin.OptimizeMode,

commit 52a5069decb6d698df347e4b46d5f26ebe639ebb
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Thu Feb 13 15:31:07 2025 -0800

    up versions for development

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 140fddbc..7c8605c7 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -19,7 +19,7 @@ const GitVersion = @import("GitVersion.zig");
 /// TODO: When Zig 0.14 is released, derive this from build.zig.zon directly.
 /// Until then this MUST match build.zig.zon and should always be the
 /// _next_ version to release.
-const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 2 };
+const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 3 };
 
 /// Standard build configuration options.
 optimize: std.builtin.OptimizeMode,

commit 25c5ecf553a1460ad88607c838e2f282612d1b9f
Author: Jeffrey C. Ollie <jeff@ocjtech.us>
Date:   Thu Jan 30 22:59:36 2025 -0600

    gtk: require libadwaita
    
    This commit removes support for building without libadwaita.

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 7c8605c7..f7bf96d3 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -32,7 +32,6 @@ renderer: renderer.Impl = .opengl,
 font_backend: font.Backend = .freetype,
 
 /// Feature flags
-adwaita: bool = false,
 x11: bool = false,
 wayland: bool = false,
 sentry: bool = true,
@@ -132,12 +131,6 @@ pub fn init(b: *std.Build) !Config {
     //---------------------------------------------------------------
     // Feature Flags
 
-    config.adwaita = b.option(
-        bool,
-        "gtk-adwaita",
-        "Enables the use of Adwaita when using the GTK rendering backend.",
-    ) orelse true;
-
     config.flatpak = b.option(
         bool,
         "flatpak",
@@ -397,7 +390,6 @@ pub fn addOptions(self: *const Config, step: *std.Build.Step.Options) !void {
     // We need to break these down individual because addOption doesn't
     // support all types.
     step.addOption(bool, "flatpak", self.flatpak);
-    step.addOption(bool, "adwaita", self.adwaita);
     step.addOption(bool, "x11", self.x11);
     step.addOption(bool, "wayland", self.wayland);
     step.addOption(bool, "sentry", self.sentry);
@@ -442,7 +434,6 @@ pub fn fromOptions() Config {
 
         .version = options.app_version,
         .flatpak = options.flatpak,
-        .adwaita = options.adwaita,
         .app_runtime = std.meta.stringToEnum(apprt.Runtime, @tagName(options.app_runtime)).?,
         .font_backend = std.meta.stringToEnum(font.Backend, @tagName(options.font_backend)).?,
         .renderer = std.meta.stringToEnum(renderer.Impl, @tagName(options.renderer)).?,

commit a85651fe4f11375257ca7b4c33c44cca06a1353e
Author: Leah Amelia Chen <hi@pluie.me>
Date:   Fri Feb 28 11:33:08 2025 +0100

    gtk: implement quick terminal
    
    Using `gtk4-layer-shell` still seems like the path of least resistance,
    and to my delight it pretty much Just Works. Hurrah!
    
    This implementation could do with some further polish (e.g. animations,
    which can be implemented via libadwaita's animations API, and global
    shortcuts), but as a MVP it works well enough.
    
    It even supports tabs!
    
    Fixes #4624.

diff --git a/src/build/Config.zig b/src/build/Config.zig
index f7bf96d3..00f04062 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -34,6 +34,7 @@ font_backend: font.Backend = .freetype,
 /// Feature flags
 x11: bool = false,
 wayland: bool = false,
+layer_shell: bool = false,
 sentry: bool = true,
 wasm_shared: bool = true,
 
@@ -109,7 +110,6 @@ pub fn init(b: *std.Build) !Config {
 
     //---------------------------------------------------------------
     // Comptime Interfaces
-
     config.font_backend = b.option(
         font.Backend,
         "font-backend",
@@ -163,6 +163,12 @@ pub fn init(b: *std.Build) !Config {
         "Enables linking against X11 libraries when using the GTK rendering backend.",
     ) orelse gtk_targets.x11;
 
+    config.layer_shell = b.option(
+        bool,
+        "gtk-layer-shell",
+        "Enables linking against the gtk4-layer-shell library for quick terminal support. Requires Wayland.",
+    ) orelse gtk_targets.layer_shell;
+
     //---------------------------------------------------------------
     // Ghostty Exe Properties
 
@@ -392,6 +398,7 @@ pub fn addOptions(self: *const Config, step: *std.Build.Step.Options) !void {
     step.addOption(bool, "flatpak", self.flatpak);
     step.addOption(bool, "x11", self.x11);
     step.addOption(bool, "wayland", self.wayland);
+    step.addOption(bool, "layer_shell", self.layer_shell);
     step.addOption(bool, "sentry", self.sentry);
     step.addOption(apprt.Runtime, "app_runtime", self.app_runtime);
     step.addOption(font.Backend, "font_backend", self.font_backend);

commit cd442eb9e26e2eb0dbae9a292d0203ef23c615fd
Author: Leah Amelia Chen <hi@pluie.me>
Date:   Fri Mar 7 17:03:23 2025 +0100

    gtk: build gtk4-layer-shell ourselves
    
    As of now `gtk4-layer-shell` is unavailable on recent, stable releases
    of many distros (Debian 12, Ubuntu 24.04, openSUSE Leap & Tumbleweed, etc.)
    and outdated on many others (Nixpkgs 24.11/unstable, Fedora 41, etc.)
    This is inconvenient for our users and severely limits where the quick
    terminal can be used. As a result we then build gtk4-layer-shell ourselves
    by default unless `--system` or `-fsys=gtk4-layer-shell` are specified.
    This also allows me to add an idiomatic Zig API on top of the library
    and avoiding adding even more raw C code in the GTK apprt.
    
    Since we now build gtk4-layer-shell it should be theoretically available
    on all Linux systems we target. As such, the `-Dgtk-layer-shell` build
    option has been removed. This is somewhat of an experimental change as
    I don't know if gtk4-layer-shell works perfectly across all distros, and
    we can always add the option back if need be.

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 00f04062..d7a5e4ae 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -34,7 +34,6 @@ font_backend: font.Backend = .freetype,
 /// Feature flags
 x11: bool = false,
 wayland: bool = false,
-layer_shell: bool = false,
 sentry: bool = true,
 wasm_shared: bool = true,
 
@@ -163,12 +162,6 @@ pub fn init(b: *std.Build) !Config {
         "Enables linking against X11 libraries when using the GTK rendering backend.",
     ) orelse gtk_targets.x11;
 
-    config.layer_shell = b.option(
-        bool,
-        "gtk-layer-shell",
-        "Enables linking against the gtk4-layer-shell library for quick terminal support. Requires Wayland.",
-    ) orelse gtk_targets.layer_shell;
-
     //---------------------------------------------------------------
     // Ghostty Exe Properties
 
@@ -366,6 +359,7 @@ pub fn init(b: *std.Build) !Config {
             "libpng",
             "zlib",
             "oniguruma",
+            "gtk4-layer-shell",
         }) |dep| {
             _ = b.systemIntegrationOption(
                 dep,
@@ -398,7 +392,6 @@ pub fn addOptions(self: *const Config, step: *std.Build.Step.Options) !void {
     step.addOption(bool, "flatpak", self.flatpak);
     step.addOption(bool, "x11", self.x11);
     step.addOption(bool, "wayland", self.wayland);
-    step.addOption(bool, "layer_shell", self.layer_shell);
     step.addOption(bool, "sentry", self.sentry);
     step.addOption(apprt.Runtime, "app_runtime", self.app_runtime);
     step.addOption(font.Backend, "font_backend", self.font_backend);

commit 7e2286eb8c603ade782a3970911531595d57e280
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Tue Mar 11 14:33:33 2025 -0700

    Zig 0.14

diff --git a/src/build/Config.zig b/src/build/Config.zig
index d7a5e4ae..562e1777 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -7,7 +7,7 @@ const builtin = @import("builtin");
 
 const apprt = @import("../apprt.zig");
 const font = @import("../font/main.zig");
-const renderer = @import("../renderer.zig");
+const rendererpkg = @import("../renderer.zig");
 const Command = @import("../Command.zig");
 const WasmTarget = @import("../os/wasm/target.zig").Target;
 
@@ -28,7 +28,7 @@ wasm_target: WasmTarget,
 
 /// Comptime interfaces
 app_runtime: apprt.Runtime = .none,
-renderer: renderer.Impl = .opengl,
+renderer: rendererpkg.Impl = .opengl,
 font_backend: font.Backend = .freetype,
 
 /// Feature flags
@@ -69,7 +69,9 @@ pub fn init(b: *std.Build) !Config {
 
         // If we're building for macOS and we're on macOS, we need to
         // use a generic target to workaround compilation issues.
-        if (result.result.os.tag == .macos and builtin.target.isDarwin()) {
+        if (result.result.os.tag == .macos and
+            builtin.target.os.tag.isDarwin())
+        {
             result = genericMacOSTarget(b, null);
         }
 
@@ -122,10 +124,10 @@ pub fn init(b: *std.Build) !Config {
     ) orelse apprt.Runtime.default(target.result);
 
     config.renderer = b.option(
-        renderer.Impl,
+        rendererpkg.Impl,
         "renderer",
         "The app runtime to use. Not all values supported on all platforms.",
-    ) orelse renderer.Impl.default(target.result, wasm_target);
+    ) orelse rendererpkg.Impl.default(target.result, wasm_target);
 
     //---------------------------------------------------------------
     // Feature Flags
@@ -331,7 +333,7 @@ pub fn init(b: *std.Build) !Config {
         bool,
         "emit-xcframework",
         "Build and install the xcframework for the macOS library.",
-    ) orelse builtin.target.isDarwin() and
+    ) orelse builtin.target.os.tag.isDarwin() and
         target.result.os.tag == .macos and
         config.app_runtime == .none and
         (!config.emit_bench and
@@ -366,7 +368,7 @@ pub fn init(b: *std.Build) !Config {
                 .{
                     // If we're not on darwin we want to use whatever the
                     // default is via the system package mode
-                    .default = if (target.result.isDarwin()) false else null,
+                    .default = if (target.result.os.tag.isDarwin()) false else null,
                 },
             );
         }
@@ -395,7 +397,7 @@ pub fn addOptions(self: *const Config, step: *std.Build.Step.Options) !void {
     step.addOption(bool, "sentry", self.sentry);
     step.addOption(apprt.Runtime, "app_runtime", self.app_runtime);
     step.addOption(font.Backend, "font_backend", self.font_backend);
-    step.addOption(renderer.Impl, "renderer", self.renderer);
+    step.addOption(rendererpkg.Impl, "renderer", self.renderer);
     step.addOption(ExeEntrypoint, "exe_entrypoint", self.exe_entrypoint);
     step.addOption(WasmTarget, "wasm_target", self.wasm_target);
     step.addOption(bool, "wasm_shared", self.wasm_shared);
@@ -436,7 +438,7 @@ pub fn fromOptions() Config {
         .flatpak = options.flatpak,
         .app_runtime = std.meta.stringToEnum(apprt.Runtime, @tagName(options.app_runtime)).?,
         .font_backend = std.meta.stringToEnum(font.Backend, @tagName(options.font_backend)).?,
-        .renderer = std.meta.stringToEnum(renderer.Impl, @tagName(options.renderer)).?,
+        .renderer = std.meta.stringToEnum(rendererpkg.Impl, @tagName(options.renderer)).?,
         .exe_entrypoint = std.meta.stringToEnum(ExeEntrypoint, @tagName(options.exe_entrypoint)).?,
         .wasm_target = std.meta.stringToEnum(WasmTarget, @tagName(options.wasm_target)).?,
         .wasm_shared = options.wasm_shared,

commit 221f905a1c5332a96f04918ea87d1c85a05af035
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Thu Mar 13 20:05:33 2025 -0700

    pkg/glfw
    
    Closes #6702
    
    This removes our mach-glfw dependency and replaces it with an in-tree
    pkg/glfw that includes both the source for compiling glfw as well as the
    Zig bindings. This matches the pattern from our other packages.
    
    This is based on the upstream mach-glfw work and therefore includes the
    original license and copyright information.
    
    The reasoning is stated in the issue but to summarize for the commit:
    
      - mach-glfw is no longer maintained, so we have to take ownership
      - mach-glfw depended on some large blobs of header files to enable
        cross-compilation but this isn't something we actually care about,
        so we can (and do) drop the blobs
      - mach-glfw blobs were hosted on mach hosts. given mach-glfw is
        unmaintained, we can't rely on this hosting
      - mach-glfw relied on a "glfw" package which was owned by another
        person to be Zig 0.14 compatible, but we no longer need to rely on
        this
      - mach-glfw builds were outdated based on latest Zig practices

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 562e1777..e0c7ed2b 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -337,8 +337,8 @@ pub fn init(b: *std.Build) !Config {
         target.result.os.tag == .macos and
         config.app_runtime == .none and
         (!config.emit_bench and
-        !config.emit_test_exe and
-        !config.emit_helpgen);
+            !config.emit_test_exe and
+            !config.emit_helpgen);
 
     //---------------------------------------------------------------
     // System Packages
@@ -379,6 +379,11 @@ pub fn init(b: *std.Build) !Config {
             "glslang",
             "spirv-cross",
             "simdutf",
+
+            // This is default false because it is used for testing
+            // primarily and not official packaging. The packaging
+            // guide advises against building the GLFW backend.
+            "glfw3",
         }) |dep| {
             _ = b.systemIntegrationOption(dep, .{ .default = false });
         }

commit f31f8bb78236a8388fc7af9f5621639ca812f879
Author: Mitchell Hashimoto <m@mitchellh.com>
Date:   Wed Mar 19 20:55:41 2025 -0700

    apprt/embedded: utf8 encoding buffer lifetime must extend beyond call
    
    Fixes #6821
    
    UTF8 translation using KeymapDarwin requires a buffer and the buffer was
    stack allocated in the coreKeyEvent call and returned from the function.
    We need the buffer to live longer than this.
    
    Long term, we're removing KeymapDarwin (there is a whole TODO comment in
    there about how to do it), but this fixes a real problem today.

diff --git a/src/build/Config.zig b/src/build/Config.zig
index e0c7ed2b..48456734 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -72,7 +72,7 @@ pub fn init(b: *std.Build) !Config {
         if (result.result.os.tag == .macos and
             builtin.target.os.tag.isDarwin())
         {
-            result = genericMacOSTarget(b, null);
+            result = genericMacOSTarget(b, result.query.cpu_arch);
         }
 
         // If we have no minimum OS version, we set the default based on

commit 27978ef4d0f1b25891d4f92fbd0dd46ece176198
Author: Jeffrey C. Ollie <jeff@ocjtech.us>
Date:   Wed Mar 26 23:29:15 2025 -0500

    version bump for development

diff --git a/src/build/Config.zig b/src/build/Config.zig
index 48456734..8974e1f0 100644
--- a/src/build/Config.zig
+++ b/src/build/Config.zig
@@ -19,7 +19,7 @@ const GitVersion = @import("GitVersion.zig");
 /// TODO: When Zig 0.14 is released, derive this from build.zig.zon directly.
 /// Until then this MUST match build.zig.zon and should always be the
 /// _next_ version to release.
-const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 3 };
+const app_version: std.SemanticVersion = .{ .major = 1, .minor = 1, .patch = 4 };
 
 /// Standard build configuration options.
 optimize: std.builtin.OptimizeMode,

</code></pre>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
        });
    </script>
</body>
</html>
    