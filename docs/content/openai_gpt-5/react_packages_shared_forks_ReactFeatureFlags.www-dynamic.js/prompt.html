<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt: packages/shared/forks/ReactFeatureFlags.www-dynamic.js - GPT-5</title>
    <link rel="stylesheet" href="../../../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>
<body>
    <header>
        <h1>Prompt: packages/shared/forks/ReactFeatureFlags.www-dynamic.js</h1>
        <h2>Model: GPT-5</h2>
        <p><a href="../../../cases/openai_gpt-5/react_packages_shared_forks_ReactFeatureFlags.www-dynamic.js.html">Back to Case</a> | <a href="../../../cases.html">All Cases</a> | <a href="../../../index.html">Home</a></p>
    </header>
    <main>
        <section>
            <h2>Prompt Content</h2>
            <pre><code class="language-plaintext"># Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- packages/shared/forks/ReactFeatureFlags.www-dynamic.js

commit 115cd12d9bbb2bff303e52feb1394e3a2cef20ca
Author: Andrew Clark <git@andrewclark.io>
Date:   Fri Mar 6 09:29:05 2020 -0800

    Add test run that uses www feature flags (#18234)
    
    In CI, we run our test suite against multiple build configurations. For
    example, we run our tests in both dev and prod, and in both the
    experimental and stable release channels. This is to prevent accidental
    deviations in behavior between the different builds. If there's an
    intentional deviation in behavior, the test author must account
    for them.
    
    However, we currently don't run tests against the www builds. That's
    a problem, because it's common for features to land in www before they
    land anywhere else, including the experimental release channel.
    Typically we do this so we can gradually roll out the feature behind
    a flag before deciding to enable it.
    
    The way we test those features today is by mutating the
    `shared/ReactFeatureFlags` module. There are a few downsides to this
    approach, though. The flag is only overridden for the specific tests or
    test suites where you apply the override. But usually what you want is
    to run *all* tests with the flag enabled, to protect against unexpected
    regressions.
    
    Also, mutating the feature flags module only works when running the
    tests against source, not against the final build artifacts, because the
    ReactFeatureFlags module is inlined by the build script.
    
    Instead, we should run the test suite against the www configuration,
    just like we do for prod, experimental, and so on. I've added a new
    command, `yarn test-www`. It automatically runs in CI.
    
    Some of the www feature flags are dynamic; that is, they depend on
    a runtime condition (i.e. a GK). These flags are imported from an
    external module that lives in www. Those flags will be enabled for some
    clients and disabled for others, so we should run the tests against
    *both* modes.
    
    So I've added a new global `__VARIANT__`, and a new test command `yarn
    test-www-variant`. `__VARIANT__` is set to false by default; when
    running `test-www-variant`, it's set to true.
    
    If we were going for *really* comprehensive coverage, we would run the
    tests against every possible configuration of feature flags: 2 ^
    numberOfFlags total combinations. That's not practical, though, so
    instead we only run against two combinations: once with `__VARIANT__`
    set to `true`, and once with it set to `false`. We generally assume that
    flags can be toggled independently, so in practice this should
    be enough.
    
    You can also refer to `__VARIANT__` in tests to detect which mode you're
    running in. Or, you can import `shared/ReactFeatureFlags` and read the
    specific flag you can about. However, we should stop mutating that
    module going forward. Treat it as read-only.
    
    In this commit, I have only setup the www tests to run against source.
    I'll leave running against build for a follow up.
    
    Many of our tests currently assume they run only in the default
    configuration, and break when certain flags are toggled. Rather than fix
    these all up front, I've hard-coded the relevant flags to the default
    values. We can incrementally migrate those tests later.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
new file mode 100644
index 0000000000..007577a1f4
--- /dev/null
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -0,0 +1,32 @@
+/**
+ * Copyright (c) Facebook, Inc. and its affiliates.
+ *
+ * This source code is licensed under the MIT license found in the
+ * LICENSE file in the root directory of this source tree.
+ *
+ * @flow strict
+ */
+
+// In www, these flags are controlled by GKs. Because most GKs have some
+// population running in either mode, we should run our tests that way, too,
+//
+// Use __VARIANT__ to simulate a GK. The tests will be run twice: once
+// with the __VARIANT__ set to `true`, and once set to `false`.
+
+export const deferPassiveEffectCleanupDuringUnmount = __VARIANT__;
+export const runAllPassiveEffectDestroysBeforeCreates = __VARIANT__;
+export const warnAboutSpreadingKeyToJSX = __VARIANT__;
+
+// These are already tested in both modes using the build type dimension,
+// so we don't need to use __VARIANT__ to get extra coverage.
+export const debugRenderPhaseSideEffectsForStrictMode = __DEV__;
+export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
+
+// TODO: These flags are hard-coded to the default values used in open source.
+// Update the tests so that they pass in either mode, then set these
+// to __VARIANT__.
+export const enableTrustedTypesIntegration = false;
+export const warnAboutShorthandPropertyCollision = true;
+export const disableInputAttributeSyncing = false;
+export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
+export const enableModernEventSystem = false;

commit f4cc970276ee7d66db54191b626b19c721ebaa91
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Mar 31 10:05:15 2020 -0700

    Enable new passive effect behavior for FB builds (#18444)
    
    * Enable new passive effect behavior for FB builds
    
    Previously this behavior was controlled by GKs. This PR updates the flags to be enabled statically. It also enables the flags in the test builds.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 007577a1f4..a4b2d9d128 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -13,8 +13,6 @@
 // Use __VARIANT__ to simulate a GK. The tests will be run twice: once
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
-export const deferPassiveEffectCleanupDuringUnmount = __VARIANT__;
-export const runAllPassiveEffectDestroysBeforeCreates = __VARIANT__;
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 
 // These are already tested in both modes using the build type dimension,

commit d8d2b6e89cdff27a1ac246c6e9e030c2cc8760e3
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Wed Apr 1 18:31:59 2020 +0100

    Disable module components dynamically for WWW (#18446)
    
    * Make disableModulePatternComponents dynamic for WWW
    
    * Run both flags and tests and respect the flag in SSR

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a4b2d9d128..923372abb7 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -14,6 +14,7 @@
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
+export const disableModulePatternComponents = __VARIANT__;
 
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.

commit 31734540dc1b507982cae839536f757de964dcd5
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Apr 2 11:55:17 2020 +0100

    Remove a flag for style collision warning (#18462)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 923372abb7..45cc2462f5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,7 +25,6 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
-export const warnAboutShorthandPropertyCollision = true;
 export const disableInputAttributeSyncing = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const enableModernEventSystem = false;

commit 7dfdff42af8e128326672608c9cf8980e289c423
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Apr 2 16:19:09 2020 +0100

    Run more flags in VARIANT tests (#18461)
    
    * Run more flags in VARIANT tests
    
    * Revert enabling modern system
    
    * Fix

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 45cc2462f5..a9beff4e16 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -15,6 +15,7 @@
 
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableModulePatternComponents = __VARIANT__;
+export const disableInputAttributeSyncing = __VARIANT__;
 
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.
@@ -25,6 +26,5 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
-export const disableInputAttributeSyncing = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const enableModernEventSystem = false;

commit 3966081cf2ffb75cde8239399176f98338511a35
Author: Dominic Gannaway <trueadm@users.noreply.github.com>
Date:   Thu Apr 2 16:25:35 2020 +0100

    Revert: Enable new passive effect behavior for FB builds (#18467)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a9beff4e16..4c5685bde6 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -13,6 +13,8 @@
 // Use __VARIANT__ to simulate a GK. The tests will be run twice: once
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
+export const deferPassiveEffectCleanupDuringUnmount = __VARIANT__;
+export const runAllPassiveEffectDestroysBeforeCreates = __VARIANT__;
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableModulePatternComponents = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;

commit 4123d729e53d11f8a29c7665ce0f52308cca3bd4
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Apr 2 15:24:36 2020 -0700

    Revert "Revert: Enable new passive effect behavior for FB builds (#18467)" (#18468)
    
    This reverts commit 3966081cf2ffb75cde8239399176f98338511a35.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 4c5685bde6..a9beff4e16 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -13,8 +13,6 @@
 // Use __VARIANT__ to simulate a GK. The tests will be run twice: once
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
-export const deferPassiveEffectCleanupDuringUnmount = __VARIANT__;
-export const runAllPassiveEffectDestroysBeforeCreates = __VARIANT__;
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableModulePatternComponents = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;

commit 41694201988c5e651f0c3bc69921d5c9717be88b
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Mon Apr 6 15:43:39 2020 -0700

    Refactor Component Stack Traces (#18495)
    
    * Add feature flag
    
    * Split stack from current fiber
    
    You can get stack from any fiber, not just current.
    
    * Refactor description of component frames
    
    These should use fiber tags for switching. This also puts the relevant code
    behind DEV flags.
    
    * We no longer expose StrictMode in component stacks
    
    They're not super useful and will go away later anyway.
    
    * Update tests
    
    Context is no longer part of SSR stacks. This was already the case on the
    client.
    
    forwardRef no longer is wrapped on the stack. It's still in getComponentName
    but it's probably just noise in stacks. Eventually we'll remove the wrapper
    so it'll go away anyway. If we use native stack frames they won't have this
    extra wrapper.
    
    It also doesn't pick up displayName from the outer wrapper. We could maybe
    transfer it but this will also be fixed by removing the wrapper.
    
    * Forward displayName onto the inner function for forwardRef and memo in DEV
    
    This allows them to show up in stack traces.
    
    I'm not doing this for lazy because lazy is supposed to be called on the
    consuming side so you shouldn't assign it a name on that end. Especially
    not one that mutates the inner.
    
    * Use multiple instances of the fake component
    
    We mutate the inner component for its name so we need multiple copies.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a9beff4e16..d67bf6be88 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -14,6 +14,7 @@
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
+export const enableComponentStackLocations = __VARIANT__;
 export const disableModulePatternComponents = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 

commit dc49ea108c3a33fcc717ef346847dd1ad4d14f66
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Apr 7 09:52:36 2020 -0700

    Filter certain DOM attributes (e.g. src) if value is empty string (#18513)
    
    * Filter certain DOM attributes (e.g. src, href) if their values are empty strings
    
    This prevents e.g. <img src=""> from making an unnecessar HTTP request for certain browsers.
    
    * Expanded warning recommendation
    
    * Improved error message
    
    * Further refined error message

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d67bf6be88..b7e987cbd5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -17,6 +17,7 @@ export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const enableComponentStackLocations = __VARIANT__;
 export const disableModulePatternComponents = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
+export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.

commit ca1a703d216cc70e40ebb45533b44773ae7a32d8
Author: Dominic Gannaway <trueadm@users.noreply.github.com>
Date:   Thu Apr 9 15:31:36 2020 +0100

    Make enableLegacyFBSupport flag dynamic for www (#18551)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b7e987cbd5..fcda77c24b 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,6 +18,8 @@ export const enableComponentStackLocations = __VARIANT__;
 export const disableModulePatternComponents = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
+export const enableModernEventSystem = __VARIANT__;
+export const enableLegacyFBSupport = __VARIANT__;
 
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.
@@ -29,4 +31,3 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
-export const enableModernEventSystem = false;

commit 22dc2e42bdc00d87fc19c5e75fc7c0b3fdcdc572
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed Apr 15 19:10:15 2020 -0700

    Add experimental DebugTracing logger for internal use (#18531)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index fcda77c24b..718c211394 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -20,6 +20,7 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableModernEventSystem = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
+export const enableDebugTracing = __VARIANT__;
 
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.

commit 0301f3e24ff98d50c6625ce394bc3a54d4b39c7b
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Apr 16 19:42:30 2020 +0100

    Statically disable factory components for WWW (#18641)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 718c211394..c43a319790 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -15,7 +15,6 @@
 
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const enableComponentStackLocations = __VARIANT__;
-export const disableModulePatternComponents = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableModernEventSystem = __VARIANT__;

commit 571f5ad2d695e6373ffbd8e86b27c11dad3d22cf
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Tue Apr 21 20:14:40 2020 -0700

    Temporarily Remove DebugTracing from the New Reconciler (#18697)
    
    * Remove priority field from tracing
    
    * Remove DebugTracing mode from new reconciler (temporarily)
    
    * Run DebugTracing tests in the *other* variant so it's no on for new reconciler

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index c43a319790..766b4ebe7d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,7 +19,7 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableModernEventSystem = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
-export const enableDebugTracing = __VARIANT__;
+export const enableDebugTracing = !__VARIANT__;
 
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.

commit 47ebc90b08be7a2e6955dd3cfd468318e0b8fdfd
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed May 6 19:19:14 2020 -0700

    Put render phase update change behind a flag (#18850)
    
    In the new reconciler, I made a change to how render phase updates
    work. (By render phase updates, I mean when a component updates
    another component during its render phase. Or when a class component
    updates itself during the render phase. It does not include when
    a hook updates its own component during the render phase. Those have
    their own semantics. So really I mean anything triggers the "`setState`
    in render" warning.)
    
    The old behavior is to give the update the same "thread" (expiration
    time) as whatever is currently rendering. So if you call `setState` on a
    component that happens later in the same render, it will flush during
    that render. Ideally, we want to remove the special case and treat them
    as if they came from an interleaved event.
    
    Regardless, this pattern is not officially supported. This behavior is
    only a fallback. The flag only exists until we can roll out the
    `setState` warnning, since existing code might accidentally rely on the
    current behavior.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 766b4ebe7d..a047ec5d72 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,6 +21,16 @@ export const enableModernEventSystem = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const enableDebugTracing = !__VARIANT__;
 
+// This only has an effect in the new reconciler. But also, the new reconciler
+// is only enabled when __VARIANT__ is true. So this is set to the opposite of
+// __VARIANT__ so that it's `false` when running against the new reconciler.
+// Ideally we would test both against the new reconciler, but until then, we
+// should test the value that is used in www. Which is `false`.
+//
+// Once Lanes has landed in both reconciler forks, we'll get coverage of
+// both branches.
+export const deferRenderPhaseUpdateToNextBatch = !__VARIANT__;
+
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.
 export const debugRenderPhaseSideEffectsForStrictMode = __DEV__;

commit 8b9c4d1688333865e702fcd65ad2ab7d83b3c33c
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon May 11 20:02:08 2020 -0700

    Expose LegacyHidden type and disable <div hidden /> API in new fork (#18891)
    
    * Expose LegacyHidden type
    
    I will use this internally at Facebook to migrate away from
    <div hidden />. The end goal is to migrate to the Offscreen type, but
    that has different semantics. This is an incremental step.
    
    * Disable <div hidden /> API in new fork
    
    Migrates to the unstable_LegacyHidden type instead. The old fork does
    not support the new component type, so I updated the tests to use an
    indirection that picks the correct API. I will remove this once the
    LegacyHidden (and/or Offscreen) type has landed in both implementations.
    
    * Add gated warning for `<div hidden />` API
    
    Only exists so we can detect callers in www and migrate them to the new
    API. Should not visible to anyone outside React Core team.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a047ec5d72..af65097e7c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -36,6 +36,13 @@ export const deferRenderPhaseUpdateToNextBatch = !__VARIANT__;
 export const debugRenderPhaseSideEffectsForStrictMode = __DEV__;
 export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 
+// Do not add the corresponding warning to the warning filter! Only exists so we
+// can detect callers and migrate them to the new API. Should not visible to
+// anyone outside React Core team.
+//
+// Disabled in our tests, but we'll enable in www.
+export const warnAboutDOMHiddenAttribute = false;
+
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.

commit b4a1a4980c98c6d8a7ced428a1adc9e278fec430
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed May 13 20:01:10 2020 -0700

    Disable <div hidden /> API in old fork, too (#18917)
    
    The motivation for doing this is to make it impossible for additional
    uses of pre-rendering to sneak into www without going through the
    LegacyHidden abstraction. Since this feature was already disabled in
    the new fork, this brings the two closer to parity.
    
    The LegacyHidden abstraction itself still needs to opt into
    pre-rendering somehow, so rather than totally disabling the feature, I
    updated the `hidden` prop check to be obnoxiously specific. Before, you
    could set it to any truthy value; now, you must set it to the string
    "unstable-do-not-use-legacy-hidden".
    
    The node will still be hidden in the DOM, since any truthy value will
    cause the browser to apply a style of `display: none`.
    
    I will have to update the LegacyHidden component in www to use the
    obnoxious string prop. This doesn't block merge, though, since the
    behavior is gated by a dynamic flag. I will update the component before
    I enable the flag.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index af65097e7c..e0365704e2 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,6 +21,9 @@ export const enableModernEventSystem = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const enableDebugTracing = !__VARIANT__;
 
+// Temporary flag, in case we need to re-enable this feature.
+export const disableHiddenPropDeprioritization = __VARIANT__;
+
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of
 // __VARIANT__ so that it's `false` when running against the new reconciler.
@@ -36,13 +39,6 @@ export const deferRenderPhaseUpdateToNextBatch = !__VARIANT__;
 export const debugRenderPhaseSideEffectsForStrictMode = __DEV__;
 export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 
-// Do not add the corresponding warning to the warning filter! Only exists so we
-// can detect callers and migrate them to the new API. Should not visible to
-// anyone outside React Core team.
-//
-// Disabled in our tests, but we'll enable in www.
-export const warnAboutDOMHiddenAttribute = false;
-
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.

commit 64f50c667a778c85dc8f1d56e26d881fada4c85a
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed May 20 15:29:34 2020 -0700

    Remove disableHiddenPropDeprioritization flag (#18964)
    
    This is rolled out to 100% public, so we can remove it.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e0365704e2..a047ec5d72 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,9 +21,6 @@ export const enableModernEventSystem = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const enableDebugTracing = !__VARIANT__;
 
-// Temporary flag, in case we need to re-enable this feature.
-export const disableHiddenPropDeprioritization = __VARIANT__;
-
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of
 // __VARIANT__ so that it's `false` when running against the new reconciler.

commit e3ccdf1544478e27ce2970562139d726c5ec992b
Author: Dominic Gannaway <trueadm@users.noreply.github.com>
Date:   Thu Jun 11 19:49:45 2020 +0100

    Remove synamic modern event system flag for FB (#19059)
    
    * Remove synamic modern event system flag for FB

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a047ec5d72..dfe94e4b44 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -17,7 +17,6 @@ export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const enableComponentStackLocations = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
-export const enableModernEventSystem = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const enableDebugTracing = !__VARIANT__;
 

commit 7f28234f8468d23dac7980be55e1a20f86a7b915
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Thu Jun 11 19:13:13 2020 -0700

    Enable component stacks everywhere except RN (#19120)
    
    This would still affect test renderer and isomorphic in RN.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index dfe94e4b44..03100167f3 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -14,7 +14,6 @@
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
-export const enableComponentStackLocations = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;

commit 91a2e8173f1fadd2dfd4b12753ebcdc60986d42d
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Jul 6 18:53:42 2020 -0400

    Decouple update priority tracking from Scheduler package (#19121)
    
    * Initial currentLanePriority implementation
    
    * Minor updates from review
    
    * Fix typos and enable flag
    
    * Fix feature flags and lint
    
    * Fix simple event tests by switching to withSuspenseConfig
    
    * Don't lower the priority of setPending in startTransition below InputContinuous
    
    * Move currentUpdateLanePriority in commit root into the first effect block
    
    * Refactor requestUpdateLane to log for priority mismatches
    
    Also verifies that the update lane priority matches the scheduler lane priority before using it
    
    * Fix four tests by adding ReactDOM.unstable_runWithPriority
    
    * Fix partial hydration when using update lane priority
    
    * Fix partial hydration when using update lane priority
    
    * Rename feature flag and only log for now
    
    * Move unstable_runWithPriority to ReactFiberReconciler
    
    * Add unstable_runWithPriority to ReactNoopPersistent too
    
    * Bug fixes and performance improvements
    
    * Initial currentLanePriority implementation
    
    * Minor updates from review
    
    * Fix typos and enable flag
    
    * Remove higherLanePriority from ReactDOMEventReplaying.js
    
    * Change warning implementation and startTransition update lane priority
    
    * Inject reconciler functions to avoid importing src/
    
    * Fix feature flags and lint
    
    * Fix simple event tests by switching to withSuspenseConfig
    
    * Don't lower the priority of setPending in startTransition below InputContinuous
    
    * Move currentUpdateLanePriority in commit root into the first effect block
    
    * Refactor requestUpdateLane to log for priority mismatches
    
    Also verifies that the update lane priority matches the scheduler lane priority before using it
    
    * Fix four tests by adding ReactDOM.unstable_runWithPriority
    
    * Fix partial hydration when using update lane priority
    
    * Fix partial hydration when using update lane priority
    
    * Rename feature flag and only log for now
    
    * Move unstable_runWithPriority to ReactFiberReconciler
    
    * Bug fixes and performance improvements
    
    * Remove higherLanePriority from ReactDOMEventReplaying.js
    
    * Change warning implementation and startTransition update lane priority
    
    * Inject reconciler functions to avoid importing src/
    
    * Fixes from bad rebase

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 03100167f3..32e1cc1537 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,6 +18,7 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const enableDebugTracing = !__VARIANT__;
+export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of

commit 40cddfeeb167d4964d82220142deb00f57fe197d
Author: E-Liang Tan <eliang@eliangtan.com>
Date:   Wed Jul 8 22:36:02 2020 +0800

    Add user timing marks for scheduling profiler tool (#19223)
    
    High level breakdown of this commit:
    
    * Add a enableSchedulingProfiling feature flag.
    * Add functions that call User Timing APIs to a new SchedulingProfiler file. The file follows DebugTracing's structure.
    * Add user timing marks to places where DebugTracing logs.
    * Add user timing marks to most other places where @bvaughn's original draft DebugTracing branch marks.
    * Tests added
    * More context (and discussions with @bvaughn) available at our internal PR MLH-Fellowship#11 and issue MLH-Fellowship#5.
    
    Similar to DebugTracing, we've only added scheduling profiling calls to the old reconciler fork.
    
    Co-authored-by: Kartik Choudhary <kartik.c918@gmail.com>
    Co-authored-by: Kartik Choudhary <kartikc.918@gmail.com>
    Co-authored-by: Brian Vaughn <brian.david.vaughn@gmail.com>

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 32e1cc1537..84fafd6e14 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -17,9 +17,12 @@ export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
-export const enableDebugTracing = !__VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 
+// TODO: These features do not currently exist in the new reconciler fork.
+export const enableDebugTracing = !__VARIANT__;
+export const enableSchedulingProfiler = !__VARIANT__ && __PROFILE__;
+
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of
 // __VARIANT__ so that it's `false` when running against the new reconciler.

commit 26472c88979bb60746a47a660415df80775d25f9
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Mon Jul 13 17:17:28 2020 +0100

    Bubble onSubmit/onReset behind a feature flag (#19333)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 84fafd6e14..d244b0fda6 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -43,3 +43,5 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
+
+export const enableFormEventDelegation = __VARIANT__;

commit 6d7555b014513125b0c229b9c6e45c903d974ff7
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Mon Jul 13 22:20:53 2020 -0400

    Scheduling profiler updates (#19334)
    
    * Make enableSchedulingProfiler static for profiling+experimental builds
    
    * Copied debug tracing and scheduler profiling to .new fork
    
    * Updated test @gate conditions

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d244b0fda6..e3721bdb4c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,9 +19,8 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 
-// TODO: These features do not currently exist in the new reconciler fork.
+// TODO: This feature does not currently exist in the new reconciler fork.
 export const enableDebugTracing = !__VARIANT__;
-export const enableSchedulingProfiler = !__VARIANT__ && __PROFILE__;
 
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of

commit 392277f0abc2251ea93b7debad4ae86cd0f1bdff
Author: Dominic Gannaway <trueadm@users.noreply.github.com>
Date:   Wed Jul 15 12:36:40 2020 +0100

    Revert "Scheduling profiler updates (#19334)" (#19366)
    
    This reverts commit 6d7555b014513125b0c229b9c6e45c903d974ff7.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e3721bdb4c..d244b0fda6 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,8 +19,9 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 
-// TODO: This feature does not currently exist in the new reconciler fork.
+// TODO: These features do not currently exist in the new reconciler fork.
 export const enableDebugTracing = !__VARIANT__;
+export const enableSchedulingProfiler = !__VARIANT__ && __PROFILE__;
 
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of

commit aec934af7f182e0bda910f64972722b147a68657
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Fri Jul 17 14:19:39 2020 +0100

    Remove form event delegation flag (#19395)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d244b0fda6..84fafd6e14 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -43,5 +43,3 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
-
-export const enableFormEventDelegation = __VARIANT__;

commit 51267c4ac9de8bf190505fbb7670ed99aae325f7
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Fri Jul 17 11:24:26 2020 -0400

    Sync scheduling profiler marks and debug tracing to new reconciler fork (#19375, #19376, #19396)
    
    * Make enableSchedulingProfiler flag static
    
    * Copied debug tracing and scheduler profiling to .new fork and updated feature flags
    
    * Move profiler component stacks behind a feature flag

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 84fafd6e14..201a40fdbf 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,9 +19,17 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 
-// TODO: These features do not currently exist in the new reconciler fork.
-export const enableDebugTracing = !__VARIANT__;
-export const enableSchedulingProfiler = !__VARIANT__ && __PROFILE__;
+// Enable this flag to help with concurrent mode debugging.
+// It logs information to the console about React scheduling, rendering, and commit phases.
+//
+// NOTE: This feature will only work in DEV mode; all callsights are wrapped with __DEV__.
+export const enableDebugTracing = false;
+
+// TODO: getStackByFiberInDevAndProd() causes errors when synced to www.
+// This flag can be used to disable component stacks for the profiler marks,
+// so that the feature can be synced for others,
+// while still enabling investigation into the underlying source of the errors.
+export const enableSchedulingProfilerComponentStacks = false;
 
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of

commit 06d104e8ec89df4bc5176e014c83e8b6393e555f
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Mon Jul 27 17:33:54 2020 +0100

    Don't emulate bubbling of the scroll event (#19464)
    
    * Don't emulate bubbling of the scroll event
    
    * Put behind a flag

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 201a40fdbf..e016a0f071 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,6 +18,7 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
+export const disableOnScrollBubbling = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 815ee89bf55078f2447fe49a1c68336e70c1ce44
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Fri Jul 31 14:57:57 2020 +0100

    Statically enable enableFilterEmptyStringAttributesDOM (#19502)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e016a0f071..497feba2ad 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -15,7 +15,6 @@
 
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
-export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const disableOnScrollBubbling = __VARIANT__;

commit 332ecefacec7a15d9088b37e2a158fe91641ed67
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Fri Jul 31 15:01:27 2020 +0100

    Revert "Statically enable enableFilterEmptyStringAttributesDOM (#19502)" (#19504)
    
    This reverts commit 815ee89bf55078f2447fe49a1c68336e70c1ce44.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 497feba2ad..e016a0f071 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -15,6 +15,7 @@
 
 export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
+export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const disableOnScrollBubbling = __VARIANT__;

commit e9721e14e4b8776c107afa3cdd7c6d664fe20c24
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Wed Aug 5 16:07:58 2020 +0100

    Remove onScroll bubbling flag (#19535)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e016a0f071..201a40fdbf 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,7 +18,6 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
-export const disableOnScrollBubbling = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 9b35dd2fcc8b8dfbd1363cef9e5c59a0deab0dd3
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Fri Aug 14 15:21:13 2020 -0400

    Permanently removed component stacks from scheduling profiler data (#19615)
    
    These stacks improve the profiler data but they're expensive to generate and generating them can also cause runtime errors in larger applications (although an exact repro has been hard to nail down). Removing them for now. We can revisit adding them after this profiler has been integrated into the DevTools extension and we can generate them lazily.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 201a40fdbf..9b23645a3d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,12 +25,6 @@ export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 // NOTE: This feature will only work in DEV mode; all callsights are wrapped with __DEV__.
 export const enableDebugTracing = false;
 
-// TODO: getStackByFiberInDevAndProd() causes errors when synced to www.
-// This flag can be used to disable component stacks for the profiler marks,
-// so that the feature can be synced for others,
-// while still enabling investigation into the underlying source of the errors.
-export const enableSchedulingProfilerComponentStacks = false;
-
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of
 // __VARIANT__ so that it's `false` when running against the new reconciler.

commit bcca5a6ca78b33504e0a328c411b043261e7e303
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Mon Aug 17 15:01:06 2020 -0400

    Always skip unmounted/unmounting error boundaries (#19627)
    
    The behavior of error boundaries for passive effects that throw during cleanup was recently changed so that React ignores boundaries which are also unmounting in favor of still-mounted boundaries. This commit implements that same behavior for layout effects (useLayoutEffect, componentWillUnmount, and ref-detachment).
    
    The new, skip-unmounting-boundaries behavior is behind a feature flag (`skipUnmountedBoundaries`).

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 9b23645a3d..c7df70d192 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,6 +18,7 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
+export const skipUnmountedBoundaries = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit dd651df05e5802a31484f269b689c17acf087299
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Wed Aug 19 18:42:33 2020 +0100

    Keep onTouchStart, onTouchMove, and onWheel passive (#19654)
    
    * Keep onTouchStart, onTouchMove, and onWheel passive
    
    * Put it behind a feature flag on WWW

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index c7df70d192..1397d33d53 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,6 +19,7 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
+export const enablePassiveEventIntervention = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 64ddef44c69a18038b1683e04c4558a72af1b91a
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Wed Aug 19 20:54:54 2020 +0100

    Revert "Remove onScroll bubbling flag (#19535)" (#19655)
    
    This reverts commit e9721e14e4b8776c107afa3cdd7c6d664fe20c24.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 1397d33d53..f58f9f8aae 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -20,6 +20,7 @@ export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enablePassiveEventIntervention = __VARIANT__;
+export const disableOnScrollBubbling = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 848bb2426e44606e0a55dfe44c7b3ece33772485
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Mon Aug 24 16:50:20 2020 +0100

    Attach Listeners Eagerly to Roots and Portal Containers (#19659)
    
    * Failing test for #19608
    
    * Attach Listeners Eagerly to Roots and Portal Containers
    
    * Forbid createEventHandle with custom events
    
    We can't support this without adding more complexity. It's not clear that this is even desirable, as none of our existing use cases need custom events. This API primarily exists as a deprecation strategy for Flare, so I don't think it is important to expand its support beyond what Flare replacement code currently needs. We can later revisit it with a better understanding of the eager/lazy tradeoff but for now let's remove the inconsistency.
    
    * Reduce risk by changing condition only under the flag
    
    Co-authored-by: koba04 <koba0004@gmail.com>

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index f58f9f8aae..3cf35c8607 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,6 +21,7 @@ export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enablePassiveEventIntervention = __VARIANT__;
 export const disableOnScrollBubbling = __VARIANT__;
+export const enableEagerRootListeners = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit b754caaaf23a070de281dcd0a9d32846470e1907
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Fri Aug 28 12:23:28 2020 +0100

    Enable eager listeners in open source (#19716)
    
    * Enable eager listeners in open source
    
    * Fix tests
    
    * Enable in all places

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 3cf35c8607..088422d405 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,7 +21,7 @@ export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enablePassiveEventIntervention = __VARIANT__;
 export const disableOnScrollBubbling = __VARIANT__;
-export const enableEagerRootListeners = __VARIANT__;
+export const enableEagerRootListeners = !__VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit bcc0aa4633760352c6c56f559d1e2d374d302f5a
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Sep 3 17:06:20 2020 +0100

    Revert "Revert "Remove onScroll bubbling flag (#19535)" (#19655)" (#19761)
    
    This reverts commit 64ddef44c69a18038b1683e04c4558a72af1b91a.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 088422d405..2ffdff0853 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -20,7 +20,6 @@ export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enablePassiveEventIntervention = __VARIANT__;
-export const disableOnScrollBubbling = __VARIANT__;
 export const enableEagerRootListeners = !__VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.

commit 36df483af4a626fd4021c060fcb0f62471e82af1
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Fri Sep 4 10:58:17 2020 -0400

    Add feature flag to disable scheduler timeout in work loop (#19771)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 2ffdff0853..301da30b57 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -48,3 +48,4 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
+export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;

commit 6fddca27e75950adda92ab4f4946442907dc3bb7
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Sep 17 15:37:12 2020 +0100

    Remove passive intervention flag (#19849)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 301da30b57..871da4da31 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,7 +19,6 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
-export const enablePassiveEventIntervention = __VARIANT__;
 export const enableEagerRootListeners = !__VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.

commit c63741fb3daef6c1e8746cbe7d7b07ecb281a9fd
Author: Luna Ruan <lunaris.ruan@gmail.com>
Date:   Thu Sep 24 13:42:17 2020 -0700

    offscreen double invoke effects (#19523)
    
    This PR double invokes effects in __DEV__ mode.
    
    We are thinking about unmounting layout and/or passive effects for a hidden tree. To understand potential issues with this, we want to double invoke effects. This PR changes the behavior in DEV when an effect runs from create() to create() -> destroy() -> create(). The effect cleanup function will still be called before the effect runs in both dev and prod. (Note: This change is purely for research for now as it is likely to break real code.)
    
    **Note: The change is fully behind a flag and does not affect any of the code on npm.**

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 871da4da31..838f478b21 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -48,3 +48,5 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
+
+export const enableDoubleInvokingEffects = false;

commit ba82eea3837e4aaeb5a30b7827b664a8c2128d2e
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon Sep 28 12:19:14 2020 -0500

    Remove disableSchedulerTimeoutInWorkLoop flag (#19902)
    
    We found and mitigated the root cause of the regression that led us to
    temporarily revert this change. So now I'm un-reverting it.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 838f478b21..aa3cf1a64a 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -47,6 +47,5 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
-export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 
 export const enableDoubleInvokingEffects = false;

commit 97625272abe1fecc8ffba469795803ca8cfff9a7
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Oct 1 12:02:26 2020 -0400

    Debug tracing tests for CPU bound suspense (#19943)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index aa3cf1a64a..881a0e6101 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,7 +25,7 @@ export const enableEagerRootListeners = !__VARIANT__;
 // It logs information to the console about React scheduling, rendering, and commit phases.
 //
 // NOTE: This feature will only work in DEV mode; all callsights are wrapped with __DEV__.
-export const enableDebugTracing = false;
+export const enableDebugTracing = __EXPERIMENTAL__;
 
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of

commit 993ca533b42756811731f6b7791ae06a35ee6b4d
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Oct 8 19:32:28 2020 +0100

    Enable eager listeners statically (#19983)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 881a0e6101..103e8adc5c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,7 +19,6 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
-export const enableEagerRootListeners = !__VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit c59c3dfe554dafb64864f3bbcfff6ffe51f32275
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Mon Oct 19 16:05:00 2020 -0400

    useRef: Warn about reading or writing mutable values during render (#18545)
    
    Reading or writing a ref value during render is only safe if you are implementing the lazy initialization pattern.
    
    Other types of reading are unsafe as the ref is a mutable source.
    
    Other types of writing are unsafe as they are effectively side effects.
    
    This change also refactors useTransition to no longer use a ref hook, but instead manage its own (stable) hook state.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 103e8adc5c..d03ba3eadd 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -48,3 +48,4 @@ export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 
 export const enableDoubleInvokingEffects = false;
+export const enableUseRefAccessWarning = __VARIANT__;

commit 7a73d6a0f9ad43a6dce145e3cc47e88cc59fbbd7
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Mon Nov 9 10:14:24 2020 -0500

    (Temporarily) revert unmounting error boundaries changes (#20147)
    
    This reverts commits bcca5a6ca78b33504e0a328c411b043261e7e303 and ffb749c95e0361b3cfbbfc4e1a73bfa2fda0aa93, although neither revert cleanly since methods have been moved between the work-loop and commit-work files. This commit is a mostly manual effort of undoing the changes.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d03ba3eadd..fee39cd71a 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,7 +18,6 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
-export const skipUnmountedBoundaries = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 9403c3b536f510fc54a16607bb211f630c71b55f
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Nov 12 09:31:27 2020 -0500

    Add Profiler callback when nested updates are scheduled (#20211)
    
    This callback accepts the no parameters (except for the current interactions). Users of this hook can inspect the call stack to access and log the source location of the component.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index fee39cd71a..95ba1859e1 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -48,3 +48,5 @@ export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 
 export const enableDoubleInvokingEffects = false;
 export const enableUseRefAccessWarning = __VARIANT__;
+
+export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;

commit 760d9ab57a0fbffe8caf1d15c40efaa0a3592733
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Nov 12 09:47:04 2020 -0500

    Scheduling profiler tweaks (#20215)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 95ba1859e1..1321bf70ba 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,6 +25,8 @@ export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 // NOTE: This feature will only work in DEV mode; all callsights are wrapped with __DEV__.
 export const enableDebugTracing = __EXPERIMENTAL__;
 
+export const enableSchedulingProfiler = __VARIANT__;
+
 // This only has an effect in the new reconciler. But also, the new reconciler
 // is only enabled when __VARIANT__ is true. So this is set to the opposite of
 // __VARIANT__ so that it's `false` when running against the new reconciler.

commit 555eeae33de09a5cbbb0b71aba3c57d7bfac0513
Author: Philipp Spiess <hello@philippspiess.com>
Date:   Wed Dec 2 16:25:55 2020 +0100

    Add disableNativeComponentFrames flag (#20364)
    
    ## Summary
    
    We're experiencing some issues internally where the component stack is
    getting into our way of fixing them as it causes the page to become
    unresponsive. This adds a flag so that we can disable this feature as a
    temporary workaround.
    
    More internal context: https://fburl.com/go9yoklm
    
    ## Test Plan
    
    I tried to default this flag to `__VARIANT__` but the variant tests
    (`yarn test-www --variant`) started to fail across the board since a lot
    of tests depend on the component tree, things like this:
    
    https://user-images.githubusercontent.com/458591/100771192-6a1e1c00-33fe-11eb-9ab0-8ff46ba378a2.png
    
    So, it seems to work :-)
    
    Given that it's unhandy to update the hundreds of tests that are failing
    I decided to hard code this to `false` like we already do for some other
    options.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 1321bf70ba..ad4ff2bab7 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -47,6 +47,7 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
+export const disableNativeComponentFrames = false;
 
 export const enableDoubleInvokingEffects = false;
 export const enableUseRefAccessWarning = __VARIANT__;

commit 5687864eb77f2a43eefa1681f2d097490832f002
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu Dec 17 17:17:23 2020 -0500

    Add back disableSchedulerTimeoutInWorkLoop flag (#20482)
    
    * Add back enableSchedulerTimeoutInWorkLoop flag
    
    * Nvm, keep it as disableSchedulerTimeoutInWorkLoop

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index ad4ff2bab7..cf0ca5ae54 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -53,3 +53,4 @@ export const enableDoubleInvokingEffects = false;
 export const enableUseRefAccessWarning = __VARIANT__;
 
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
+export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;

commit 895ae67fd3cb16b23d66a8be2ad1c747188a811f
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Mon Jan 25 05:54:20 2021 -0800

    Improve error boundary handling for unmounted subtrees (#20645)
    
    A passive effect's cleanup function may throw after an unmount. Prior to this commit, such an error would be ignored. (React would not notify any error boundaries.)
    
    After this commit, React will skip any unmounted boundaries and look for a still-mounted boundary. If one is found, it will call getDerivedStateFromError and/or componentDidCatch (depending on the type of boundary). Unmounted boundaries will be ignored, but as they have been unmounted– this seems appropriate.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index cf0ca5ae54..cf858b767c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,6 +18,7 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
+export const skipUnmountedBoundaries = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit d13f5b9538e48f74f7c571ef3cde652ca887cca0
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Jan 26 14:23:34 2021 -0600

    Experiment: Unsuspend all lanes on update (#20660)
    
    Adds a feature flag to tweak the internal heuristic used to "unsuspend"
    lanes when a new update comes in.
    
    A lane is "suspended" if we couldn't finish rendering it because it was
    missing data, and we chose not to commit the fallback. (In this context,
    "suspended" does not include updates that finished with a fallback.)
    
    When we receive new data in the form of an update, we need to retry
    rendering the suspended lanes, since the new data may have unblocked the
    previously suspended work. For example, the new update could navigate
    back to an already loaded route.
    
    It's impractical to retry every combination of suspended lanes, so we
    need some heuristic that decides which lanes to retry and in
    which order.
    
    The existing heuristic roughly approximates the old Expiration Times
    model. It unsuspends all lower priority lanes, but leaves higher
    priority lanes suspended.
    
    Then when we start rendering, we choose the lanes that have the highest
    LanePriority and render those -- and then we add to that all the lanes
    that are highher priority.
    
    If this sounds terribly confusing, it's because it barely makes sense.
    (It made more sense in the Expiration Times world, I promise, but it
    was still confusing.) I don't think it's worth me trying to explain the
    old behavior too much because the point here is that we can replace it
    with something simpler.
    
    The new heurstic is to unsuspend all suspended lanes whenever there's
    an update.
    
    This is effectively what we already do except in a few very specific
    edge cases, ever since we removed the delayed suspense feature from
    everything that's not a refresh transition.
    
    We can optimize this in the future to only unsuspend lanes that are
    either 1) in the `lanes` or `subtreeLanes` of the node that was updated,
    or 2) in the `lanes` of the return path of the node that was updated.
    This would exclude lanes that are only located in unrelated sibling
    trees. But, this optimization wouldn't be useful currently because we
    assign the same transition lane to all transitions. It will become
    relevant again once we start assigning arbitrary lanes to transitions
    -- but that in turn requires us to implement entanglement of overlapping
    transitions, one of our planned projects.
    
    So to sum up: the goal here is to remove the weird edge cases and switch
    to a simpler model, on top of which we can make more substantial
    improvements.
    
    I put it behind a flag so I can run an A/B test and confirm it doesn't
    cause a regression.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index cf858b767c..e6cbe5c387 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -55,3 +55,4 @@ export const enableUseRefAccessWarning = __VARIANT__;
 
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
+export const enableTransitionEntanglement = __VARIANT__;

commit e51bd6c1fa2731c4fcd39300144e917aedfc989b
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Wed Jan 27 18:24:58 2021 -0500

    Queue discrete events in microtask (#20669)
    
    * Queue discrete events in microtask
    
    * Use callback priority to determine cancellation
    
    * Add queueMicrotask to react-reconciler README
    
    * Fix invatiant conditon for InputDiscrete
    
    * Switch invariant null check
    
    * Convert invariant to warning
    
    * Remove warning from codes.json

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e6cbe5c387..47d8763d03 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -56,3 +56,4 @@ export const enableUseRefAccessWarning = __VARIANT__;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableTransitionEntanglement = __VARIANT__;
+export const enableDiscreteEventMicroTasks = __VARIANT__;

commit 97fce318a6618bc883a8578f58b9083484c9e6d7
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Tue Feb 9 18:32:20 2021 +0000

    Experiment: Infer the current event priority from the native event (#20748)
    
    * Add the feature flag
    
    * Add a host config method
    
    * Wire it up to the work loop
    
    * Export constants for third-party renderers
    
    * Document for third-party renderers

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 47d8763d03..f0cb3c5eb1 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -57,3 +57,4 @@ export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableTransitionEntanglement = __VARIANT__;
 export const enableDiscreteEventMicroTasks = __VARIANT__;
+export const enableNativeEventPriorityInference = __VARIANT__;

commit d1845ad0ff6c69ea377d710d4053d9bd65e0d0ff
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Feb 10 02:00:24 2021 -0600

    Default updates should not interrupt transitions (#20771)
    
    The only difference between default updates and transition updates is
    that default updates do not support suspended refreshes — they will
    instantly display a fallback.
    
    Co-authored-by: Rick Hanlon <rickhanlonii@gmail.com>

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index f0cb3c5eb1..0d1adfc4d4 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -56,5 +56,6 @@ export const enableUseRefAccessWarning = __VARIANT__;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableTransitionEntanglement = __VARIANT__;
+export const enableNonInterruptingNormalPri = __VARIANT__;
 export const enableDiscreteEventMicroTasks = __VARIANT__;
 export const enableNativeEventPriorityInference = __VARIANT__;

commit 3b870b1e0912c076c450bee261d8dbb181de673c
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Feb 10 02:25:39 2021 -0600

    Lane enableTransitionEntanglement flag (#20775)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 0d1adfc4d4..b6e1d4260c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -55,7 +55,6 @@ export const enableUseRefAccessWarning = __VARIANT__;
 
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const enableTransitionEntanglement = __VARIANT__;
 export const enableNonInterruptingNormalPri = __VARIANT__;
 export const enableDiscreteEventMicroTasks = __VARIANT__;
 export const enableNativeEventPriorityInference = __VARIANT__;

commit 4d28eca97e469ae6515fa369ed380e3c82fb7acc
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Feb 22 12:56:54 2021 -0500

    Land enableNonInterruptingNormalPri (#20859)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b6e1d4260c..daf49b2ab2 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -55,6 +55,5 @@ export const enableUseRefAccessWarning = __VARIANT__;
 
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const enableNonInterruptingNormalPri = __VARIANT__;
 export const enableDiscreteEventMicroTasks = __VARIANT__;
 export const enableNativeEventPriorityInference = __VARIANT__;

commit 9209c30ff98528cfbbe9df0774fda0b117975a25
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed Feb 24 16:14:14 2021 -0500

    Add StrictMode level prop and createRoot unstable_strictModeLevel option (#20849)
    
    * The exported '<React.StrictMode>' tag remains the same and opts legacy subtrees into strict mode level one ('mode == StrictModeL1'). This mode enables DEV-only double rendering, double component lifecycles, string ref warnings, legacy context warnings, etc. The primary purpose of this mode is to help detected render phase side effects. No new behavior. Roots created with experimental 'createRoot' and 'createBlockingRoot' APIs will also (for now) continue to default to strict mode level 1.
    
    In a subsequent commit I will add support for a 'level' attribute on the '<React.StrictMode>' tag (as well as a new option supported by ). This will be the way to opt into strict mode level 2 ('mode == StrictModeL2'). This mode will enable DEV-only double invoking of effects on initial mount. This will simulate future Offscreen API semantics for trees being mounted, then hidden, and then shown again. The primary purpose of this mode is to enable applications to prepare for compatibility with the new Offscreen API (more information to follow shortly).
    
    For now, this commit changes no public facing behavior. The only mechanism for opting into strict mode level 2 is the pre-existing 'enableDoubleInvokingEffects' feature flag (only enabled within Facebook for now).
    
    * Renamed strict mode constants
    
    StrictModeL1 -> StrictLegacyMode and StrictModeL2 -> StrictEffectsMode
    
    * Renamed tests
    
    * Split strict effects mode into two flags
    
    One flag ('enableStrictEffects') enables strict mode level 2. It is similar to 'debugRenderPhaseSideEffectsForStrictMode' which enables srtict mode level 1.
    
    The second flag ('createRootStrictEffectsByDefault') controls the default strict mode level for 'createRoot' trees. For now, all 'createRoot' trees remain level 1 by default. We will experiment with level 2 within Facebook.
    
    This is a prerequisite for adding a configurable option to 'createRoot' that enables choosing a different StrictMode level than the default.
    
    * Add StrictMode 'unstable_level' prop and createRoot 'unstable_strictModeLevel' option
    
    New StrictMode 'unstable_level' prop allows specifying which level of strict mode to use. If no level attribute is specified, StrictLegacyMode will be used to maintain backwards compatibility. Otherwise the following is true:
    * Level 0 does nothing
    * Level 1 selects StrictLegacyMode
    * Level 2 selects StrictEffectsMode (which includes StrictLegacyMode)
    
    Levels can be increased with nesting (0 -> 1 -> 2) but not decreased.
    
    This commit also adds a new 'unstable_strictModeLevel' option to the createRoot and createBatchedRoot APIs. This option can be used to override default behavior to increase or decrease the StrictMode level of the root.
    
    A subsequent commit will add additional DEV warnings:
    * If a nested StrictMode tag attempts to explicitly decrease the level
    * If a level attribute changes in an update

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index daf49b2ab2..1d9f89699f 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -50,7 +50,8 @@ export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const disableNativeComponentFrames = false;
 
-export const enableDoubleInvokingEffects = false;
+export const createRootStrictEffectsByDefault = false;
+export const enableStrictEffects = false;
 export const enableUseRefAccessWarning = __VARIANT__;
 
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;

commit c581cdd480f71af6ee87168c72ecabb87b6984c3
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu Feb 25 17:25:25 2021 -0500

    Schedule sync updates in microtask (#20872)
    
    * Schedule sync updates in microtask
    
    * Updates from review
    
    * Fix comment

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 1d9f89699f..b75b80dbde 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -57,4 +57,5 @@ export const enableUseRefAccessWarning = __VARIANT__;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableDiscreteEventMicroTasks = __VARIANT__;
+export const enableSyncMicroTasks = __VARIANT__;
 export const enableNativeEventPriorityInference = __VARIANT__;

commit 258b375a419098a5b6c3568e8d35046d142ea912
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Feb 25 16:42:11 2021 -0600

    Move context comparison to consumer
    
    In the lazy context implementation, not all context changes are
    propagated from the provider, so we can't rely on the propagation alone
    to mark the consumer as dirty. The consumer needs to compare to the
    previous value, like we do for state and context.
    
    I added a `memoizedValue` field to the context dependency type. Then in
    the consumer, we iterate over the current dependencies to see if
    something changed. We only do this iteration after props and state has
    already bailed out, so it's a relatively uncommon path, except at the
    root of a changed subtree. Alternatively, we could move these
    comparisons into `readContext`, but that's a much hotter path, so I
    think this is an appropriate trade off.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b75b80dbde..416dfb6191 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -59,3 +59,4 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableDiscreteEventMicroTasks = __VARIANT__;
 export const enableSyncMicroTasks = __VARIANT__;
 export const enableNativeEventPriorityInference = __VARIANT__;
+export const enableLazyContextPropagation = __VARIANT__;

commit e89d74ee679bafe09213ef66394dd530d2168787
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Mar 8 09:16:30 2021 -0700

    Remove decoupleUpdatePriorityFromScheduler

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 416dfb6191..a550d45be2 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -17,7 +17,6 @@ export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
-export const decoupleUpdatePriorityFromScheduler = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.

commit 73e900b0e78c752d1e045a42ddea8175679ea8f7
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Mar 8 16:43:44 2021 -0500

    Land enableDiscreteEventMicroTasks (#20954)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a550d45be2..46dc190a61 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -55,7 +55,6 @@ export const enableUseRefAccessWarning = __VARIANT__;
 
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const enableDiscreteEventMicroTasks = __VARIANT__;
 export const enableSyncMicroTasks = __VARIANT__;
 export const enableNativeEventPriorityInference = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;

commit e4d4b7074d89a9a94f352ef9336ba0fdc620d8b4
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Mar 9 23:59:02 2021 -0500

    Land enableNativeEventPriorityInference (#20955)
    
    * Land enableNativeEventPriorityInference
    
    * Move schedulerPriorityToLanePriority
    
    * Remove obsolete comment

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 46dc190a61..df98012634 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -56,5 +56,4 @@ export const enableUseRefAccessWarning = __VARIANT__;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableSyncMicroTasks = __VARIANT__;
-export const enableNativeEventPriorityInference = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;

commit be5a2e231ae27b2c64806c026a5b9921be5e7560
Author: Andrew Clark <git@andrewclark.io>
Date:   Fri Mar 19 17:28:41 2021 -0500

    Land enableSyncMicrotasks (#20979)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index df98012634..e2496510ef 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -55,5 +55,4 @@ export const enableUseRefAccessWarning = __VARIANT__;
 
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const enableSyncMicroTasks = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;

commit 25bfa287f6c49950d8ea16f542716835683442d6
Author: Benoit Girard <b56girard@gmail.com>
Date:   Mon Mar 22 21:54:53 2021 -0700

    [Experiment] Add feature flag for more aggressive memory clean-up of deleted fiber trees (#21039)
    
    * Add feature flag: enableStrongMemoryCleanup
    
    Add a feature flag that will test doing a recursive clean of an unmount
    node. This will disconnect the fiber graph making leaks less severe.
    
    * Detach sibling pointers in old child list
    
    When a fiber is deleted, it's still part of the previous (alternate)
    parent fiber's list of children. Because children are a linked list, an
    earlier sibling that's still alive will be connected to the deleted
    fiber via its alternate:
    
    
      live fiber
      --alternate--> previous live fiber
      --sibling--> deleted fiber
    
    We can't disconnect `alternate` on nodes that haven't been deleted
    yet, but we can disconnect the `sibling` and `child` pointers.
    
    Will use this feature flag to test the memory impact.
    
    * Combine into single enum flag
    
    I combined `enableStrongMemoryCleanup` and `enableDetachOldChildList`
    into a single enum flag. The flag has three possible values. Each level
    is a superset of the previous one and performs more aggressive clean up.
    
    We will use this to compare the memory impact of each level.
    
    * Add Flow type to new host config method
    
    * Re-use existing recursive clean up path
    
    We already have a recursive loop that visits every deleted fiber. We
    can re-use that one for clean up instead of adding another one.
    
    Co-authored-by: Andrew Clark <git@andrewclark.io>

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e2496510ef..503d263fc9 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -52,6 +52,7 @@ export const disableNativeComponentFrames = false;
 export const createRootStrictEffectsByDefault = false;
 export const enableStrictEffects = false;
 export const enableUseRefAccessWarning = __VARIANT__;
+export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
 
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;

commit 7c1ba2b57d37df165da0f19c65ccc174866b5af7
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Apr 6 09:21:02 2021 -0400

    Proposed new Suspense layout effect semantics (#21079)
    
    This commit contains a proposed change to layout effect semantics within Suspense subtrees: If a component mounts within a Suspense boundary and is later hidden (because of something else suspending) React will cleanup that component’s layout effects (including React-managed refs).
    
    This change will hopefully fix existing bugs that occur because of things like reading layout in a hidden tree and will also enable a point at which to e.g. pause videos and hide user-managed portals. After the suspended boundary resolves, React will setup the component’s layout effects again (including React-managed refs).
    
    The scenario described above is not common. The useTransition API should ensure that Suspense does not revert to its fallback state after being mounted.
    
    Note that these changes are primarily written in terms of the (as of yet internal) Offscreen API as we intend to provide similar effects semantics within recently shown/hidden Offscreen trees in the future. (More to follow.)
    
    (Note that all changes in this PR are behind a new feature flag, enableSuspenseLayoutEffectSemantics, which is disabled for now.)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 503d263fc9..01937c7b12 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,6 +18,7 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
+export const enableSuspenseLayoutEffectSemantics = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit dc108b0f55387c811899aeb92e583294b0707b1c
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Fri Apr 9 10:34:33 2021 -0400

    Track which fibers scheduled the current render work (#15658)
    
    Tracked Fibers are called "updaters" and are exposed to DevTools via a 'memoizedUpdaters' property on the ReactFiberRoot. The implementation of this feature follows a vaguely similar approach as interaction tracing, but does not require reference counting since there is no subscriptions API.
    
    This change is in support of a new DevTools Profiler feature that shows which Fiber(s) scheduled the selected commit in the Profiler.
    
    All changes have been gated behind a new feature flag, 'enableUpdaterTracking', which is enabled for Profiling builds by default. We also only track updaters when DevTools has been detected, to avoid doing unnecessary work.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 01937c7b12..9b9ec4310c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,6 +25,7 @@ export const enableSuspenseLayoutEffectSemantics = __VARIANT__;
 //
 // NOTE: This feature will only work in DEV mode; all callsights are wrapped with __DEV__.
 export const enableDebugTracing = __EXPERIMENTAL__;
+export const enableUpdaterTracking = false;
 
 export const enableSchedulingProfiler = __VARIANT__;
 

commit 933880b4544a83ce54c8a47f348effe725a58843
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Fri Apr 9 19:50:09 2021 -0400

    Make time-slicing opt-in (#21072)
    
    * Add enableSyncDefaultUpdates feature flag
    
    * Add enableSyncDefaultUpdates implementation
    
    * Fix tests
    
    * Switch feature flag to true by default
    
    * Finish concurrent render whenever for non-sync lanes
    
    * Also return DefaultLane with eventLane
    
    * Gate interruption test
    
    * Add continuout native event test
    
    * Fix tests from rebasing main
    
    * Hardcode lanes, remove added export
    
    * Sync forks

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 9b9ec4310c..d0fc8e6177 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -59,3 +59,4 @@ export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
+export const enableSyncDefaultUpdates = __VARIANT__;

commit 9e9dac650535406b25979758a630a78b7c68a22c
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Wed Apr 28 16:09:30 2021 -0400

    Add unstable_concurrentUpdatesByDefault (#21227)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d0fc8e6177..b8c7a56ce7 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -60,3 +60,4 @@ export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
+export const allowConcurrentByDefault = true;

commit 2bf4805e4bd63dab45cd7f5e1ad32ef8fed3f6ab
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed May 12 11:28:14 2021 -0400

    Update entry point exports (#21488)
    
    The following APIs have been added to the `react` stable entry point:
    * `SuspenseList`
    * `startTransition`
    * `unstable_createMutableSource`
    * `unstable_useMutableSource`
    * `useDeferredValue`
    * `useTransition`
    
    The following APIs have been added or removed from the `react-dom` stable entry point:
    * `createRoot`
    * `unstable_createPortal` (removed)
    
    The following APIs have been added to the `react-is` stable entry point:
    * `SuspenseList`
    * `isSuspenseList`
    
    The following feature flags have been changed from experimental to true:
    * `enableLazyElements`
    * `enableSelectiveHydration`
    * `enableSuspenseServerRenderer`

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b8c7a56ce7..83f7c3b812 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -23,7 +23,7 @@ export const enableSuspenseLayoutEffectSemantics = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.
 //
-// NOTE: This feature will only work in DEV mode; all callsights are wrapped with __DEV__.
+// NOTE: This feature will only work in DEV mode; all callsites are wrapped with __DEV__.
 export const enableDebugTracing = __EXPERIMENTAL__;
 export const enableUpdaterTracking = false;
 

commit 316943091ed36b2807b70b765283c7647dd9ffda
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue May 18 07:07:58 2021 -0700

    Make StrictMode double rendering flag static for FB/www (#21517)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 83f7c3b812..42e5d97e30 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -41,7 +41,6 @@ export const deferRenderPhaseUpdateToNextBatch = !__VARIANT__;
 
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.
-export const debugRenderPhaseSideEffectsForStrictMode = __DEV__;
 export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 
 // TODO: These flags are hard-coded to the default values used in open source.

commit 7841d0695ae4bde9848cf8953baf34d312d0cced
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue May 25 14:41:19 2021 -0700

    Enable the updater-tracking feature flag in more builds (#21567)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 42e5d97e30..591193ebb7 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,7 +25,6 @@ export const enableSuspenseLayoutEffectSemantics = __VARIANT__;
 //
 // NOTE: This feature will only work in DEV mode; all callsites are wrapped with __DEV__.
 export const enableDebugTracing = __EXPERIMENTAL__;
-export const enableUpdaterTracking = false;
 
 export const enableSchedulingProfiler = __VARIANT__;
 

commit 19092ac8c354b92c2e0e27b73f391571ad452505
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Aug 3 22:30:20 2021 -0400

    Re-add old Fabric Offscreen impl behind flag (#22018)
    
    * Re-add old Fabric Offscreen impl behind flag
    
    There's a chance that #21960 will affect layout in a way that we don't
    expect, so I'm adding back the old implementation so we can toggle the
    feature with a flag.
    
    The flag should read from the ReactNativeFeatureFlags shim so that we
    can change it at runtime. I'll do that separately.
    
    * Import dynamic RN flags from external module
    
    Internal feature flags that we wish to control with a GK can now be
    imported from an external module, which I've called
    "ReactNativeInternalFeatureFlags".
    
    We'll need to add this module to the downstream repo.
    
    We can't yet use this in our tests, because we don't have a test
    configuration that runs against the React Native feature flags fork. We
    should set up that up the same way we did for www.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 591193ebb7..72ae2f2c5b 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -59,3 +59,4 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const allowConcurrentByDefault = true;
+export const enablePersistentOffscreenHostContainer = false;

commit ecd73e17bcdecc092cb56259999787d832d6510a
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Mon Aug 9 15:45:12 2021 -0400

    Enable enableSuspenseLayoutEffectSemantics flag statically for Facebook (#22050)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 72ae2f2c5b..23a7e321e6 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,7 +18,6 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
-export const enableSuspenseLayoutEffectSemantics = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit fc40f02adb2d11e4936cc31119c7a45acc471a7a
Author: Luna Ruan <lunaris.ruan@gmail.com>
Date:   Wed Sep 1 11:56:52 2021 -0700

    Add consoleManagedByDevToolsDuringStrictMode feature flag in React Reconciler (#22196)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 23a7e321e6..a9563d3b44 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -59,3 +59,5 @@ export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const allowConcurrentByDefault = true;
 export const enablePersistentOffscreenHostContainer = false;
+
+export const consoleManagedByDevToolsDuringStrictMode = true;

commit 2f156eafb83d129a729947ac2bd7089d20b208ab
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Tue Sep 7 19:51:12 2021 +0100

    Adjust consoleManagedByDevToolsDuringStrictMode feature flag (#22253)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a9563d3b44..e39892a106 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -60,4 +60,4 @@ export const enableSyncDefaultUpdates = __VARIANT__;
 export const allowConcurrentByDefault = true;
 export const enablePersistentOffscreenHostContainer = false;
 
-export const consoleManagedByDevToolsDuringStrictMode = true;
+export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;

commit d4d1dc085d1332fdd5025c292adcb5b39811e5b5
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Tue Sep 7 23:28:38 2021 +0100

    Reorder VARIANT feature flags (#22266)
    
    * Move variant tests up
    
    * Add a comment

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e39892a106..366f1fd0a7 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,6 +18,13 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
+export const enableUseRefAccessWarning = __VARIANT__;
+export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
+export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
+export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
+export const enableLazyContextPropagation = __VARIANT__;
+export const enableSyncDefaultUpdates = __VARIANT__;
+export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.
@@ -47,17 +54,9 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const disableNativeComponentFrames = false;
-
 export const createRootStrictEffectsByDefault = false;
 export const enableStrictEffects = false;
-export const enableUseRefAccessWarning = __VARIANT__;
-export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
-
-export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
-export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const enableLazyContextPropagation = __VARIANT__;
-export const enableSyncDefaultUpdates = __VARIANT__;
 export const allowConcurrentByDefault = true;
 export const enablePersistentOffscreenHostContainer = false;
-
-export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
+// You probably *don't* want to add more hardcoded ones.
+// Instead, try to add them above with the __VARIANT__ value.

commit a3fde2358896e32201f49bc81acd2f228951ca84
Author: salazarm <salazarm@users.noreply.github.com>
Date:   Wed Sep 8 17:01:09 2021 -0400

    Detect subscriptions wrapped in startTransition (#22271)
    
    * Detect subscriptions wrapped in startTransition

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 366f1fd0a7..d6a5c77b83 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,6 +25,7 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
+export const warnOnSubscriptionInsideStartTransition = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 67222f044c582a1a10f3b9d15d9daf67d5dc5c4f
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Wed Sep 15 13:51:39 2021 +0100

    [Experiment] Warn if callback ref returns a function (#22313)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d6a5c77b83..6400ef0422 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,6 +19,7 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
+export const warnAboutCallbackRefReturningFunction = __VARIANT__;
 export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;

commit 0ecbbe142201ef65830f0b7a19d52c1f77043e86
Author: salazarm <salazarm@users.noreply.github.com>
Date:   Mon Oct 4 09:54:33 2021 -0400

    Sync hydrate discrete events in capture phase and dont replay discrete events (#22448)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 6400ef0422..ef980529f3 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -27,6 +27,7 @@ export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const warnOnSubscriptionInsideStartTransition = __VARIANT__;
+export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit fdc1d617a44cb9015c3bac3a6341b5af3311faf6
Author: salazarm <salazarm@users.noreply.github.com>
Date:   Thu Nov 18 08:16:09 2021 -0500

    Flag for client render fallback behavior on hydration mismatch (#22787)
    
    * Add flag for new client-render fallback behavior on hydration mismatch
    
    * gate test
    
    * gate tests too
    
    * fix test gating

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index ef980529f3..288e9631c7 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -28,6 +28,7 @@ export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const warnOnSubscriptionInsideStartTransition = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
+export const enableClientRenderFallbackOnHydrationMismatch = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit e4894025570ebbe5955b4e4b226dd900e17c93e7
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Jan 20 15:18:38 2022 +0000

    Warn when a callback ref returns a function (#23145)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 288e9631c7..ab5e1526e3 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,7 +19,6 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
-export const warnAboutCallbackRefReturningFunction = __VARIANT__;
 export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;

commit 419ccc2b1974206b9fcbe539a31654dd64024156
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Feb 17 21:43:25 2022 -0500

    Land skipUnmountedBoundaries experiment (#23322)
    
    This has been rolled out to 10% of Facebook users for months without
    any issues.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index ab5e1526e3..61898e5a6e 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -17,7 +17,6 @@ export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
-export const skipUnmountedBoundaries = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
 export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;

commit b3f3da205b9abfc3c70e7018b03114a33ef43ca5
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Feb 23 18:52:08 2022 -0500

    Land warnOnSubscriptionInsideStartTransition flag (#23353)
    
    We're including this in 18. The feature was already enabled — this just
    removes the flag.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 61898e5a6e..055cbd5d1e 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -24,7 +24,6 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
-export const warnOnSubscriptionInsideStartTransition = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
 export const enableClientRenderFallbackOnHydrationMismatch = __VARIANT__;
 

commit 42f15b324f50d0fd98322c21646ac3013e30344a
Author: Luna Ruan <lunaris.ruan@gmail.com>
Date:   Thu Feb 24 17:28:18 2022 -0500

    [DevTools][Transition Tracing] onTransitionComplete and onTransitionStart implmentation (#23313)
    
    * add transition name to startTransition
    
    Add a transitionName to start transition, store the transition start time and name in the batch config, and pass it to the root on render
    
    * Transition Tracing Types and Consts
    
    * Root begin work
    
    The root operates as a tracing marker that has all transitions on it. This PR only tested the root with one transition so far
    
    - Store transitions in memoizedState. Do this in updateHostRoot AND attemptEarlyBailoutIfNoScheduledUpdate. We need to do this in the latter part because even if the root itself doesn't have an update, it could still have new transitions in its transitionLanes map that we need to process.
    
    * Transition Tracing commit phase
    
    - adds a module scoped pending transition callbacks object that contains all transition callbacks that have not yet been processed. This  contains all callbacks before the next paint occurs.
    - Add code in the mutation phase to:
            * For the root, if there are transitions that were initialized during this commit in the root transition lanes map, add a transition start call to the pending transition callbacks object. Then, remove the transitions from the root transition lanes map.
            * For roots, in the commit phase, add a transition complete call
    
    We add this code in the mutation phase because we can't add it to the passive phase because then the paint might have occurred before we even know which callbacks to call
    
    * Process Callbacks after paint
    
    At the end of the commit phase, call scheduleTransitionCallbacks to schedule all pending transition callbacks to be called after paint. Then clear the callbacks

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 055cbd5d1e..36627a5d50 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -26,6 +26,7 @@ export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
 export const enableClientRenderFallbackOnHydrationMismatch = __VARIANT__;
+export const enableTransitionTracing = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit a82ef6d40bb0b000a97ca82590bfeaa3637c66bb
Author: Andrew Clark <git@andrewclark.io>
Date:   Mon Feb 28 11:14:30 2022 -0500

    Add back skipUnmountedBoundaries flag only for www (#23383)
    
    There are a few internal tests that still need to be updated, so I'm
    adding this flag back for www only.
    
    The desired behavior rolled out to 10% public, so we're confident there
    are no issues.
    
    The open source behavior remains (skipUnmountedBoundaries = true).

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 36627a5d50..173713b36c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -17,6 +17,7 @@ export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
+export const skipUnmountedBoundaries = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
 export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;

commit ef23a9ee8114c939946ceff91becc13415d99d5a
Author: salazarm <salazarm@users.noreply.github.com>
Date:   Wed Mar 16 10:12:59 2022 -0400

    Flag for text hydration mismatch (#24107)
    
    * flag for text hydration mismatch
    
    * rm unused import

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 173713b36c..1f7de0b6b5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -27,6 +27,7 @@ export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
 export const enableClientRenderFallbackOnHydrationMismatch = __VARIANT__;
+export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.

commit 6b85823b35f75baec9022a40df336d6aee788ce0
Author: salazarm <salazarm@users.noreply.github.com>
Date:   Thu Mar 24 14:12:43 2022 -0400

    Clean up Selective Hydration / Event Replay flag (#24156)
    
    * clean up selective hydration / replay flag
    
    * dont export return_targetInst

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 1f7de0b6b5..bdc3abb2a8 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,7 +25,6 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
-export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
 export const enableClientRenderFallbackOnHydrationMismatch = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;

commit a6d53f3468636bcee30c26d4e0df7a4582526d63
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Apr 19 17:34:30 2022 -0400

    Revert "Clean up Selective Hydration / Event Replay flag (#24156)" (#24402)
    
    This reverts commit b5cca182ffd5500b83f20f215d0e16d6dbae0efb.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index bdc3abb2a8..1f7de0b6b5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,6 +25,7 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
+export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
 export const enableClientRenderFallbackOnHydrationMismatch = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;

commit 4175f05934d3954827c00b7633c1ce8e4e87d227
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Apr 19 17:34:49 2022 -0400

    Temporarily feature flag numeric fallback for symbols (#24401)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 1f7de0b6b5..cfc32d6bac 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,7 +29,7 @@ export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __
 export const enableClientRenderFallbackOnHydrationMismatch = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
-
+export const enableSymbolFallbackForWWW = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.
 //

commit 0dc4e6663dc875e0f734b1a96b26ebc33902323a
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Apr 20 14:09:11 2022 -0400

    Land enableClientRenderFallbackOnHydrationMismatch (#24410)
    
    This flag is already enabled on all relevant surfaces. We can remove it.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index cfc32d6bac..253cb58a2d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -26,7 +26,6 @@ export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
-export const enableClientRenderFallbackOnHydrationMismatch = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableSymbolFallbackForWWW = __VARIANT__;

commit ce13860281f833de8a3296b7a3dad9caced102e9
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Apr 28 15:05:41 2022 -0400

    Remove enablePersistentOffscreenHostContainer flag (#24460)
    
    This was a Fabric-related experiment that we ended up not shipping.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 253cb58a2d..7a89e41ad5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -60,6 +60,5 @@ export const disableNativeComponentFrames = false;
 export const createRootStrictEffectsByDefault = false;
 export const enableStrictEffects = false;
 export const allowConcurrentByDefault = true;
-export const enablePersistentOffscreenHostContainer = false;
 // You probably *don't* want to add more hardcoded ones.
 // Instead, try to add them above with the __VARIANT__ value.

commit 99eef9e2df7b6aade461a1a958eb3838239e72c4
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue May 3 10:16:53 2022 -0400

    Hide children of Offscreen after destroy effects (#24446)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7a89e41ad5..ab0a2e1aa4 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,6 +29,7 @@ export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableSymbolFallbackForWWW = __VARIANT__;
+export const enableFlipOffscreenUnhideOrder = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.
 //

commit 62662633d1293f47ab0f5ee444a2a2fd52df322a
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu May 12 12:40:17 2022 -0400

    Remove enableFlipOffscreenUnhideOrder (#24545)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index ab0a2e1aa4..7a89e41ad5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,7 +29,6 @@ export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableSymbolFallbackForWWW = __VARIANT__;
-export const enableFlipOffscreenUnhideOrder = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.
 //

commit 327e4a1f96fbb874001b17684fbb073046a84938
Author: Andrew Clark <git@andrewclark.io>
Date:   Sun Jun 12 18:12:33 2022 -0400

    [Follow-up] Land enableClientRenderFallbackOnTextMismatch
    
    This was meant to land in the previous commit; forgot to stage the
    changes when I was rebasing.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7a89e41ad5..255a183d42 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -26,7 +26,6 @@ export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
-export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableSymbolFallbackForWWW = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.

commit 229c86af07302d40b70c41de18106f80fe89836c
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Jun 16 11:38:37 2022 -0400

    Revert "Land enableClientRenderFallbackOnTextMismatch" (#24738)
    
    This reverts commit 327e4a1f96fbb874001b17684fbb073046a84938.
    
    Turns out we hadn't rolled this out internally yet — I mistook
    enableClientRenderFallbackOnHydrationMismatch for
    said enableClientRenderFallbackOnTextMismatch. Need to revert
    until we finish rolling out the change.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 255a183d42..7a89e41ad5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -26,6 +26,7 @@ export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
+export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableSymbolFallbackForWWW = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.

commit 796d31809b3683083d3b62ccbab4f00dec8ffb1f
Author: Josh Story <story@hey.com>
Date:   Fri Aug 12 13:27:53 2022 -0700

    Implement basic stylesheet Resources for react-dom (#25060)
    
    Implement basic support for "Resources". In the context of this commit, the only thing that is currently a Resource are
    
    <link rel="stylesheet" precedence="some-value" ...>
    
    Resources can be rendered anywhere in the react tree, even outside of normal parenting rules, for instance you can render a resource before you have rendered the <html><head> tags for your application. In the stream we reorder this so the browser always receives valid HTML and resources are emitted either in place (normal circumstances) or at the top of the <head> (when you render them above or before the <head> in your react tree)
    
    On the client, resources opt into an entirely different hydration path. Instead of matching the location within the Document these resources are queried for in the entire document. It is an error to have more than one resource with the same href attribute.
    
    The use of precedence here as an opt-in signal for resourcifying the link is in preparation for a more complete Resource implementation which will dedupe resource references (multiple will be valid), hoist to the appropriate container (body, head, or elsewhere), order (according to precedence) and Suspend boundaries that depend on them. More details will come in the coming weeks on this plan.
    
    This feature is gated by an experimental flag and will only be made available in experimental builds until some future time.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7a89e41ad5..dd6dcff47b 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -60,5 +60,6 @@ export const disableNativeComponentFrames = false;
 export const createRootStrictEffectsByDefault = false;
 export const enableStrictEffects = false;
 export const allowConcurrentByDefault = true;
+export const enableFloat = false;
 // You probably *don't* want to add more hardcoded ones.
 // Instead, try to add them above with the __VARIANT__ value.

commit 0de3ddf56e011c708067319d9b8e94e1cd1ea1a5
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu Aug 25 17:01:30 2022 -0400

    Remove Symbol Polyfill (again) (#25144)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index dd6dcff47b..520b102b7d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -28,7 +28,6 @@ export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
-export const enableSymbolFallbackForWWW = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.
 //

commit 346c7d4c43a0717302d446da9e7423a8e28d8996
Author: Jan Kassens <jan@kassens.net>
Date:   Tue Sep 13 17:57:38 2022 -0400

    straightford explicit types (#25253)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 520b102b7d..67812e36da 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,7 +19,7 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
-export const deletedTreeCleanUpLevel = __VARIANT__ ? 3 : 1;
+export const deletedTreeCleanUpLevel: number = __VARIANT__ ? 3 : 1;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;

commit 2cf4352e1c81a5b8c3528519a128c20e8e65531d
Author: Josh Story <story@hey.com>
Date:   Tue Oct 11 08:42:42 2022 -0700

    Implement HostSingleton Fiber type (#25426)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 67812e36da..28f5aa531d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -59,6 +59,5 @@ export const disableNativeComponentFrames = false;
 export const createRootStrictEffectsByDefault = false;
 export const enableStrictEffects = false;
 export const allowConcurrentByDefault = true;
-export const enableFloat = false;
 // You probably *don't* want to add more hardcoded ones.
 // Instead, try to add them above with the __VARIANT__ value.

commit 9cdf8a99edcfd94d7420835ea663edca04237527
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Oct 18 11:19:24 2022 -0400

    [Codemod] Update copyright header to Meta (#25315)
    
    * Facebook -> Meta in copyright
    
    rg --files | xargs sed -i 's#Copyright (c) Facebook, Inc. and its affiliates.#Copyright (c) Meta Platforms, Inc. and affiliates.#g'
    
    * Manual tweaks

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 28f5aa531d..c08abf443f 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -1,5 +1,5 @@
 /**
- * Copyright (c) Facebook, Inc. and its affiliates.
+ * Copyright (c) Meta Platforms, Inc. and affiliates.
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE file in the root directory of this source tree.

commit 987292815c68be0fd5916d1f9b0d6c983e2db7ce
Author: Samuel Susla <samuel.susla@gmail.com>
Date:   Wed Oct 19 10:57:09 2022 +0100

    Remove feature flag enableStrictEffects (#25387)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index c08abf443f..882871de6f 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -57,7 +57,6 @@ export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const disableNativeComponentFrames = false;
 export const createRootStrictEffectsByDefault = false;
-export const enableStrictEffects = false;
 export const allowConcurrentByDefault = true;
 // You probably *don't* want to add more hardcoded ones.
 // Instead, try to add them above with the __VARIANT__ value.

commit 5379b6123f171bb48cc8a9c435c11ccb9f8ff0e7
Author: Tianyu Yao <skyyao@fb.com>
Date:   Thu Jan 5 15:21:35 2023 -0800

    Batch sync, default and continuous lanes (#25700)
    
    <!--
      Thanks for submitting a pull request!
    We appreciate you spending the time to work on these changes. Please
    provide enough information so that others can review your pull request.
    The three fields below are mandatory.
    
    Before submitting a pull request, please make sure the following is
    done:
    
    1. Fork [the repository](https://github.com/facebook/react) and create
    your branch from `main`.
      2. Run `yarn` in the repository root.
    3. If you've fixed a bug or added code that should be tested, add tests!
    4. Ensure the test suite passes (`yarn test`). Tip: `yarn test --watch
    TestName` is helpful in development.
    5. Run `yarn test --prod` to test in the production environment. It
    supports the same options as `yarn test`.
    6. If you need a debugger, run `yarn debug-test --watch TestName`, open
    `chrome://inspect`, and press "Inspect".
    7. Format your code with
    [prettier](https://github.com/prettier/prettier) (`yarn prettier`).
    8. Make sure your code lints (`yarn lint`). Tip: `yarn linc` to only
    check changed files.
      9. Run the [Flow](https://flowtype.org/) type checks (`yarn flow`).
      10. If you haven't already, complete the CLA.
    
    Learn more about contributing:
    https://reactjs.org/docs/how-to-contribute.html
    -->
    
    ## Summary
    
    <!--
    Explain the **motivation** for making this change. What existing problem
    does the pull request solve?
    -->
    This is the other approach for unifying default and sync lane
    https://github.com/facebook/react/pull/25524.
    The approach in that PR is to merge default and continuous lane into the
    sync lane, and use a new field to track the priority. But there are a
    couple places that field will be needed, and it is difficult to
    correctly reset the field when there is no sync lane.
    
    In this PR we take the other approach that doesn't remove any lane, but
    batch them to get the behavior we want.
    
    
    ## How did you test this change?
    
    <!--
    Demonstrate the code is solid. Example: The exact commands you ran and
    their output, screenshots / videos if the pull request changes the user
    interface.
    How exactly did you verify that your PR solves the issue you wanted to
    solve?
      If you leave this empty, your PR will very likely be closed.
    -->
    yarn test
    
    Co-authored-by: Andrew Clark <hi@andrewclark.io>

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 882871de6f..12b4ba8d35 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -24,6 +24,7 @@ export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
+export const enableUnifiedSyncLane = __VARIANT__;
 export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;

commit 7002a6743ebb24ed55af8f626c89dd39460230fc
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Jan 10 23:26:01 2023 -0500

    [cleanup] remove unused values from ReactFeatureFlags.www-dynamic (#25575)
    
    These values are never imported into `ReactFeatureFlags.www.js`, so
    they're unused:
    - `allowConcurrentByDefault`
    - `consoleManagedByDevToolsDuringStrictMode`
    
    These values are never set in the WWW module
    (https://fburl.com/code/dsb2ohv8), so they're always `undefined` on www:
    - `createRootStrictEffectsByDefault`
    - `enableClientRenderFallbackOnTextMismatch`

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 12b4ba8d35..a19c6ef38a 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,9 +25,7 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
-export const consoleManagedByDevToolsDuringStrictMode = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
-export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.
@@ -57,7 +55,5 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const disableNativeComponentFrames = false;
-export const createRootStrictEffectsByDefault = false;
-export const allowConcurrentByDefault = true;
 // You probably *don't* want to add more hardcoded ones.
 // Instead, try to add them above with the __VARIANT__ value.

commit 379dd741e9aabefb880af1794d3c828984f9e143
Author: Jan Kassens <jkassens@meta.com>
Date:   Fri Jan 13 16:02:24 2023 -0500

    [www] set enableTrustedTypesIntegration to false (#25997)
    
    This isn't configured to a dynamic value on www, so hardcode here to
    false.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a19c6ef38a..8cdbc224a8 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -52,7 +52,6 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.
-export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const disableNativeComponentFrames = false;
 // You probably *don't* want to add more hardcoded ones.

commit ee85098019bf9703b32f608f8bbd5f8fb1a7d60b
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Jan 17 11:03:29 2023 -0500

    [cleanup] remove deletedTreeCleanUpLevel feature flag (#25529)
    
    I noticed this was an experiment concluded 16 months ago (#21679) that
    this extra work is beneficial
    to break up cycles leaking memory in product code.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 8cdbc224a8..0297c7dd44 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,7 +19,6 @@ export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
-export const deletedTreeCleanUpLevel: number = __VARIANT__ ? 3 : 1;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;

commit 48b687fc95a172cec8f305312a27d105e5719581
Author: an onion <onionymous@users.noreply.github.com>
Date:   Mon Jan 30 10:26:04 2023 -0800

    [trusted types][www] Add enableTrustedTypesIntegration flag back in (#26016)
    
    ## Summary
    
    The flag was first added in #16157 and was rolled out to employees in
    D17430095. #25997 removed this flag because it wasn't dynamically set to
    a value in www. The www side was mistakenly removed in D41851685 due to
    deprecation of a TypedJSModule but we still want to keep this flag, so
    let's add it back in + add a GK on the www side to match the previous
    rollout.
    
    See D42574435 for the dynamic value change in www
    
    ## How did you test this change?
    
    ```
    yarn test
    yarn test --prod
    ```

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 0297c7dd44..b2882118be 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -51,6 +51,7 @@ export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.
+export const enableTrustedTypesIntegration = false;
 export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const disableNativeComponentFrames = false;
 // You probably *don't* want to add more hardcoded ones.

commit 1f5ce59dd7b6869b1a17ede65aa301002ef31d4b
Author: Jan Kassens <jkassens@meta.com>
Date:   Mon Jan 30 15:25:24 2023 -0500

    [cleanup] fully roll out warnAboutSpreadingKeyToJSX (#26080)
    
    I fully enabled this flag internally now and unless I see complications,
    we should be able to clean this up in the code.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b2882118be..b0a4261362 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -13,7 +13,6 @@
 // Use __VARIANT__ to simulate a GK. The tests will be run twice: once
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
-export const warnAboutSpreadingKeyToJSX = __VARIANT__;
 export const disableInputAttributeSyncing = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;

commit 6b3083266686f62b29462d32de75c6e71f7ba3e3
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Jan 31 08:25:05 2023 -0500

    Upgrade prettier (#26081)
    
    The old version of prettier we were using didn't support the Flow syntax
    to access properties in a type using `SomeType['prop']`. This updates
    `prettier` and `rollup-plugin-prettier` to the latest versions.
    
    I added the prettier config `arrowParens: "avoid"` to reduce the diff
    size as the default has changed in Prettier 2.0. The largest amount of
    changes comes from function expressions now having a space. This doesn't
    have an option to preserve the old behavior, so we have to update this.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b0a4261362..c9e353f2ba 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -23,7 +23,8 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableSyncDefaultUpdates = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
-export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay = __VARIANT__;
+export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay =
+  __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit c9d9f524d7deaf3ec94e3d13dc84240bd63cded2
Author: Andrew Clark <git@andrewclark.io>
Date:   Fri Feb 17 15:45:03 2023 -0500

    Make enableCustomElementPropertySupport a dynamic flag in www build (#26194)
    
    Turns enableCustomElementPropertySupport into a dynamic flag in the www
    build so we can turn it on behind a GK.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index c9e353f2ba..42e9c8a7ab 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -26,6 +26,8 @@ export const enableUnifiedSyncLane = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay =
   __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
+export const enableCustomElementPropertySupport = __VARIANT__;
+
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.
 //

commit b2ae9ddb3b497d16a7c27c051da1827d08871138
Author: Jan Kassens <jkassens@meta.com>
Date:   Mon Feb 27 14:04:02 2023 -0500

    Cleanup enableSyncDefaultUpdate flag (#26236)
    
    This feature flag is enabled everywhere.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 42e9c8a7ab..c754e18430 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,7 +21,6 @@ export const enableUseRefAccessWarning = __VARIANT__;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
-export const enableSyncDefaultUpdates = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay =
   __VARIANT__;

commit cfc1274e3be5a93a4c93f8fb87f2109993afe1dd
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Tue Mar 14 23:27:04 2023 -0400

    Disable IE innerHTML workaround behind a flag (#26390)
    
    We don't need this workaround for SVG anymore and we don't need to
    workaround MSApp's security model since Windows 10.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index c754e18430..53a293dab5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -14,6 +14,7 @@
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
 export const disableInputAttributeSyncing = __VARIANT__;
+export const disableIEWorkarounds = __VARIANT__;
 export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;

commit 55308554edb7a7d0c091c2ee4973ba5f4b06dfe8
Author: Jan Kassens <jkassens@meta.com>
Date:   Fri Mar 17 12:09:36 2023 -0400

    [www] enable enableFilterEmptyStringAttributesDOM flag (#26410)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 53a293dab5..73d91e4f80 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -15,7 +15,6 @@
 
 export const disableInputAttributeSyncing = __VARIANT__;
 export const disableIEWorkarounds = __VARIANT__;
-export const enableFilterEmptyStringAttributesDOM = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const skipUnmountedBoundaries = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;

commit 12a1d140e366aa8d95338e4412117f16da79a078
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Mar 21 10:24:56 2023 -0400

    Don't prerender siblings of suspended component  (#26380)
    
    Today if something suspends, React will continue rendering the siblings
    of that component.
    
    Our original rationale for prerendering the siblings of a suspended
    component was to initiate any lazy fetches that they might contain. This
    was when we were more bullish about lazy fetching being a good idea some
    of the time (when combined with prefetching), as opposed to our latest
    thinking, which is that it's almost always a bad idea.
    
    Another rationale for the original behavior was that the render was I/O
    bound, anyway, so we might as do some extra work in the meantime. But
    this was before we had the concept of instant loading states: when
    navigating to a new screen, it's better to show a loading state as soon
    as you can (often a skeleton UI), rather than delay the transition.
    (There are still cases where we block the render, when a suitable
    loading state is not available; it's just not _all_ cases where
    something suspends.) So the biggest issue with our existing
    implementation is that the prerendering of the siblings happens within
    the same render pass as the one that suspended — _before_ the loading
    state appears.
    
    What we should do instead is immediately unwind the stack as soon as
    something suspends, to unblock the loading state.
    
    If we want to preserve the ability to prerender the siblings, what we
    could do is schedule special render pass immediately after the fallback
    is displayed. This is likely what we'll do in the future. However, in
    the new implementation of `use`, there's another reason we don't
    prerender siblings: so we can preserve the state of the stack when
    something suspends, and resume where we left of when the promise
    resolves without replaying the parents. The only way to do this
    currently is to suspend the entire work loop. Fiber does not currently
    support rendering multiple siblings in "parallel". Once you move onto
    the next sibling, the stack of the previous sibling is discarded and
    cannot be restored. We do plan to implement this feature, but it will
    require a not-insignificant refactor.
    
    Given that lazy data fetching is already bad for performance, the best
    trade off for now seems to be to disable prerendering of siblings. This
    gives us the best performance characteristics when you're following best
    practices (i.e. hoist data fetches to Server Components or route
    loaders), at the expense of making an already bad pattern a bit worse.
    
    Later, when we implement resumable context stacks, we can reenable
    sibling prerendering. Though even then the use case will mostly be to
    prerender the CPU-bound work, not lazy fetches.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 73d91e4f80..eae2363b6f 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -49,6 +49,12 @@ export const deferRenderPhaseUpdateToNextBatch = !__VARIANT__;
 // so we don't need to use __VARIANT__ to get extra coverage.
 export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 
+// This flag only exists so it can be connected to a www GK that acts as a
+// killswitch. We don't run our tests against the `true` value because 1) it
+// affects too many tests 2) it shouldn't break anything. But it is mildly
+// risky, hence this extra precaution.
+export const revertRemovalOfSiblingPrerendering = false;
+
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.

commit 8342a09927b18725e1dd2a78b9a78b439528a7d1
Author: Jan Kassens <jkassens@meta.com>
Date:   Mon Mar 27 17:52:02 2023 +0200

    Remove unused feature flag disableSchedulerTimeoutBasedOnReactExpirationTime (#26488)
    
    Easy removal as it's completely unused as @rickhanlonii noticed.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index eae2363b6f..15d775e750 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -59,7 +59,6 @@ export const revertRemovalOfSiblingPrerendering = false;
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
-export const disableSchedulerTimeoutBasedOnReactExpirationTime = false;
 export const disableNativeComponentFrames = false;
 // You probably *don't* want to add more hardcoded ones.
 // Instead, try to add them above with the __VARIANT__ value.

commit 41b4714f195868193ddfb2a89d2373b1c61387f4
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Mar 28 09:46:26 2023 -0400

    Remove disableNativeComponentFrames (#26490)
    
    ## Overview
    
    I'm landing this flag internally so we can delete this

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 15d775e750..ef76f9129d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -59,6 +59,5 @@ export const revertRemovalOfSiblingPrerendering = false;
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.
 export const enableTrustedTypesIntegration = false;
-export const disableNativeComponentFrames = false;
 // You probably *don't* want to add more hardcoded ones.
 // Instead, try to add them above with the __VARIANT__ value.

commit 2d51251e608b7b1a8baf79ae6bdba81ed8e1939a
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Mar 30 14:10:19 2023 -0400

    Clean up deferRenderPhaseUpdateToNextBatch (#26511)
    
    This is a change to some undefined behavior that we though we would do
    at one point but decided not to roll out. It's already disabled
    everywhere, so this just deletes the branch from the implementation and
    the tests.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index ef76f9129d..d567eedb97 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -35,16 +35,6 @@ export const enableDebugTracing = __EXPERIMENTAL__;
 
 export const enableSchedulingProfiler = __VARIANT__;
 
-// This only has an effect in the new reconciler. But also, the new reconciler
-// is only enabled when __VARIANT__ is true. So this is set to the opposite of
-// __VARIANT__ so that it's `false` when running against the new reconciler.
-// Ideally we would test both against the new reconciler, but until then, we
-// should test the value that is used in www. Which is `false`.
-//
-// Once Lanes has landed in both reconciler forks, we'll get coverage of
-// both branches.
-export const deferRenderPhaseUpdateToNextBatch = !__VARIANT__;
-
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.
 export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;

commit ca01f359b9236292c749075bb2fd41bb7b569308
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu Mar 30 20:58:13 2023 -0400

    Remove skipUnmountedBoundaries (#26489)
    
    # Overview
    
    Landing this flag internally, will test this PR in React Native before
    merging.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d567eedb97..9682825117 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -16,7 +16,6 @@
 export const disableInputAttributeSyncing = __VARIANT__;
 export const disableIEWorkarounds = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
-export const skipUnmountedBoundaries = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;

commit 8310854cebba4d1f404e65ff2064825ee76d78e2
Author: Andrew Clark <git@andrewclark.io>
Date:   Fri Mar 31 10:25:58 2023 -0400

    Clean up enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay (#26521)
    
    This flag is already enabled everywhere except for www, which is blocked
    by a few tests that assert on the old behavior. Once www is ready, I'll
    land this.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 9682825117..64670368b8 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,8 +21,6 @@ export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
-export const enableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay =
-  __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableCustomElementPropertySupport = __VARIANT__;
 

commit 09c8d2563300621dc91258a4c2839210e2fbdf0e
Author: Andrew Clark <git@andrewclark.io>
Date:   Fri Mar 31 13:04:08 2023 -0400

    Move update scheduling to microtask (#26512)
    
    When React receives new input (via `setState`, a Suspense promise
    resolution, and so on), it needs to ensure there's a rendering task
    associated with the update. Most of this happens
    `ensureRootIsScheduled`.
    
    If a single event contains multiple updates, we end up running the
    scheduling code once per update. But this is wasteful because we really
    only need to run it once, at the end of the event (or in the case of
    flushSync, at the end of the scope function's execution).
    
    So this PR moves the scheduling logic to happen in a microtask instead.
    In some cases, we will force it run earlier than that, like for
    `flushSync`, but since updates are batched by default, it will almost
    always happen in the microtask. Even for discrete updates.
    
    In production, this should have no observable behavior difference. In a
    testing environment that uses `act`, this should also not have a
    behavior difference because React will push these tasks to an internal
    `act` queue.
    
    However, tests that do not use `act` and do not simulate an actual
    production environment (like an e2e test) may be affected. For example,
    before this change, if a test were to call `setState` outside of `act`
    and then immediately call `jest.runAllTimers()`, the update would be
    synchronously applied. After this change, that will no longer work
    because the rendering task (a timer, in this case) isn't scheduled until
    after the microtask queue has run.
    
    I don't expect this to be an issue in practice because most people do
    not write their tests this way. They either use `act`, or they write
    e2e-style tests.
    
    The biggest exception has been... our own internal test suite. Until
    recently, many of our tests were written in a way that accidentally
    relied on the updates being scheduled synchronously. Over the past few
    weeks, @tyao1 and I have gradually converted the test suite to use a new
    set of testing helpers that are resilient to this implementation detail.
    
    (There are also some old Relay tests that were written in the style of
    React's internal test suite. Those will need to be fixed, too.)
    
    The larger motivation behind this change, aside from a minor performance
    improvement, is we intend to use this new microtask to perform
    additional logic that doesn't yet exist. Like inferring the priority of
    a custom event.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 64670368b8..69c5fad893 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -23,6 +23,7 @@ export const enableLazyContextPropagation = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableCustomElementPropertySupport = __VARIANT__;
+export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit da94e8b24a3f31a3e805f9bf6bba73055aad9d41
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Apr 4 10:08:14 2023 -0400

    Revert "Cleanup enableSyncDefaultUpdate flag (#26236)" (#26528)
    
    This reverts commit b2ae9ddb3b497d16a7c27c051da1827d08871138.
    
    While the feature flag is fully rolled out, these tests are also testing
    behavior set with an unstable flag on root, which for now we want to
    preserve.
    
    Not sure if there's a better way then adding a dynamic feature flag to
    the www build?

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 69c5fad893..0926f66fc3 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -20,6 +20,7 @@ export const enableUseRefAccessWarning = __VARIANT__;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
+export const enableSyncDefaultUpdates = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableCustomElementPropertySupport = __VARIANT__;

commit ca41adb8c1b256705f73d1fb657421a03dfad82c
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Mon Apr 10 19:09:28 2023 -0400

    Diff properties in the commit phase instead of generating an update payload (#26583)
    
    This removes the concept of `prepareUpdate()`, behind a flag.
    
    React Native already does everything in the commit phase, but generates
    a temporary update payload before applying it.
    
    React Fabric does it both in the render phase. Now it just moves it to a
    single host config.
    
    For DOM I forked updateProperties into one that does diffing and
    updating in one pass vs just applying a pre-diffed updatePayload.
    
    There are a few downsides of this approach:
    
    - If only "children" has changed, we end up scheduling an update to be
    done in the commit phase. Since we traverse through it anyway, it's
    probably not much extra.
    - It does more work in the commit phase so for a large tree that is
    mostly unchanged, it'll stall longer.
    - It does some extra work for special cases since that work happens if
    anything has changed. We no longer have a deep bailout.
    - The special cases now have to each replicate the "clean up old props"
    loop, leading to extra code.
    
    The benefit is that this doesn't allocate temporary extra objects
    (possibly multiple per element if the array has to resize). It's less
    work overall. It also gives us an option to reuse this function for a
    sync render optimization.
    
    Another benefit is that if we do the loop in the commit phase I can do
    further optimizations by reading all props that I need for special cases
    in that loop instead of polymorphic reads from props. This is what I'd
    like to do in future refactors that would be stacked on top of this
    change.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 0926f66fc3..a958bf5f66 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,6 +25,7 @@ export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableCustomElementPropertySupport = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
+export const diffInCommitPhase = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 7b0642bb989ec659c6c9891ea16daa0420caab4d
Author: Samuel Susla <samuel.susla@gmail.com>
Date:   Thu Apr 13 02:05:17 2023 +0100

    Remove revertRemovalOfSiblingPrerendering killswitch (#26549)
    
    removal of sibling prerendering has been rolled out at Meta. We can
    delete the flag now.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a958bf5f66..2a45a1969c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -39,12 +39,6 @@ export const enableSchedulingProfiler = __VARIANT__;
 // so we don't need to use __VARIANT__ to get extra coverage.
 export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
 
-// This flag only exists so it can be connected to a www GK that acts as a
-// killswitch. We don't run our tests against the `true` value because 1) it
-// affects too many tests 2) it shouldn't break anything. But it is mildly
-// risky, hence this extra precaution.
-export const revertRemovalOfSiblingPrerendering = false;
-
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.

commit cd2b79dedd6d81abb0b01d38396afa083feaf9e9
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Apr 19 13:33:11 2023 -0400

    Initial (client-only) async actions support (#26621)
    
    Implements initial (client-only) support for async actions behind a
    flag. This is an experimental feature and the design isn't completely
    finalized but we're getting closer. It will be layered alongside other
    features we're working on, so it may not feel complete when considered
    in isolation.
    
    The basic description is you can pass an async function to
    `startTransition` and all the transition updates that are scheduled
    inside that async function will be grouped together. The `isPending`
    flag will be set to true immediately, and only set back to false once
    the async action has completed (as well as all the updates that it
    triggers).
    
    The ideal behavior would be that all updates spawned by the async action
    are automatically inferred and grouped together; however, doing this
    properly requires the upcoming (stage 2) Async Context API, which is not
    yet implemented by browsers. In the meantime, we will fake this by
    grouping together all transition updates that occur until the async
    function has terminated. This can lead to overgrouping between unrelated
    actions, which is not wrong per se, just not ideal.
    
    If the `useTransition` hook is removed from the UI before an async
    action has completed — for example, if the user navigates to a new page
    — subsequent transitions will no longer be grouped with together with
    that action.
    
    Another consequence of the lack of Async Context is that if you call
    `setState` inside an action but after an `await`, it must be wrapped in
    `startTransition` in order to be grouped properly. If we didn't require
    this, then there would be no way to distinguish action updates from
    urgent updates caused by user input, too. This is an unfortunate footgun
    but we can likely detect the most common mistakes using a lint rule.
    
    Once Async Context lands in browsers, we can start warning in dev if we
    detect an update that hasn't been wrapped in `startTransition`. Then,
    longer term, once the feature is ubiquitous, we can rely on it for real
    and allow you to call `setState` without the additional wrapper.
    
    Things that are _not_ yet implemented in this PR, but will be added as
    follow ups:
    
    - Support for non-hook form of `startTransition`
    - Canceling the async action scope if the `useTransition` hook is
    deleted from the UI
    - Anything related to server actions

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 2a45a1969c..ad284d30c5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -26,6 +26,7 @@ export const enableTransitionTracing = __VARIANT__;
 export const enableCustomElementPropertySupport = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const diffInCommitPhase = __VARIANT__;
+export const enableAsyncActions = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit d73d7d59086218b0fa42d0a79c32a0365952650b
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Apr 20 14:23:22 2023 -0400

    Add `alwaysThrottleRetries` flag (#26685)
    
    This puts the change introduced by #26611 behind a flag until Meta is
    able to roll it out. Disabling the flag reverts back to the old
    behavior, where retries are throttled if there's still data remaining in
    the tree, but not if all the data has finished loading.
    
    The new behavior is still enabled in the public builds.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index ad284d30c5..827d1413b5 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -27,6 +27,7 @@ export const enableCustomElementPropertySupport = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const diffInCommitPhase = __VARIANT__;
 export const enableAsyncActions = __VARIANT__;
+export const alwaysThrottleRetries = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 018c58c9c65452cff25aaf1f38f78a9b90d8e5c1
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu Jun 1 09:24:56 2023 -0400

    Clean up enableSyncDefaultUpdates flag a bit (#26858)
    
    ## Overview
    
    Does a few things:
    - Renames `enableSyncDefaultUpdates` to
    `forceConcurrentByDefaultForTesting`
    - Changes the way it's used so it's dead-code eliminated separate from
    `allowConcurrentByDefault`
    - Deletes a bunch of the gated code
    
    The gates that are deleted are unnecessary now. We were keeping them
    when we originally thought we would come back to being concurrent by
    default. But we've shifted and now sync-by default is the desired
    behavior long term, so there's no need to keep all these forked tests
    around.
    
    I'll follow up to delete more of the forked behavior if possible.
    Ideally we wouldn't need this flag even if we're still using
    `allowConcurrentByDefault`.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 827d1413b5..58cfcdfff4 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -20,7 +20,7 @@ export const enableUseRefAccessWarning = __VARIANT__;
 export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
-export const enableSyncDefaultUpdates = __VARIANT__;
+export const forceConcurrentByDefaultForTesting = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableCustomElementPropertySupport = __VARIANT__;

commit 254cbdbd6d851a30bf3b649a6cb7c52786766fa4
Author: Tianyu Yao <skyyao@fb.com>
Date:   Wed Jun 21 11:14:57 2023 -0700

    Add a temporary internal option to disable double useEffect in legacy strict mode (#26914)
    
    <!--
      Thanks for submitting a pull request!
    We appreciate you spending the time to work on these changes. Please
    provide enough information so that others can review your pull request.
    The three fields below are mandatory.
    
    Before submitting a pull request, please make sure the following is
    done:
    
    1. Fork [the repository](https://github.com/facebook/react) and create
    your branch from `main`.
      2. Run `yarn` in the repository root.
    3. If you've fixed a bug or added code that should be tested, add tests!
    4. Ensure the test suite passes (`yarn test`). Tip: `yarn test --watch
    TestName` is helpful in development.
    5. Run `yarn test --prod` to test in the production environment. It
    supports the same options as `yarn test`.
    6. If you need a debugger, run `yarn test --debug --watch TestName`,
    open `chrome://inspect`, and press "Inspect".
    7. Format your code with
    [prettier](https://github.com/prettier/prettier) (`yarn prettier`).
    8. Make sure your code lints (`yarn lint`). Tip: `yarn linc` to only
    check changed files.
      9. Run the [Flow](https://flowtype.org/) type checks (`yarn flow`).
      10. If you haven't already, complete the CLA.
    
    Learn more about contributing:
    https://reactjs.org/docs/how-to-contribute.html
    -->
    
    ## Summary
    
    <!--
    Explain the **motivation** for making this change. What existing problem
    does the pull request solve?
    -->
    We are upgrading React 17 codebase to React18, and `StrictMode` has been
    great for surfacing potential production bugs on React18 for class
    components. There are non-trivial number of test failures caused by
    double `useEffect` in StrictMode. To prioritize surfacing and fixing
    issues that will break in production now, we need a flag to turn off
    double `useEffect` for now in StrictMode temporarily. This is a
    Meta-only hack for rolling out `createRoot` and we will fast follow to
    remove it and use full strict mode.
    
    ## How did you test this change?
    
    <!--
    Demonstrate the code is solid. Example: The exact commands you ran and
    their output, screenshots / videos if the pull request changes the user
    interface.
    How exactly did you verify that your PR solves the issue you wanted to
    solve?
      If you leave this empty, your PR will very likely be closed.
    -->
    jest

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 58cfcdfff4..a1197be405 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -28,6 +28,7 @@ export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const diffInCommitPhase = __VARIANT__;
 export const enableAsyncActions = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
+export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 7f6201889e8e628eeb53e05d8850ddffa3c2e74a
Author: Sophie Alpert <git@sophiebits.com>
Date:   Fri Sep 22 20:24:42 2023 -0700

    Ship diffInCommitPhase (#27409)
    
    Performance tests at Meta showed neutral results.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a1197be405..db3adeb56d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -25,7 +25,6 @@ export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableCustomElementPropertySupport = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
-export const diffInCommitPhase = __VARIANT__;
 export const enableAsyncActions = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;

commit be67db46b60d94f9fbefccf2523429af25873e5b
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Oct 10 16:39:02 2023 -0400

    Add optional initialValue argument to useDeferredValue (#27500)
    
    Adds a second argument to useDeferredValue called initialValue:
    
    ```js
    const value = useDeferredValue(finalValue, initialValue);
    ```
    
    During the initial render of a component, useDeferredValue will return
    initialValue. Once that render finishes, it will spawn an additional
    render to switch to finalValue.
    
    This same sequence should occur whenever the hook is hidden and revealed
    again, i.e. by a Suspense or Activity, though this part is not yet
    implemented.
    
    When initialValue is not provided, useDeferredValue has no effect during
    initial render, but during an update, it will remain on the previous
    value, then spawn an additional render to switch to the new value. (This
    is the same behavior that exists today.)
    
    During SSR, initialValue is always used, if provided.
    
    This feature is currently behind an experimental flag. We plan to ship
    it in a non-breaking release.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index db3adeb56d..1fb76bf4b3 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -28,6 +28,7 @@ export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableAsyncActions = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
+export const enableUseDeferredValueInitialArg = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 593ecee66a609d4a4c2b36b39b1e5e23b2456dd1
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Nov 14 10:15:17 2023 -0500

    Add a feature flag to enable expiration of retry lanes (#27694)
    
    An attempt to see if we can bring back expiration of retry lanes to
    avoid cases resolving Suspense can be starved by frequent updates.
    
    In the past, this caused increase browser crashes, but a lot of time has
    passed since then. Just trying if we can re-enable this.
    
    Old PR that reverted adding the timeout:
    https://github.com/facebook/react/pull/21300

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 1fb76bf4b3..b824c9ac83 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,6 +29,7 @@ export const enableAsyncActions = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
+export const enableRetryLaneExpiration = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 0cdfef19b96cc6202d48e0812b5069c286d12b04
Author: Jan Kassens <jkassens@meta.com>
Date:   Mon Dec 11 09:58:18 2023 -0500

    Add feature flags for expiration times (#27821)
    
    It seems worthwhile to me to run a test to experiment with different
    expiration times. This moves the expiration times for scheduler and
    reconciler into FeatureFlags for the facebook build. Non-facebook should
    not be affected by these changes.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b824c9ac83..74c0ab2f6f 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,7 +29,11 @@ export const enableAsyncActions = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
+
 export const enableRetryLaneExpiration = __VARIANT__;
+export const retryLaneExpirationMs = 5000;
+export const syncLaneExpirationMs = 250;
+export const transitionLaneExpirationMs = 5000;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 417188314dd1d6df54efc8cd6a0c5d4830615888
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Jan 30 14:24:41 2024 -0500

    Update www flags (#28150)
    
    Adds an experiment for `enableFormActions` and hardcodes
    `enableCustomElementPropertySupport` on www since this is shipped.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 74c0ab2f6f..775dced6d1 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -23,9 +23,9 @@ export const enableLazyContextPropagation = __VARIANT__;
 export const forceConcurrentByDefaultForTesting = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
-export const enableCustomElementPropertySupport = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableAsyncActions = __VARIANT__;
+export const enableFormActions = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;

commit d8c1fa6b0b8da0512cb5acab9cd4f242451392f3
Author: Jan Kassens <jkassens@meta.com>
Date:   Fri Feb 9 11:14:37 2024 -0500

    Add infinite update loop detection (#28279)
    
    This is a partial redo of https://github.com/facebook/react/pull/26625.
    Since that was unlanded due to some detected breakages. This now
    includes a feature flag to be careful in rolling this out.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 775dced6d1..9b15bddded 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -43,6 +43,8 @@ export const enableDebugTracing = __EXPERIMENTAL__;
 
 export const enableSchedulingProfiler = __VARIANT__;
 
+export const enableInfiniteRenderLoopDetection = __VARIANT__;
+
 // These are already tested in both modes using the build type dimension,
 // so we don't need to use __VARIANT__ to get extra coverage.
 export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;

commit 14fd9630ee04387f4361da289393234e2b7d93b6
Author: dan <dan.abramov@me.com>
Date:   Tue Feb 13 15:04:49 2024 +0000

    Switch <Context> to mean <Context.Provider> (#28226)
    
    Previously, `<Context>` was equivalent to `<Context.Consumer>`. However,
    since the introduction of Hooks, the `<Context.Consumer>` API is rarely
    used. The goal here is to make the common case cleaner:
    
    ```js
    const ThemeContext = createContext('light')
    
    function App() {
      return (
        <ThemeContext value="dark">
          ...
        </ThemeContext>
      )
    }
    
    function Button() {
      const theme = use(ThemeContext)
      // ...
    }
    ```
    
    This is technically a breaking change, but we've been warning about
    rendering `<Context>` directly for several years by now, so it's
    unlikely much code in the wild depends on the old behavior. [Proof that
    it warns today (check
    console).](https://codesandbox.io/p/sandbox/peaceful-nobel-pdxtfl)
    
    ---
    
    **The relevant commit is 5696782b428a5ace96e66c1857e13249b6c07958.** It
    switches `createContext` implementation so that `Context.Provider ===
    Context`.
    
    The main assumption that changed is that a Provider's fiber type is now
    the context itself (rather than an intermediate object). Whereas a
    Consumer's fiber type is now always an intermediate object (rather than
    it being sometimes the context itself and sometimes an intermediate
    object).
    
    My methodology was to start with the relevant symbols, work tags, and
    types, and work my way backwards to all usages.
    
    This might break tooling that depends on inspecting React's internal
    fields. I've added DevTools support in the second commit. This didn't
    need explicit versioning—the structure tells us enough.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 9b15bddded..cd073c6429 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,6 +29,7 @@ export const enableFormActions = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
+export const enableRenderableContext = __VARIANT__;
 
 export const enableRetryLaneExpiration = __VARIANT__;
 export const retryLaneExpirationMs = 5000;

commit 5d445b50a670d6cdc52943ca4e5ab3422792c57c
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Feb 13 11:48:56 2024 -0500

    Land enableAsyncActions enableFormActions in www (#28315)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index cd073c6429..a8c873d93b 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -24,8 +24,6 @@ export const forceConcurrentByDefaultForTesting = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
-export const enableAsyncActions = __VARIANT__;
-export const enableFormActions = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;

commit ef72271c2d1234c9d1e1358f8083021089a50faa
Author: Jack Pope <jackpope1@gmail.com>
Date:   Fri Feb 16 11:21:35 2024 -0500

    Add useModernStrictMode as dynamic flag on www (#28346)
    
    ## Summary
    
    Preparing modern strict mode rollout with dynamic feature flag
    
    ## How did you test this change?
    
    ![Screenshot 2024-02-15 at 10 09
    49 AM](https://github.com/facebook/react/assets/8965173/9e90efc2-3578-4e63-ae2c-63d4a4e194b3)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a8c873d93b..b97a52e52a 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -28,6 +28,7 @@ export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
+export const useModernStrictMode = __VARIANT__;
 
 export const enableRetryLaneExpiration = __VARIANT__;
 export const retryLaneExpirationMs = 5000;

commit aaf85f3af8c30252edaab5c24975cd086937b2a4
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu Feb 22 15:35:52 2024 -0500

    Make enableRefAsProp www dynamic (#28423)
    
    Going to start rolling this out

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b97a52e52a..463704d0b1 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,6 +29,7 @@ export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
+export const enableRefAsProp = __VARIANT__;
 
 export const enableRetryLaneExpiration = __VARIANT__;
 export const retryLaneExpirationMs = 5000;

commit 239d06e2b8b0f2dabd6bc154e5f24d594ac5840d
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Sun Feb 25 13:20:42 2024 -0500

    Make enableClientRenderFallbackOnText dynamic (#28436)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 463704d0b1..39fc234de2 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -30,7 +30,7 @@ export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
-
+export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;

commit 6c3b8dbfed6f879440f484bd0bf801fac67ec684
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Feb 26 10:08:47 2024 -0500

    Turn on enableRenderableContext for www (#28438)
    
    We can land for www now

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 39fc234de2..235fc6bbbb 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -27,7 +27,6 @@ export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
-export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;

commit d88fb321a3c5ccadb9d617364b6f50cb943765eb
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Feb 27 18:11:42 2024 -0500

    Move enableRenderableContext back to dynamic (#28466)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 235fc6bbbb..39fc234de2 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -27,6 +27,7 @@ export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
+export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;

commit 0d1ae5d753044fae99bc37a7815aa947447de3f8
Author: Noah Lemen <noah.lemen@gmail.com>
Date:   Mon Mar 11 11:37:17 2024 -0400

    cleanup enableProfilerNestedUpdateScheduledHook feature flag (#28509)
    
    ## Summary
    
    Looks like this was added years ago for instrumentation at meta that
    never ended up rolling out. Should be safe to clean up.
    
    ## How did you test this change?
    `yarn test`

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 39fc234de2..5219e1ed13 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -17,7 +17,6 @@ export const disableInputAttributeSyncing = __VARIANT__;
 export const disableIEWorkarounds = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
-export const enableProfilerNestedUpdateScheduledHook = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const forceConcurrentByDefaultForTesting = __VARIANT__;

commit 56e20051c3c1611f9495081d01f1946184332c6b
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Mar 11 11:40:48 2024 -0400

    Land enableClientRenderFallbackOnTextMismatch for www (#28538)
    
    This is landed, we can hardcode the flag

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 5219e1ed13..d3f28ec94c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,7 +29,6 @@ export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
-export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;

commit 89021fb4ec9aa82194b0788566e736a4cedfc0e4
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Mon Mar 11 17:17:07 2024 -0700

    Remove invokeGuardedCallback and replay trick (#28515)
    
    We broke the ability to "break on uncaught exceptions" by adding a
    try/catch higher up in the scheduling. We're giving up on fixing that so
    we can remove the replay trick inside an event handler.
    
    The issue with that approach is that we end up double logging a lot of
    errors in DEV since they get reported to the page.
    
    It's also a lot of complexity around this feature.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d3f28ec94c..7fa47bfe0e 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -44,10 +44,6 @@ export const enableSchedulingProfiler = __VARIANT__;
 
 export const enableInfiniteRenderLoopDetection = __VARIANT__;
 
-// These are already tested in both modes using the build type dimension,
-// so we don't need to use __VARIANT__ to get extra coverage.
-export const replayFailedUnitOfWorkWithInvokeGuardedCallback = __DEV__;
-
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.

commit 3e6bc7d2d7098d9c8a30ba6e7a877df70f4d8d34
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Mar 12 15:29:41 2024 -0400

    Revert "Land enableClientRenderFallbackOnTextMismatch for www" (#28548)
    
    We're looking to run further experiments on this.
    
    Reverts facebook/react#28538

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7fa47bfe0e..7343b8c1c4 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,6 +29,7 @@ export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
+export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;

commit a870b2d5494351d75b68c3d9baf03a52fd40a8ef
Author: Sebastian Silbermann <silbermann.sebastian@gmail.com>
Date:   Thu Mar 14 16:50:11 2024 +0100

    Make `enableNewBooleanProps` www dynamic (#28559)
    
    Feature: https://github.com/facebook/react/pull/24730

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7343b8c1c4..40e4e943aa 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -30,6 +30,7 @@ export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
 export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
+export const enableNewBooleanProps = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;

commit 0aab065eb3250a9714a62dc05587cbb571da7f71
Author: Timothy Yung <yungsters@meta.com>
Date:   Mon Mar 18 11:16:47 2024 -0700

    Add `alwaysThrottleDisappearingFallbacks` Flag (#28550)
    
    ## Summary
    
    Creates a new `alwaysThrottleDisappearingFallbacks` feature flag that
    gates the changes from https://github.com/facebook/react/pull/26802
    (instead of being controlled by `alwaysThrottleRetries`). The values of
    this new flag mirror the current values of `alwaysThrottleRetries` such
    that there is no behavior difference.
    
    This additional feature flag allows us to incrementally validate the
    change (arguably bug fix) from
    https://github.com/facebook/react/pull/26802 independently from
    `alwaysThrottleRetries`.
    
    ## How did you test this change?
    
    ```
    $ yarn test
    $ yarn flow dom-browser
    $ yarn flow dom-fb
    $ yarn flow fabric
    ```

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 40e4e943aa..f8ebfb050f 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -23,6 +23,7 @@ export const forceConcurrentByDefaultForTesting = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
+export const alwaysThrottleDisappearingFallbacks = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;

commit 5a75f9e78544fa6d052aff7fe99607e48f35b979
Author: Jan Kassens <jkassens@meta.com>
Date:   Mon Mar 25 13:48:22 2024 -0400

    Make enableBigIntSupport a dynamic flag for Meta (#28617)
    
    Make enableBigIntSupport a dynamic flag for Meta
    
    Should be an easy launch, but let's make this a dynamic flag to be safe.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index f8ebfb050f..32fd025104 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -15,6 +15,7 @@
 
 export const disableInputAttributeSyncing = __VARIANT__;
 export const disableIEWorkarounds = __VARIANT__;
+export const enableBigIntSupport = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;

commit 6fd0cb9a9feeccea2f70d993dc2d53f11cab0b5d
Author: Timothy Yung <yungsters@meta.com>
Date:   Tue Mar 26 10:01:38 2024 -0700

    Cleanup `alwaysThrottleDisappearingFallbacks` Flag (#28639)
    
    ## Summary
    
    After realizing that this feature flag is entangled with
    `alwaysThrottleRetries`, we're going to undo
    https://github.com/facebook/react/pull/28550
    
    ## How did you test this change?
    
    ```
    $ yarn test
    $ yarn flow dom-browser
    $ yarn flow dom-fb
    $ yarn flow fabric
    ```

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 32fd025104..89ef7fae08 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -24,7 +24,6 @@ export const forceConcurrentByDefaultForTesting = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
-export const alwaysThrottleDisappearingFallbacks = __VARIANT__;
 export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;

commit 84c84d72f11ff1961a103b3cd59919876e48f759
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Tue Mar 26 14:55:14 2024 -0700

    Remove enableClientRenderFallbackOnTextMismatch flag (#28458)
    
    Build on top of #28440.
    
    This lets us remove the path where updates are tracked on differences in
    text.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 89ef7fae08..9d5dccc464 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -30,7 +30,6 @@ export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
-export const enableClientRenderFallbackOnTextMismatch = __VARIANT__;
 export const enableNewBooleanProps = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const retryLaneExpirationMs = 5000;

commit 9f33f699e4f832971dc0f2047129f832655a3b6d
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Wed Mar 27 17:43:25 2024 -0400

    Dymanic favorSafetyOverHydrationPerf (#28663)
    
    For rollout

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 9d5dccc464..b542bbb10a 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -32,6 +32,7 @@ export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
 export const enableNewBooleanProps = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
+export const favorSafetyOverHydrationPerf = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;

commit 6cd6ba703de77e332ab201518b6e30e47cd49aaf
Author: Jack Pope <jackpope1@gmail.com>
Date:   Fri Mar 29 16:02:32 2024 -0400

    Land enableNewBooleanProps everywhere (#28676)
    
    Rolled out internally. Removing flag.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b542bbb10a..95b9927092 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -30,7 +30,6 @@ export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
 export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
-export const enableNewBooleanProps = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
 export const retryLaneExpirationMs = 5000;

commit 5ab97b73457e2da72749322a1925a970a967f3bc
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Apr 1 13:05:08 2024 -0400

    Land useModernStrictMode in www (#28696)
    
    this has landed

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 95b9927092..73c9c571c1 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -28,7 +28,6 @@ export const alwaysThrottleRetries = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
-export const useModernStrictMode = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;

commit 7659c4d9e0e4de2ec758c9a03ad7cbf07fc696d0
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Apr 2 10:57:23 2024 -0400

    Remove dynamic www flag for disableInputAttributeSyncing (#28703)
    
    Remove dynamic www flag for disableInputAttributeSyncing

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 73c9c571c1..1bada798e6 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -13,7 +13,6 @@
 // Use __VARIANT__ to simulate a GK. The tests will be run twice: once
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
-export const disableInputAttributeSyncing = __VARIANT__;
 export const disableIEWorkarounds = __VARIANT__;
 export const enableBigIntSupport = __VARIANT__;
 export const enableLegacyFBSupport = __VARIANT__;

commit ba5496d411a2d3067b5aae58b882aa2041807e77
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Apr 2 11:35:18 2024 -0400

    Hardcode enableLegacyFBSupport flag (#28701)
    
    Hardcode enableLegacyFBSupport flag

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 1bada798e6..552a588ad6 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -15,7 +15,6 @@
 
 export const disableIEWorkarounds = __VARIANT__;
 export const enableBigIntSupport = __VARIANT__;
-export const enableLegacyFBSupport = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;

commit 7a2609eedc571049a3272e60d5f7d84601ffca3f
Author: Jan Kassens <jkassens@meta.com>
Date:   Wed Apr 3 09:25:02 2024 -0400

    Cleanup enableBigIntSupport flag (#28711)
    
    Cleanup enableBigIntSupport flag

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 552a588ad6..96921a847d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -14,7 +14,6 @@
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
 export const disableIEWorkarounds = __VARIANT__;
-export const enableBigIntSupport = __VARIANT__;
 export const enableUseRefAccessWarning = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;

commit 20e710aeab3e03809c82d134171986ea270026a0
Author: Jan Kassens <jkassens@meta.com>
Date:   Wed Apr 3 13:35:38 2024 -0400

    Cleanup enableUseRefAccessWarning flag (#28699)
    
    Cleanup enableUseRefAccessWarning flag
    
    I don't think this flag has a path forward in the current
    implementation. The detection by stack trace is too brittle to detect
    the lazy initialization pattern reliably (see e.g. some internal tests
    that expect the warning because they use lazy intialization, but a
    slightly different pattern then the expected pattern.
    
    I think a new version of this could be to fully ban ref access during
    render with an alternative API for the exceptional cases that today
    require ref access during render.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 96921a847d..b7e953047e 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -14,7 +14,6 @@
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
 export const disableIEWorkarounds = __VARIANT__;
-export const enableUseRefAccessWarning = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const forceConcurrentByDefaultForTesting = __VARIANT__;

commit 48b4ecc9012638ed51b275aad24b2086b8215e32
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Apr 4 10:59:19 2024 -0400

    Remove defaultProps support (except for classes)  (#28733)
    
    This removes defaultProps support for all component types except for
    classes. We've chosen to continue supporting defaultProps for classes
    because lots of older code relies on it, and unlike function components,
    (which can use default params), there's no straightforward alternative.
    
    By implication, it also removes support for setting defaultProps on
    `React.lazy` wrapper. So this will not work:
    
    ```js
    const MyClassComponent = React.lazy(() => import('./MyClassComponent'));
    // MyClassComponent is not actually a class; it's a lazy wrapper. So
    // defaultProps does not work.
    MyClassComponent.defaultProps = { foo: 'bar' };
    ```
    
    However, if you set the default props on the class itself, then it's
    fine.
    
    For classes, this change also moves where defaultProps are resolved.
    Previously, defaultProps were resolved by the JSX runtime. This change
    is only observable if you introspect a JSX element, which is relatively
    rare but does happen.
    
    In other words, previously `<ClassWithDefaultProp />.props.aDefaultProp`
    would resolve to the default prop value, but now it does not.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b7e953047e..63f2d57ea4 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -27,6 +27,7 @@ export const enableRenderableContext = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
+export const disableDefaultPropsExceptForClasses = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;

commit 84cb3b4cb250bd592f4eb9495e66b50d33c8cd1e
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Wed Apr 10 11:14:33 2024 -0400

    Hardcode disableIEWorkarounds for www (#28811)
    
    This has landed and is true everywhere, but let's keep the flag until it
    lands in the stable release.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 63f2d57ea4..54202e8028 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -13,7 +13,6 @@
 // Use __VARIANT__ to simulate a GK. The tests will be run twice: once
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
-export const disableIEWorkarounds = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const forceConcurrentByDefaultForTesting = __VARIANT__;

commit ea26e38e33bffeba1ecc42688d7e8cd7e0da1c02
Author: Andrew Clark <git@andrewclark.io>
Date:   Fri Apr 19 19:30:01 2024 -0400

    [Experiment] Reuse memo cache after interruption (#28878)
    
    Adds an experimental feature flag to the implementation of useMemoCache,
    the internal cache used by the React Compiler (Forget).
    
    When enabled, instead of treating the cache as copy-on-write, like we do
    with fibers, we share the same cache instance across all render
    attempts, even if the component is interrupted before it commits.
    
    If an update is interrupted, either because it suspended or because of
    another update, we can reuse the memoized computations from the previous
    attempt. We can do this because the React Compiler performs atomic
    writes to the memo cache, i.e. it will not record the inputs to a
    memoization without also recording its output.
    
    This gives us a form of "resuming" within components and hooks.
    
    This only works when updating a component that already mounted. It has
    no impact during initial render, because the memo cache is stored on the
    fiber, and since we have not implemented resuming for fibers, it's
    always a fresh memo cache, anyway.
    
    However, this alone is pretty useful — it happens whenever you update
    the UI with fresh data after a mutation/action, which is extremely
    common in a Suspense-driven (e.g. RSC or Relay) app.
    
    So the impact of this feature is faster data mutations/actions (when the
    React Compiler is used).

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 54202e8028..af5071c47a 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -27,6 +27,7 @@ export const enableRefAsProp = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
 export const disableDefaultPropsExceptForClasses = __VARIANT__;
+export const enableNoCloningMemoCache = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;

commit 73bcdfbae57545aa8f88ecdf67426275610b5573
Author: Dmytro Rykun <dmitryrykun@meta.com>
Date:   Thu May 2 17:10:13 2024 +0100

    Introduce a faster version of the addProperties function (#28969)
    
    ## Summary
    
    This PR introduces a faster version of the `addProperties` function.
    This new function is basically the `diffProperties` with `prevProps` set
    to `null`, propagated constants, and all the unreachable code paths
    collapsed.
    
    ## How did you test this change?
    
    I've tested this change with [the benchmark
    app](https://github.com/react-native-community/RNNewArchitectureApp/tree/new-architecture-benchmarks)
    and got ~4.4% improvement in the view creation time.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index af5071c47a..d0b39d5abf 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -31,6 +31,7 @@ export const enableNoCloningMemoCache = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;
+export const enableAddPropertiesFastPath = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 1beb73de0f7c3261a0de37620453b102caaa6236
Author: Jack Pope <jackpope1@gmail.com>
Date:   Fri May 3 10:47:13 2024 -0400

    Add flag to test fast jsx (#28816)
    
    Following #28768, add a path to testing Fast JSX on www.
    
    We want to measure the impact of Fast JSX and enable a path to testing
    before string refs are completely removed in www (which is a work in
    progress).
    
    Without `disableStringRefs`, we need to copy any object with a `ref` key
    so we can pass it through `coerceStringRef()` and copy it into the
    object. This de-opt path is what is gated behind
    `enableFastJSXWithStringRefs`.
    
    The additional checks should have no perf impact in OSS as the flags
    remain true there and the build output is not changed. For www, I've
    benchmarked the addition of the boolean checks with values cached at
    module scope. There is no significant change observed from our
    benchmarks and any latency will apply to test and control branches
    evenly. This added experiment complexity is temporary. We should be able
    to clean it up, along with the flag checks for `enableRefAsProp` and
    `disableStringRefs` shortly.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d0b39d5abf..a7dbeac15d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -24,6 +24,7 @@ export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
 export const enableRefAsProp = __VARIANT__;
+export const enableFastJSX = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
 export const disableDefaultPropsExceptForClasses = __VARIANT__;

commit 217b2ccf160d7594a926d276a75c7312b299be4d
Author: Josh Story <story@hey.com>
Date:   Tue May 21 16:03:46 2024 -0700

    [Fiber] render boundary in fallback if it contains a new stylesheet during sync update (#28965)
    
    Updates Suspensey instances and resources to preload even during urgent
    updates and to potentially suspend.
    
    The current implementation is unchanged for transitions but for sync
    updates if there is a suspense boundary above the resource/instance it
    will be rendered in fallback mode instead.
    
    Note: This behavior is not what we want for images once we make them
    suspense enabled. We will need to have forked behavior here to
    distinguish between stylesheets which should never commit when not
    loaded and images which should commit after a small delay

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index a7dbeac15d..e57cf043ee 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -19,7 +19,7 @@ export const forceConcurrentByDefaultForTesting = __VARIANT__;
 export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
-export const alwaysThrottleRetries = __VARIANT__;
+export const alwaysThrottleRetries = true;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;

commit a26e90c29cfa841d3e2bc08876c5929d5680fb6d
Author: Jan Kassens <jkassens@meta.com>
Date:   Tue Jun 4 11:17:19 2024 -0400

    www: set enableRefAsProp to true (#29756)
    
    www: set enableRefAsProp to true

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e57cf043ee..7ad7c293f2 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -23,7 +23,6 @@ export const alwaysThrottleRetries = true;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
-export const enableRefAsProp = __VARIANT__;
 export const enableFastJSX = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;

commit 142b2a8230130ddf3de8a9c8e7799a291f4d1a97
Author: Jan Kassens <jkassens@meta.com>
Date:   Fri Jun 7 07:36:10 2024 -0400

    www: make disableLegacyMode dynamic flag (#29774)
    
    This makes the flag dynamic for Meta and turns it on for the www test
    renderer.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7ad7c293f2..4ec863c7bb 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -32,6 +32,7 @@ export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;
 export const enableAddPropertiesFastPath = __VARIANT__;
+export const disableLegacyMode = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit fb9a90fa480efce40ac2a845478817467f965ddc
Author: Jan Kassens <jkassens@meta.com>
Date:   Fri Jun 14 09:52:49 2024 -0400

    Set disableLegacyMode to true for www (#29871)
    
    Set disableLegacyMode to true for www

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 4ec863c7bb..7ad7c293f2 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -32,7 +32,6 @@ export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;
 export const enableAddPropertiesFastPath = __VARIANT__;
-export const disableLegacyMode = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit 88959fd54af7d418b799a9898b921f32a356b212
Author: Jan Kassens <jkassens@meta.com>
Date:   Fri Jun 14 15:27:32 2024 -0400

    Revert "Set disableLegacyMode to true for www" (#29901)
    
    Reverts facebook/react#29871
    
    Just temporarily while we're investigating something.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7ad7c293f2..4ec863c7bb 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -32,6 +32,7 @@ export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;
 export const enableAddPropertiesFastPath = __VARIANT__;
+export const disableLegacyMode = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit babe5a2f1be70f67a456c4a96db9163f4ea60503
Author: Jan Kassens <jkassens@meta.com>
Date:   Thu Jun 20 16:47:28 2024 -0400

    www: remove dynamic feature flag enableSchedulingProfiler (#29994)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 4ec863c7bb..c698b11b86 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -40,8 +40,6 @@ export const disableLegacyMode = __VARIANT__;
 // NOTE: This feature will only work in DEV mode; all callsites are wrapped with __DEV__.
 export const enableDebugTracing = __EXPERIMENTAL__;
 
-export const enableSchedulingProfiler = __VARIANT__;
-
 export const enableInfiniteRenderLoopDetection = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.

commit 6ab67c35f15bd0ebf93af8d48d4d0545e9bb9551
Author: Jan Kassens <jkassens@meta.com>
Date:   Thu Jun 20 17:17:25 2024 -0400

    Revert "www: remove dynamic feature flag enableSchedulingProfiler" (#29995)
    
    Reverts facebook/react#29994

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index c698b11b86..4ec863c7bb 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -40,6 +40,8 @@ export const disableLegacyMode = __VARIANT__;
 // NOTE: This feature will only work in DEV mode; all callsites are wrapped with __DEV__.
 export const enableDebugTracing = __EXPERIMENTAL__;
 
+export const enableSchedulingProfiler = __VARIANT__;
+
 export const enableInfiniteRenderLoopDetection = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.

commit c21bcd627b6a8f31548edfc149dd3b879fea6558
Author: Jack Pope <jackpope1@gmail.com>
Date:   Mon Jun 24 11:18:22 2024 -0400

    Clean up enableUnifiedSyncLane flag (#30062)
    
    `enableUnifiedSyncLane` now passes everywhere. Let's clean it up
    
    Implemented with https://github.com/facebook/react/pull/27646
    
    Flag enabled with https://github.com/facebook/react/pull/27646,
    https://github.com/facebook/react/pull/28269,
    https://github.com/facebook/react/pull/29052

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 4ec863c7bb..08f8041f25 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -16,7 +16,6 @@
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const forceConcurrentByDefaultForTesting = __VARIANT__;
-export const enableUnifiedSyncLane = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const alwaysThrottleRetries = true;

commit 89580f209ce68ae9e266e309dfeb1625b434fb58
Author: Jack Pope <jackpope1@gmail.com>
Date:   Mon Jun 24 12:28:39 2024 -0400

    Set renameElementSymbol to dynamic value (#30066)
    
    Prepare to roll this out with dynamic flag
    
    `yarn flags --diff www canary`
    
    <img width="514" alt="Screenshot 2024-06-24 at 11 33 55 AM"
    src="https://github.com/facebook/react/assets/8965173/31508fdc-4cb1-4ce0-8e22-c02a034377b0">

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 08f8041f25..07c50c7a3e 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -32,6 +32,7 @@ export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;
 export const enableAddPropertiesFastPath = __VARIANT__;
 export const disableLegacyMode = __VARIANT__;
+export const renameElementSymbol = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit fe9828954adcc51aa2bd21fe53d969a44dd3c9d2
Author: Jan Kassens <jkassens@meta.com>
Date:   Wed Jul 10 16:42:08 2024 -0400

    Experiment with using an object literal for Fiber creation (#28734)
    
    Object literals should be faster at least on React Native with Hermes as
    the JS engine.
    It might also be interesting to confirm the old comments in this file
    from years ago are even still valid. Creating an object from a literal
    should be a simpler operation.
    
    It's a bit unfortunate that this introduces a bunch of copied code, but
    since we rearely update the fields on fibers, this seems like an okay
    tradeoff for a hot code path. An alternative would be some sort of macro
    system, but that doesn't seem worth the extra complexity.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 07c50c7a3e..9c6e40b373 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -13,26 +13,27 @@
 // Use __VARIANT__ to simulate a GK. The tests will be run twice: once
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
+export const alwaysThrottleRetries = true;
+export const disableDefaultPropsExceptForClasses = __VARIANT__;
+export const disableLegacyMode = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const enableLazyContextPropagation = __VARIANT__;
-export const forceConcurrentByDefaultForTesting = __VARIANT__;
-export const enableTransitionTracing = __VARIANT__;
+export const enableAddPropertiesFastPath = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
-export const alwaysThrottleRetries = true;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
-export const enableUseDeferredValueInitialArg = __VARIANT__;
-export const enableRenderableContext = __VARIANT__;
 export const enableFastJSX = __VARIANT__;
+export const enableLazyContextPropagation = __VARIANT__;
+export const enableNoCloningMemoCache = __VARIANT__;
+export const enableObjectFiber = __VARIANT__;
+export const enableRenderableContext = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
+export const enableTransitionTracing = __VARIANT__;
+export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
-export const disableDefaultPropsExceptForClasses = __VARIANT__;
-export const enableNoCloningMemoCache = __VARIANT__;
+export const forceConcurrentByDefaultForTesting = __VARIANT__;
+export const renameElementSymbol = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;
-export const enableAddPropertiesFastPath = __VARIANT__;
-export const disableLegacyMode = __VARIANT__;
-export const renameElementSymbol = __VARIANT__;
 
 // Enable this flag to help with concurrent mode debugging.
 // It logs information to the console about React scheduling, rendering, and commit phases.

commit af28f480e8e74ce71bb33259b61fef8a5a228f74
Author: Jan Kassens <jkassens@meta.com>
Date:   Thu Jul 11 16:21:12 2024 -0400

    Feature flag to disable legacy context for function components (#30319)
    
    While the goal is to remove legacy context completely, I think we can
    already land the removal of legacy context for function components. I
    didn't even know this feature existed until reading the code recently.
    
    The win is just a couple of property lookups on function renders, but it
    trims down the API already as the full removal will likely still take a
    bit more time.
    
    www: Starting with enabled test renderer and a feature flag for
    production rollout.
    
    RN: Not enabled, will follow up on this.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 9c6e40b373..34a8ff82fa 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -15,6 +15,7 @@
 
 export const alwaysThrottleRetries = true;
 export const disableDefaultPropsExceptForClasses = __VARIANT__;
+export const disableLegacyContextForFunctionComponents = __VARIANT__;
 export const disableLegacyMode = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableAddPropertiesFastPath = __VARIANT__;

commit d025ddd3b954dfc52ad7e6a036913946a8ca2644
Author: Jan Kassens <jkassens@meta.com>
Date:   Mon Jul 22 11:50:35 2024 -0400

    Set enableFastJSX flag to true (#30343)
    
    When these to diffs are landed, we can merge this
    
    - [x] D59772879
    - [x] D59773043

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 34a8ff82fa..49814e0d9d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,7 +21,6 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableAddPropertiesFastPath = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
-export const enableFastJSX = __VARIANT__;
 export const enableLazyContextPropagation = __VARIANT__;
 export const enableNoCloningMemoCache = __VARIANT__;
 export const enableObjectFiber = __VARIANT__;

commit e902c45caf7ca67810d3e53748a549bdcc36063b
Author: Jack Pope <jackpope1@gmail.com>
Date:   Wed Jul 24 10:17:33 2024 -0400

    Remove forceConcurrentByDefaultForTesting flag (#30436)
    
    Concurrent by default has been unshipped! Let's clean it up.
    
    Here we remove `forceConcurrentByDefaultForTesting`, which allows us to
    run tests against both concurrent strategies. In the next PR, we'll
    remove the actual concurrent by default code path.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 49814e0d9d..faf87deb6e 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -29,7 +29,6 @@ export const enableRetryLaneExpiration = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
-export const forceConcurrentByDefaultForTesting = __VARIANT__;
 export const renameElementSymbol = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;

commit 397646ad5123de02486b08e34aba1a480f5af186
Author: Jack Pope <jackpope1@gmail.com>
Date:   Mon Jul 29 16:50:28 2024 -0400

    Update enableLazyContextPropagation flag (#30514)
    
    - Flag set to true for FB
    - Flag set to experimental for OSS

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index faf87deb6e..15e0cf3b3c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,7 +21,6 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableAddPropertiesFastPath = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
-export const enableLazyContextPropagation = __VARIANT__;
 export const enableNoCloningMemoCache = __VARIANT__;
 export const enableObjectFiber = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;

commit 65903583d2ab45aea45bdd23ed0b5dc214ff3c1c
Author: Jan Kassens <jkassens@meta.com>
Date:   Mon Aug 5 11:25:05 2024 -0400

    Remove flag enableUseDeferredValueInitialArg (#30595)
    
    This is enabled everywhere for a while and I don't think we'd be backing
    this out of 19. Seems like it's good to clean up to me.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 15e0cf3b3c..e2f2751f0c 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -26,7 +26,6 @@ export const enableObjectFiber = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;
 export const enableRetryLaneExpiration = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
-export const enableUseDeferredValueInitialArg = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
 export const renameElementSymbol = __VARIANT__;
 export const retryLaneExpirationMs = 5000;

commit eb3ad065a10e542eb501bcb7dba7f9617e8c363e
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Aug 22 10:17:19 2024 -0400

    Feature flag: enableSiblingPrerendering (#30761)
    
    Adds a new feature flag for an upcoming experiment.
    
    No implementation yet.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e2f2751f0c..d6e11f9264 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -41,6 +41,7 @@ export const enableDebugTracing = __EXPERIMENTAL__;
 export const enableSchedulingProfiler = __VARIANT__;
 
 export const enableInfiniteRenderLoopDetection = __VARIANT__;
+export const enableSiblingPrerendering = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these

commit d3d4d3a46b014ab0f6edc443c19fcdba09105f20
Author: Jan Kassens <jkassens@meta.com>
Date:   Fri Sep 13 13:18:14 2024 -0700

    Call cleanup of insertion effects when hidden (#30954)
    
    Insertion effects do not unmount when a subtree is removed while
    offscreen.
    
    Current behavior for an insertion effect is if the component goes
    
    - *visible -> removed:* calls insertion effect cleanup
    - *visible -> offscreen -> removed:* insertion effect cleanup is never
    called
    
    This makes it so we always call insertion effect cleanup when removing
    the component.
    
    Likely also fixes https://github.com/facebook/react/issues/26670
    
    ---------
    
    Co-authored-by: Rick Hanlon <rickhanlonii@fb.com>

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d6e11f9264..dbd00f671d 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,6 +21,7 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableAddPropertiesFastPath = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
+export const enableHiddenSubtreeInsertionEffectCleanup = __VARIANT__;
 export const enableNoCloningMemoCache = __VARIANT__;
 export const enableObjectFiber = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;

commit de43d560a8622fa44ba4162424437125564e906e
Author: Jan Kassens <jkassens@meta.com>
Date:   Wed Oct 9 16:46:35 2024 -0400

    [cleanup] remove flag enableAddPropertiesFastPath (#31062)
    
    The experiment was tested internally and rolled out, replacing the flag
    with `true`.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index dbd00f671d..8a82b7f552 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,7 +18,6 @@ export const disableDefaultPropsExceptForClasses = __VARIANT__;
 export const disableLegacyContextForFunctionComponents = __VARIANT__;
 export const disableLegacyMode = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const enableAddPropertiesFastPath = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableHiddenSubtreeInsertionEffectCleanup = __VARIANT__;

commit 5636fad840942cfea80301d91e931a50c6370d19
Author: Jan Kassens <jkassens@meta.com>
Date:   Thu Oct 10 18:12:47 2024 -0400

    [string-refs] log string ref from prod (#31161)
    
    If passed as a feature flag, this calls the configured function when a
    string ref is used even from prod code to find the last usages.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 8a82b7f552..3888339bff 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -21,6 +21,7 @@ export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableHiddenSubtreeInsertionEffectCleanup = __VARIANT__;
+export const enableLogStringRefsProd: null | ((string, string) => void) = null;
 export const enableNoCloningMemoCache = __VARIANT__;
 export const enableObjectFiber = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;

commit 75dd053b5e83e8ae20e9f771bca7b95dba4ff881
Author: Jan Kassens <jkassens@meta.com>
Date:   Mon Oct 14 10:13:40 2024 -0400

    [string-refs] make disableStringRefs a dynamic www flag (#31175)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 3888339bff..d4102efb06 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,6 +18,7 @@ export const disableDefaultPropsExceptForClasses = __VARIANT__;
 export const disableLegacyContextForFunctionComponents = __VARIANT__;
 export const disableLegacyMode = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
+export const disableStringRefs = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableHiddenSubtreeInsertionEffectCleanup = __VARIANT__;

commit d1f04722d617600cc6cd96dcebc1c2ef7affc904
Author: Jan Kassens <jkassens@meta.com>
Date:   Wed Nov 6 09:00:49 2024 -0500

    [string-refs] remove enableLogStringRefsProd flag (#31414)
    
    We no longer need this production logging.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d4102efb06..1c740f5211 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -22,7 +22,6 @@ export const disableStringRefs = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableHiddenSubtreeInsertionEffectCleanup = __VARIANT__;
-export const enableLogStringRefsProd: null | ((string, string) => void) = null;
 export const enableNoCloningMemoCache = __VARIANT__;
 export const enableObjectFiber = __VARIANT__;
 export const enableRenderableContext = __VARIANT__;

commit a7b83e7ceb3e0390e4ad4f9b417f21cb5a0ef17f
Author: Jan Kassens <jkassens@meta.com>
Date:   Wed Nov 6 12:13:43 2024 -0500

    [www] set disableStringRefs to true (#31438)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 1c740f5211..8a82b7f552 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -18,7 +18,6 @@ export const disableDefaultPropsExceptForClasses = __VARIANT__;
 export const disableLegacyContextForFunctionComponents = __VARIANT__;
 export const disableLegacyMode = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const disableStringRefs = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableHiddenSubtreeInsertionEffectCleanup = __VARIANT__;

commit 682a103cde99a3091850d1c27de8846b5d14e803
Author: Jan Kassens <jkassens@meta.com>
Date:   Thu Nov 7 09:05:31 2024 -0500

    [www] set disableLegacyMode to true (#31439)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 8a82b7f552..482ebb03c6 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -16,7 +16,6 @@
 export const alwaysThrottleRetries = true;
 export const disableDefaultPropsExceptForClasses = __VARIANT__;
 export const disableLegacyContextForFunctionComponents = __VARIANT__;
-export const disableLegacyMode = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
 export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;

commit 7dd6b9e68abed4f37a2dafb649294dafdfd26b63
Author: lauren <poteto@users.noreply.github.com>
Date:   Fri Nov 15 17:49:42 2024 -0500

    [crud] Add enableUseResourceEffectHook flag (#31556)
    
    Adds a new feature flag for `enableUseResourceEffectHook`.
    
    ---
    [//]: # (BEGIN SAPLING FOOTER)
    Stack created with [Sapling](https://sapling-scm.com). Best reviewed
    with [ReviewStack](https://reviewstack.dev/facebook/react/pull/31556).
    * #31523
    * #31557
    * __->__ #31556
    * #31555

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 482ebb03c6..db38e0e1fd 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -42,6 +42,8 @@ export const enableSchedulingProfiler = __VARIANT__;
 export const enableInfiniteRenderLoopDetection = __VARIANT__;
 export const enableSiblingPrerendering = __VARIANT__;
 
+export const enableUseResourceEffectHook = __VARIANT__;
+
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.

commit a4964987dc140526702e996223fe7ee293def8ac
Author: Noah Lemen <noahlemen@meta.com>
Date:   Wed Dec 11 12:00:25 2024 -0500

    Make enableOwnerStacks dynamic (#31661)
    
    following up on https://github.com/facebook/react/pull/31287, fixing
    tests
    
    ---------
    
    Co-authored-by: Rick Hanlon <rickhanlonii@fb.com>

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index db38e0e1fd..7c28c76fb1 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -27,6 +27,7 @@ export const enableRetryLaneExpiration = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
 export const renameElementSymbol = __VARIANT__;
+export const enableOwnerStacks = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;

commit 2d320563f35ad75419983f166431055b4e7ed9f6
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Sun Dec 15 12:16:10 2024 -0500

    [flags] Delete enableDebugTracing (#31780)
    
    This is unused, even in the one builds that uses it, and we don't plan
    on landing it in this form.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7c28c76fb1..69da420d04 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -32,12 +32,6 @@ export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;
 
-// Enable this flag to help with concurrent mode debugging.
-// It logs information to the console about React scheduling, rendering, and commit phases.
-//
-// NOTE: This feature will only work in DEV mode; all callsites are wrapped with __DEV__.
-export const enableDebugTracing = __EXPERIMENTAL__;
-
 export const enableSchedulingProfiler = __VARIANT__;
 
 export const enableInfiniteRenderLoopDetection = __VARIANT__;

commit 379089d28875f565a488ec169e84c78e87a1dc4d
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Wed Jan 8 12:03:01 2025 -0500

    [flags] remove enableDeferRootSchedulingToMicrotask (#32008)
    
    Wait for me to merge, but this has landed everywhere and is ready to
    remove.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 69da420d04..6c99d5e278 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -17,7 +17,6 @@ export const alwaysThrottleRetries = true;
 export const disableDefaultPropsExceptForClasses = __VARIANT__;
 export const disableLegacyContextForFunctionComponents = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;
-export const enableDeferRootSchedulingToMicrotask = __VARIANT__;
 export const enableDO_NOT_USE_disableStrictPassiveEffect = __VARIANT__;
 export const enableHiddenSubtreeInsertionEffectCleanup = __VARIANT__;
 export const enableNoCloningMemoCache = __VARIANT__;

commit 059760548feb9615fc651469d6380613a667b2c8
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Wed Jan 15 08:19:21 2025 -0600

    Flag to remove www console forks (#32058)
    
    Let's remove these

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 6c99d5e278..b75a0a9175 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -37,6 +37,7 @@ export const enableInfiniteRenderLoopDetection = __VARIANT__;
 export const enableSiblingPrerendering = __VARIANT__;
 
 export const enableUseResourceEffectHook = __VARIANT__;
+export const enableRemoveConsolePatches = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these

commit bb9a24d9fc5faa57a85750cd3bb94546baa405ac
Author: Dmytro Rykun <dmitryrykun@meta.com>
Date:   Thu Jan 30 11:16:42 2025 +0000

    Use fastAddProperties in diffing (#32243)
    
    ## Summary
    
    `fastAddProperties` has shown some perf benefits when used for creating
    props payload for new components. In this PR we'll try to use it for
    diffing props for existing components.
    
    It would be good enough if it simply doesn't regress perf. We'll be able
    to delete the old `addProperties`, and make `fastAddProperties` the
    default behaviour.
    
    ## How did you test this change?
    
    ```
    yarn lint
    yarn flow native
    yarn test packages/react-native-renderer -r=xplat --variant=false
    yarn test packages/react-native-renderer -r=xplat --variant=true
    ```

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index b75a0a9175..ca097b5a9e 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -38,6 +38,7 @@ export const enableSiblingPrerendering = __VARIANT__;
 
 export const enableUseResourceEffectHook = __VARIANT__;
 export const enableRemoveConsolePatches = __VARIANT__;
+export const enableFastAddPropertiesInDiffing = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these

commit 32b411496b92455cede3b286eb37c8b183989051
Author: Jack Pope <jackpope1@gmail.com>
Date:   Tue Feb 4 15:53:03 2025 -0500

    Set enableViewTransition to dynamic for www (#32306)
    
    Unblocks internal experimentation

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index ca097b5a9e..e6fd46d0b1 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -39,6 +39,7 @@ export const enableSiblingPrerendering = __VARIANT__;
 export const enableUseResourceEffectHook = __VARIANT__;
 export const enableRemoveConsolePatches = __VARIANT__;
 export const enableFastAddPropertiesInDiffing = __VARIANT__;
+export const enableViewTransition = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these

commit 0461c0d8a49730d1c8ebca2071d9bb7adfc8ac92
Author: lauren <poteto@users.noreply.github.com>
Date:   Tue Feb 11 14:05:50 2025 -0500

    [crud] Rename useResourceEffect flag (#32204)
    
    Rename the flag in preparation for the overload.
    ---
    [//]: # (BEGIN SAPLING FOOTER)
    Stack created with [Sapling](https://sapling-scm.com). Best reviewed
    with [ReviewStack](https://reviewstack.dev/facebook/react/pull/32204).
    * #32206
    * #32205
    * __->__ #32204

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e6fd46d0b1..3cab1318c4 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -36,7 +36,7 @@ export const enableSchedulingProfiler = __VARIANT__;
 export const enableInfiniteRenderLoopDetection = __VARIANT__;
 export const enableSiblingPrerendering = __VARIANT__;
 
-export const enableUseResourceEffectHook = __VARIANT__;
+export const enableUseEffectCRUDOverload = __VARIANT__;
 export const enableRemoveConsolePatches = __VARIANT__;
 export const enableFastAddPropertiesInDiffing = __VARIANT__;
 export const enableViewTransition = __VARIANT__;

commit f83903bfcc5a61811bd1b69b14f0ebbac4754462
Author: Rubén Norte <rubennorte@meta.com>
Date:   Wed Feb 12 13:52:57 2025 +0000

    [RN] Set up test to create public instances lazily in Fabric (#32363)
    
    ## Summary
    
    In React Native, public instances and internal host nodes are not
    represented by the same object (ReactNativeElement & shadow nodes vs.
    just DOM elements), and the only one that's required for rendering is
    the shadow node. Public instances are generally only necessary when
    accessed via refs or events, and that usually happens for a small amount
    of components in the tree.
    
    This implements an optimization to create the public instance on demand,
    instead of eagerly creating it when creating the host node. We expect
    this to improve performance by reducing the logic we do per node and the
    number of object allocations.
    
    ## How did you test this change?
    
    Manually synced the changes to React Native and run Fantom tests and
    benchmarks, with the flag enabled and disabled. All tests pass in both
    cases, and benchmarks show a slight but consistent performance
    improvement.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 3cab1318c4..d0b4404a3e 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -39,6 +39,7 @@ export const enableSiblingPrerendering = __VARIANT__;
 export const enableUseEffectCRUDOverload = __VARIANT__;
 export const enableRemoveConsolePatches = __VARIANT__;
 export const enableFastAddPropertiesInDiffing = __VARIANT__;
+export const enableLazyPublicInstanceInFabric = false;
 export const enableViewTransition = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.

commit 8a7b487e3b171c91f2fe18e9142af53f4dd83454
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Feb 18 10:29:40 2025 -0500

    [flags] enable owner stacks everywhere (#32376)
    
    this is now canary and on everywhere

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d0b4404a3e..e0f431fe7f 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -26,7 +26,6 @@ export const enableRetryLaneExpiration = __VARIANT__;
 export const enableTransitionTracing = __VARIANT__;
 export const favorSafetyOverHydrationPerf = __VARIANT__;
 export const renameElementSymbol = __VARIANT__;
-export const enableOwnerStacks = __VARIANT__;
 export const retryLaneExpirationMs = 5000;
 export const syncLaneExpirationMs = 250;
 export const transitionLaneExpirationMs = 5000;
@@ -37,7 +36,6 @@ export const enableInfiniteRenderLoopDetection = __VARIANT__;
 export const enableSiblingPrerendering = __VARIANT__;
 
 export const enableUseEffectCRUDOverload = __VARIANT__;
-export const enableRemoveConsolePatches = __VARIANT__;
 export const enableFastAddPropertiesInDiffing = __VARIANT__;
 export const enableLazyPublicInstanceInFabric = false;
 export const enableViewTransition = __VARIANT__;

commit d48c69246c9acd3b39c1eec4f3c12103e95cdd66
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Mar 4 11:55:34 2025 -0500

    [flags] make enableScrollEndPolyfill dynamic (#32517)
    
    Will roll this out in www

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index e0f431fe7f..eba6c45aba 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -39,6 +39,7 @@ export const enableUseEffectCRUDOverload = __VARIANT__;
 export const enableFastAddPropertiesInDiffing = __VARIANT__;
 export const enableLazyPublicInstanceInFabric = false;
 export const enableViewTransition = __VARIANT__;
+export const enableScrollEndPolyfill = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these

commit f9d78089c6ec8dce3a11cdf135d6d27b7a8dc1c5
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu Mar 6 14:00:12 2025 -0500

    [flags] make enableComponentPerformanceTrack dynamic (#32359)

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index eba6c45aba..3fe3b7a0a3 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -39,6 +39,7 @@ export const enableUseEffectCRUDOverload = __VARIANT__;
 export const enableFastAddPropertiesInDiffing = __VARIANT__;
 export const enableLazyPublicInstanceInFabric = false;
 export const enableViewTransition = __VARIANT__;
+export const enableComponentPerformanceTrack = __VARIANT__;
 export const enableScrollEndPolyfill = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.

commit 6aa8254bb7353fe3096289edc669cf168e9fd190
Author: Jack Pope <jackpope1@gmail.com>
Date:   Wed Mar 12 10:32:11 2025 -0400

    Add ref to Fragment (#32465)
    
    *This API is experimental and subject to change or removal.*
    
    This PR is an alternative to
    https://github.com/facebook/react/pull/32421 based on feedback:
    https://github.com/facebook/react/pull/32421#pullrequestreview-2625382015
    . The difference here is that we traverse from the Fragment's fiber at
    operation time instead of keeping a set of children on the
    `FragmentInstance`. We still need to handle newly added or removed child
    nodes to apply event listeners and observers, so we treat those updates
    as effects.
    
    **Fragment Refs**
    
    This PR extends React's Fragment component to accept a `ref` prop. The
    Fragment's ref will attach to a custom host instance, which will provide
    an Element-like API for working with the Fragment's host parent and host
    children.
    
    Here I've implemented `addEventListener`, `removeEventListener`, and
    `focus` to get started but we'll be iterating on this by adding
    additional APIs in future PRs. This sets up the mechanism to attach refs
    and perform operations on children. The FragmentInstance is implemented
    in `react-dom` here but is planned for Fabric as well.
    
    The API works by targeting the first level of host children and proxying
    Element-like APIs to allow developers to manage groups of elements or
    elements that cannot be easily accessed such as from a third-party
    library or deep in a tree of Functional Component wrappers.
    
    ```javascript
    import {Fragment, useRef} from 'react';
    
    const fragmentRef = useRef(null);
    
    <Fragment ref={fragmentRef}>
      <div id="A" />
      <Wrapper>
        <div id="B">
          <div id="C" />
        </div>
      </Wrapper>
      <div id="D" />
    </Fragment>
    ```
    
    In this case, calling `fragmentRef.current.addEventListener()` would
    apply an event listener to `A`, `B`, and `D`. `C` is skipped because it
    is nested under the first level of Host Component. If another Host
    Component was appended as a sibling to `A`, `B`, or `D`, the event
    listener would be applied to that element as well and any other APIs
    would also affect the newly added child.
    
    This is an implementation of the basic feature as a starting point for
    feedback and further iteration.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 3fe3b7a0a3..0116e160b6 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -41,6 +41,7 @@ export const enableLazyPublicInstanceInFabric = false;
 export const enableViewTransition = __VARIANT__;
 export const enableComponentPerformanceTrack = __VARIANT__;
 export const enableScrollEndPolyfill = __VARIANT__;
+export const enableFragmentRefs = __VARIANT__;
 
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these

commit 7943da1e81bb8730db78db99af5f967bdf213a75
Author: Jack Pope <jackpope1@gmail.com>
Date:   Thu Mar 20 14:28:55 2025 -0400

    Set accurate value for alwaysThrottleRetries on www (#32684)
    
    This flag value was updated in
    https://github.com/facebook/react/pull/28965 (seemingly unrelated, maybe
    as part of unit testing). But its still controlled by a dynamic flag in
    www. Let's update this to VARIANT to accurately represent the state of
    the rollout.
    
    Before:
    <img width="1340" alt="Screenshot 2025-03-20 at 10 45 30 AM"
    src="https://github.com/user-attachments/assets/d0405a36-eb71-4108-9e23-8d462cc68fb4"
    />
    
    After:
    <img width="1351" alt="Screenshot 2025-03-20 at 10 45 11 AM"
    src="https://github.com/user-attachments/assets/459d260d-7a25-430b-95a6-d6a91d958417"
    />

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 0116e160b6..d94a0c0ebd 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -13,7 +13,7 @@
 // Use __VARIANT__ to simulate a GK. The tests will be run twice: once
 // with the __VARIANT__ set to `true`, and once set to `false`.
 
-export const alwaysThrottleRetries = true;
+export const alwaysThrottleRetries = __VARIANT__;
 export const disableDefaultPropsExceptForClasses = __VARIANT__;
 export const disableLegacyContextForFunctionComponents = __VARIANT__;
 export const disableSchedulerTimeoutInWorkLoop = __VARIANT__;

commit 4a9df08157f001c01b078d259748512211233dcf
Author: Sebastian "Sebbie" Silbermann <sebastian.silbermann@vercel.com>
Date:   Sun Mar 23 15:47:03 2025 -0700

    Stop creating Owner Stacks if many have been created recently (#32529)
    
    Co-authored-by: Jack Pope <jackpope1@gmail.com>

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d94a0c0ebd..7cc0a0cded 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -43,6 +43,11 @@ export const enableComponentPerformanceTrack = __VARIANT__;
 export const enableScrollEndPolyfill = __VARIANT__;
 export const enableFragmentRefs = __VARIANT__;
 
+export const ownerStackLimit: number = __VARIANT__
+  ? // Some value that doesn't impact existing tests
+    500
+  : 1e4;
+
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.

commit f99c9feaf786fbdad0ad8d2d81196a247302dd3c
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Wed Mar 26 12:01:05 2025 -0400

    Fix ownerStackLimit feature gating for tests (#32726)
    
    https://github.com/facebook/react/pull/32529 added a dynamic flag for
    this, but that breaks tests since the flags are not defined everywhere.
    
    However, this is a static value and the flag is only for supporting
    existing tests. So we can override it in the test config, and make it
    static at built time instead.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index 7cc0a0cded..d94a0c0ebd 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -43,11 +43,6 @@ export const enableComponentPerformanceTrack = __VARIANT__;
 export const enableScrollEndPolyfill = __VARIANT__;
 export const enableFragmentRefs = __VARIANT__;
 
-export const ownerStackLimit: number = __VARIANT__
-  ? // Some value that doesn't impact existing tests
-    500
-  : 1e4;
-
 // TODO: These flags are hard-coded to the default values used in open source.
 // Update the tests so that they pass in either mode, then set these
 // to __VARIANT__.

commit 313332d111a2fba2db94c584334d8895e8d73c61
Author: lauren <poteto@users.noreply.github.com>
Date:   Wed Mar 26 12:04:57 2025 -0400

    [crud] Revert CRUD overload (#32741)
    
    Cleans up this experiment. After some internal experimentation we are
    deprioritizing this project for now and may revisit it at a later point.

diff --git a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
index d94a0c0ebd..46442874e7 100644
--- a/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
+++ b/packages/shared/forks/ReactFeatureFlags.www-dynamic.js
@@ -35,7 +35,6 @@ export const enableSchedulingProfiler = __VARIANT__;
 export const enableInfiniteRenderLoopDetection = __VARIANT__;
 export const enableSiblingPrerendering = __VARIANT__;
 
-export const enableUseEffectCRUDOverload = __VARIANT__;
 export const enableFastAddPropertiesInDiffing = __VARIANT__;
 export const enableLazyPublicInstanceInFabric = false;
 export const enableViewTransition = __VARIANT__;

</code></pre>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
        });
    </script>
</body>
</html>
    