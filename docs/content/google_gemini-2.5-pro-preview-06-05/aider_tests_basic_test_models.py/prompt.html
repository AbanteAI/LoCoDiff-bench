<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt: tests/basic/test_models.py - Gemini 2.5 Pro 06-05</title>
    <link rel="stylesheet" href="../../../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>
<body>
    <header>
        <h1>Prompt: tests/basic/test_models.py</h1>
        <h2>Model: Gemini 2.5 Pro 06-05</h2>
        <p><a href="../../../cases/google_gemini-2.5-pro-preview-06-05/aider_tests_basic_test_models.py.html">Back to Case</a> | <a href="../../../cases.html">All Cases</a> | <a href="../../../index.html">Home</a></p>
    </header>
    <main>
        <section>
            <h2>Prompt Content</h2>
            <pre><code class="language-plaintext"># Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- tests/basic/test_models.py

commit 896e79bcd10f61bfddc0aba9dfc5c5351391464e
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Jul 16 10:33:42 2024 +0100

    use pytest.ini testpaths to order testing

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
new file mode 100644
index 00000000..d46a721d
--- /dev/null
+++ b/tests/basic/test_models.py
@@ -0,0 +1,28 @@
+import unittest
+
+from aider.models import Model
+
+
+class TestModels(unittest.TestCase):
+    def test_max_context_tokens(self):
+        model = Model("gpt-3.5-turbo")
+        self.assertEqual(model.info["max_input_tokens"], 16385)
+
+        model = Model("gpt-3.5-turbo-16k")
+        self.assertEqual(model.info["max_input_tokens"], 16385)
+
+        model = Model("gpt-3.5-turbo-1106")
+        self.assertEqual(model.info["max_input_tokens"], 16385)
+
+        model = Model("gpt-4")
+        self.assertEqual(model.info["max_input_tokens"], 8 * 1024)
+
+        model = Model("gpt-4-32k")
+        self.assertEqual(model.info["max_input_tokens"], 32 * 1024)
+
+        model = Model("gpt-4-0613")
+        self.assertEqual(model.info["max_input_tokens"], 8 * 1024)
+
+
+if __name__ == "__main__":
+    unittest.main()

commit 8d532effc86c659211323f98e111714ed45811be
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 08:23:23 2024 -0700

    feat: Add tests for get_model_info function

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index d46a721d..51110d9d 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,6 +1,10 @@
 import unittest
+from unittest.mock import patch, mock_open
+import json
+import time
+from pathlib import Path
 
-from aider.models import Model
+from aider.models import Model, get_model_info
 
 
 class TestModels(unittest.TestCase):
@@ -23,6 +27,44 @@ class TestModels(unittest.TestCase):
         model = Model("gpt-4-0613")
         self.assertEqual(model.info["max_input_tokens"], 8 * 1024)
 
+    @patch('aider.models.litellm._lazy_module', False)
+    @patch('aider.models.Path.home')
+    @patch('aider.models.Path.stat')
+    @patch('aider.models.safe_read_json')
+    @patch('aider.models.safe_write_json')
+    @patch('aider.models.requests.get')
+    def test_get_model_info(self, mock_get, mock_write_json, mock_read_json, mock_stat, mock_home):
+        # Setup
+        mock_home.return_value = Path('/mock/home')
+        mock_stat.return_value.st_mtime = time.time() - 86400 * 2  # 2 days old
+
+        # Test case 1: Cache exists and is fresh
+        mock_read_json.return_value = {'test_model': {'info': 'cached'}}
+        mock_stat.return_value.st_mtime = time.time() - 3600  # 1 hour old
+        self.assertEqual(get_model_info('test_model'), {'info': 'cached'})
+
+        # Test case 2: Cache doesn't exist or is old, GitHub fetch succeeds
+        mock_read_json.return_value = None
+        mock_get.return_value.status_code = 200
+        mock_get.return_value.json.return_value = {'test_model': {'info': 'from_github'}}
+        self.assertEqual(get_model_info('test_model'), {'info': 'from_github'})
+
+        # Test case 3: Cache doesn't exist, GitHub fetch fails, fallback to local resource
+        mock_get.return_value.status_code = 404
+        with patch('importlib.resources.open_text') as mock_open_text:
+            mock_open_text.return_value.__enter__.return_value.read.return_value = json.dumps({'test_model': {'info': 'local_backup'}})
+            self.assertEqual(get_model_info('test_model'), {'info': 'local_backup'})
+
+        # Test case 4: All previous methods fail, fallback to litellm.get_model_info
+        mock_open_text.side_effect = Exception("Resource not found")
+        with patch('aider.models.litellm.get_model_info') as mock_litellm_get_model_info:
+            mock_litellm_get_model_info.return_value = {'info': 'from_litellm'}
+            self.assertEqual(get_model_info('test_model'), {'info': 'from_litellm'})
+
+        # Test case 5: Everything fails
+        mock_litellm_get_model_info.side_effect = Exception("LiteLLM failed")
+        self.assertEqual(get_model_info('test_model'), {})
+
 
 if __name__ == "__main__":
     unittest.main()

commit 69fcdd4a13af74716bd16ec4b9604e3e9e8ff892
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 08:23:26 2024 -0700

    style: Run linter

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 51110d9d..04102a78 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,8 +1,8 @@
-import unittest
-from unittest.mock import patch, mock_open
 import json
 import time
+import unittest
 from pathlib import Path
+from unittest.mock import mock_open, patch
 
 from aider.models import Model, get_model_info
 
@@ -27,43 +27,45 @@ class TestModels(unittest.TestCase):
         model = Model("gpt-4-0613")
         self.assertEqual(model.info["max_input_tokens"], 8 * 1024)
 
-    @patch('aider.models.litellm._lazy_module', False)
-    @patch('aider.models.Path.home')
-    @patch('aider.models.Path.stat')
-    @patch('aider.models.safe_read_json')
-    @patch('aider.models.safe_write_json')
-    @patch('aider.models.requests.get')
+    @patch("aider.models.litellm._lazy_module", False)
+    @patch("aider.models.Path.home")
+    @patch("aider.models.Path.stat")
+    @patch("aider.models.safe_read_json")
+    @patch("aider.models.safe_write_json")
+    @patch("aider.models.requests.get")
     def test_get_model_info(self, mock_get, mock_write_json, mock_read_json, mock_stat, mock_home):
         # Setup
-        mock_home.return_value = Path('/mock/home')
+        mock_home.return_value = Path("/mock/home")
         mock_stat.return_value.st_mtime = time.time() - 86400 * 2  # 2 days old
 
         # Test case 1: Cache exists and is fresh
-        mock_read_json.return_value = {'test_model': {'info': 'cached'}}
+        mock_read_json.return_value = {"test_model": {"info": "cached"}}
         mock_stat.return_value.st_mtime = time.time() - 3600  # 1 hour old
-        self.assertEqual(get_model_info('test_model'), {'info': 'cached'})
+        self.assertEqual(get_model_info("test_model"), {"info": "cached"})
 
         # Test case 2: Cache doesn't exist or is old, GitHub fetch succeeds
         mock_read_json.return_value = None
         mock_get.return_value.status_code = 200
-        mock_get.return_value.json.return_value = {'test_model': {'info': 'from_github'}}
-        self.assertEqual(get_model_info('test_model'), {'info': 'from_github'})
+        mock_get.return_value.json.return_value = {"test_model": {"info": "from_github"}}
+        self.assertEqual(get_model_info("test_model"), {"info": "from_github"})
 
         # Test case 3: Cache doesn't exist, GitHub fetch fails, fallback to local resource
         mock_get.return_value.status_code = 404
-        with patch('importlib.resources.open_text') as mock_open_text:
-            mock_open_text.return_value.__enter__.return_value.read.return_value = json.dumps({'test_model': {'info': 'local_backup'}})
-            self.assertEqual(get_model_info('test_model'), {'info': 'local_backup'})
+        with patch("importlib.resources.open_text") as mock_open_text:
+            mock_open_text.return_value.__enter__.return_value.read.return_value = json.dumps(
+                {"test_model": {"info": "local_backup"}}
+            )
+            self.assertEqual(get_model_info("test_model"), {"info": "local_backup"})
 
         # Test case 4: All previous methods fail, fallback to litellm.get_model_info
         mock_open_text.side_effect = Exception("Resource not found")
-        with patch('aider.models.litellm.get_model_info') as mock_litellm_get_model_info:
-            mock_litellm_get_model_info.return_value = {'info': 'from_litellm'}
-            self.assertEqual(get_model_info('test_model'), {'info': 'from_litellm'})
+        with patch("aider.models.litellm.get_model_info") as mock_litellm_get_model_info:
+            mock_litellm_get_model_info.return_value = {"info": "from_litellm"}
+            self.assertEqual(get_model_info("test_model"), {"info": "from_litellm"})
 
         # Test case 5: Everything fails
         mock_litellm_get_model_info.side_effect = Exception("LiteLLM failed")
-        self.assertEqual(get_model_info('test_model'), {})
+        self.assertEqual(get_model_info("test_model"), {})
 
 
 if __name__ == "__main__":

commit 27015c2c624cecbc327219a44a9794bdae3e65f7
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 08:24:11 2024 -0700

    fix: Patch `requests.get` directly in tests

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 04102a78..1ded9c1d 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -3,6 +3,7 @@ import time
 import unittest
 from pathlib import Path
 from unittest.mock import mock_open, patch
+import requests
 
 from aider.models import Model, get_model_info
 
@@ -32,7 +33,7 @@ class TestModels(unittest.TestCase):
     @patch("aider.models.Path.stat")
     @patch("aider.models.safe_read_json")
     @patch("aider.models.safe_write_json")
-    @patch("aider.models.requests.get")
+    @patch("requests.get")
     def test_get_model_info(self, mock_get, mock_write_json, mock_read_json, mock_stat, mock_home):
         # Setup
         mock_home.return_value = Path("/mock/home")

commit 6b0c98c799661631e4b1cecf24d613782a32fcc6
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 08:24:14 2024 -0700

    style: Fix linter issues in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 1ded9c1d..6c6fed1f 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -3,6 +3,7 @@ import time
 import unittest
 from pathlib import Path
 from unittest.mock import mock_open, patch
+
 import requests
 
 from aider.models import Model, get_model_info

commit 710484386a9a9343fb074c9391d85fae67a4f036
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 08:26:00 2024 -0700

    fix: Mock file system operations in test_get_model_info

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 6c6fed1f..11aaaeab 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -35,10 +35,12 @@ class TestModels(unittest.TestCase):
     @patch("aider.models.safe_read_json")
     @patch("aider.models.safe_write_json")
     @patch("requests.get")
-    def test_get_model_info(self, mock_get, mock_write_json, mock_read_json, mock_stat, mock_home):
+    @patch("aider.models.Path.mkdir")
+    def test_get_model_info(self, mock_mkdir, mock_get, mock_write_json, mock_read_json, mock_stat, mock_home):
         # Setup
         mock_home.return_value = Path("/mock/home")
-        mock_stat.return_value.st_mtime = time.time() - 86400 * 2  # 2 days old
+        mock_stat.return_value = unittest.mock.Mock(st_mtime=time.time() - 86400 * 2)  # 2 days old
+        mock_mkdir.return_value = None  # Ensure mkdir doesn't raise an exception
 
         # Test case 1: Cache exists and is fresh
         mock_read_json.return_value = {"test_model": {"info": "cached"}}

commit 7ef1b21a3f1084bd7c8dc62ed15ba451cdceb69e
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 08:26:03 2024 -0700

    chore: Run the linter

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 11aaaeab..3706a79e 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -36,7 +36,9 @@ class TestModels(unittest.TestCase):
     @patch("aider.models.safe_write_json")
     @patch("requests.get")
     @patch("aider.models.Path.mkdir")
-    def test_get_model_info(self, mock_mkdir, mock_get, mock_write_json, mock_read_json, mock_stat, mock_home):
+    def test_get_model_info(
+        self, mock_mkdir, mock_get, mock_write_json, mock_read_json, mock_stat, mock_home
+    ):
         # Setup
         mock_home.return_value = Path("/mock/home")
         mock_stat.return_value = unittest.mock.Mock(st_mtime=time.time() - 86400 * 2)  # 2 days old

commit b67914d74e31e31698fd988f7655511999813926
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Aug 25 09:39:26 2024 -0700

    fix: Improve model info caching and fallback logic

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 3706a79e..8b3da4af 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -29,49 +29,6 @@ class TestModels(unittest.TestCase):
         model = Model("gpt-4-0613")
         self.assertEqual(model.info["max_input_tokens"], 8 * 1024)
 
-    @patch("aider.models.litellm._lazy_module", False)
-    @patch("aider.models.Path.home")
-    @patch("aider.models.Path.stat")
-    @patch("aider.models.safe_read_json")
-    @patch("aider.models.safe_write_json")
-    @patch("requests.get")
-    @patch("aider.models.Path.mkdir")
-    def test_get_model_info(
-        self, mock_mkdir, mock_get, mock_write_json, mock_read_json, mock_stat, mock_home
-    ):
-        # Setup
-        mock_home.return_value = Path("/mock/home")
-        mock_stat.return_value = unittest.mock.Mock(st_mtime=time.time() - 86400 * 2)  # 2 days old
-        mock_mkdir.return_value = None  # Ensure mkdir doesn't raise an exception
-
-        # Test case 1: Cache exists and is fresh
-        mock_read_json.return_value = {"test_model": {"info": "cached"}}
-        mock_stat.return_value.st_mtime = time.time() - 3600  # 1 hour old
-        self.assertEqual(get_model_info("test_model"), {"info": "cached"})
-
-        # Test case 2: Cache doesn't exist or is old, GitHub fetch succeeds
-        mock_read_json.return_value = None
-        mock_get.return_value.status_code = 200
-        mock_get.return_value.json.return_value = {"test_model": {"info": "from_github"}}
-        self.assertEqual(get_model_info("test_model"), {"info": "from_github"})
-
-        # Test case 3: Cache doesn't exist, GitHub fetch fails, fallback to local resource
-        mock_get.return_value.status_code = 404
-        with patch("importlib.resources.open_text") as mock_open_text:
-            mock_open_text.return_value.__enter__.return_value.read.return_value = json.dumps(
-                {"test_model": {"info": "local_backup"}}
-            )
-            self.assertEqual(get_model_info("test_model"), {"info": "local_backup"})
-
-        # Test case 4: All previous methods fail, fallback to litellm.get_model_info
-        mock_open_text.side_effect = Exception("Resource not found")
-        with patch("aider.models.litellm.get_model_info") as mock_litellm_get_model_info:
-            mock_litellm_get_model_info.return_value = {"info": "from_litellm"}
-            self.assertEqual(get_model_info("test_model"), {"info": "from_litellm"})
-
-        # Test case 5: Everything fails
-        mock_litellm_get_model_info.side_effect = Exception("LiteLLM failed")
-        self.assertEqual(get_model_info("test_model"), {})
 
 
 if __name__ == "__main__":

commit 1edd046d0808f0533501d3dc3c47473d16dd7dee
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Aug 25 09:39:41 2024 -0700

    fix: Reduce max_input_tokens in test_models

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 8b3da4af..034e0461 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -30,6 +30,5 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.info["max_input_tokens"], 8 * 1024)
 
 
-
 if __name__ == "__main__":
     unittest.main()

commit cf3d7f7064794e75c647e20df8326cc69463210e
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 09:39:47 2024 -0700

    fix: Remove unused imports in tests/basic/test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 034e0461..d46a721d 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,12 +1,6 @@
-import json
-import time
 import unittest
-from pathlib import Path
-from unittest.mock import mock_open, patch
 
-import requests
-
-from aider.models import Model, get_model_info
+from aider.models import Model
 
 
 class TestModels(unittest.TestCase):

commit 4200c575f8ba8a05cd1cbd6d33f9952276e7dcc4
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 09:41:19 2024 -0700

    feat: add tests for `get_model_info`

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index d46a721d..a7638753 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,9 +1,63 @@
 import unittest
+from unittest.mock import patch
+import json
+from pathlib import Path
 
-from aider.models import Model
+from aider.models import Model, get_model_info
 
 
 class TestModels(unittest.TestCase):
+    @patch('aider.models.Path.home')
+    @patch('aider.models.time.time')
+    @patch('aider.models.Path.stat')
+    @patch('aider.models.Path.read_text')
+    def test_get_model_info_cached(self, mock_read_text, mock_stat, mock_time, mock_home):
+        # Setup mock
+        mock_home.return_value = Path('/mock/home')
+        mock_time.return_value = 1000000
+        mock_stat.return_value.st_mtime = 999999  # File modified 1 second ago
+        mock_read_text.return_value = json.dumps({"gpt-3.5-turbo": {"max_input_tokens": 16385}})
+
+        # Test
+        info = get_model_info("gpt-3.5-turbo")
+        self.assertEqual(info, {"max_input_tokens": 16385})
+
+    @patch('aider.models.Path.home')
+    @patch('aider.models.time.time')
+    @patch('aider.models.Path.stat')
+    @patch('aider.models.requests.get')
+    def test_get_model_info_fetch(self, mock_get, mock_stat, mock_time, mock_home):
+        # Setup mock
+        mock_home.return_value = Path('/mock/home')
+        mock_time.return_value = 1000000
+        mock_stat.return_value.st_mtime = 900000  # File modified a long time ago
+        mock_get.return_value.status_code = 200
+        mock_get.return_value.json.return_value = {"gpt-4": {"max_input_tokens": 8192}}
+
+        # Test
+        info = get_model_info("gpt-4")
+        self.assertEqual(info, {"max_input_tokens": 8192})
+
+    @patch('aider.models.Path.home')
+    @patch('aider.models.time.time')
+    @patch('aider.models.Path.stat')
+    @patch('aider.models.requests.get')
+    @patch('aider.models.litellm.get_model_info')
+    def test_get_model_info_fallback(self, mock_litellm, mock_get, mock_stat, mock_time, mock_home):
+        # Setup mock
+        mock_home.return_value = Path('/mock/home')
+        mock_time.return_value = 1000000
+        mock_stat.return_value.st_mtime = 900000  # File modified a long time ago
+        mock_get.return_value.status_code = 404  # Simulate failed request
+        mock_litellm.return_value = {"max_input_tokens": 4096}
+
+        # Test
+        info = get_model_info("unknown-model")
+        self.assertEqual(info, {"max_input_tokens": 4096})
+
+    def test_get_model_info_nonexistent(self):
+        info = get_model_info("non-existent-model")
+        self.assertEqual(info, {})
     def test_max_context_tokens(self):
         model = Model("gpt-3.5-turbo")
         self.assertEqual(model.info["max_input_tokens"], 16385)

commit 27f9b7a251c21d2888e33d9ae490a1a1bd953626
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Aug 25 09:54:43 2024 -0700

    fix: Remove unused imports and tests in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index a7638753..ec0fe1ff 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,63 +1,16 @@
-import unittest
-from unittest.mock import patch
 import json
+import unittest
 from pathlib import Path
+from unittest.mock import patch
 
 from aider.models import Model, get_model_info
 
 
 class TestModels(unittest.TestCase):
-    @patch('aider.models.Path.home')
-    @patch('aider.models.time.time')
-    @patch('aider.models.Path.stat')
-    @patch('aider.models.Path.read_text')
-    def test_get_model_info_cached(self, mock_read_text, mock_stat, mock_time, mock_home):
-        # Setup mock
-        mock_home.return_value = Path('/mock/home')
-        mock_time.return_value = 1000000
-        mock_stat.return_value.st_mtime = 999999  # File modified 1 second ago
-        mock_read_text.return_value = json.dumps({"gpt-3.5-turbo": {"max_input_tokens": 16385}})
-
-        # Test
-        info = get_model_info("gpt-3.5-turbo")
-        self.assertEqual(info, {"max_input_tokens": 16385})
-
-    @patch('aider.models.Path.home')
-    @patch('aider.models.time.time')
-    @patch('aider.models.Path.stat')
-    @patch('aider.models.requests.get')
-    def test_get_model_info_fetch(self, mock_get, mock_stat, mock_time, mock_home):
-        # Setup mock
-        mock_home.return_value = Path('/mock/home')
-        mock_time.return_value = 1000000
-        mock_stat.return_value.st_mtime = 900000  # File modified a long time ago
-        mock_get.return_value.status_code = 200
-        mock_get.return_value.json.return_value = {"gpt-4": {"max_input_tokens": 8192}}
-
-        # Test
-        info = get_model_info("gpt-4")
-        self.assertEqual(info, {"max_input_tokens": 8192})
-
-    @patch('aider.models.Path.home')
-    @patch('aider.models.time.time')
-    @patch('aider.models.Path.stat')
-    @patch('aider.models.requests.get')
-    @patch('aider.models.litellm.get_model_info')
-    def test_get_model_info_fallback(self, mock_litellm, mock_get, mock_stat, mock_time, mock_home):
-        # Setup mock
-        mock_home.return_value = Path('/mock/home')
-        mock_time.return_value = 1000000
-        mock_stat.return_value.st_mtime = 900000  # File modified a long time ago
-        mock_get.return_value.status_code = 404  # Simulate failed request
-        mock_litellm.return_value = {"max_input_tokens": 4096}
-
-        # Test
-        info = get_model_info("unknown-model")
-        self.assertEqual(info, {"max_input_tokens": 4096})
-
     def test_get_model_info_nonexistent(self):
         info = get_model_info("non-existent-model")
         self.assertEqual(info, {})
+
     def test_max_context_tokens(self):
         model = Model("gpt-3.5-turbo")
         self.assertEqual(model.info["max_input_tokens"], 16385)

commit 2849c8bf78b59e7d5aa0198f287e36bfae928702
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Sun Aug 25 09:54:49 2024 -0700

    fix: Remove unused imports in tests/basic/test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index ec0fe1ff..7022fa0e 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,7 +1,4 @@
-import json
 import unittest
-from pathlib import Path
-from unittest.mock import patch
 
 from aider.models import Model, get_model_info
 

commit abf19a61cf8f16a5478c5be6e5114c0a7ed47d20
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Aug 26 14:42:24 2024 -0700

    feat: Add tests for sanity_check_model function

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 7022fa0e..1cc31771 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,6 +1,8 @@
 import unittest
+from unittest.mock import patch, MagicMock
+import os
 
-from aider.models import Model, get_model_info
+from aider.models import Model, get_model_info, sanity_check_model
 
 
 class TestModels(unittest.TestCase):
@@ -27,6 +29,40 @@ class TestModels(unittest.TestCase):
         model = Model("gpt-4-0613")
         self.assertEqual(model.info["max_input_tokens"], 8 * 1024)
 
+    @patch('os.environ')
+    def test_sanity_check_model_all_set(self, mock_environ):
+        mock_environ.get.return_value = "dummy_value"
+        mock_io = MagicMock()
+        model = MagicMock()
+        model.name = "test-model"
+        model.missing_keys = ["API_KEY1", "API_KEY2"]
+        model.keys_in_environment = True
+        model.info = {"some": "info"}
+
+        sanity_check_model(mock_io, model)
+
+        mock_io.tool_error.assert_called_once_with("Model test-model: Environment variables status:")
+        calls = mock_io.tool_error.call_args_list
+        self.assertIn("- API_KEY1: ✓ Set", str(calls))
+        self.assertIn("- API_KEY2: ✓ Set", str(calls))
+
+    @patch('os.environ')
+    def test_sanity_check_model_not_set(self, mock_environ):
+        mock_environ.get.return_value = ""
+        mock_io = MagicMock()
+        model = MagicMock()
+        model.name = "test-model"
+        model.missing_keys = ["API_KEY1", "API_KEY2"]
+        model.keys_in_environment = True
+        model.info = {"some": "info"}
+
+        sanity_check_model(mock_io, model)
+
+        mock_io.tool_error.assert_called_once_with("Model test-model: Environment variables status:")
+        calls = mock_io.tool_error.call_args_list
+        self.assertIn("- API_KEY1: ✗ Not set", str(calls))
+        self.assertIn("- API_KEY2: ✗ Not set", str(calls))
+
 
 if __name__ == "__main__":
     unittest.main()

commit f74fa16e4addd2b1bdab757f28b3bbf693007dea
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Aug 26 14:42:26 2024 -0700

    style: Fix import order in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 1cc31771..446e9558 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,6 +1,6 @@
-import unittest
-from unittest.mock import patch, MagicMock
 import os
+import unittest
+from unittest.mock import MagicMock, patch
 
 from aider.models import Model, get_model_info, sanity_check_model
 
@@ -29,7 +29,7 @@ class TestModels(unittest.TestCase):
         model = Model("gpt-4-0613")
         self.assertEqual(model.info["max_input_tokens"], 8 * 1024)
 
-    @patch('os.environ')
+    @patch("os.environ")
     def test_sanity_check_model_all_set(self, mock_environ):
         mock_environ.get.return_value = "dummy_value"
         mock_io = MagicMock()
@@ -41,12 +41,14 @@ class TestModels(unittest.TestCase):
 
         sanity_check_model(mock_io, model)
 
-        mock_io.tool_error.assert_called_once_with("Model test-model: Environment variables status:")
+        mock_io.tool_error.assert_called_once_with(
+            "Model test-model: Environment variables status:"
+        )
         calls = mock_io.tool_error.call_args_list
         self.assertIn("- API_KEY1: ✓ Set", str(calls))
         self.assertIn("- API_KEY2: ✓ Set", str(calls))
 
-    @patch('os.environ')
+    @patch("os.environ")
     def test_sanity_check_model_not_set(self, mock_environ):
         mock_environ.get.return_value = ""
         mock_io = MagicMock()
@@ -58,7 +60,9 @@ class TestModels(unittest.TestCase):
 
         sanity_check_model(mock_io, model)
 
-        mock_io.tool_error.assert_called_once_with("Model test-model: Environment variables status:")
+        mock_io.tool_error.assert_called_once_with(
+            "Model test-model: Environment variables status:"
+        )
         calls = mock_io.tool_error.call_args_list
         self.assertIn("- API_KEY1: ✗ Not set", str(calls))
         self.assertIn("- API_KEY2: ✗ Not set", str(calls))

commit fefe6f742417b0e1057679cfb0292820f74f5633
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Aug 26 14:43:00 2024 -0700

    fix: Remove unused import statement in tests/basic/test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 446e9558..040647ea 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,4 +1,3 @@
-import os
 import unittest
 from unittest.mock import MagicMock, patch
 

commit 0a05f7efd7d7ea40e6aac110e787ed095017f4de
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Aug 26 14:43:42 2024 -0700

    fix: Ensure tool_error is called at least once in tests

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 040647ea..2ba0a77a 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -40,10 +40,9 @@ class TestModels(unittest.TestCase):
 
         sanity_check_model(mock_io, model)
 
-        mock_io.tool_error.assert_called_once_with(
-            "Model test-model: Environment variables status:"
-        )
+        mock_io.tool_error.assert_called()
         calls = mock_io.tool_error.call_args_list
+        self.assertIn("Model test-model: Environment variables status:", str(calls))
         self.assertIn("- API_KEY1: ✓ Set", str(calls))
         self.assertIn("- API_KEY2: ✓ Set", str(calls))
 
@@ -59,10 +58,9 @@ class TestModels(unittest.TestCase):
 
         sanity_check_model(mock_io, model)
 
-        mock_io.tool_error.assert_called_once_with(
-            "Model test-model: Environment variables status:"
-        )
+        mock_io.tool_error.assert_called()
         calls = mock_io.tool_error.call_args_list
+        self.assertIn("Model test-model: Environment variables status:", str(calls))
         self.assertIn("- API_KEY1: ✗ Not set", str(calls))
         self.assertIn("- API_KEY2: ✗ Not set", str(calls))
 

commit 5481d4385ef61e1c58b635533d5e06b7a11d59ab
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Aug 26 14:44:18 2024 -0700

    fix: Remove redundant assertion from test cases

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 2ba0a77a..02539841 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -42,7 +42,6 @@ class TestModels(unittest.TestCase):
 
         mock_io.tool_error.assert_called()
         calls = mock_io.tool_error.call_args_list
-        self.assertIn("Model test-model: Environment variables status:", str(calls))
         self.assertIn("- API_KEY1: ✓ Set", str(calls))
         self.assertIn("- API_KEY2: ✓ Set", str(calls))
 
@@ -60,7 +59,6 @@ class TestModels(unittest.TestCase):
 
         mock_io.tool_error.assert_called()
         calls = mock_io.tool_error.call_args_list
-        self.assertIn("Model test-model: Environment variables status:", str(calls))
         self.assertIn("- API_KEY1: ✗ Not set", str(calls))
         self.assertIn("- API_KEY2: ✗ Not set", str(calls))
 

commit d8c78cf8cdb25a49fa6b223d2fd9401f491473c1
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Sep 3 13:50:10 2024 -0700

    test: update sanity_check_model tests to use tool_warning

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 02539841..af6e7081 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -40,8 +40,8 @@ class TestModels(unittest.TestCase):
 
         sanity_check_model(mock_io, model)
 
-        mock_io.tool_error.assert_called()
-        calls = mock_io.tool_error.call_args_list
+        mock_io.tool_warning.assert_called()
+        calls = mock_io.tool_warning.call_args_list
         self.assertIn("- API_KEY1: ✓ Set", str(calls))
         self.assertIn("- API_KEY2: ✓ Set", str(calls))
 
@@ -57,8 +57,8 @@ class TestModels(unittest.TestCase):
 
         sanity_check_model(mock_io, model)
 
-        mock_io.tool_error.assert_called()
-        calls = mock_io.tool_error.call_args_list
+        mock_io.tool_warning.assert_called()
+        calls = mock_io.tool_warning.call_args_list
         self.assertIn("- API_KEY1: ✗ Not set", str(calls))
         self.assertIn("- API_KEY2: ✗ Not set", str(calls))
 

commit 98835d1f6d7266cbcfad78f4898ebd190eb8a85f
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Sep 3 17:21:06 2024 -0700

    test: update sanity check tests to use tool_output instead of tool_warning

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index af6e7081..0cac3fdd 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -40,8 +40,8 @@ class TestModels(unittest.TestCase):
 
         sanity_check_model(mock_io, model)
 
-        mock_io.tool_warning.assert_called()
-        calls = mock_io.tool_warning.call_args_list
+        mock_io.tool_output.assert_called()
+        calls = mock_io.tool_output.call_args_list
         self.assertIn("- API_KEY1: ✓ Set", str(calls))
         self.assertIn("- API_KEY2: ✓ Set", str(calls))
 
@@ -57,8 +57,8 @@ class TestModels(unittest.TestCase):
 
         sanity_check_model(mock_io, model)
 
-        mock_io.tool_warning.assert_called()
-        calls = mock_io.tool_warning.call_args_list
+        mock_io.tool_output.assert_called()
+        calls = mock_io.tool_output.call_args_list
         self.assertIn("- API_KEY1: ✗ Not set", str(calls))
         self.assertIn("- API_KEY2: ✗ Not set", str(calls))
 

commit 924eeb43de2f1b0a673fd3fb0a0b55968437d7d2
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Sep 23 11:34:49 2024 -0700

    fix: Update test assertions for API key checks

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 0cac3fdd..330fa79a 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -42,8 +42,8 @@ class TestModels(unittest.TestCase):
 
         mock_io.tool_output.assert_called()
         calls = mock_io.tool_output.call_args_list
-        self.assertIn("- API_KEY1: ✓ Set", str(calls))
-        self.assertIn("- API_KEY2: ✓ Set", str(calls))
+        self.assertIn("- API_KEY1: Set", str(calls))
+        self.assertIn("- API_KEY2: Set", str(calls))
 
     @patch("os.environ")
     def test_sanity_check_model_not_set(self, mock_environ):
@@ -59,8 +59,8 @@ class TestModels(unittest.TestCase):
 
         mock_io.tool_output.assert_called()
         calls = mock_io.tool_output.call_args_list
-        self.assertIn("- API_KEY1: ✗ Not set", str(calls))
-        self.assertIn("- API_KEY2: ✗ Not set", str(calls))
+        self.assertIn("- API_KEY1: Not set", str(calls))
+        self.assertIn("- API_KEY2: Not set", str(calls))
 
 
 if __name__ == "__main__":

commit 433223a7fc377f4536e31ef3779e57745f51606b
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:15:05 2024 -0700

    test: add sanity check for bogus editor model

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 330fa79a..6c3d99a9 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,7 +1,7 @@
 import unittest
 from unittest.mock import MagicMock, patch
 
-from aider.models import Model, get_model_info, sanity_check_model
+from aider.models import Model, get_model_info, sanity_check_model, sanity_check_models
 
 
 class TestModels(unittest.TestCase):
@@ -62,6 +62,24 @@ class TestModels(unittest.TestCase):
         self.assertIn("- API_KEY1: Not set", str(calls))
         self.assertIn("- API_KEY2: Not set", str(calls))
 
+    @patch("aider.models.sanity_check_model")
+    def test_sanity_check_models_bogus_editor(self, mock_sanity_check_model):
+        mock_io = MagicMock()
+        main_model = MagicMock()
+        main_model.name = "gpt-4"
+        main_model.weak_model = None
+        main_model.editor_model = MagicMock()
+        main_model.editor_model.name = "bogus-model"
+
+        # Set up mock to return False for main model and True (problem) for editor model
+        mock_sanity_check_model.side_effect = [False, True]
+
+        result = models.sanity_check_models(mock_io, main_model)
+
+        self.assertTrue(result)  # Should return True because there's a problem with the editor model
+        mock_sanity_check_model.assert_called_with(mock_io, main_model.editor_model)
+        mock_io.tool_warning.assert_called_once()  # Ensure a warning was issued
+
 
 if __name__ == "__main__":
     unittest.main()

commit 7e55a8f68486c79b0bb2c83361aa8c0d26026789
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:15:09 2024 -0700

    style: Format code in test_models.py to improve readability

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 6c3d99a9..efb9bacd 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -76,7 +76,9 @@ class TestModels(unittest.TestCase):
 
         result = models.sanity_check_models(mock_io, main_model)
 
-        self.assertTrue(result)  # Should return True because there's a problem with the editor model
+        self.assertTrue(
+            result
+        )  # Should return True because there's a problem with the editor model
         mock_sanity_check_model.assert_called_with(mock_io, main_model.editor_model)
         mock_io.tool_warning.assert_called_once()  # Ensure a warning was issued
 

commit 93cb615ffde4af2c868acb84d85b57a8acf1ff6a
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:15:27 2024 -0700

    test: add test for sanity check with bogus editor model

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index efb9bacd..397b3148 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,7 +1,7 @@
 import unittest
 from unittest.mock import MagicMock, patch
 
-from aider.models import Model, get_model_info, sanity_check_model, sanity_check_models
+from aider.models import Model, get_model_info, sanity_check_model
 
 
 class TestModels(unittest.TestCase):
@@ -74,7 +74,7 @@ class TestModels(unittest.TestCase):
         # Set up mock to return False for main model and True (problem) for editor model
         mock_sanity_check_model.side_effect = [False, True]
 
-        result = models.sanity_check_models(mock_io, main_model)
+        result = sanity_check_models(mock_io, main_model)
 
         self.assertTrue(
             result

commit da9af264f8900014b53a83be3f5fa0f1937ab1d6
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:17:53 2024 -0700

    fix: import sanity_check_models in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 397b3148..4ad4cafb 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,7 +1,7 @@
 import unittest
 from unittest.mock import MagicMock, patch
 
-from aider.models import Model, get_model_info, sanity_check_model
+from aider.models import Model, get_model_info, sanity_check_model, sanity_check_models
 
 
 class TestModels(unittest.TestCase):

commit 1a3e8b337543009fae012ace270c0a07b41d2152
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:19:22 2024 -0700

    test: update sanity check test to use real Model instances

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 4ad4cafb..531a317c 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -62,25 +62,17 @@ class TestModels(unittest.TestCase):
         self.assertIn("- API_KEY1: Not set", str(calls))
         self.assertIn("- API_KEY2: Not set", str(calls))
 
-    @patch("aider.models.sanity_check_model")
-    def test_sanity_check_models_bogus_editor(self, mock_sanity_check_model):
+    def test_sanity_check_models_bogus_editor(self):
         mock_io = MagicMock()
-        main_model = MagicMock()
-        main_model.name = "gpt-4"
-        main_model.weak_model = None
-        main_model.editor_model = MagicMock()
-        main_model.editor_model.name = "bogus-model"
+        main_model = models.Model("gpt-4")
+        main_model.editor_model = models.Model("bogus-model")
 
-        # Set up mock to return False for main model and True (problem) for editor model
-        mock_sanity_check_model.side_effect = [False, True]
+        result = models.sanity_check_models(mock_io, main_model)
 
-        result = sanity_check_models(mock_io, main_model)
-
-        self.assertTrue(
-            result
-        )  # Should return True because there's a problem with the editor model
-        mock_sanity_check_model.assert_called_with(mock_io, main_model.editor_model)
+        self.assertTrue(result)  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_once()  # Ensure a warning was issued
+        warning_message = mock_io.tool_warning.call_args[0][0]
+        self.assertIn("bogus-model", warning_message)  # Check that the warning mentions the bogus model
 
 
 if __name__ == "__main__":

commit 1a355cbf7478da3b29313a41d1c65f5154f79add
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:19:25 2024 -0700

    style: format code in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 531a317c..bef05c01 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -69,10 +69,14 @@ class TestModels(unittest.TestCase):
 
         result = models.sanity_check_models(mock_io, main_model)
 
-        self.assertTrue(result)  # Should return True because there's a problem with the editor model
+        self.assertTrue(
+            result
+        )  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_once()  # Ensure a warning was issued
         warning_message = mock_io.tool_warning.call_args[0][0]
-        self.assertIn("bogus-model", warning_message)  # Check that the warning mentions the bogus model
+        self.assertIn(
+            "bogus-model", warning_message
+        )  # Check that the warning mentions the bogus model
 
 
 if __name__ == "__main__":

commit 21adf405a04695526de309362d41ad8e09ba09a6
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:19:38 2024 -0700

    fix: correct imports and model usage in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index bef05c01..d4964973 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,7 +1,7 @@
 import unittest
 from unittest.mock import MagicMock, patch
 
-from aider.models import Model, get_model_info, sanity_check_model, sanity_check_models
+from aider.models import Model, get_model_info, sanity_check_models
 
 
 class TestModels(unittest.TestCase):
@@ -64,10 +64,10 @@ class TestModels(unittest.TestCase):
 
     def test_sanity_check_models_bogus_editor(self):
         mock_io = MagicMock()
-        main_model = models.Model("gpt-4")
-        main_model.editor_model = models.Model("bogus-model")
+        main_model = Model("gpt-4")
+        main_model.editor_model = Model("bogus-model")
 
-        result = models.sanity_check_models(mock_io, main_model)
+        result = sanity_check_models(mock_io, main_model)
 
         self.assertTrue(
             result

commit 97d6b686130bc9fa07d3300711e069347aa3870a
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:20:01 2024 -0700

    fix: add missing sanity_check_model import

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index d4964973..8d75d9e6 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,7 +1,7 @@
 import unittest
 from unittest.mock import MagicMock, patch
 
-from aider.models import Model, get_model_info, sanity_check_models
+from aider.models import Model, get_model_info, sanity_check_model, sanity_check_models
 
 
 class TestModels(unittest.TestCase):

commit 875fb3a17873c56b77e745258b0ec6202d579970
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:21:13 2024 -0700

    test: update sanity_check_models_bogus_editor to expect two warnings

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 8d75d9e6..a8105096 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -69,14 +69,11 @@ class TestModels(unittest.TestCase):
 
         result = sanity_check_models(mock_io, main_model)
 
-        self.assertTrue(
-            result
-        )  # Should return True because there's a problem with the editor model
-        mock_io.tool_warning.assert_called_once()  # Ensure a warning was issued
-        warning_message = mock_io.tool_warning.call_args[0][0]
-        self.assertIn(
-            "bogus-model", warning_message
-        )  # Check that the warning mentions the bogus model
+        self.assertTrue(result)  # Should return True because there's a problem with the editor model
+        mock_io.tool_warning.assert_called_with(ANY)  # Ensure a warning was issued
+        self.assertEqual(mock_io.tool_warning.call_count, 2)  # Expect two warnings
+        warning_messages = [call.args[0] for call in mock_io.tool_warning.call_args_list]
+        self.assertTrue(any("bogus-model" in msg for msg in warning_messages))  # Check that one of the warnings mentions the bogus model
 
 
 if __name__ == "__main__":

commit b35bd06eb8ae2dba900d9fa34e96c088d23d4cdd
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:21:17 2024 -0700

    style: format code in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index a8105096..77ed041b 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -69,11 +69,15 @@ class TestModels(unittest.TestCase):
 
         result = sanity_check_models(mock_io, main_model)
 
-        self.assertTrue(result)  # Should return True because there's a problem with the editor model
+        self.assertTrue(
+            result
+        )  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_with(ANY)  # Ensure a warning was issued
         self.assertEqual(mock_io.tool_warning.call_count, 2)  # Expect two warnings
         warning_messages = [call.args[0] for call in mock_io.tool_warning.call_args_list]
-        self.assertTrue(any("bogus-model" in msg for msg in warning_messages))  # Check that one of the warnings mentions the bogus model
+        self.assertTrue(
+            any("bogus-model" in msg for msg in warning_messages)
+        )  # Check that one of the warnings mentions the bogus model
 
 
 if __name__ == "__main__":

commit e33e9c44bbb65a5d82a6fd9ec526cbdb417b1e6d
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 2 11:21:28 2024 -0700

    fix: import ANY from unittest.mock to resolve undefined name error

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 77ed041b..6071e6c4 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,5 +1,5 @@
 import unittest
-from unittest.mock import MagicMock, patch
+from unittest.mock import ANY, MagicMock, patch
 
 from aider.models import Model, get_model_info, sanity_check_model, sanity_check_models
 

commit 33b45b68e26c7122bf8d495cbd75f18ba599acc6
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Oct 2 12:03:47 2024 -0700

    copy

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 6071e6c4..f14183b4 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -73,7 +73,7 @@ class TestModels(unittest.TestCase):
             result
         )  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_with(ANY)  # Ensure a warning was issued
-        self.assertEqual(mock_io.tool_warning.call_count, 2)  # Expect two warnings
+        self.assertGreaterEqual(mock_io.tool_warning.call_count, 2)  # Expect two warnings
         warning_messages = [call.args[0] for call in mock_io.tool_warning.call_args_list]
         self.assertTrue(
             any("bogus-model" in msg for msg in warning_messages)

commit 0d86124b15f0a3c9db56e6c14e6855cc2c7ec32e
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Oct 30 06:32:17 2024 -0700

    test: add comment about tool warning args inspection

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index f14183b4..065692f2 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -73,6 +73,7 @@ class TestModels(unittest.TestCase):
             result
         )  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_with(ANY)  # Ensure a warning was issued
+        #ai print the args that tool_warning was called with!
         self.assertGreaterEqual(mock_io.tool_warning.call_count, 2)  # Expect two warnings
         warning_messages = [call.args[0] for call in mock_io.tool_warning.call_args_list]
         self.assertTrue(

commit 20ca9c84c7cebe2b7c0457c56e5d1de442582490
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 30 06:32:18 2024 -0700

    test: add warning message debug print in model test

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 065692f2..be91f4b9 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -76,6 +76,7 @@ class TestModels(unittest.TestCase):
         #ai print the args that tool_warning was called with!
         self.assertGreaterEqual(mock_io.tool_warning.call_count, 2)  # Expect two warnings
         warning_messages = [call.args[0] for call in mock_io.tool_warning.call_args_list]
+        print("Warning messages:", warning_messages)  # Add this line
         self.assertTrue(
             any("bogus-model" in msg for msg in warning_messages)
         )  # Check that one of the warnings mentions the bogus model

commit 55a2ba4bd6a015d289b6e06126d6f803d73e24d4
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 30 06:32:22 2024 -0700

    style: Fix comment formatting in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index be91f4b9..6b7641cb 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -73,7 +73,7 @@ class TestModels(unittest.TestCase):
             result
         )  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_with(ANY)  # Ensure a warning was issued
-        #ai print the args that tool_warning was called with!
+        # ai print the args that tool_warning was called with!
         self.assertGreaterEqual(mock_io.tool_warning.call_count, 2)  # Expect two warnings
         warning_messages = [call.args[0] for call in mock_io.tool_warning.call_args_list]
         print("Warning messages:", warning_messages)  # Add this line

commit ea3359fb4bb5e405020282ce469de2a454b27775
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Oct 30 06:33:31 2024 -0700

    test: adjust warning count assertion in model test

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 6b7641cb..24aad3d7 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -73,10 +73,11 @@ class TestModels(unittest.TestCase):
             result
         )  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_with(ANY)  # Ensure a warning was issued
-        # ai print the args that tool_warning was called with!
-        self.assertGreaterEqual(mock_io.tool_warning.call_count, 2)  # Expect two warnings
+
         warning_messages = [call.args[0] for call in mock_io.tool_warning.call_args_list]
         print("Warning messages:", warning_messages)  # Add this line
+
+        self.assertGreaterEqual(mock_io.tool_warning.call_count, 1)  # Expect two warnings
         self.assertTrue(
             any("bogus-model" in msg for msg in warning_messages)
         )  # Check that one of the warnings mentions the bogus model

commit a045bda1719b6efabd19f2a11c3578ce48edbfeb
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 30 13:21:43 2024 -0700

    refactor: update test to use ModelInfoManager instead of get_model_info

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 24aad3d7..038e8024 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,12 +1,13 @@
 import unittest
 from unittest.mock import ANY, MagicMock, patch
 
-from aider.models import Model, get_model_info, sanity_check_model, sanity_check_models
+from aider.models import Model, ModelInfoManager, sanity_check_model, sanity_check_models
 
 
 class TestModels(unittest.TestCase):
     def test_get_model_info_nonexistent(self):
-        info = get_model_info("non-existent-model")
+        manager = ModelInfoManager()
+        info = manager.get_model_info("non-existent-model")
         self.assertEqual(info, {})
 
     def test_max_context_tokens(self):

commit a565a63436d2dc255d40768b5ee88b5a532613d1
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Wed Oct 30 13:21:47 2024 -0700

    style: Fix import formatting in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 038e8024..6718e6f3 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,7 +1,12 @@
 import unittest
 from unittest.mock import ANY, MagicMock, patch
 
-from aider.models import Model, ModelInfoManager, sanity_check_model, sanity_check_models
+from aider.models import (
+    Model,
+    ModelInfoManager,
+    sanity_check_model,
+    sanity_check_models,
+)
 
 
 class TestModels(unittest.TestCase):

commit 7c8f10e83297cd9c6b3679fd5a742d3c7b734f5e
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 10:04:19 2024 -0800

    test: Add tests for default and override model settings

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 6718e6f3..bfd081b5 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -88,6 +88,34 @@ class TestModels(unittest.TestCase):
             any("bogus-model" in msg for msg in warning_messages)
         )  # Check that one of the warnings mentions the bogus model
 
+    def test_default_and_override_settings(self):
+        # Add default and override settings to MODEL_SETTINGS
+        MODEL_SETTINGS.extend([
+            ModelSettings(
+                name="aider/default",
+                edit_format="diff",
+                use_repo_map=True,
+            ),
+            ModelSettings(
+                name="aider/override",
+                use_temperature=False,
+            ),
+        ])
+
+        # Test that defaults are applied when no exact match
+        model = Model("unknown-model")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertFalse(model.use_temperature)  # Override should win
+
+        # Test that exact match overrides defaults but not overrides
+        model = Model("gpt-4")
+        self.assertNotEqual(model.edit_format, "diff")  # Model setting should win over default
+        self.assertFalse(model.use_temperature)  # Override should still win
+
+        # Clean up by removing test settings
+        MODEL_SETTINGS[:] = [ms for ms in MODEL_SETTINGS if ms.name not in ("aider/default", "aider/override")]
+
 
 if __name__ == "__main__":
     unittest.main()

commit 210500ff3e8ac46e16ccde4ad91f64dccb2de1df
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 10:04:23 2024 -0800

    style: Apply linter formatting to test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index bfd081b5..f9e79e16 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -90,17 +90,19 @@ class TestModels(unittest.TestCase):
 
     def test_default_and_override_settings(self):
         # Add default and override settings to MODEL_SETTINGS
-        MODEL_SETTINGS.extend([
-            ModelSettings(
-                name="aider/default",
-                edit_format="diff",
-                use_repo_map=True,
-            ),
-            ModelSettings(
-                name="aider/override",
-                use_temperature=False,
-            ),
-        ])
+        MODEL_SETTINGS.extend(
+            [
+                ModelSettings(
+                    name="aider/default",
+                    edit_format="diff",
+                    use_repo_map=True,
+                ),
+                ModelSettings(
+                    name="aider/override",
+                    use_temperature=False,
+                ),
+            ]
+        )
 
         # Test that defaults are applied when no exact match
         model = Model("unknown-model")
@@ -114,7 +116,9 @@ class TestModels(unittest.TestCase):
         self.assertFalse(model.use_temperature)  # Override should still win
 
         # Clean up by removing test settings
-        MODEL_SETTINGS[:] = [ms for ms in MODEL_SETTINGS if ms.name not in ("aider/default", "aider/override")]
+        MODEL_SETTINGS[:] = [
+            ms for ms in MODEL_SETTINGS if ms.name not in ("aider/default", "aider/override")
+        ]
 
 
 if __name__ == "__main__":

commit 2c5feddad50833058657ed7fa00a984c15650cbd
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 10:04:41 2024 -0800

    test: Add imports for ModelSettings and MODEL_SETTINGS

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index f9e79e16..9c1035d8 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,9 +1,11 @@
 import unittest
-from unittest.mock import ANY, MagicMock, patch
+from unittest.mock import ANY, MagicMock, patch, call
 
 from aider.models import (
     Model,
     ModelInfoManager,
+    ModelSettings,
+    MODEL_SETTINGS,
     sanity_check_model,
     sanity_check_models,
 )

commit 32eb365a0b1292e3a8cf267c78b930d35ef5868c
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 10:04:45 2024 -0800

    style: Reorder imports in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 9c1035d8..59b564e4 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,11 +1,11 @@
 import unittest
-from unittest.mock import ANY, MagicMock, patch, call
+from unittest.mock import ANY, MagicMock, call, patch
 
 from aider.models import (
+    MODEL_SETTINGS,
     Model,
     ModelInfoManager,
     ModelSettings,
-    MODEL_SETTINGS,
     sanity_check_model,
     sanity_check_models,
 )

commit 76988b746f2e6e97f23780269461f791e0d27077
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 10:05:01 2024 -0800

    refactor: Remove unused call import and rename loop variable

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 59b564e4..94c61f7b 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -82,7 +82,7 @@ class TestModels(unittest.TestCase):
         )  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_with(ANY)  # Ensure a warning was issued
 
-        warning_messages = [call.args[0] for call in mock_io.tool_warning.call_args_list]
+        warning_messages = [warning_call.args[0] for warning_call in mock_io.tool_warning.call_args_list]
         print("Warning messages:", warning_messages)  # Add this line
 
         self.assertGreaterEqual(mock_io.tool_warning.call_count, 1)  # Expect two warnings

commit 6133fa8384ef629b20d353e05573fcc36bf84043
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 19 11:49:55 2024 -0800

    test: Update test cases with new edit_format value

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 94c61f7b..f2d92872 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -96,7 +96,7 @@ class TestModels(unittest.TestCase):
             [
                 ModelSettings(
                     name="aider/default",
-                    edit_format="diff",
+                    edit_format="fake",
                     use_repo_map=True,
                 ),
                 ModelSettings(
@@ -108,13 +108,13 @@ class TestModels(unittest.TestCase):
 
         # Test that defaults are applied when no exact match
         model = Model("unknown-model")
-        self.assertEqual(model.edit_format, "diff")
+        self.assertEqual(model.edit_format, "fake")
         self.assertTrue(model.use_repo_map)
         self.assertFalse(model.use_temperature)  # Override should win
 
         # Test that exact match overrides defaults but not overrides
         model = Model("gpt-4")
-        self.assertNotEqual(model.edit_format, "diff")  # Model setting should win over default
+        self.assertNotEqual(model.edit_format, "fake")  # Model setting should win over default
         self.assertFalse(model.use_temperature)  # Override should still win
 
         # Clean up by removing test settings

commit 7b9a76c5ea230d5a566c7782699e2f9764be148b
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 11:49:57 2024 -0800

    refactor: Use temporary YAML file for model settings in test_default_and_override_settings

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index f2d92872..9e56d244 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -91,37 +91,45 @@ class TestModels(unittest.TestCase):
         )  # Check that one of the warnings mentions the bogus model
 
     def test_default_and_override_settings(self):
-        # Add default and override settings to MODEL_SETTINGS
-        MODEL_SETTINGS.extend(
-            [
-                ModelSettings(
-                    name="aider/default",
-                    edit_format="fake",
-                    use_repo_map=True,
-                ),
-                ModelSettings(
-                    name="aider/override",
-                    use_temperature=False,
-                ),
-            ]
-        )
-
-        # Test that defaults are applied when no exact match
-        model = Model("unknown-model")
-        self.assertEqual(model.edit_format, "fake")
-        self.assertTrue(model.use_repo_map)
-        self.assertFalse(model.use_temperature)  # Override should win
-
-        # Test that exact match overrides defaults but not overrides
-        model = Model("gpt-4")
-        self.assertNotEqual(model.edit_format, "fake")  # Model setting should win over default
-        self.assertFalse(model.use_temperature)  # Override should still win
-
-        # Clean up by removing test settings
-        MODEL_SETTINGS[:] = [
-            ms for ms in MODEL_SETTINGS if ms.name not in ("aider/default", "aider/override")
+        import tempfile
+        import yaml
+
+        # Create temporary YAML file with test settings
+        test_settings = [
+            {
+                "name": "aider/default",
+                "edit_format": "fake",
+                "use_repo_map": True,
+            },
+            {
+                "name": "aider/override",
+                "use_temperature": False,
+            }
         ]
 
+        with tempfile.NamedTemporaryFile(mode='w', suffix='.yml') as tmp:
+            yaml.dump(test_settings, tmp)
+            tmp.flush()
+            
+            # Register the test settings
+            register_models([tmp.name])
+
+            # Test that defaults are applied when no exact match
+            model = Model("unknown-model")
+            self.assertEqual(model.edit_format, "fake")
+            self.assertTrue(model.use_repo_map)
+            self.assertFalse(model.use_temperature)  # Override should win
+
+            # Test that exact match overrides defaults but not overrides
+            model = Model("gpt-4")
+            self.assertNotEqual(model.edit_format, "fake")  # Model setting should win over default
+            self.assertFalse(model.use_temperature)  # Override should still win
+
+            # Clean up by removing test settings
+            MODEL_SETTINGS[:] = [
+                ms for ms in MODEL_SETTINGS if ms.name not in ("aider/default", "aider/override")
+            ]
+
 
 if __name__ == "__main__":
     unittest.main()

commit e0aadbd9611efb95cec608458a33e9d4d6801b2d
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 11:50:01 2024 -0800

    style: Format code with linter and improve readability

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 9e56d244..14772ee6 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -82,7 +82,9 @@ class TestModels(unittest.TestCase):
         )  # Should return True because there's a problem with the editor model
         mock_io.tool_warning.assert_called_with(ANY)  # Ensure a warning was issued
 
-        warning_messages = [warning_call.args[0] for warning_call in mock_io.tool_warning.call_args_list]
+        warning_messages = [
+            warning_call.args[0] for warning_call in mock_io.tool_warning.call_args_list
+        ]
         print("Warning messages:", warning_messages)  # Add this line
 
         self.assertGreaterEqual(mock_io.tool_warning.call_count, 1)  # Expect two warnings
@@ -92,6 +94,7 @@ class TestModels(unittest.TestCase):
 
     def test_default_and_override_settings(self):
         import tempfile
+
         import yaml
 
         # Create temporary YAML file with test settings
@@ -104,13 +107,13 @@ class TestModels(unittest.TestCase):
             {
                 "name": "aider/override",
                 "use_temperature": False,
-            }
+            },
         ]
 
-        with tempfile.NamedTemporaryFile(mode='w', suffix='.yml') as tmp:
+        with tempfile.NamedTemporaryFile(mode="w", suffix=".yml") as tmp:
             yaml.dump(test_settings, tmp)
             tmp.flush()
-            
+
             # Register the test settings
             register_models([tmp.name])
 

commit c1febce52888dfd1d67037526096bf9dbaea397d
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 11:50:12 2024 -0800

    fix: Remove unused imports and add missing register_models import

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 14772ee6..aac0bc2e 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -1,11 +1,11 @@
 import unittest
-from unittest.mock import ANY, MagicMock, call, patch
+from unittest.mock import ANY, MagicMock, patch
 
 from aider.models import (
     MODEL_SETTINGS,
     Model,
     ModelInfoManager,
-    ModelSettings,
+    register_models,
     sanity_check_model,
     sanity_check_models,
 )

commit 34aff6c786b3e3342eb8af4cb08831a015524714
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 19 12:06:13 2024 -0800

    test: Update model settings test to check extra parameters

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index aac0bc2e..9603cd74 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -92,7 +92,7 @@ class TestModels(unittest.TestCase):
             any("bogus-model" in msg for msg in warning_messages)
         )  # Check that one of the warnings mentions the bogus model
 
-    def test_default_and_override_settings(self):
+    def test_aider_extra_model_settings(self):
         import tempfile
 
         import yaml
@@ -100,13 +100,11 @@ class TestModels(unittest.TestCase):
         # Create temporary YAML file with test settings
         test_settings = [
             {
-                "name": "aider/default",
-                "edit_format": "fake",
-                "use_repo_map": True,
-            },
-            {
-                "name": "aider/override",
-                "use_temperature": False,
+                "name": "aider/extra",
+                "extra_params" : {
+                    "extra_headers" : { "Foo" : "bar" },
+                    "some_param" : "some value",
+                }
             },
         ]
 
@@ -118,20 +116,13 @@ class TestModels(unittest.TestCase):
             register_models([tmp.name])
 
             # Test that defaults are applied when no exact match
-            model = Model("unknown-model")
-            self.assertEqual(model.edit_format, "fake")
-            self.assertTrue(model.use_repo_map)
-            self.assertFalse(model.use_temperature)  # Override should win
+            model = Model("claude-3-5-sonnet-20240620")
+            # TODO: make sure Foo:bar and existing anthropic-beta headers are both here; check some_param; check max_tokens=8192 still there
 
             # Test that exact match overrides defaults but not overrides
             model = Model("gpt-4")
-            self.assertNotEqual(model.edit_format, "fake")  # Model setting should win over default
-            self.assertFalse(model.use_temperature)  # Override should still win
+            # TODO: make sure Foo:bar header is there; check some_param
 
-            # Clean up by removing test settings
-            MODEL_SETTINGS[:] = [
-                ms for ms in MODEL_SETTINGS if ms.name not in ("aider/default", "aider/override")
-            ]
 
 
 if __name__ == "__main__":

commit 92cf2cbd474b6fed02da17025a09529ea6a89098
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 12:06:15 2024 -0800

    test: Implement TODOs in test_aider_extra_model_settings

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 9603cd74..c08784eb 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -117,11 +117,20 @@ class TestModels(unittest.TestCase):
 
             # Test that defaults are applied when no exact match
             model = Model("claude-3-5-sonnet-20240620")
-            # TODO: make sure Foo:bar and existing anthropic-beta headers are both here; check some_param; check max_tokens=8192 still there
+            # Test that both the override and existing headers are present
+            model = Model("claude-3-5-sonnet-20240620")
+            self.assertEqual(model.extra_params["extra_headers"]["Foo"], "bar")
+            self.assertEqual(
+                model.extra_params["extra_headers"]["anthropic-beta"],
+                ANTHROPIC_BETA_HEADER,
+            )
+            self.assertEqual(model.extra_params["some_param"], "some value")
+            self.assertEqual(model.extra_params["max_tokens"], 8192)
 
             # Test that exact match overrides defaults but not overrides
             model = Model("gpt-4")
-            # TODO: make sure Foo:bar header is there; check some_param
+            self.assertEqual(model.extra_params["extra_headers"]["Foo"], "bar")
+            self.assertEqual(model.extra_params["some_param"], "some value")
 
 
 

commit 5ed44bb1742bf8a0fba9754290639177f783dda4
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 12:06:19 2024 -0800

    style: Format test_models.py with consistent whitespace and trailing commas

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index c08784eb..dbfd7750 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -101,10 +101,10 @@ class TestModels(unittest.TestCase):
         test_settings = [
             {
                 "name": "aider/extra",
-                "extra_params" : {
-                    "extra_headers" : { "Foo" : "bar" },
-                    "some_param" : "some value",
-                }
+                "extra_params": {
+                    "extra_headers": {"Foo": "bar"},
+                    "some_param": "some value",
+                },
             },
         ]
 
@@ -133,6 +133,5 @@ class TestModels(unittest.TestCase):
             self.assertEqual(model.extra_params["some_param"], "some value")
 
 
-
 if __name__ == "__main__":
     unittest.main()

commit aabbf5a72f79223d14672a66a942b48b99e3f1e1
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 12:06:29 2024 -0800

    refactor: Remove unused import and add ANTHROPIC_BETA_HEADER import

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index dbfd7750..7145a0fa 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -2,7 +2,7 @@ import unittest
 from unittest.mock import ANY, MagicMock, patch
 
 from aider.models import (
-    MODEL_SETTINGS,
+    ANTHROPIC_BETA_HEADER,
     Model,
     ModelInfoManager,
     register_models,

commit cc18441435c682732a50de01cffb5999decc1e22
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 19 12:15:11 2024 -0800

    refactor: Update model settings name from "aider/extra" to "aider/extra_params"

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 7145a0fa..fb91ef21 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -100,7 +100,7 @@ class TestModels(unittest.TestCase):
         # Create temporary YAML file with test settings
         test_settings = [
             {
-                "name": "aider/extra",
+                "name": "aider/extra_params",
                 "extra_params": {
                     "extra_headers": {"Foo": "bar"},
                     "some_param": "some value",

commit a7998518325c31ee688871ffc1feb65b0e93fdfb
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 14:48:06 2024 -0800

    fix: Resolve temporary file permission issues in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index fb91ef21..2d9d9c76 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -108,12 +108,14 @@ class TestModels(unittest.TestCase):
             },
         ]
 
-        with tempfile.NamedTemporaryFile(mode="w", suffix=".yml") as tmp:
-            yaml.dump(test_settings, tmp)
-            tmp.flush()
+        # Write to a regular file instead of NamedTemporaryFile for better cross-platform compatibility
+        tmp = tempfile.mktemp(suffix=".yml")
+        try:
+            with open(tmp, 'w') as f:
+                yaml.dump(test_settings, f)
 
             # Register the test settings
-            register_models([tmp.name])
+            register_models([tmp])
 
             # Test that defaults are applied when no exact match
             model = Model("claude-3-5-sonnet-20240620")
@@ -131,6 +133,13 @@ class TestModels(unittest.TestCase):
             model = Model("gpt-4")
             self.assertEqual(model.extra_params["extra_headers"]["Foo"], "bar")
             self.assertEqual(model.extra_params["some_param"], "some value")
+        finally:
+            # Clean up the temporary file
+            import os
+            try:
+                os.unlink(tmp)
+            except OSError:
+                pass
 
 
 if __name__ == "__main__":

commit 1e8fc97ba4ca9476036043358505e8ca1e6937a9
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 14:48:11 2024 -0800

    style: Apply linter formatting to test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 2d9d9c76..04c9b183 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -111,7 +111,7 @@ class TestModels(unittest.TestCase):
         # Write to a regular file instead of NamedTemporaryFile for better cross-platform compatibility
         tmp = tempfile.mktemp(suffix=".yml")
         try:
-            with open(tmp, 'w') as f:
+            with open(tmp, "w") as f:
                 yaml.dump(test_settings, f)
 
             # Register the test settings
@@ -136,6 +136,7 @@ class TestModels(unittest.TestCase):
         finally:
             # Clean up the temporary file
             import os
+
             try:
                 os.unlink(tmp)
             except OSError:

commit 77e180171c5539cbad713d6d986410825362320f
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Tue Nov 19 14:48:22 2024 -0800

    style: Break long comment into two lines for flake8 compliance

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 04c9b183..b4bebc3e 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -108,7 +108,8 @@ class TestModels(unittest.TestCase):
             },
         ]
 
-        # Write to a regular file instead of NamedTemporaryFile for better cross-platform compatibility
+        # Write to a regular file instead of NamedTemporaryFile
+        # for better cross-platform compatibility
         tmp = tempfile.mktemp(suffix=".yml")
         try:
             with open(tmp, "w") as f:

commit bf38371971b0399093824cf2fa9404590449c8d9
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Mon Nov 25 21:06:29 2024 -0800

    test: add test cases for model name aliases

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index b4bebc3e..8bf2ca44 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -92,6 +92,36 @@ class TestModels(unittest.TestCase):
             any("bogus-model" in msg for msg in warning_messages)
         )  # Check that one of the warnings mentions the bogus model
 
+    def test_model_aliases(self):
+        # Test common aliases
+        model = Model("4")
+        self.assertEqual(model.name, "gpt-4-0613")
+
+        model = Model("4o")
+        self.assertEqual(model.name, "gpt-4o-2024-08-06")
+
+        model = Model("35turbo")
+        self.assertEqual(model.name, "gpt-3.5-turbo")
+
+        model = Model("35-turbo")
+        self.assertEqual(model.name, "gpt-3.5-turbo")
+
+        model = Model("3")
+        self.assertEqual(model.name, "gpt-3.5-turbo")
+
+        model = Model("sonnet")
+        self.assertEqual(model.name, "claude-3-sonnet-20241022")
+
+        model = Model("haiku")
+        self.assertEqual(model.name, "claude-3-haiku-20241022")
+
+        model = Model("opus")
+        self.assertEqual(model.name, "claude-3-opus-20240229")
+
+        # Test non-alias passes through unchanged
+        model = Model("gpt-4")
+        self.assertEqual(model.name, "gpt-4")
+
     def test_aider_extra_model_settings(self):
         import tempfile
 

commit dd48b740f975e3bff713ca0e816ba6cc66cc7b2d
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 26 12:33:58 2024 -0800

    test: update Claude model name tests to use 3.5 version

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 8bf2ca44..6aff2be7 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -110,10 +110,10 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.name, "gpt-3.5-turbo")
 
         model = Model("sonnet")
-        self.assertEqual(model.name, "claude-3-sonnet-20241022")
+        self.assertEqual(model.name, "claude-3-5-sonnet-20241022")
 
         model = Model("haiku")
-        self.assertEqual(model.name, "claude-3-haiku-20241022")
+        self.assertEqual(model.name, "claude-3-5-haiku-20241022")
 
         model = Model("opus")
         self.assertEqual(model.name, "claude-3-opus-20240229")

commit 16250e1b7c43eba585baa719138accb7efe2c23e
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Dec 3 08:35:38 2024 -0800

    fix: Update model name assertion in test case

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 6aff2be7..28df5b6d 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -98,7 +98,7 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.name, "gpt-4-0613")
 
         model = Model("4o")
-        self.assertEqual(model.name, "gpt-4o-2024-08-06")
+        self.assertEqual(model.name, "gpt-4o")
 
         model = Model("35turbo")
         self.assertEqual(model.name, "gpt-3.5-turbo")

commit 4830d82a735cd20ecba31be6aee76d965e60812f
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Thu Dec 5 06:47:28 2024 -0800

    test: add temperature validation for GitHub Copilot models

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 28df5b6d..a1267f22 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -118,6 +118,15 @@ class TestModels(unittest.TestCase):
         model = Model("opus")
         self.assertEqual(model.name, "claude-3-opus-20240229")
 
+        # Test GitHub Copilot models
+        model = Model("github/o1-mini")
+        self.assertEqual(model.name, "github/o1-mini")
+        self.assertEqual(model.temperature, 0.0)  # Should be deterministic
+
+        model = Model("github/o1-preview")
+        self.assertEqual(model.name, "github/o1-preview") 
+        self.assertEqual(model.temperature, 0.0)  # Should be deterministic
+
         # Test non-alias passes through unchanged
         model = Model("gpt-4")
         self.assertEqual(model.name, "gpt-4")

commit f8f69fadc4cdd876fac0097e75472d70979153c8
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Thu Dec 5 06:47:33 2024 -0800

    style: Remove trailing whitespace in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index a1267f22..2f8ccc04 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -124,7 +124,7 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.temperature, 0.0)  # Should be deterministic
 
         model = Model("github/o1-preview")
-        self.assertEqual(model.name, "github/o1-preview") 
+        self.assertEqual(model.name, "github/o1-preview")
         self.assertEqual(model.temperature, 0.0)  # Should be deterministic
 
         # Test non-alias passes through unchanged

commit 341419788e6fec3b6f21198fa0f9cb2042a64cdb
Author: Paul Gauthier (aider) <aider@paulg.org>
Date:   Thu Dec 5 06:47:58 2024 -0800

    fix: update test to use correct temperature attribute name

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 2f8ccc04..c9c8f5c1 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -121,11 +121,11 @@ class TestModels(unittest.TestCase):
         # Test GitHub Copilot models
         model = Model("github/o1-mini")
         self.assertEqual(model.name, "github/o1-mini")
-        self.assertEqual(model.temperature, 0.0)  # Should be deterministic
+        self.assertEqual(model.use_temperature, 0.0)  # Should be deterministic
 
         model = Model("github/o1-preview")
         self.assertEqual(model.name, "github/o1-preview")
-        self.assertEqual(model.temperature, 0.0)  # Should be deterministic
+        self.assertEqual(model.use_temperature, 0.0)  # Should be deterministic
 
         # Test non-alias passes through unchanged
         model = Model("gpt-4")

commit 9121026856fb15bae0776004f74d066c2fa83ee9
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Dec 5 06:50:49 2024 -0800

    test: reorganize model test cases for better readability

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index c9c8f5c1..06568792 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -118,6 +118,11 @@ class TestModels(unittest.TestCase):
         model = Model("opus")
         self.assertEqual(model.name, "claude-3-opus-20240229")
 
+        # Test non-alias passes through unchanged
+        model = Model("gpt-4")
+        self.assertEqual(model.name, "gpt-4")
+
+    def test_o1_use_temp_false(self):
         # Test GitHub Copilot models
         model = Model("github/o1-mini")
         self.assertEqual(model.name, "github/o1-mini")
@@ -127,10 +132,6 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.name, "github/o1-preview")
         self.assertEqual(model.use_temperature, 0.0)  # Should be deterministic
 
-        # Test non-alias passes through unchanged
-        model = Model("gpt-4")
-        self.assertEqual(model.name, "gpt-4")
-
     def test_aider_extra_model_settings(self):
         import tempfile
 

commit 995541db2e23541114e1e16da236624dea745741
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Dec 5 07:04:17 2024 -0800

    test: update GitHub Copilot model temperature test assertions

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 06568792..33237d6c 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -126,11 +126,11 @@ class TestModels(unittest.TestCase):
         # Test GitHub Copilot models
         model = Model("github/o1-mini")
         self.assertEqual(model.name, "github/o1-mini")
-        self.assertEqual(model.use_temperature, 0.0)  # Should be deterministic
+        self.assertEqual(model.use_temperature, False)
 
         model = Model("github/o1-preview")
         self.assertEqual(model.name, "github/o1-preview")
-        self.assertEqual(model.use_temperature, 0.0)  # Should be deterministic
+        self.assertEqual(model.use_temperature, False)
 
     def test_aider_extra_model_settings(self):
         import tempfile

commit e6b449f24d8fca523859d385560bea5fc1a98c7f
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Jan 10 14:39:50 2025 -0800

    test: add tests for get_repo_map_tokens method

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 33237d6c..a8f7c8d3 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -132,6 +132,31 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.name, "github/o1-preview")
         self.assertEqual(model.use_temperature, False)
 
+    def test_get_repo_map_tokens(self):
+        # Test default case (no max_input_tokens in info)
+        model = Model("gpt-4")
+        model.info = {}
+        self.assertEqual(model.get_repo_map_tokens(), 1024)
+
+        # Test minimum boundary (max_input_tokens < 8192)
+        model.info = {"max_input_tokens": 4096}
+        self.assertEqual(model.get_repo_map_tokens(), 1024)
+
+        # Test middle range (max_input_tokens = 16384)
+        model.info = {"max_input_tokens": 16384}
+        self.assertEqual(model.get_repo_map_tokens(), 2048)
+
+        # Test maximum boundary (max_input_tokens > 32768)
+        model.info = {"max_input_tokens": 65536}
+        self.assertEqual(model.get_repo_map_tokens(), 4096)
+
+        # Test exact boundary values
+        model.info = {"max_input_tokens": 8192}
+        self.assertEqual(model.get_repo_map_tokens(), 1024)
+
+        model.info = {"max_input_tokens": 32768}
+        self.assertEqual(model.get_repo_map_tokens(), 4096)
+
     def test_aider_extra_model_settings(self):
         import tempfile
 

commit 9094af565f213b43e9e07ddd1e1d6dbf71cf5a03
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:19:19 2025 -0800

    test: add tests for Ollama model num_ctx handling

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index a8f7c8d3..8820bda6 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -208,6 +208,65 @@ class TestModels(unittest.TestCase):
             except OSError:
                 pass
 
+    @patch('aider.models.litellm.completion')
+    @patch.object(Model, 'token_count')
+    def test_ollama_num_ctx_set_when_missing(self, mock_token_count, mock_completion):
+        mock_token_count.return_value = 1000
+        
+        model = Model("ollama/llama3")
+        messages = [{"role": "user", "content": "Hello"}]
+        
+        model.send_completion(messages, functions=None, stream=False)
+        
+        # Verify num_ctx was calculated and added to call
+        expected_ctx = int(1000 * 1.25) + 8192  # 9442
+        mock_completion.assert_called_once_with(
+            model=model.name,
+            messages=messages,
+            stream=False,
+            temperature=ANY,
+            num_ctx=expected_ctx,
+            tools=None,
+            tool_choice=None,
+        )
+
+    @patch('aider.models.litellm.completion')
+    def test_ollama_uses_existing_num_ctx(self, mock_completion):
+        model = Model("ollama/llama3")
+        model.extra_params = {"num_ctx": 4096}
+        
+        messages = [{"role": "user", "content": "Hello"}]
+        model.send_completion(messages, functions=None, stream=False)
+        
+        # Should use provided num_ctx from extra_params
+        mock_completion.assert_called_once_with(
+            model=model.name,
+            messages=messages,
+            stream=False,
+            temperature=ANY,
+            num_ctx=4096,
+            tools=None,
+            tool_choice=None,
+        )
+
+    @patch('aider.models.litellm.completion')
+    def test_non_ollama_no_num_ctx(self, mock_completion):
+        model = Model("gpt-4")
+        messages = [{"role": "user", "content": "Hello"}]
+        
+        model.send_completion(messages, functions=None, stream=False)
+        
+        # Regular models shouldn't get num_ctx
+        mock_completion.assert_called_once_with(
+            model=model.name,
+            messages=messages,
+            stream=False,
+            temperature=ANY,
+            tools=None,
+            tool_choice=None,
+        )
+        self.assertNotIn('num_ctx', mock_completion.call_args.kwargs)
+
 
 if __name__ == "__main__":
     unittest.main()

commit 016aa87e34609632ca17d6af8e6901e72313375f
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:19:25 2025 -0800

    style: Format strings with double quotes in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 8820bda6..3532fd31 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -208,16 +208,16 @@ class TestModels(unittest.TestCase):
             except OSError:
                 pass
 
-    @patch('aider.models.litellm.completion')
-    @patch.object(Model, 'token_count')
+    @patch("aider.models.litellm.completion")
+    @patch.object(Model, "token_count")
     def test_ollama_num_ctx_set_when_missing(self, mock_token_count, mock_completion):
         mock_token_count.return_value = 1000
-        
+
         model = Model("ollama/llama3")
         messages = [{"role": "user", "content": "Hello"}]
-        
+
         model.send_completion(messages, functions=None, stream=False)
-        
+
         # Verify num_ctx was calculated and added to call
         expected_ctx = int(1000 * 1.25) + 8192  # 9442
         mock_completion.assert_called_once_with(
@@ -230,14 +230,14 @@ class TestModels(unittest.TestCase):
             tool_choice=None,
         )
 
-    @patch('aider.models.litellm.completion')
+    @patch("aider.models.litellm.completion")
     def test_ollama_uses_existing_num_ctx(self, mock_completion):
         model = Model("ollama/llama3")
         model.extra_params = {"num_ctx": 4096}
-        
+
         messages = [{"role": "user", "content": "Hello"}]
         model.send_completion(messages, functions=None, stream=False)
-        
+
         # Should use provided num_ctx from extra_params
         mock_completion.assert_called_once_with(
             model=model.name,
@@ -249,13 +249,13 @@ class TestModels(unittest.TestCase):
             tool_choice=None,
         )
 
-    @patch('aider.models.litellm.completion')
+    @patch("aider.models.litellm.completion")
     def test_non_ollama_no_num_ctx(self, mock_completion):
         model = Model("gpt-4")
         messages = [{"role": "user", "content": "Hello"}]
-        
+
         model.send_completion(messages, functions=None, stream=False)
-        
+
         # Regular models shouldn't get num_ctx
         mock_completion.assert_called_once_with(
             model=model.name,
@@ -265,7 +265,7 @@ class TestModels(unittest.TestCase):
             tools=None,
             tool_choice=None,
         )
-        self.assertNotIn('num_ctx', mock_completion.call_args.kwargs)
+        self.assertNotIn("num_ctx", mock_completion.call_args.kwargs)
 
 
 if __name__ == "__main__":

commit 11a233da84bc050f7eb4ed7f0f1b59039c02e267
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:20:38 2025 -0800

    fix: Update test assertions to match actual model completion call parameters

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 3532fd31..66bcf309 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -224,10 +224,8 @@ class TestModels(unittest.TestCase):
             model=model.name,
             messages=messages,
             stream=False,
-            temperature=ANY,
+            temperature=0,
             num_ctx=expected_ctx,
-            tools=None,
-            tool_choice=None,
         )
 
     @patch("aider.models.litellm.completion")
@@ -261,9 +259,7 @@ class TestModels(unittest.TestCase):
             model=model.name,
             messages=messages,
             stream=False,
-            temperature=ANY,
-            tools=None,
-            tool_choice=None,
+            temperature=0,
         )
         self.assertNotIn("num_ctx", mock_completion.call_args.kwargs)
 

commit aef2b95d413eaeaa3a1f4f9dae2128bb45fe743a
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:21:42 2025 -0800

    fix: Reset MODEL_SETTINGS between tests to prevent parameter leakage

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 66bcf309..ce560a30 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -12,6 +12,17 @@ from aider.models import (
 
 
 class TestModels(unittest.TestCase):
+    def setUp(self):
+        """Reset MODEL_SETTINGS before each test"""
+        from aider.models import MODEL_SETTINGS
+        self._original_settings = MODEL_SETTINGS.copy()
+
+    def tearDown(self):
+        """Restore original MODEL_SETTINGS after each test"""
+        from aider.models import MODEL_SETTINGS
+        MODEL_SETTINGS.clear()
+        MODEL_SETTINGS.extend(self._original_settings)
+
     def test_get_model_info_nonexistent(self):
         manager = ModelInfoManager()
         info = manager.get_model_info("non-existent-model")

commit 85399bd6e25b5f7e1e34b8820e9a22725db4bc1d
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:21:48 2025 -0800

    style: Format code with linter in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index ce560a30..04179aea 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -15,11 +15,13 @@ class TestModels(unittest.TestCase):
     def setUp(self):
         """Reset MODEL_SETTINGS before each test"""
         from aider.models import MODEL_SETTINGS
+
         self._original_settings = MODEL_SETTINGS.copy()
 
     def tearDown(self):
         """Restore original MODEL_SETTINGS after each test"""
         from aider.models import MODEL_SETTINGS
+
         MODEL_SETTINGS.clear()
         MODEL_SETTINGS.extend(self._original_settings)
 

commit 3b16d6c291f31e7f6db4d3112214b6bdce5031bd
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:22:19 2025 -0800

    fix: Update test_ollama_uses_existing_num_ctx to match actual call parameters

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 04179aea..4df152e2 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -254,10 +254,8 @@ class TestModels(unittest.TestCase):
             model=model.name,
             messages=messages,
             stream=False,
-            temperature=ANY,
+            temperature=0,
             num_ctx=4096,
-            tools=None,
-            tool_choice=None,
         )
 
     @patch("aider.models.litellm.completion")

commit a9f0983f0fc0dde5d4fd38cb0a0a37aa4cf06b3f
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:23:34 2025 -0800

    test: add tests for configure_model_settings covering all cases

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 4df152e2..95947894 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -170,6 +170,89 @@ class TestModels(unittest.TestCase):
         model.info = {"max_input_tokens": 32768}
         self.assertEqual(model.get_repo_map_tokens(), 4096)
 
+    def test_configure_model_settings(self):
+        # Test o3-mini case
+        model = Model("something/o3-mini")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertFalse(model.use_temperature)
+
+        # Test o1-mini case
+        model = Model("something/o1-mini")
+        self.assertTrue(model.use_repo_map)
+        self.assertFalse(model.use_temperature)
+        self.assertFalse(model.use_system_prompt)
+
+        # Test o1-preview case
+        model = Model("something/o1-preview")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertFalse(model.use_temperature)
+        self.assertFalse(model.use_system_prompt)
+
+        # Test o1 case
+        model = Model("something/o1")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertFalse(model.use_temperature)
+        self.assertFalse(model.streaming)
+
+        # Test deepseek v3 case
+        model = Model("deepseek-v3")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertEqual(model.reminder, "sys")
+        self.assertTrue(model.examples_as_sys_msg)
+
+        # Test deepseek reasoner case
+        model = Model("deepseek-r1")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertTrue(model.examples_as_sys_msg)
+        self.assertFalse(model.use_temperature)
+        self.assertEqual(model.remove_reasoning, "think")
+
+        # Test llama3 70b case
+        model = Model("llama3-70b")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertTrue(model.send_undo_reply)
+        self.assertTrue(model.examples_as_sys_msg)
+
+        # Test gpt-4-turbo case
+        model = Model("gpt-4-turbo")
+        self.assertEqual(model.edit_format, "udiff")
+        self.assertTrue(model.use_repo_map)
+        self.assertTrue(model.send_undo_reply)
+
+        # Test gpt-4 case
+        model = Model("gpt-4")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertTrue(model.send_undo_reply)
+
+        # Test gpt-3.5 case
+        model = Model("gpt-3.5")
+        self.assertEqual(model.reminder, "sys")
+
+        # Test 3.5-sonnet case
+        model = Model("claude-3.5-sonnet")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertTrue(model.examples_as_sys_msg)
+        self.assertEqual(model.reminder, "user")
+
+        # Test o1- prefix case
+        model = Model("o1-something")
+        self.assertFalse(model.use_system_prompt)
+        self.assertFalse(model.use_temperature)
+
+        # Test qwen case
+        model = Model("qwen-coder-2.5-32b")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertEqual(model.editor_edit_format, "editor-diff")
+        self.assertTrue(model.use_repo_map)
+
     def test_aider_extra_model_settings(self):
         import tempfile
 

commit 3add686e9b747bff611a0aaab87ca41dd2c5d9da
Author: Paul Gauthier <paul@aider.chat>
Date:   Thu Feb 6 08:25:38 2025 -0800

    test: Remove gpt-4-turbo test case from test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 95947894..f39d62e0 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -219,12 +219,6 @@ class TestModels(unittest.TestCase):
         self.assertTrue(model.send_undo_reply)
         self.assertTrue(model.examples_as_sys_msg)
 
-        # Test gpt-4-turbo case
-        model = Model("gpt-4-turbo")
-        self.assertEqual(model.edit_format, "udiff")
-        self.assertTrue(model.use_repo_map)
-        self.assertTrue(model.send_undo_reply)
-
         # Test gpt-4 case
         model = Model("gpt-4")
         self.assertEqual(model.edit_format, "diff")

commit 7db1613b1ae0da7ab1073d4cb6d5e91bf1053fb3
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:25:59 2025 -0800

    test: Add provider-prefixed deepseek model test cases

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index f39d62e0..a05b6b55 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -212,6 +212,21 @@ class TestModels(unittest.TestCase):
         self.assertFalse(model.use_temperature)
         self.assertEqual(model.remove_reasoning, "think")
 
+        # Test provider/deepseek-r1 case
+        model = Model("someprovider/deepseek-r1")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertTrue(model.examples_as_sys_msg)
+        self.assertFalse(model.use_temperature)
+        self.assertEqual(model.remove_reasoning, "think")
+
+        # Test provider/deepseek-v3 case
+        model = Model("anotherprovider/deepseek-v3")
+        self.assertEqual(model.edit_format, "diff")
+        self.assertTrue(model.use_repo_map)
+        self.assertEqual(model.reminder, "sys")
+        self.assertTrue(model.examples_as_sys_msg)
+
         # Test llama3 70b case
         model = Model("llama3-70b")
         self.assertEqual(model.edit_format, "diff")

commit 856006a68df0dd2f744aa67aaefaee6e88dbcb6f
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:36:33 2025 -0800

    test: add tests for `remove_reasoning_content` and `simple_send_with_retries`

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index a05b6b55..3c62339d 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -262,6 +262,68 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.editor_edit_format, "editor-diff")
         self.assertTrue(model.use_repo_map)
 
+    def test_remove_reasoning_content(self):
+        # Test with no removal configured
+        model = Model("gpt-4")
+        text = "Here is <think>some reasoning</think> and regular text"
+        self.assertEqual(model.remove_reasoning_content(text), text)
+
+        # Test with removal configured
+        model = Model("deepseek-r1")  # This model has remove_reasoning="think"
+        text = """Here is some text
+<think>
+This is reasoning that should be removed
+Over multiple lines
+</think>
+And more text here"""
+        expected = """Here is some text
+
+And more text here"""
+        self.assertEqual(model.remove_reasoning_content(text), expected)
+
+        # Test with multiple reasoning blocks
+        text = """Start
+<think>Block 1</think>
+Middle
+<think>Block 2</think>
+End"""
+        expected = """Start
+
+Middle
+
+End"""
+        self.assertEqual(model.remove_reasoning_content(text), expected)
+
+        # Test with no reasoning blocks
+        text = "Just regular text"
+        self.assertEqual(model.remove_reasoning_content(text), text)
+
+    @patch("aider.models.litellm.completion")
+    def test_simple_send_with_retries_removes_reasoning(self, mock_completion):
+        model = Model("deepseek-r1")  # This model has remove_reasoning="think"
+        
+        # Mock the completion response
+        mock_response = MagicMock()
+        mock_response.choices = [
+            MagicMock(message=MagicMock(content="""Here is some text
+<think>
+This reasoning should be removed
+</think>
+And this text should remain"""))
+        ]
+        mock_completion.return_value = mock_response
+
+        messages = [{"role": "user", "content": "test"}]
+        result = model.simple_send_with_retries(messages)
+
+        expected = """Here is some text
+
+And this text should remain"""
+        self.assertEqual(result, expected)
+
+        # Verify the completion was called
+        mock_completion.assert_called_once()
+
     def test_aider_extra_model_settings(self):
         import tempfile
 

commit 51938affc2c53c47499198757e4846ebebecd362
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 08:36:38 2025 -0800

    style: Format test_models.py with linter

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 3c62339d..d8750ddb 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -301,16 +301,14 @@ End"""
     @patch("aider.models.litellm.completion")
     def test_simple_send_with_retries_removes_reasoning(self, mock_completion):
         model = Model("deepseek-r1")  # This model has remove_reasoning="think"
-        
+
         # Mock the completion response
         mock_response = MagicMock()
-        mock_response.choices = [
-            MagicMock(message=MagicMock(content="""Here is some text
+        mock_response.choices = [MagicMock(message=MagicMock(content="""Here is some text
 <think>
 This reasoning should be removed
 </think>
-And this text should remain"""))
-        ]
+And this text should remain"""))]
         mock_completion.return_value = mock_response
 
         messages = [{"role": "user", "content": "test"}]

commit 3c9f4ee555f8b973be51439e9a56ae81f5fdd1f7
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 09:33:23 2025 -0800

    test: Add tests for use_temperature behavior in Model class

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index d8750ddb..435ab208 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -426,6 +426,52 @@ And this text should remain"""
         )
         self.assertNotIn("num_ctx", mock_completion.call_args.kwargs)
 
+    def test_use_temperature_settings(self):
+        # Test use_temperature=True (default) uses temperature=0
+        model = Model("gpt-4")
+        self.assertTrue(model.use_temperature)
+        self.assertEqual(model.use_temperature, True)
+        
+        # Test use_temperature=False doesn't pass temperature
+        model = Model("github/o1-mini")
+        self.assertFalse(model.use_temperature)
+        
+        # Test use_temperature as float value
+        model = Model("gpt-4")
+        model.use_temperature = 0.7
+        self.assertEqual(model.use_temperature, 0.7)
+
+    @patch("aider.models.litellm.completion")
+    def test_use_temperature_in_send_completion(self, mock_completion):
+        # Test use_temperature=True sends temperature=0
+        model = Model("gpt-4")
+        messages = [{"role": "user", "content": "Hello"}]
+        model.send_completion(messages, functions=None, stream=False)
+        mock_completion.assert_called_with(
+            model=model.name,
+            messages=messages,
+            stream=False,
+            temperature=0,
+        )
+
+        # Test use_temperature=False doesn't send temperature
+        model = Model("github/o1-mini")
+        messages = [{"role": "user", "content": "Hello"}]
+        model.send_completion(messages, functions=None, stream=False)
+        self.assertNotIn("temperature", mock_completion.call_args.kwargs)
+
+        # Test use_temperature as float sends that value
+        model = Model("gpt-4")
+        model.use_temperature = 0.7
+        messages = [{"role": "user", "content": "Hello"}]
+        model.send_completion(messages, functions=None, stream=False)
+        mock_completion.assert_called_with(
+            model=model.name,
+            messages=messages,
+            stream=False,
+            temperature=0.7,
+        )
+
 
 if __name__ == "__main__":
     unittest.main()

commit a9dd6e0f3dca32c211baa1f64d0fd708b94c93e6
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 09:33:30 2025 -0800

    style: Remove trailing whitespace in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 435ab208..f54cbca6 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -431,11 +431,11 @@ And this text should remain"""
         model = Model("gpt-4")
         self.assertTrue(model.use_temperature)
         self.assertEqual(model.use_temperature, True)
-        
+
         # Test use_temperature=False doesn't pass temperature
         model = Model("github/o1-mini")
         self.assertFalse(model.use_temperature)
-        
+
         # Test use_temperature as float value
         model = Model("gpt-4")
         model.use_temperature = 0.7

commit 44171417e3cd2ce064586eb0d0ecf7d1baa38527
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 11:46:39 2025 -0800

    fix: Update test assertions to include timeout parameter

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index f54cbca6..6d156261 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -391,6 +391,7 @@ And this text should remain"""
             stream=False,
             temperature=0,
             num_ctx=expected_ctx,
+            timeout=600,
         )
 
     @patch("aider.models.litellm.completion")
@@ -408,6 +409,7 @@ And this text should remain"""
             stream=False,
             temperature=0,
             num_ctx=4096,
+            timeout=600,
         )
 
     @patch("aider.models.litellm.completion")
@@ -423,6 +425,7 @@ And this text should remain"""
             messages=messages,
             stream=False,
             temperature=0,
+            timeout=600,
         )
         self.assertNotIn("num_ctx", mock_completion.call_args.kwargs)
 
@@ -452,6 +455,7 @@ And this text should remain"""
             messages=messages,
             stream=False,
             temperature=0,
+            timeout=600,
         )
 
         # Test use_temperature=False doesn't send temperature

commit f9fd4c71f157d85b47c32f1b3091fadd229647ff
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 11:47:08 2025 -0800

    fix: Add missing timeout parameter to test assertion

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 6d156261..f89a0739 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -474,6 +474,7 @@ And this text should remain"""
             messages=messages,
             stream=False,
             temperature=0.7,
+            timeout=600,
         )
 
 

commit 36ea166c20f6e3f39f315ec3ad48958f091d08a6
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Thu Feb 6 11:47:57 2025 -0800

    test: add request_timeout tests for Model class

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index f89a0739..462e9111 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -444,6 +444,50 @@ And this text should remain"""
         model.use_temperature = 0.7
         self.assertEqual(model.use_temperature, 0.7)
 
+    @patch("aider.models.litellm.completion")
+    def test_request_timeout_default(self, mock_completion):
+        # Test default timeout is used when not specified in extra_params
+        model = Model("gpt-4")
+        messages = [{"role": "user", "content": "Hello"}]
+        model.send_completion(messages, functions=None, stream=False)
+        mock_completion.assert_called_with(
+            model=model.name,
+            messages=messages,
+            stream=False,
+            temperature=0,
+            timeout=600,  # Default timeout
+        )
+
+    @patch("aider.models.litellm.completion")
+    def test_request_timeout_from_extra_params(self, mock_completion):
+        # Test timeout from extra_params overrides default
+        model = Model("gpt-4")
+        model.extra_params = {"timeout": 300}  # 5 minutes
+        messages = [{"role": "user", "content": "Hello"}]
+        model.send_completion(messages, functions=None, stream=False)
+        mock_completion.assert_called_with(
+            model=model.name,
+            messages=messages,
+            stream=False,
+            temperature=0,
+            timeout=300,  # From extra_params
+        )
+
+    @patch("aider.models.litellm.completion")
+    def test_request_timeout_explicit_in_call(self, mock_completion):
+        # Test explicit timeout in send_completion overrides both default and extra_params
+        model = Model("gpt-4")
+        model.extra_params = {"timeout": 300}  # 5 minutes
+        messages = [{"role": "user", "content": "Hello"}]
+        model.send_completion(messages, functions=None, stream=False, timeout=120)  # 2 minutes
+        mock_completion.assert_called_with(
+            model=model.name,
+            messages=messages,
+            stream=False,
+            temperature=0,
+            timeout=120,  # Explicit in call
+        )
+
     @patch("aider.models.litellm.completion")
     def test_use_temperature_in_send_completion(self, mock_completion):
         # Test use_temperature=True sends temperature=0

commit 53ce96b48f919cac512c1d183738448a12725a77
Author: Paul Gauthier <paul@aider.chat>
Date:   Thu Feb 6 11:48:55 2025 -0800

    refactor: Remove redundant test case for request timeout in send_completion

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 462e9111..aa99040a 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -473,21 +473,6 @@ And this text should remain"""
             timeout=300,  # From extra_params
         )
 
-    @patch("aider.models.litellm.completion")
-    def test_request_timeout_explicit_in_call(self, mock_completion):
-        # Test explicit timeout in send_completion overrides both default and extra_params
-        model = Model("gpt-4")
-        model.extra_params = {"timeout": 300}  # 5 minutes
-        messages = [{"role": "user", "content": "Hello"}]
-        model.send_completion(messages, functions=None, stream=False, timeout=120)  # 2 minutes
-        mock_completion.assert_called_with(
-            model=model.name,
-            messages=messages,
-            stream=False,
-            temperature=0,
-            timeout=120,  # Explicit in call
-        )
-
     @patch("aider.models.litellm.completion")
     def test_use_temperature_in_send_completion(self, mock_completion):
         # Test use_temperature=True sends temperature=0

commit 2f79b4fde7737b25f349d56a749930e46032decc
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Mon Feb 24 12:32:47 2025 -0800

    test: Update sonnet model name in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index aa99040a..be42f3bf 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -123,7 +123,7 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.name, "gpt-3.5-turbo")
 
         model = Model("sonnet")
-        self.assertEqual(model.name, "claude-3-5-sonnet-20241022")
+        self.assertEqual(model.name, "anthropic/claude-3-7-sonnet-20250219")
 
         model = Model("haiku")
         self.assertEqual(model.name, "claude-3-5-haiku-20241022")

commit 90efaa41c2b505b2e88017f5778d0fa171b9e05d
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Wed Mar 5 17:07:43 2025 -0800

    test: Add tests for `check_for_dependencies` function

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index be42f3bf..2cc887ff 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -144,6 +144,55 @@ class TestModels(unittest.TestCase):
         model = Model("github/o1-preview")
         self.assertEqual(model.name, "github/o1-preview")
         self.assertEqual(model.use_temperature, False)
+        
+    @patch("aider.models.check_pip_install_extra")
+    def test_check_for_dependencies_bedrock(self, mock_check_pip):
+        """Test that check_for_dependencies calls check_pip_install_extra for Bedrock models"""
+        from aider.io import InputOutput
+        io = InputOutput()
+        
+        # Test with a Bedrock model
+        from aider.models import check_for_dependencies
+        check_for_dependencies(io, "bedrock/anthropic.claude-3-sonnet-20240229-v1:0")
+        
+        # Verify check_pip_install_extra was called with correct arguments
+        mock_check_pip.assert_called_once_with(
+            io, 
+            "boto3", 
+            "AWS Bedrock models require the boto3 package.", 
+            ["boto3"]
+        )
+        
+    @patch("aider.models.check_pip_install_extra")
+    def test_check_for_dependencies_vertex_ai(self, mock_check_pip):
+        """Test that check_for_dependencies calls check_pip_install_extra for Vertex AI models"""
+        from aider.io import InputOutput
+        io = InputOutput()
+        
+        # Test with a Vertex AI model
+        from aider.models import check_for_dependencies
+        check_for_dependencies(io, "vertex_ai/gemini-1.5-pro")
+        
+        # Verify check_pip_install_extra was called with correct arguments
+        mock_check_pip.assert_called_once_with(
+            io, 
+            "google.cloud.aiplatform", 
+            "Google Vertex AI models require the google-cloud-aiplatform package.", 
+            ["google-cloud-aiplatform"]
+        )
+        
+    @patch("aider.models.check_pip_install_extra")
+    def test_check_for_dependencies_other_model(self, mock_check_pip):
+        """Test that check_for_dependencies doesn't call check_pip_install_extra for other models"""
+        from aider.io import InputOutput
+        io = InputOutput()
+        
+        # Test with a non-Bedrock, non-Vertex AI model
+        from aider.models import check_for_dependencies
+        check_for_dependencies(io, "gpt-4")
+        
+        # Verify check_pip_install_extra was not called
+        mock_check_pip.assert_not_called()
 
     def test_get_repo_map_tokens(self):
         # Test default case (no max_input_tokens in info)

commit c6e02a620aa8eef5302e8468c555e1c4a5431491
Author: Paul Gauthier <paul@aider.chat>
Date:   Wed Mar 5 17:11:15 2025 -0800

    test: Add unit tests for model dependency checks and sanity checks

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 2cc887ff..9a263a29 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -105,6 +105,21 @@ class TestModels(unittest.TestCase):
             any("bogus-model" in msg for msg in warning_messages)
         )  # Check that one of the warnings mentions the bogus model
 
+    @patch("aider.models.check_for_dependencies")
+    def test_sanity_check_model_calls_check_dependencies(self, mock_check_deps):
+        """Test that sanity_check_model calls check_for_dependencies"""
+        mock_io = MagicMock()
+        model = MagicMock()
+        model.name = "test-model"
+        model.missing_keys = []
+        model.keys_in_environment = True
+        model.info = {"some": "info"}
+
+        sanity_check_model(mock_io, model)
+
+        # Verify check_for_dependencies was called with the model name
+        mock_check_deps.assert_called_once_with(mock_io, "test-model")
+
     def test_model_aliases(self):
         # Test common aliases
         model = Model("4")
@@ -144,53 +159,56 @@ class TestModels(unittest.TestCase):
         model = Model("github/o1-preview")
         self.assertEqual(model.name, "github/o1-preview")
         self.assertEqual(model.use_temperature, False)
-        
+
     @patch("aider.models.check_pip_install_extra")
     def test_check_for_dependencies_bedrock(self, mock_check_pip):
         """Test that check_for_dependencies calls check_pip_install_extra for Bedrock models"""
         from aider.io import InputOutput
+
         io = InputOutput()
-        
+
         # Test with a Bedrock model
         from aider.models import check_for_dependencies
+
         check_for_dependencies(io, "bedrock/anthropic.claude-3-sonnet-20240229-v1:0")
-        
+
         # Verify check_pip_install_extra was called with correct arguments
         mock_check_pip.assert_called_once_with(
-            io, 
-            "boto3", 
-            "AWS Bedrock models require the boto3 package.", 
-            ["boto3"]
+            io, "boto3", "AWS Bedrock models require the boto3 package.", ["boto3"]
         )
-        
+
     @patch("aider.models.check_pip_install_extra")
     def test_check_for_dependencies_vertex_ai(self, mock_check_pip):
         """Test that check_for_dependencies calls check_pip_install_extra for Vertex AI models"""
         from aider.io import InputOutput
+
         io = InputOutput()
-        
+
         # Test with a Vertex AI model
         from aider.models import check_for_dependencies
+
         check_for_dependencies(io, "vertex_ai/gemini-1.5-pro")
-        
+
         # Verify check_pip_install_extra was called with correct arguments
         mock_check_pip.assert_called_once_with(
-            io, 
-            "google.cloud.aiplatform", 
-            "Google Vertex AI models require the google-cloud-aiplatform package.", 
-            ["google-cloud-aiplatform"]
+            io,
+            "google.cloud.aiplatform",
+            "Google Vertex AI models require the google-cloud-aiplatform package.",
+            ["google-cloud-aiplatform"],
         )
-        
+
     @patch("aider.models.check_pip_install_extra")
     def test_check_for_dependencies_other_model(self, mock_check_pip):
         """Test that check_for_dependencies doesn't call check_pip_install_extra for other models"""
         from aider.io import InputOutput
+
         io = InputOutput()
-        
+
         # Test with a non-Bedrock, non-Vertex AI model
         from aider.models import check_for_dependencies
+
         check_for_dependencies(io, "gpt-4")
-        
+
         # Verify check_pip_install_extra was not called
         mock_check_pip.assert_not_called()
 

commit b53c0b982a556ddbbafe43186eee90737cd56981
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Mar 7 17:54:28 2025 -0800

    refactor: Move reasoning content removal tests to test_reasoning.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 9a263a29..9f86b474 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -329,65 +329,7 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.editor_edit_format, "editor-diff")
         self.assertTrue(model.use_repo_map)
 
-    def test_remove_reasoning_content(self):
-        # Test with no removal configured
-        model = Model("gpt-4")
-        text = "Here is <think>some reasoning</think> and regular text"
-        self.assertEqual(model.remove_reasoning_content(text), text)
-
-        # Test with removal configured
-        model = Model("deepseek-r1")  # This model has remove_reasoning="think"
-        text = """Here is some text
-<think>
-This is reasoning that should be removed
-Over multiple lines
-</think>
-And more text here"""
-        expected = """Here is some text
-
-And more text here"""
-        self.assertEqual(model.remove_reasoning_content(text), expected)
-
-        # Test with multiple reasoning blocks
-        text = """Start
-<think>Block 1</think>
-Middle
-<think>Block 2</think>
-End"""
-        expected = """Start
-
-Middle
-
-End"""
-        self.assertEqual(model.remove_reasoning_content(text), expected)
-
-        # Test with no reasoning blocks
-        text = "Just regular text"
-        self.assertEqual(model.remove_reasoning_content(text), text)
-
-    @patch("aider.models.litellm.completion")
-    def test_simple_send_with_retries_removes_reasoning(self, mock_completion):
-        model = Model("deepseek-r1")  # This model has remove_reasoning="think"
-
-        # Mock the completion response
-        mock_response = MagicMock()
-        mock_response.choices = [MagicMock(message=MagicMock(content="""Here is some text
-<think>
-This reasoning should be removed
-</think>
-And this text should remain"""))]
-        mock_completion.return_value = mock_response
-
-        messages = [{"role": "user", "content": "test"}]
-        result = model.simple_send_with_retries(messages)
-
-        expected = """Here is some text
-
-And this text should remain"""
-        self.assertEqual(result, expected)
 
-        # Verify the completion was called
-        mock_completion.assert_called_once()
 
     def test_aider_extra_model_settings(self):
         import tempfile

commit 4858749a20eaa5b2393c37976d67d30d3f294377
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Fri Mar 7 17:54:34 2025 -0800

    style: Apply linter fixes to test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 9f86b474..355ddeef 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -329,8 +329,6 @@ class TestModels(unittest.TestCase):
         self.assertEqual(model.editor_edit_format, "editor-diff")
         self.assertTrue(model.use_repo_map)
 
-
-
     def test_aider_extra_model_settings(self):
         import tempfile
 

commit 072ce87051bbfeab3af8b4c97b9f3c8a87328dae
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Sat Mar 8 17:34:43 2025 -0800

    refactor: rename remove_reasoning to reasoning_tag in test files

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 355ddeef..97262776 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -277,7 +277,7 @@ class TestModels(unittest.TestCase):
         self.assertTrue(model.use_repo_map)
         self.assertTrue(model.examples_as_sys_msg)
         self.assertFalse(model.use_temperature)
-        self.assertEqual(model.remove_reasoning, "think")
+        self.assertEqual(model.reasoning_tag, "think")
 
         # Test provider/deepseek-r1 case
         model = Model("someprovider/deepseek-r1")

commit 14e37a82ab01ddaedf7e2e326fec00b7fda15fd7
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Sat Mar 8 17:37:37 2025 -0800

    fix: maintain backward compatibility for remove_reasoning field

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 97262776..96848131 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -285,7 +285,7 @@ class TestModels(unittest.TestCase):
         self.assertTrue(model.use_repo_map)
         self.assertTrue(model.examples_as_sys_msg)
         self.assertFalse(model.use_temperature)
-        self.assertEqual(model.remove_reasoning, "think")
+        self.assertEqual(model.reasoning_tag, "think")
 
         # Test provider/deepseek-v3 case
         model = Model("anotherprovider/deepseek-v3")

commit 58cd190ca9886d7687b468c57acb0aacc529a445
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Tue Mar 11 11:30:23 2025 -0700

    test: Add comprehensive tests for token parsing and thinking tokens methods

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index 96848131..f5b6de51 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -159,6 +159,51 @@ class TestModels(unittest.TestCase):
         model = Model("github/o1-preview")
         self.assertEqual(model.name, "github/o1-preview")
         self.assertEqual(model.use_temperature, False)
+        
+    def test_parse_token_value(self):
+        # Create a model instance to test the parse_token_value method
+        model = Model("gpt-4")
+        
+        # Test integer inputs
+        self.assertEqual(model.parse_token_value(8096), 8096)
+        self.assertEqual(model.parse_token_value(1000), 1000)
+        
+        # Test string inputs
+        self.assertEqual(model.parse_token_value("8096"), 8096)
+        
+        # Test k/K suffix (kilobytes)
+        self.assertEqual(model.parse_token_value("8k"), 8 * 1024)
+        self.assertEqual(model.parse_token_value("8K"), 8 * 1024)
+        self.assertEqual(model.parse_token_value("10.5k"), 10.5 * 1024)
+        self.assertEqual(model.parse_token_value("0.5K"), 0.5 * 1024)
+        
+        # Test m/M suffix (megabytes)
+        self.assertEqual(model.parse_token_value("1m"), 1 * 1024 * 1024)
+        self.assertEqual(model.parse_token_value("1M"), 1 * 1024 * 1024)
+        self.assertEqual(model.parse_token_value("0.5M"), 0.5 * 1024 * 1024)
+        
+        # Test with spaces
+        self.assertEqual(model.parse_token_value(" 8k "), 8 * 1024)
+        
+        # Test conversion from other types
+        self.assertEqual(model.parse_token_value(8.0), 8)
+        
+    def test_set_thinking_tokens(self):
+        # Test that set_thinking_tokens correctly sets the tokens with different formats
+        model = Model("gpt-4")
+        
+        # Test with integer
+        model.set_thinking_tokens(8096)
+        self.assertEqual(model.extra_params["thinking"]["budget_tokens"], 8096)
+        self.assertFalse(model.use_temperature)
+        
+        # Test with string
+        model.set_thinking_tokens("10k")
+        self.assertEqual(model.extra_params["thinking"]["budget_tokens"], 10 * 1024)
+        
+        # Test with decimal value
+        model.set_thinking_tokens("0.5M")
+        self.assertEqual(model.extra_params["thinking"]["budget_tokens"], 0.5 * 1024 * 1024)
 
     @patch("aider.models.check_pip_install_extra")
     def test_check_for_dependencies_bedrock(self, mock_check_pip):

commit 68c27f885fec5eb232e9b0a569dd771adab617ea
Author: Paul Gauthier (aider) <paul@aider.chat>
Date:   Tue Mar 11 11:30:28 2025 -0700

    style: Fix linting issues in test_models.py

diff --git a/tests/basic/test_models.py b/tests/basic/test_models.py
index f5b6de51..b4fbfc23 100644
--- a/tests/basic/test_models.py
+++ b/tests/basic/test_models.py
@@ -159,48 +159,48 @@ class TestModels(unittest.TestCase):
         model = Model("github/o1-preview")
         self.assertEqual(model.name, "github/o1-preview")
         self.assertEqual(model.use_temperature, False)
-        
+
     def test_parse_token_value(self):
         # Create a model instance to test the parse_token_value method
         model = Model("gpt-4")
-        
+
         # Test integer inputs
         self.assertEqual(model.parse_token_value(8096), 8096)
         self.assertEqual(model.parse_token_value(1000), 1000)
-        
+
         # Test string inputs
         self.assertEqual(model.parse_token_value("8096"), 8096)
-        
+
         # Test k/K suffix (kilobytes)
         self.assertEqual(model.parse_token_value("8k"), 8 * 1024)
         self.assertEqual(model.parse_token_value("8K"), 8 * 1024)
         self.assertEqual(model.parse_token_value("10.5k"), 10.5 * 1024)
         self.assertEqual(model.parse_token_value("0.5K"), 0.5 * 1024)
-        
+
         # Test m/M suffix (megabytes)
         self.assertEqual(model.parse_token_value("1m"), 1 * 1024 * 1024)
         self.assertEqual(model.parse_token_value("1M"), 1 * 1024 * 1024)
         self.assertEqual(model.parse_token_value("0.5M"), 0.5 * 1024 * 1024)
-        
+
         # Test with spaces
         self.assertEqual(model.parse_token_value(" 8k "), 8 * 1024)
-        
+
         # Test conversion from other types
         self.assertEqual(model.parse_token_value(8.0), 8)
-        
+
     def test_set_thinking_tokens(self):
         # Test that set_thinking_tokens correctly sets the tokens with different formats
         model = Model("gpt-4")
-        
+
         # Test with integer
         model.set_thinking_tokens(8096)
         self.assertEqual(model.extra_params["thinking"]["budget_tokens"], 8096)
         self.assertFalse(model.use_temperature)
-        
+
         # Test with string
         model.set_thinking_tokens("10k")
         self.assertEqual(model.extra_params["thinking"]["budget_tokens"], 10 * 1024)
-        
+
         # Test with decimal value
         model.set_thinking_tokens("0.5M")
         self.assertEqual(model.extra_params["thinking"]["budget_tokens"], 0.5 * 1024 * 1024)

</code></pre>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
        });
    </script>
</body>
</html>
    