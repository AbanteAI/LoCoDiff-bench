<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/apprt/glfw.zig - Gemini 2.5 Flash</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/apprt/glfw.zig</h1>
        <p><a href="../../models/google_gemini-2.5-flash-preview.html">‚Üê Back to Gemini 2.5 Flash Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Gemini 2.5 Flash</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 62392</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 77206</p>
                <p><strong>Native Completion Tokens:</strong> 11552</p>
                <p><strong>Native Tokens Reasoning:</strong> 151</p>
                <p><strong>Native Finish Reason:</strong> STOP</p>
                <p><strong>Cost:</strong> $0.0185121</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/google_gemini-2.5-flash-preview/ghostty_src_apprt_glfw.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/google_gemini-2.5-flash-preview/ghostty_src_apprt_glfw.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/google_gemini-2.5-flash-preview/ghostty_src_apprt_glfw.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index afd17d61..8678f622 100644</div><div class="diff-header">--- a/ghostty_src_apprt_glfw.zig_expectedoutput.txt (expected):tmp/tmpppie7yx2_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_apprt_glfw.zig_extracted.txt (actual):tmp/tmp_mfplbny_actual.txt	</div><div class="diff-info">@@ -191,10 +191,10 @@ pub const App = struct {</div><div>                 ),</div><div>             },</div><div> </div><div class="diff-removed">-            .toggle_fullscreen => self.toggleFullscreen(target),</div><div class="diff-removed">-</div><div>             .open_config => try configpkg.edit.open(self.app.alloc),</div><div> </div><div class="diff-added">+            .reload_config => try self.reloadConfig(target, value),</div><div class="diff-added">+</div><div>             .set_title => switch (target) {</div><div>                 .app => {},</div><div>                 .surface => |surface| try surface.rt_surface.setTitle(value.title),</div><div class="diff-info">@@ -213,8 +213,6 @@ pub const App = struct {</div><div>                 }),</div><div>             },</div><div> </div><div class="diff-removed">-            .reload_config => try self.reloadConfig(target, value),</div><div class="diff-removed">-</div><div>             // Unimplemented</div><div>             .new_split,</div><div>             .goto_split,</div><div class="diff-info">@@ -281,6 +279,17 @@ pub const App = struct {</div><div>         var config = try Config.load(self.app.alloc);</div><div>         errdefer config.deinit();</div><div> </div><div class="diff-added">+        // If we had configuration errors, then log them.</div><div class="diff-added">+        if (!config._diagnostics.empty()) {</div><div class="diff-added">+            var buf = std.ArrayList(u8).init(self.app.alloc);</div><div class="diff-added">+            defer buf.deinit();</div><div class="diff-added">+            for (config._diagnostics.items()) |diag| {</div><div class="diff-added">+                try diag.write(buf.writer());</div><div class="diff-added">+                log.warn("configuration error: {s}", .{buf.items});</div><div class="diff-added">+                buf.clearRetainingCapacity();</div><div class="diff-added">+            }</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div>         // Call into our app to update</div><div>         switch (target) {</div><div>             .app => try self.app.updateConfig(self, &config),</div><div class="diff-info">@@ -292,56 +301,6 @@ pub const App = struct {</div><div>         self.config = config;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Toggle the window to fullscreen mode.</div><div class="diff-removed">-    fn toggleFullscreen(self: *App, target: apprt.Target) void {</div><div class="diff-removed">-        _ = self;</div><div class="diff-removed">-        const surface: *Surface = switch (target) {</div><div class="diff-removed">-            .app => return,</div><div class="diff-removed">-            .surface => |v| v.rt_surface,</div><div class="diff-removed">-        };</div><div class="diff-removed">-        const win = surface.window;</div><div class="diff-removed">-</div><div class="diff-removed">-        if (surface.isFullscreen()) {</div><div class="diff-removed">-            win.setMonitor(</div><div class="diff-removed">-                null,</div><div class="diff-removed">-                @intCast(surface.monitor_dims.position_x),</div><div class="diff-removed">-                @intCast(surface.monitor_dims.position_y),</div><div class="diff-removed">-                surface.monitor_dims.width,</div><div class="diff-removed">-                surface.monitor_dims.height,</div><div class="diff-removed">-                0,</div><div class="diff-removed">-            );</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        }</div><div class="diff-removed">-</div><div class="diff-removed">-        const monitor = win.getMonitor() orelse monitor: {</div><div class="diff-removed">-            log.warn("window had null monitor, getting primary monitor", .{});</div><div class="diff-removed">-            break :monitor glfw.Monitor.getPrimary() orelse {</div><div class="diff-removed">-                log.warn("window could not get any monitor. will not perform action", .{});</div><div class="diff-removed">-                return;</div><div class="diff-removed">-            };</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        const video_mode = monitor.getVideoMode() orelse {</div><div class="diff-removed">-            log.warn("failed to get video mode. will not perform action", .{});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        const position = win.getPos();</div><div class="diff-removed">-        const size = surface.getSize() catch {</div><div class="diff-removed">-            log.warn("failed to get window size. will not perform fullscreen action", .{});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        surface.monitor_dims = .{</div><div class="diff-removed">-            .width = size.width,</div><div class="diff-removed">-            .height = size.height,</div><div class="diff-removed">-            .position_x = position.x,</div><div class="diff-removed">-            .position_y = position.y,</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        win.setMonitor(monitor, 0, 0, video_mode.getWidth(), video_mode.getHeight(), 0);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     /// Create a new tab in the parent surface.</div><div>     fn newTab(self: *App, parent_: ?*CoreSurface) !void {</div><div>         if (comptime !darwin_enabled) {</div><div class="diff-info">@@ -402,8 +361,7 @@ pub const App = struct {</div><div> </div><div>     /// Close the given surface.</div><div>     pub fn closeSurface(self: *App, surface: *Surface) void {</div><div class="diff-removed">-        surface.deinit();</div><div class="diff-removed">-        self.app.alloc.destroy(surface);</div><div class="diff-added">+        surface.close(false);</div><div>     }</div><div> </div><div>     pub fn redrawSurface(self: *App, surface: *Surface) void {</div><div class="diff-info">@@ -420,20 +378,6 @@ pub const App = struct {</div><div>         // GLFW doesn't support the inspector</div><div>     }</div><div> </div><div class="diff-removed">-    fn glfwErrorCallback(code: glfw.ErrorCode, desc: [:0]const u8) void {</div><div class="diff-removed">-        std.log.warn("glfw error={} message={s}", .{ code, desc });</div><div class="diff-removed">-</div><div class="diff-removed">-        // Workaround for: https://github.com/ocornut/imgui/issues/5908</div><div class="diff-removed">-        // If we get an invalid value with "scancode" in the message we assume</div><div class="diff-removed">-        // it is from the glfw key callback that imgui sets and we clear the</div><div class="diff-removed">-        // error so that our future code doesn't crash.</div><div class="diff-removed">-        if (code == glfw.ErrorCode.InvalidValue and</div><div class="diff-removed">-            std.mem.indexOf(u8, desc, "scancode") != null)</div><div class="diff-removed">-        {</div><div class="diff-removed">-            _ = glfw.getError();</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     pub fn keyboardLayout(self: *const App) input.KeyboardLayout {</div><div>         _ = self;</div><div> </div><div class="diff-info">@@ -536,8 +480,8 @@ pub const Surface = struct {</div><div>         // Setup our</div><div>         setInitialWindowPosition(</div><div>             win,</div><div class="diff-removed">-            app.config.@"window-position-x",</div><div class="diff-removed">-            app.config.@"window-position-y",</div><div class="diff-added">+            app.config.@"window-initial-position-x",</div><div class="diff-added">+            app.config.@"window-initial-position-y",</div><div>         );</div><div> </div><div>         // Get our physical DPI - debug only because we don't have a use for</div><div class="diff-info">@@ -600,6 +544,7 @@ pub const Surface = struct {</div><div>             .cursor = null,</div><div>             .core_surface = undefined,</div><div>             .monitor_dims = dimensions,</div><div class="diff-added">+            .title_text = null,</div><div>         };</div><div>         errdefer self.* = undefined;</div><div> </div><div class="diff-info">@@ -672,7 +617,7 @@ pub const Surface = struct {</div><div>     /// Close this surface.</div><div>     pub fn close(self: *Surface, processActive: bool) void {</div><div>         _ = processActive;</div><div class="diff-removed">-        self.setShouldClose();</div><div class="diff-added">+        self.window.setShouldClose(true);</div><div>         self.deinit();</div><div>         self.app.app.alloc.destroy(self);</div><div>     }</div><div class="diff-info">@@ -704,6 +649,13 @@ pub const Surface = struct {</div><div>         win.setPos(.{ .x = start_position_x, .y = start_position_y });</div><div>     }</div><div> </div><div class="diff-added">+    /// Set the cell size. Unused by GLFW.</div><div class="diff-added">+    pub fn setCellSize(self: *const Surface, width: u32, height: u32) !void {</div><div class="diff-added">+        _ = self;</div><div class="diff-added">+        _ = width;</div><div class="diff-added">+        _ = height;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div>     /// Set the size limits of the window.</div><div>     /// Note: this interface is not good, we should redo it if we plan</div><div>     /// to use this more. i.e. you can't set max width but no max height,</div><div class="diff-info">@@ -746,17 +698,6 @@ pub const Surface = struct {</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the flag that notes this window should be closed for the next</div><div class="diff-removed">-    /// iteration of the event loop.</div><div class="diff-removed">-    pub fn setShouldClose(self: *Surface) void {</div><div class="diff-removed">-        self.window.setShouldClose(true);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Returns true if the window is flagged to close.</div><div class="diff-removed">-    pub fn shouldClose(self: *const Surface) bool {</div><div class="diff-removed">-        return self.window.shouldClose();</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     /// Set the title of the window.</div><div>     fn setTitle(self: *Surface, slice: [:0]const u8) !void {</div><div>         if (self.title_text) |t| self.core_surface.alloc.free(t);</div><div class="diff-info">@@ -806,11 +747,23 @@ pub const Surface = struct {</div><div>         self.cursor = new;</div><div>     }</div><div> </div><div class="diff-added">+    pub fn mouseOverLink(self: *Surface, uri: ?[]const u8) void {</div><div class="diff-added">+        // We don't do anything in GLFW.</div><div class="diff-added">+        _ = self;</div><div class="diff-added">+        _ = uri;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div>     /// Set the visibility of the mouse cursor.</div><div>     fn setMouseVisibility(self: *Surface, visible: bool) void {</div><div>         self.window.setInputModeCursor(if (visible) .normal else .hidden);</div><div>     }</div><div> </div><div class="diff-added">+    pub fn updateRendererHealth(self: *const Surface, health: renderer.Health) void {</div><div class="diff-added">+        // We don't support this in GLFW.</div><div class="diff-added">+        _ = self;</div><div class="diff-added">+        _ = health;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div>     pub fn supportsClipboard(</div><div>         self: *const Surface,</div><div>         clipboard_type: apprt.Clipboard,</div><div class="diff-info">@@ -895,17 +848,18 @@ pub const Surface = struct {</div><div>         _ = width;</div><div>         _ = height;</div><div> </div><div class="diff-added">+        const surface = window.getUserPointer(CoreSurface) orelse return;</div><div class="diff-added">+</div><div>         // Get the size. We are given a width/height but this is in screen</div><div>         // coordinates and we want raw pixels. The core window uses the content</div><div>         // scale to scale appropriately.</div><div class="diff-removed">-        const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div class="diff-removed">-        const size = core_win.rt_surface.getSize() catch |err| {</div><div class="diff-added">+        const size = surface.rt_surface.getSize() catch |err| {</div><div>             log.err("error querying window size for size callback err={}", .{err});</div><div>             return;</div><div>         };</div><div> </div><div>         // Call the primary callback.</div><div class="diff-removed">-        core_win.sizeCallback(size) catch |err| {</div><div class="diff-added">+        surface.sizeCallback(size) catch |err| {</div><div>             log.err("error in size callback err={}", .{err});</div><div>             return;</div><div>         };</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    