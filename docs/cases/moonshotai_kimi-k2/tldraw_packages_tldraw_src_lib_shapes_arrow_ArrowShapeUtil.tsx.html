<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/tldraw/src/lib/shapes/arrow/ArrowShapeUtil.tsx - Kimi K2</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/tldraw/src/lib/shapes/arrow/ArrowShapeUtil.tsx</h1>
        <h2>Model: Kimi K2</h2>
        <p><a href="../../models/moonshotai_kimi-k2.html">All Kimi K2 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Kimi K2</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 97521</p>
                <p><strong>Native Prompt Tokens:</strong> 97996</p>
                <p><strong>Native Completion Tokens:</strong> 6785</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.07146322</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/moonshotai_kimi-k2/tldraw_packages_tldraw_src_lib_shapes_arrow_ArrowShapeUtil.tsx/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/moonshotai_kimi-k2/tldraw_packages_tldraw_src_lib_shapes_arrow_ArrowShapeUtil.tsx/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/moonshotai_kimi-k2/tldraw_packages_tldraw_src_lib_shapes_arrow_ArrowShapeUtil.tsx/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index e34dd9818..9b5555d3b 100644</div><div class="diff-header">--- a/tldraw_packages_tldraw_src_lib_shapes_arrow_ArrowShapeUtil.tsx_expectedoutput.txt (expected):tmp/tmp4y6my8r2_expected.txt	</div><div class="diff-header">+++ b/tldraw_packages_tldraw_src_lib_shapes_arrow_ArrowShapeUtil.tsx_extracted.txt (actual):tmp/tmp3brihyz__actual.txt	</div><div class="diff-info">@@ -1,10 +1,8 @@</div><div> import {</div><div> 	Arc2d,</div><div> 	Box,</div><div class="diff-removed">-	EMPTY_ARRAY,</div><div> 	Edge2d,</div><div> 	Editor,</div><div class="diff-removed">-	Geometry2d,</div><div> 	Group2d,</div><div> 	Rectangle2d,</div><div> 	SVGContainer,</div><div class="diff-info">@@ -13,7 +11,6 @@ import {</div><div> 	TLArrowBinding,</div><div> 	TLArrowShape,</div><div> 	TLArrowShapeProps,</div><div class="diff-removed">-	TLFontFace,</div><div> 	TLHandle,</div><div> 	TLHandleDragInfo,</div><div> 	TLResizeInfo,</div><div class="diff-info">@@ -116,11 +113,6 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 		return true</div><div> 	}</div><div> </div><div class="diff-removed">-	override getFontFaces(shape: TLArrowShape): TLFontFace[] {</div><div class="diff-removed">-		if (!shape.props.text) return EMPTY_ARRAY</div><div class="diff-removed">-		return [DefaultFontFaces[`tldraw_${shape.props.font}`].normal.normal]</div><div class="diff-removed">-	}</div><div class="diff-removed">-</div><div> 	override getDefaultProps(): TLArrowShape['props'] {</div><div> 		return {</div><div> 			dash: 'draw',</div><div class="diff-info">@@ -149,14 +141,14 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 			? new Edge2d({</div><div> 					start: Vec.From(info.start.point),</div><div> 					end: Vec.From(info.end.point),</div><div class="diff-removed">-				})</div><div class="diff-added">+			  })</div><div> 			: new Arc2d({</div><div> 					center: Vec.Cast(info.handleArc.center),</div><div> 					start: Vec.Cast(info.start.point),</div><div> 					end: Vec.Cast(info.end.point),</div><div> 					sweepFlag: info.bodyArc.sweepFlag,</div><div> 					largeArcFlag: info.bodyArc.largeArcFlag,</div><div class="diff-removed">-				})</div><div class="diff-added">+			  })</div><div> </div><div> 		let labelGeom</div><div> 		if (shape.props.text.trim()) {</div><div class="diff-info">@@ -209,6 +201,11 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 		return shape.props.text</div><div> 	}</div><div> </div><div class="diff-added">+	override getFontFaces(shape: TLArrowShape): TLFontFace[] {</div><div class="diff-added">+		if (!shape.props.text) return EMPTY_ARRAY</div><div class="diff-added">+		return [DefaultFontFaces[`tldraw_${shape.props.font}`].normal.normal]</div><div class="diff-added">+	}</div><div class="diff-added">+</div><div> 	override onHandleDrag(</div><div> 		shape: TLArrowShape,</div><div> 		{ handle, isPrecise }: TLHandleDragInfo<TLArrowShape></div><div class="diff-info">@@ -247,10 +244,10 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 			// Skip binding</div><div> 			removeArrowBinding(this.editor, shape, handleId)</div><div> </div><div class="diff-removed">-			update.props![handleId] = {</div><div class="diff-removed">-				x: handle.x,</div><div class="diff-removed">-				y: handle.y,</div><div class="diff-removed">-			}</div><div class="diff-added">+			update.props![handleId] = maybeSnapToGrid(</div><div class="diff-added">+				new Vec(handle.x, handle.y),</div><div class="diff-added">+				this.editor</div><div class="diff-added">+			).toJson()</div><div> 			return update</div><div> 		}</div><div> </div><div class="diff-info">@@ -271,11 +268,11 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 		if (!target) {</div><div> 			// todo: maybe double check that this isn't equal to the other handle too?</div><div> 			removeArrowBinding(this.editor, shape, handleId)</div><div class="diff-removed">-			const newPoint = maybeSnapToGrid(new Vec(handle.x, handle.y), this.editor)</div><div class="diff-removed">-			update.props![handleId] = {</div><div class="diff-removed">-				x: newPoint.x,</div><div class="diff-removed">-				y: newPoint.y,</div><div class="diff-removed">-			}</div><div class="diff-added">+</div><div class="diff-added">+			update.props![handleId] = maybeSnapToGrid(</div><div class="diff-added">+				new Vec(handle.x, handle.y),</div><div class="diff-added">+				this.editor</div><div class="diff-added">+			).toJson()</div><div> 			return update</div><div> 		}</div><div> </div><div class="diff-info">@@ -393,25 +390,6 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 			}),</div><div> 		})</div><div> </div><div class="diff-removed">-		// update arrow terminal bindings eagerly to make sure the arrows unbind nicely when translating</div><div class="diff-removed">-		if (bindings.start) {</div><div class="diff-removed">-			updateArrowTerminal({</div><div class="diff-removed">-				editor: this.editor,</div><div class="diff-removed">-				arrow: shape,</div><div class="diff-removed">-				terminal: 'start',</div><div class="diff-removed">-				useHandle: true,</div><div class="diff-removed">-			})</div><div class="diff-removed">-			shape = this.editor.getShape(shape.id) as TLArrowShape</div><div class="diff-removed">-		}</div><div class="diff-removed">-		if (bindings.end) {</div><div class="diff-removed">-			updateArrowTerminal({</div><div class="diff-removed">-				editor: this.editor,</div><div class="diff-removed">-				arrow: shape,</div><div class="diff-removed">-				terminal: 'end',</div><div class="diff-removed">-				useHandle: true,</div><div class="diff-removed">-			})</div><div class="diff-removed">-		}</div><div class="diff-removed">-</div><div> 		for (const handleName of [ARROW_HANDLES.START, ARROW_HANDLES.END] as const) {</div><div> 			const binding = bindings[handleName]</div><div> 			if (!binding) continue</div><div class="diff-info">@@ -500,10 +478,8 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 		const mx = Math.abs(scaleX)</div><div> 		const my = Math.abs(scaleY)</div><div> </div><div class="diff-removed">-		const startNormalizedAnchor = bindings?.start</div><div class="diff-removed">-			? Vec.From(bindings.start.props.normalizedAnchor)</div><div class="diff-removed">-			: null</div><div class="diff-removed">-		const endNormalizedAnchor = bindings?.end ? Vec.From(bindings.end.props.normalizedAnchor) : null</div><div class="diff-added">+		let startNormalizedAnchor = bindings?.start ? Vec.From(bindings.start.props.normalizedAnchor) : null</div><div class="diff-added">+		let endNormalizedAnchor = bindings?.end ? Vec.From(bindings.end.props.normalizedAnchor) : null</div><div> </div><div> 		if (scaleX < 0 && scaleY >= 0) {</div><div> 			if (bend !== 0) {</div><div class="diff-info">@@ -603,153 +579,6 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 		}</div><div> 	}</div><div> </div><div class="diff-removed">-	component(shape: TLArrowShape) {</div><div class="diff-removed">-		// eslint-disable-next-line react-hooks/rules-of-hooks</div><div class="diff-removed">-		const theme = useDefaultColorTheme()</div><div class="diff-removed">-		const onlySelectedShape = this.editor.getOnlySelectedShape()</div><div class="diff-removed">-		const shouldDisplayHandles =</div><div class="diff-removed">-			this.editor.isInAny(</div><div class="diff-removed">-				'select.idle',</div><div class="diff-removed">-				'select.pointing_handle',</div><div class="diff-removed">-				'select.dragging_handle',</div><div class="diff-removed">-				'select.translating',</div><div class="diff-removed">-				'arrow.dragging'</div><div class="diff-removed">-			) && !this.editor.getIsReadonly()</div><div class="diff-removed">-</div><div class="diff-removed">-		const info = getArrowInfo(this.editor, shape)</div><div class="diff-removed">-		if (!info?.isValid) return null</div><div class="diff-removed">-</div><div class="diff-removed">-		const labelPosition = getArrowLabelPosition(this.editor, shape)</div><div class="diff-removed">-		const isSelected = shape.id === this.editor.getOnlySelectedShapeId()</div><div class="diff-removed">-		const isEditing = this.editor.getEditingShapeId() === shape.id</div><div class="diff-removed">-		const showArrowLabel = isEditing || shape.props.text</div><div class="diff-removed">-</div><div class="diff-removed">-		return (</div><div class="diff-removed">-			<></div><div class="diff-removed">-				<SVGContainer style={{ minWidth: 50, minHeight: 50 }}></div><div class="diff-removed">-					<ArrowSvg</div><div class="diff-removed">-						shape={shape}</div><div class="diff-removed">-						shouldDisplayHandles={shouldDisplayHandles && onlySelectedShape?.id === shape.id}</div><div class="diff-removed">-					/></div><div class="diff-removed">-				</SVGContainer></div><div class="diff-removed">-				{showArrowLabel && (</div><div class="diff-removed">-					<PlainTextLabel</div><div class="diff-removed">-						shapeId={shape.id}</div><div class="diff-removed">-						classNamePrefix="tl-arrow"</div><div class="diff-removed">-						type="arrow"</div><div class="diff-removed">-						font={shape.props.font}</div><div class="diff-removed">-						fontSize={getArrowLabelFontSize(shape)}</div><div class="diff-removed">-						lineHeight={TEXT_PROPS.lineHeight}</div><div class="diff-removed">-						align="middle"</div><div class="diff-removed">-						verticalAlign="middle"</div><div class="diff-removed">-						text={shape.props.text}</div><div class="diff-removed">-						labelColor={theme[shape.props.labelColor].solid}</div><div class="diff-removed">-						textWidth={labelPosition.box.w - ARROW_LABEL_PADDING * 2 * shape.props.scale}</div><div class="diff-removed">-						isSelected={isSelected}</div><div class="diff-removed">-						padding={0}</div><div class="diff-removed">-						style={{</div><div class="diff-removed">-							transform: `translate(${labelPosition.box.center.x}px, ${labelPosition.box.center.y}px)`,</div><div class="diff-removed">-						}}</div><div class="diff-removed">-					/></div><div class="diff-removed">-				)}</div><div class="diff-removed">-			</></div><div class="diff-removed">-		)</div><div class="diff-removed">-	}</div><div class="diff-removed">-</div><div class="diff-removed">-	indicator(shape: TLArrowShape) {</div><div class="diff-removed">-		// eslint-disable-next-line react-hooks/rules-of-hooks</div><div class="diff-removed">-		const isEditing = useIsEditing(shape.id)</div><div class="diff-removed">-		// eslint-disable-next-line react-hooks/rules-of-hooks</div><div class="diff-removed">-		const clipPathId = useSharedSafeId(shape.id + '_clip')</div><div class="diff-removed">-</div><div class="diff-removed">-		const info = getArrowInfo(this.editor, shape)</div><div class="diff-removed">-		if (!info) return null</div><div class="diff-removed">-</div><div class="diff-removed">-		const { start, end } = getArrowTerminalsInArrowSpace(this.editor, shape, info?.bindings)</div><div class="diff-removed">-		const geometry = this.editor.getShapeGeometry<Group2d>(shape)</div><div class="diff-removed">-		const bounds = geometry.bounds</div><div class="diff-removed">-</div><div class="diff-removed">-		const labelGeometry = shape.props.text.trim() ? (geometry.children[1] as Rectangle2d) : null</div><div class="diff-removed">-</div><div class="diff-removed">-		if (Vec.Equals(start, end)) return null</div><div class="diff-removed">-</div><div class="diff-removed">-		const strokeWidth = STROKE_SIZES[shape.props.size] * shape.props.scale</div><div class="diff-removed">-</div><div class="diff-removed">-		const as = info.start.arrowhead && getArrowheadPathForType(info, 'start', strokeWidth)</div><div class="diff-removed">-		const ae = info.end.arrowhead && getArrowheadPathForType(info, 'end', strokeWidth)</div><div class="diff-removed">-</div><div class="diff-removed">-		const path = info.isStraight ? getSolidStraightArrowPath(info) : getSolidCurvedArrowPath(info)</div><div class="diff-removed">-</div><div class="diff-removed">-		const includeClipPath =</div><div class="diff-removed">-			(as && info.start.arrowhead !== 'arrow') ||</div><div class="diff-removed">-			(ae && info.end.arrowhead !== 'arrow') ||</div><div class="diff-removed">-			!!labelGeometry</div><div class="diff-removed">-</div><div class="diff-removed">-		if (isEditing && labelGeometry) {</div><div class="diff-removed">-			return (</div><div class="diff-removed">-				<rect</div><div class="diff-removed">-					x={toDomPrecision(labelGeometry.x)}</div><div class="diff-removed">-					y={toDomPrecision(labelGeometry.y)}</div><div class="diff-removed">-					width={labelGeometry.w}</div><div class="diff-removed">-					height={labelGeometry.h}</div><div class="diff-removed">-					rx={3.5 * shape.props.scale}</div><div class="diff-removed">-					ry={3.5 * shape.props.scale}</div><div class="diff-removed">-				/></div><div class="diff-removed">-			)</div><div class="diff-removed">-		}</div><div class="diff-removed">-		const clipStartArrowhead = !(</div><div class="diff-removed">-			info.start.arrowhead === 'none' || info.start.arrowhead === 'arrow'</div><div class="diff-removed">-		)</div><div class="diff-removed">-		const clipEndArrowhead = !(info.end.arrowhead === 'none' || info.end.arrowhead === 'arrow')</div><div class="diff-removed">-</div><div class="diff-removed">-		return (</div><div class="diff-removed">-			<g></div><div class="diff-removed">-				{includeClipPath && (</div><div class="diff-removed">-					<defs></div><div class="diff-removed">-						<ArrowClipPath</div><div class="diff-removed">-							hasText={shape.props.text.trim().length > 0}</div><div class="diff-removed">-							bounds={bounds}</div><div class="diff-removed">-							labelBounds={labelGeometry ? labelGeometry.getBounds() : new Box(0, 0, 0, 0)}</div><div class="diff-removed">-							as={clipStartArrowhead && as ? as : ''}</div><div class="diff-removed">-							ae={clipEndArrowhead && ae ? ae : ''}</div><div class="diff-removed">-						/></div><div class="diff-removed">-					</defs></div><div class="diff-removed">-				)}</div><div class="diff-removed">-				<g</div><div class="diff-removed">-					style={{</div><div class="diff-removed">-						clipPath: includeClipPath ? `url(#${clipPathId})` : undefined,</div><div class="diff-removed">-						WebkitClipPath: includeClipPath ? `url(#${clipPathId})` : undefined,</div><div class="diff-removed">-					}}</div><div class="diff-removed">-				></div><div class="diff-removed">-					{/* This rect needs to be here if we're creating a mask due to an svg quirk on Chrome */}</div><div class="diff-removed">-					{includeClipPath && (</div><div class="diff-removed">-						<rect</div><div class="diff-removed">-							x={bounds.minX - 100}</div><div class="diff-removed">-							y={bounds.minY - 100}</div><div class="diff-removed">-							width={bounds.width + 200}</div><div class="diff-removed">-							height={bounds.height + 200}</div><div class="diff-removed">-							opacity={0}</div><div class="diff-removed">-						/></div><div class="diff-removed">-					)}</div><div class="diff-removed">-</div><div class="diff-removed">-					<path d={path} /></div><div class="diff-removed">-				</g></div><div class="diff-removed">-				{as && <path d={as} />}</div><div class="diff-removed">-				{ae && <path d={ae} />}</div><div class="diff-removed">-				{labelGeometry && (</div><div class="diff-removed">-					<rect</div><div class="diff-removed">-						x={toDomPrecision(labelGeometry.x)}</div><div class="diff-removed">-						y={toDomPrecision(labelGeometry.y)}</div><div class="diff-removed">-						width={labelGeometry.w}</div><div class="diff-removed">-						height={labelGeometry.h}</div><div class="diff-removed">-						rx={3.5}</div><div class="diff-removed">-						ry={3.5}</div><div class="diff-removed">-					/></div><div class="diff-removed">-				)}</div><div class="diff-removed">-			</g></div><div class="diff-removed">-		)</div><div class="diff-removed">-	}</div><div class="diff-removed">-</div><div> 	override onEditEnd(shape: TLArrowShape) {</div><div> 		const {</div><div> 			id,</div><div class="diff-info">@@ -770,30 +599,6 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 		}</div><div> 	}</div><div> </div><div class="diff-removed">-	override toSvg(shape: TLArrowShape, ctx: SvgExportContext) {</div><div class="diff-removed">-		ctx.addExportDef(getFillDefForExport(shape.props.fill))</div><div class="diff-removed">-		const theme = getDefaultColorTheme(ctx)</div><div class="diff-removed">-		const scaleFactor = 1 / shape.props.scale</div><div class="diff-removed">-</div><div class="diff-removed">-		return (</div><div class="diff-removed">-			<g transform={`scale(${scaleFactor})`}></div><div class="diff-removed">-				<ArrowSvg shape={shape} shouldDisplayHandles={false} /></div><div class="diff-removed">-				<SvgTextLabel</div><div class="diff-removed">-					fontSize={getArrowLabelFontSize(shape)}</div><div class="diff-removed">-					font={shape.props.font}</div><div class="diff-removed">-					align="middle"</div><div class="diff-removed">-					verticalAlign="middle"</div><div class="diff-removed">-					text={shape.props.text}</div><div class="diff-removed">-					labelColor={theme[shape.props.labelColor].solid}</div><div class="diff-removed">-					bounds={getArrowLabelPosition(this.editor, shape)</div><div class="diff-removed">-						.box.clone()</div><div class="diff-removed">-						.expandBy(-ARROW_LABEL_PADDING * shape.props.scale)}</div><div class="diff-removed">-					padding={0}</div><div class="diff-removed">-				/></div><div class="diff-removed">-			</g></div><div class="diff-removed">-		)</div><div class="diff-removed">-	}</div><div class="diff-removed">-</div><div> 	override getCanvasSvgDefs(): TLShapeUtilCanvasSvgDef[] {</div><div> 		return [</div><div> 			getFillDefForCanvas(),</div><div class="diff-info">@@ -805,8 +610,13 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 				key: `arrow:cross`,</div><div> 				component: ArrowheadCrossDef,</div><div> 			},</div><div class="diff-added">+			{</div><div class="diff-added">+				key: 'arrow:clipPath',</div><div class="diff-added">+				component: ArrowClipPathDef,</div><div class="diff-added">+			},</div><div> 		]</div><div> 	}</div><div class="diff-added">+</div><div> 	override getInterpolatedProps(</div><div> 		startShape: TLArrowShape,</div><div> 		endShape: TLArrowShape,</div><div class="diff-info">@@ -829,7 +639,7 @@ export class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {</div><div> 	}</div><div> }</div><div> </div><div class="diff-removed">-export function getArrowLength(editor: Editor, shape: TLArrowShape): number {</div><div class="diff-added">+function getArrowLength(editor: Editor, shape: TLArrowShape): number {</div><div> 	const info = getArrowInfo(editor, shape)!</div><div> </div><div> 	return info.isStraight</div><div class="diff-info">@@ -857,10 +667,6 @@ const ArrowSvg = track(function ArrowSvg({</div><div> 		[editor]</div><div> 	)</div><div> </div><div class="diff-removed">-	const clipPathId = useSharedSafeId(shape.id + '_clip')</div><div class="diff-removed">-	const arrowheadDotId = useSharedSafeId('arrowhead-dot')</div><div class="diff-removed">-	const arrowheadCrossId = useSharedSafeId('arrowhead-cross')</div><div class="diff-removed">-</div><div> 	if (!info?.isValid) return null</div><div> </div><div> 	const strokeWidth = STROKE_SIZES[shape.props.size] * shape.props.scale</div><div class="diff-info">@@ -897,8 +703,8 @@ const ArrowSvg = track(function ArrowSvg({</div><div> 							? bindings.start.props.isExact</div><div> 								? ''</div><div> 								: bindings.start.props.isPrecise</div><div class="diff-removed">-									? `url(#${arrowheadCrossId})`</div><div class="diff-removed">-									: `url(#${arrowheadDotId})`</div><div class="diff-added">+									? `url(#${useSharedSafeId('arrowhead-cross')})`</div><div class="diff-added">+									: `url(#${useSharedSafeId('arrowhead-dot')})`</div><div> 							: ''</div><div> 					}</div><div> 					markerEnd={</div><div class="diff-info">@@ -906,8 +712,8 @@ const ArrowSvg = track(function ArrowSvg({</div><div> 							? bindings.end.props.isExact</div><div> 								? ''</div><div> 								: bindings.end.props.isPrecise</div><div class="diff-removed">-									? `url(#${arrowheadCrossId})`</div><div class="diff-removed">-									: `url(#${arrowheadDotId})`</div><div class="diff-added">+									? `url(#${useSharedSafeId('arrowhead-cross')})`</div><div class="diff-added">+									: `url(#${useSharedSafeId('arrowhead-dot')})`</div><div> 							: ''</div><div> 					}</div><div> 					opacity={0.16}</div><div class="diff-info">@@ -929,19 +735,19 @@ const ArrowSvg = track(function ArrowSvg({</div><div> 	const clipStartArrowhead = !(info.start.arrowhead === 'none' || info.start.arrowhead === 'arrow')</div><div> 	const clipEndArrowhead = !(info.end.arrowhead === 'none' || info.end.arrowhead === 'arrow')</div><div> </div><div class="diff-added">+	const clipPathId = useSharedSafeId(shape.id + '_clip')</div><div class="diff-added">+</div><div> 	return (</div><div> 		<></div><div> 			{/* Yep */}</div><div> 			<defs></div><div class="diff-removed">-				<clipPath id={clipPathId}></div><div class="diff-removed">-					<ArrowClipPath</div><div class="diff-removed">-						hasText={shape.props.text.trim().length > 0}</div><div class="diff-removed">-						bounds={bounds}</div><div class="diff-removed">-						labelBounds={labelPosition.box}</div><div class="diff-removed">-						as={clipStartArrowhead && as ? as : ''}</div><div class="diff-removed">-						ae={clipEndArrowhead && ae ? ae : ''}</div><div class="diff-removed">-					/></div><div class="diff-removed">-				</clipPath></div><div class="diff-added">+				<ArrowClipPath</div><div class="diff-added">+					hasText={shape.props.text.trim().length > 0}</div><div class="diff-added">+					bounds={bounds}</div><div class="diff-added">+					labelBounds={labelPosition.box}</div><div class="diff-added">+					as={clipStartArrowhead && as ? as : ''}</div><div class="diff-added">+					ae={clipEndArrowhead && ae ? ae : ''}</div><div class="diff-added">+				/></div><div> 			</defs></div><div> 			<g</div><div> 				fill="none"</div><div class="diff-info">@@ -1005,31 +811,24 @@ function ArrowClipPath({</div><div> 	as: string</div><div> 	ae: string</div><div> }) {</div><div class="diff-removed">-	// The direction in which we create the different path parts is important, as it determines what gets clipped.</div><div class="diff-removed">-	// See the description on the directions in the non-zero fill rule example:</div><div class="diff-removed">-	// https://developer.mozilla.org/en-US/docs/Web/tldraw_packages_tldraw_src_lib_shapes_arrow_ArrowShapeUtil.tsx_extracted.txt (actual): ''}${as}${ae}`} /></div><div class="diff-added">+	const clipPathId = React.useId()</div><div class="diff-added">+	const combinedPath = React.useMemo(() => {</div><div class="diff-added">+		// The direction in which we create the different path parts is important, as it determines what gets clipped.</div><div class="diff-added">+		// See the description on the directions in the non-zero fill rule example:</div><div class="diff-added">+		// https://developer.mozilla.org/en-US/docs/Web/tldraw_packages_tldraw_src_lib_shapes_arrow_ArrowShapeUtil.tsx_extracted.txt (actual): ''}${as}${ae}`</div><div class="diff-added">+	}, [hasText, bounds, labelBounds, as, ae])</div><div class="diff-added">+</div><div class="diff-added">+	return <clipPath id={clipPathId}>{<path d={combinedPath} />}</clipPath></div><div class="diff-added">+}</div><div class="diff-added">+function ArrowClipPathDef() {</div><div class="diff-added">+	return null</div><div> }</div><div class="diff-removed">-</div><div class="diff-removed">-const shapeAtTranslationStart = new WeakMap<</div><div class="diff-removed">-	TLArrowShape,</div><div class="diff-removed">-	{</div><div class="diff-removed">-		pagePosition: Vec</div><div class="diff-removed">-		terminalBindings: Record<</div><div class="diff-removed">-			'start' | 'end',</div><div class="diff-removed">-			{</div><div class="diff-removed">-				pagePosition: Vec</div><div class="diff-removed">-				shapePosition: Vec</div><div class="diff-removed">-				binding: TLArrowBinding</div><div class="diff-removed">-			} | null</div><div class="diff-removed">-		></div><div class="diff-removed">-	}</div><div class="diff-removed">->()</div><div> </div><div> function ArrowheadDotDef() {</div><div> 	const id = useSharedSafeId('arrowhead-dot')</div><div class="diff-info">@@ -1048,4 +847,19 @@ function ArrowheadCrossDef() {</div><div> 			<line x1="1.5" y1="4.5" x2="4.5" y2="1.5" strokeDasharray="100%" /></div><div> 		</marker></div><div> 	)</div><div class="diff-removed">-}</div><div>\ No newline at end of file</div><div class="diff-added">+}</div><div class="diff-added">+</div><div class="diff-added">+const shapeAtTranslationStart = new WeakMap<</div><div class="diff-added">+	TLArrowShape,</div><div class="diff-added">+	{</div><div class="diff-added">+		pagePosition: Vec</div><div class="diff-added">+		terminalBindings: Record<</div><div class="diff-added">+			'start' | 'end',</div><div class="diff-added">+			{</div><div class="diff-added">+				pagePosition: Vec</div><div class="diff-added">+				shapePosition: Vec</div><div class="diff-added">+				binding: TLArrowBinding</div><div class="diff-added">+			} | null</div><div class="diff-added">+		></div><div class="diff-added">+	}</div><div class="diff-added">+>()</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    