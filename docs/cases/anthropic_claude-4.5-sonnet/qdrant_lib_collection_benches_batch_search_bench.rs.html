<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: lib/collection/benches/batch_search_bench.rs - Sonnet 4.5</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: lib/collection/benches/batch_search_bench.rs</h1>
        <h2>Model: Sonnet 4.5</h2>
        <p><a href="../../models/anthropic_claude-4.5-sonnet.html">All Sonnet 4.5 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Sonnet 4.5</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 24820</p>
                <p><strong>Native Prompt Tokens:</strong> 31796</p>
                <p><strong>Native Completion Tokens:</strong> 1</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> None</p>
                <p><strong>Cost:</strong> $0.095403</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/anthropic_claude-4.5-sonnet/qdrant_lib_collection_benches_batch_search_bench.rs/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/anthropic_claude-4.5-sonnet/qdrant_lib_collection_benches_batch_search_bench.rs/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/anthropic_claude-4.5-sonnet/qdrant_lib_collection_benches_batch_search_bench.rs/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 91a2f434c..82420a18f 100644</div><div class="diff-header">--- a/qdrant_lib_collection_benches_batch_search_bench.rs_expectedoutput.txt (expected):tmp/tmpvg56fylk_expected.txt	</div><div class="diff-header">+++ b/qdrant_lib_collection_benches_batch_search_bench.rs_extracted.txt (actual):tmp/tmp4s9ux6ox_actual.txt	</div><div class="diff-info">@@ -69,149 +69,4 @@ fn batch_search_bench(c: &mut Criterion) {</div><div> </div><div>     let collection_config = CollectionConfigInternal {</div><div>         params: collection_params,</div><div class="diff-removed">-        optimizer_config: OptimizersConfig {</div><div class="diff-removed">-            deleted_threshold: 0.9,</div><div class="diff-removed">-            vacuum_min_vector_number: 1000,</div><div class="diff-removed">-            default_segment_number: 2,</div><div class="diff-removed">-            max_segment_size: Some(100_000),</div><div class="diff-removed">-            memmap_threshold: Some(100_000),</div><div class="diff-removed">-            indexing_threshold: Some(50_000),</div><div class="diff-removed">-            flush_interval_sec: 30,</div><div class="diff-removed">-            max_optimization_threads: Some(2),</div><div class="diff-removed">-        },</div><div class="diff-removed">-        wal_config,</div><div class="diff-removed">-        hnsw_config: Default::default(),</div><div class="diff-removed">-        quantization_config: Default::default(),</div><div class="diff-removed">-        strict_mode_config: Default::default(),</div><div class="diff-removed">-        uuid: None,</div><div class="diff-removed">-    };</div><div class="diff-removed">-</div><div class="diff-removed">-    let optimizers_config = collection_config.optimizer_config.clone();</div><div class="diff-removed">-</div><div class="diff-removed">-    let shared_config = Arc::new(RwLock::new(collection_config));</div><div class="diff-removed">-</div><div class="diff-removed">-    let payload_index_schema_dir = Builder::new().prefix("qdrant-test").tempdir().unwrap();</div><div class="diff-removed">-    let payload_index_schema_file = payload_index_schema_dir.path().join("payload-schema.json");</div><div class="diff-removed">-    let payload_index_schema =</div><div class="diff-removed">-        Arc::new(SaveOnDisk::load_or_init_default(payload_index_schema_file).unwrap());</div><div class="diff-removed">-</div><div class="diff-removed">-    let shard = handle</div><div class="diff-removed">-        .block_on(LocalShard::build_local(</div><div class="diff-removed">-            0,</div><div class="diff-removed">-            "test_collection".to_string(),</div><div class="diff-removed">-            storage_dir.path(),</div><div class="diff-removed">-            shared_config,</div><div class="diff-removed">-            Default::default(),</div><div class="diff-removed">-            payload_index_schema,</div><div class="diff-removed">-            handle.clone(),</div><div class="diff-removed">-            handle.clone(),</div><div class="diff-removed">-            ResourceBudget::default(),</div><div class="diff-removed">-            optimizers_config,</div><div class="diff-removed">-        ))</div><div class="diff-removed">-        .unwrap();</div><div class="diff-removed">-</div><div class="diff-removed">-    let rnd_batch = create_rnd_batch();</div><div class="diff-removed">-</div><div class="diff-removed">-    handle</div><div class="diff-removed">-        .block_on(shard.update(rnd_batch.into(), true, HwMeasurementAcc::new()))</div><div class="diff-removed">-        .unwrap();</div><div class="diff-removed">-</div><div class="diff-removed">-    let mut group = c.benchmark_group("batch-search-bench");</div><div class="diff-removed">-</div><div class="diff-removed">-    let filters = vec![</div><div class="diff-removed">-        None,</div><div class="diff-removed">-        Some(Filter::new_must(Condition::Field(</div><div class="diff-removed">-            FieldCondition::new_match("a".parse().unwrap(), 3.into()),</div><div class="diff-removed">-        ))),</div><div class="diff-removed">-        Some(Filter::new_must(Condition::Field(</div><div class="diff-removed">-            FieldCondition::new_range(</div><div class="diff-removed">-                "a".parse().unwrap(),</div><div class="diff-removed">-                Range {</div><div class="diff-removed">-                    lt: None,</div><div class="diff-removed">-                    gt: Some(-1.),</div><div class="diff-removed">-                    gte: None,</div><div class="diff-removed">-                    lte: Some(100.0),</div><div class="diff-removed">-                },</div><div class="diff-removed">-            ),</div><div class="diff-removed">-        ))),</div><div class="diff-removed">-    ];</div><div class="diff-removed">-</div><div class="diff-removed">-    let batch_size = 100;</div><div class="diff-removed">-</div><div class="diff-removed">-    for (fid, filter) in filters.into_iter().enumerate() {</div><div class="diff-removed">-        group.bench_function(format!("search-{fid}"), |b| {</div><div class="diff-removed">-            b.iter(|| {</div><div class="diff-removed">-                runtime.block_on(async {</div><div class="diff-removed">-                    let mut rng = rng();</div><div class="diff-removed">-                    for _i in 0..batch_size {</div><div class="diff-removed">-                        let query = random_vector(&mut rng, 100);</div><div class="diff-removed">-                        let search_query = SearchRequestInternal {</div><div class="diff-removed">-                            vector: query.into(),</div><div class="diff-removed">-                            filter: filter.clone(),</div><div class="diff-removed">-                            params: None,</div><div class="diff-removed">-                            limit: 10,</div><div class="diff-removed">-                            offset: None,</div><div class="diff-removed">-                            with_payload: None,</div><div class="diff-removed">-                            with_vector: None,</div><div class="diff-removed">-                            score_threshold: None,</div><div class="diff-removed">-                        };</div><div class="diff-removed">-                        let hw_acc = HwMeasurementAcc::new();</div><div class="diff-removed">-                        let result = shard</div><div class="diff-removed">-                            .core_search(</div><div class="diff-removed">-                                Arc::new(CoreSearchRequestBatch {</div><div class="diff-removed">-                                    searches: vec![search_query.into()],</div><div class="diff-removed">-                                }),</div><div class="diff-removed">-                                search_runtime_handle,</div><div class="diff-removed">-                                None,</div><div class="diff-removed">-                                hw_acc,</div><div class="diff-removed">-                            )</div><div class="diff-removed">-                            .await</div><div class="diff-removed">-                            .unwrap();</div><div class="diff-removed">-                        assert!(!result.is_empty());</div><div class="diff-removed">-                    }</div><div class="diff-removed">-                });</div><div class="diff-removed">-            })</div><div class="diff-removed">-        });</div><div class="diff-removed">-</div><div class="diff-removed">-        group.bench_function(format!("search-batch-{fid}"), |b| {</div><div class="diff-removed">-            b.iter(|| {</div><div class="diff-removed">-                runtime.block_on(async {</div><div class="diff-removed">-                    let mut rng = rng();</div><div class="diff-removed">-                    let mut searches = Vec::with_capacity(batch_size);</div><div class="diff-removed">-                    for _i in 0..batch_size {</div><div class="diff-removed">-                        let query = random_vector(&mut rng, 100);</div><div class="diff-removed">-                        let search_query = SearchRequestInternal {</div><div class="diff-removed">-                            vector: query.into(),</div><div class="diff-removed">-                            filter: filter.clone(),</div><div class="diff-removed">-                            params: None,</div><div class="diff-removed">-                            limit: 10,</div><div class="diff-removed">-                            offset: None,</div><div class="diff-removed">-                            with_payload: None,</div><div class="diff-removed">-                            with_vector: None,</div><div class="diff-removed">-                            score_threshold: None,</div><div class="diff-removed">-                        };</div><div class="diff-removed">-                        searches.push(search_query.into());</div><div class="diff-removed">-                    }</div><div class="diff-removed">-</div><div class="diff-removed">-                    let hw_acc = HwMeasurementAcc::new();</div><div class="diff-removed">-                    let search_query = CoreSearchRequestBatch { searches };</div><div class="diff-removed">-                    let result = shard</div><div class="diff-removed">-                        .core_search(Arc::new(search_query), search_runtime_handle, None, hw_acc)</div><div class="diff-removed">-                        .await</div><div class="diff-removed">-                        .unwrap();</div><div class="diff-removed">-                    assert!(!result.is_empty());</div><div class="diff-removed">-                });</div><div class="diff-removed">-            })</div><div class="diff-removed">-        });</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    group.finish();</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-criterion_group! {</div><div class="diff-removed">-    name = benches;</div><div class="diff-removed">-    config = Criterion::default();</div><div class="diff-removed">-    targets = batch_search_bench,</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-criterion_main!(benches);</div><div>\ No newline at end of file</div><div class="diff-added">+        optimizer_config: Opt</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    