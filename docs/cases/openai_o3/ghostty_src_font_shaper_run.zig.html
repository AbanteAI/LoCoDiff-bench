<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/font/shaper/run.zig - o3</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/font/shaper/run.zig</h1>
        <p><a href="../../models/openai_o3.html">‚Üê Back to o3 Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> o3</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 18593</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 19578</p>
                <p><strong>Native Completion Tokens:</strong> 3853</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> None</p>
                <p><strong>Cost:</strong> $0.36739499999999997</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_o3/ghostty_src_font_shaper_run.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_o3/ghostty_src_font_shaper_run.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_o3/ghostty_src_font_shaper_run.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index e41616d2..80a56cc5 100644</div><div class="diff-header">--- a/ghostty_src_font_shaper_run.zig_expectedoutput.txt (expected):tmp/tmpdwqij62z_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_font_shaper_run.zig_extracted.txt (actual):tmp/tmprdcdzubv_actual.txt	</div><div class="diff-info">@@ -12,11 +12,7 @@ const Hasher = std.hash.Wyhash;</div><div> /// rows in a terminal, so it is guaranteed to always be one line.</div><div> pub const TextRun = struct {</div><div>     /// A unique hash for this run. This can be used to cache the shaping</div><div class="diff-removed">-    /// results. We don't provide a means to compare actual values if the</div><div class="diff-removed">-    /// hash is the same, so we should continue to improve this hash to</div><div class="diff-removed">-    /// lower the chance of hash collisions if they become a problem. If</div><div class="diff-removed">-    /// there are hash collisions, it would result in rendering issues but</div><div class="diff-removed">-    /// the core data would be correct.</div><div class="diff-added">+    /// results.</div><div>     hash: u64,</div><div> </div><div>     /// The offset in the row where this run started</div><div class="diff-info">@@ -125,13 +121,11 @@ pub const RunIterator = struct {</div><div>                             const cp = cell.codepoint();</div><div>                             if (cp == 'l' or cp == 'i') break;</div><div>                         },</div><div class="diff-removed">-</div><div>                         // st</div><div>                         's' => {</div><div>                             const cp = cell.codepoint();</div><div>                             if (cp == 't') break;</div><div>                         },</div><div class="diff-removed">-</div><div>                         else => {},</div><div>                     }</div><div>                 }</div><div class="diff-info">@@ -148,14 +142,14 @@ pub const RunIterator = struct {</div><div> </div><div>             // Text runs break when font styles change so we need to get</div><div>             // the proper style.</div><div class="diff-removed">-            const font_style: font.Style = style: {</div><div class="diff-added">+            const font_style: font.Style = style_blk: {</div><div>                 if (style.flags.bold) {</div><div class="diff-removed">-                    if (style.flags.italic) break :style .bold_italic;</div><div class="diff-removed">-                    break :style .bold;</div><div class="diff-added">+                    if (style.flags.italic) break :style_blk .bold_italic;</div><div class="diff-added">+                    break :style_blk .bold;</div><div>                 }</div><div> </div><div class="diff-removed">-                if (style.flags.italic) break :style .italic;</div><div class="diff-removed">-                break :style .regular;</div><div class="diff-added">+                if (style.flags.italic) break :style_blk .italic;</div><div class="diff-added">+                break :style_blk .regular;</div><div>             };</div><div> </div><div>             // Determine the presentation format for this glyph.</div><div class="diff-info">@@ -168,8 +162,6 @@ pub const RunIterator = struct {</div><div>                 if (cps[0] == 0xFE0F) break :p .emoji;</div><div>                 break :p null;</div><div>             } else emoji: {</div><div class="diff-removed">-                // If we're not a grapheme, our individual char could be</div><div class="diff-removed">-                // an emoji so we want to check if we expect emoji presentation.</div><div>                 // The font grid indexForCodepoint we use below will do this</div><div>                 // automatically.</div><div>                 break :emoji null;</div><div class="diff-info">@@ -181,30 +173,17 @@ pub const RunIterator = struct {</div><div>             //</div><div>             // We do not break a cell that is exactly the grapheme. If there</div><div>             // are cells following that contain joiners, we allow those to</div><div class="diff-removed">-            // break. This creates an effect where hovering over an emoji</div><div class="diff-removed">-            // such as a skin-tone emoji is fine, but hovering over the</div><div class="diff-removed">-            // joiners will show the joiners allowing you to modify the</div><div class="diff-removed">-            // emoji.</div><div class="diff-added">+            // break.</div><div>             if (!cell.hasGrapheme()) {</div><div>                 if (self.cursor_x) |cursor_x| {</div><div class="diff-removed">-                    // Exactly: self.i is the cursor and we iterated once. This</div><div class="diff-removed">-                    // means that we started exactly at the cursor and did at</div><div class="diff-removed">-                    // exactly one iteration. Why exactly one? Because we may</div><div class="diff-removed">-                    // start at our cursor but do many if our cursor is exactly</div><div class="diff-removed">-                    // on an emoji.</div><div class="diff-added">+                    // Exactly</div><div>                     if (self.i == cursor_x and j == self.i + 1) break;</div><div> </div><div class="diff-removed">-                    // Before: up to and not including the cursor. This means</div><div class="diff-removed">-                    // that we started before the cursor (self.i < cursor_x)</div><div class="diff-removed">-                    // and j is now at the cursor meaning we haven't yet processed</div><div class="diff-removed">-                    // the cursor.</div><div class="diff-added">+                    // Before</div><div>                     if (self.i < cursor_x and j == cursor_x) {</div><div>                         assert(j > 0);</div><div>                         break;</div><div>                     }</div><div class="diff-removed">-</div><div class="diff-removed">-                    // After: after the cursor. We don't need to do anything</div><div class="diff-removed">-                    // special, we just let the run complete.</div><div>                 }</div><div>             }</div><div> </div><div class="diff-info">@@ -247,7 +226,6 @@ pub const RunIterator = struct {</div><div>                 unreachable;</div><div>             };</div><div> </div><div class="diff-removed">-            //log.warn("char={x} info={}", .{ cell.char, font_info });</div><div>             if (j == self.i) current_font = font_info.idx;</div><div> </div><div>             // If our fonts are not equal, then we're done with our run.</div><div class="diff-info">@@ -303,7 +281,12 @@ pub const RunIterator = struct {</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    fn addCodepoint(self: *RunIterator, hasher: anytype, cp: u32, cluster: u32) !void {</div><div class="diff-added">+    fn addCodepoint(</div><div class="diff-added">+        self: *RunIterator,</div><div class="diff-added">+        hasher: anytype,</div><div class="diff-added">+        cp: u32,</div><div class="diff-added">+        cluster: u32,</div><div class="diff-added">+    ) !void {</div><div>         autoHash(hasher, cp);</div><div>         autoHash(hasher, cluster);</div><div>         try self.hooks.addCodepoint(cp, cluster);</div><div class="diff-info">@@ -398,9 +381,4 @@ fn comparableStyle(style: terminal.Style) terminal.Style {</div><div>     var s = style;</div><div> </div><div>     // We allow background colors to differ because we'll just paint the</div><div class="diff-removed">-    // cell background whatever the style is, and wherever the glyph</div><div class="diff-removed">-    // lands on top of it will be the color of the glyph.</div><div class="diff-removed">-    s.bg_color = .none;</div><div class="diff-removed">-</div><div class="diff-removed">-    return s;</div><div class="diff-removed">-}</div><div>\ No newline at end of file</div><div class="diff-added">+    // cell</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    