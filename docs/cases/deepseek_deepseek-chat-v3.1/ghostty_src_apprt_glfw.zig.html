<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/apprt/glfw.zig - DeepSeek Chat v3.1</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/apprt/glfw.zig</h1>
        <h2>Model: DeepSeek Chat v3.1</h2>
        <p><a href="../../models/deepseek_deepseek-chat-v3.1.html">All DeepSeek Chat v3.1 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> DeepSeek Chat v3.1</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 62392</p>
                <p><strong>Native Prompt Tokens:</strong> 66181</p>
                <p><strong>Native Completion Tokens:</strong> 8200</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.0197962</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/deepseek_deepseek-chat-v3.1/ghostty_src_apprt_glfw.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/deepseek_deepseek-chat-v3.1/ghostty_src_apprt_glfw.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/deepseek_deepseek-chat-v3.1/ghostty_src_apprt_glfw.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index afd17d617..5da012f0f 100644</div><div class="diff-header">--- a/ghostty_src_apprt_glfw.zig_expectedoutput.txt (expected):tmp/tmpl_otknv7_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_apprt_glfw.zig_extracted.txt (actual):tmp/tmpc7z19q6i_actual.txt	</div><div class="diff-info">@@ -23,7 +23,7 @@ const CoreSurface = @import("../Surface.zig");</div><div> const configpkg = @import("../config.zig");</div><div> const Config = @import("../config.zig").Config;</div><div> </div><div class="diff-removed">-// Get native API access on certain platforms so we can do more customization.</div><div class="diff-added">+// Get native API access on certain platforms so we can more customization.</div><div> const glfwNative = glfw.Native(.{</div><div>     .cocoa = builtin.target.os.tag.isDarwin(),</div><div>     .x11 = builtin.os.tag == .linux,</div><div class="diff-info">@@ -420,6 +420,13 @@ pub const App = struct {</div><div>         // GLFW doesn't support the inspector</div><div>     }</div><div> </div><div class="diff-added">+    pub fn keyboardLayout(self: *const App) input.KeyboardLayout {</div><div class="diff-added">+        _ = self;</div><div class="diff-added">+</div><div class="diff-added">+        // Not supported by glfw</div><div class="diff-added">+        return .unknown;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div>     fn glfwErrorCallback(code: glfw.ErrorCode, desc: [:0]const u8) void {</div><div>         std.log.warn("glfw error={} message={s}", .{ code, desc });</div><div> </div><div class="diff-info">@@ -434,13 +441,6 @@ pub const App = struct {</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    pub fn keyboardLayout(self: *const App) input.KeyboardLayout {</div><div class="diff-removed">-        _ = self;</div><div class="diff-removed">-</div><div class="diff-removed">-        // Not supported by glfw</div><div class="diff-removed">-        return .unknown;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     /// Mac-specific settings. This is only enabled when the target is</div><div>     /// Mac and the artifact is a standalone exe. We don't target libs because</div><div>     /// the embedded API doesn't do windowing.</div><div class="diff-info">@@ -619,7 +619,6 @@ pub const Surface = struct {</div><div>             app.app.alloc,</div><div>             &config,</div><div>             app.app,</div><div class="diff-removed">-            app,</div><div>             self,</div><div>         );</div><div>         errdefer self.core_surface.deinit();</div><div class="diff-info">@@ -708,7 +707,7 @@ pub const Surface = struct {</div><div>     /// Note: this interface is not good, we should redo it if we plan</div><div>     /// to use this more. i.e. you can't set max width but no max height,</div><div>     /// or no mins.</div><div class="diff-removed">-    fn setSizeLimits(self: *Surface, min: apprt.SurfaceSize, max_: ?apprt.SurfaceSize) !void {</div><div class="diff-added">+    fn setSizeLimits(self: *Surface, min: apprt.SurfaceSize, max_: ?apprt.Surfaceize) !void {</div><div>         self.window.setSizeLimits(.{</div><div>             .width = min.width,</div><div>             .height = min.height,</div><div class="diff-info">@@ -955,306 +954,4 @@ pub const Surface = struct {</div><div>         // Convert our glfw types into our input types</div><div>         const mods: input.Mods = .{</div><div>             .shift = glfw_mods.shift,</div><div class="diff-removed">-            .ctrl = glfw_mods.control,</div><div class="diff-removed">-            .alt = glfw_mods.alt,</div><div class="diff-removed">-            .super = glfw_mods.super,</div><div class="diff-removed">-        };</div><div class="diff-removed">-        const action: input.Action = switch (glfw_action) {</div><div class="diff-removed">-            .release => .release,</div><div class="diff-removed">-            .press => .press,</div><div class="diff-removed">-            .repeat => .repeat,</div><div class="diff-removed">-        };</div><div class="diff-removed">-        const key: input.Key = switch (glfw_key) {</div><div class="diff-removed">-            .a => .a,</div><div class="diff-removed">-            .b => .b,</div><div class="diff-removed">-            .c => .c,</div><div class="diff-removed">-            .d => .d,</div><div class="diff-removed">-            .e => .e,</div><div class="diff-removed">-            .f => .f,</div><div class="diff-removed">-            .g => .g,</div><div class="diff-removed">-            .h => .h,</div><div class="diff-removed">-            .i => .i,</div><div class="diff-removed">-            .j => .j,</div><div class="diff-removed">-            .k => .k,</div><div class="diff-removed">-            .l => .l,</div><div class="diff-removed">-            .m => .m,</div><div class="diff-removed">-            .n => .n,</div><div class="diff-removed">-            .o => .o,</div><div class="diff-removed">-            .p => .p,</div><div class="diff-removed">-            .q => .q,</div><div class="diff-removed">-            .r => .r,</div><div class="diff-removed">-            .s => .s,</div><div class="diff-removed">-            .t => .t,</div><div class="diff-removed">-            .u => .u,</div><div class="diff-removed">-            .v => .v,</div><div class="diff-removed">-            .w => .w,</div><div class="diff-removed">-            .x => .x,</div><div class="diff-removed">-            .y => .y,</div><div class="diff-removed">-            .z => .z,</div><div class="diff-removed">-            .zero => .zero,</div><div class="diff-removed">-            .one => .one,</div><div class="diff-removed">-            .two => .two,</div><div class="diff-removed">-            .three => .three,</div><div class="diff-removed">-            .four => .four,</div><div class="diff-removed">-            .five => .five,</div><div class="diff-removed">-            .six => .six,</div><div class="diff-removed">-            .seven => .seven,</div><div class="diff-removed">-            .eight => .eight,</div><div class="diff-removed">-            .nine => .nine,</div><div class="diff-removed">-            .up => .up,</div><div class="diff-removed">-            .down => .down,</div><div class="diff-removed">-            .right => .right,</div><div class="diff-removed">-            .left => .left,</div><div class="diff-removed">-            .home => .home,</div><div class="diff-removed">-            .end => .end,</div><div class="diff-removed">-            .page_up => .page_up,</div><div class="diff-removed">-            .page_down => .page_down,</div><div class="diff-removed">-            .escape => .escape,</div><div class="diff-removed">-            .F1 => .f1,</div><div class="diff-removed">-            .F2 => .f2,</div><div class="diff-removed">-            .F3 => .f3,</div><div class="diff-removed">-            .F4 => .f4,</div><div class="diff-removed">-            .F5 => .f5,</div><div class="diff-removed">-            .F6 => .f6,</div><div class="diff-removed">-            .F7 => .f7,</div><div class="diff-removed">-            .F8 => .f8,</div><div class="diff-removed">-            .F9 => .f9,</div><div class="diff-removed">-            .F10 => .f10,</div><div class="diff-removed">-            .F11 => .f11,</div><div class="diff-removed">-            .F12 => .f12,</div><div class="diff-removed">-            .F13 => .f13,</div><div class="diff-removed">-            .F14 => .f14,</div><div class="diff-removed">-            .F15 => .f15,</div><div class="diff-removed">-            .F16 => .f16,</div><div class="diff-removed">-            .F17 => .f17,</div><div class="diff-removed">-            .F18 => .f18,</div><div class="diff-removed">-            .F19 => .f19,</div><div class="diff-removed">-            .F20 => .f20,</div><div class="diff-removed">-            .F21 => .f21,</div><div class="diff-removed">-            .F22 => .f22,</div><div class="diff-removed">-            .F23 => .f23,</div><div class="diff-removed">-            .F24 => .f24,</div><div class="diff-removed">-            .F25 => .f25,</div><div class="diff-removed">-            .kp_0 => .kp_0,</div><div class="diff-removed">-            .kp_1 => .kp_1,</div><div class="diff-removed">-            .kp_2 => .kp_2,</div><div class="diff-removed">-            .kp_3 => .kp_3,</div><div class="diff-removed">-            .kp_4 => .kp_4,</div><div class="diff-removed">-            .kp_5 => .kp_5,</div><div class="diff-removed">-            .kp_6 => .kp_6,</div><div class="diff-removed">-            .kp_7 => .kp_7,</div><div class="diff-removed">-            .kp_8 => .kp_8,</div><div class="diff-removed">-            .kp_9 => .kp_9,</div><div class="diff-removed">-            .kp_decimal => .kp_decimal,</div><div class="diff-removed">-            .kp_divide => .kp_divide,</div><div class="diff-removed">-            .kp_multiply => .kp_multiply,</div><div class="diff-removed">-            .kp_subtract => .kp_subtract,</div><div class="diff-removed">-            .kp_add => .kp_add,</div><div class="diff-removed">-            .kp_enter => .kp_enter,</div><div class="diff-removed">-            .kp_equal => .kp_equal,</div><div class="diff-removed">-            .grave_accent => .grave_accent,</div><div class="diff-removed">-            .minus => .minus,</div><div class="diff-removed">-            .equal => .equal,</div><div class="diff-removed">-            .space => .space,</div><div class="diff-removed">-            .semicolon => .semicolon,</div><div class="diff-removed">-            .apostrophe => .apostrophe,</div><div class="diff-removed">-            .comma => .comma,</div><div class="diff-removed">-            .period => .period,</div><div class="diff-removed">-            .slash => .slash,</div><div class="diff-removed">-            .left_bracket => .left_bracket,</div><div class="diff-removed">-            .right_bracket => .right_bracket,</div><div class="diff-removed">-            .backslash => .backslash,</div><div class="diff-removed">-            .enter => .enter,</div><div class="diff-removed">-            .tab => .tab,</div><div class="diff-removed">-            .backspace => .backspace,</div><div class="diff-removed">-            .insert => .insert,</div><div class="diff-removed">-            .delete => .delete,</div><div class="diff-removed">-            .caps_lock => .caps_lock,</div><div class="diff-removed">-            .scroll_lock => .scroll_lock,</div><div class="diff-removed">-            .num_lock => .num_lock,</div><div class="diff-removed">-            .print_screen => .print_screen,</div><div class="diff-removed">-            .pause => .pause,</div><div class="diff-removed">-            .left_shift => .left_shift,</div><div class="diff-removed">-            .left_control => .left_control,</div><div class="diff-removed">-            .left_alt => .left_alt,</div><div class="diff-removed">-            .left_super => .left_super,</div><div class="diff-removed">-            .right_shift => .right_shift,</div><div class="diff-removed">-            .right_control => .right_control,</div><div class="diff-removed">-            .right_alt => .right_alt,</div><div class="diff-removed">-            .right_super => .right_super,</div><div class="diff-removed">-</div><div class="diff-removed">-            .menu,</div><div class="diff-removed">-            .world_1,</div><div class="diff-removed">-            .world_2,</div><div class="diff-removed">-            .unknown,</div><div class="diff-removed">-            => .invalid,</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        // This is a hack for GLFW. We require our apprts to send both</div><div class="diff-removed">-        // the UTF8 encoding AND the keypress at the same time. Its critical</div><div class="diff-removed">-        // for things like ctrl sequences to work. However, GLFW doesn't</div><div class="diff-removed">-        // provide this information all at once. So we just infer based on</div><div class="diff-removed">-        // the key press. This isn't portable but GLFW is only for testing.</div><div class="diff-removed">-        const utf8 = switch (key) {</div><div class="diff-removed">-            inline else => |k| utf8: {</div><div class="diff-removed">-                if (mods.shift) break :utf8 "";</div><div class="diff-removed">-                const cp = k.codepoint() orelse break :utf8 "";</div><div class="diff-removed">-                const byte = std.math.cast(u8, cp) orelse break :utf8 "";</div><div class="diff-removed">-                break :utf8 &.{byte};</div><div class="diff-removed">-            },</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        const key_event: input.KeyEvent = .{</div><div class="diff-removed">-            .action = action,</div><div class="diff-removed">-            .key = key,</div><div class="diff-removed">-            .physical_key = key,</div><div class="diff-removed">-            .mods = mods,</div><div class="diff-removed">-            .consumed_mods = .{},</div><div class="diff-removed">-            .composing = false,</div><div class="diff-removed">-            .utf8 = utf8,</div><div class="diff-removed">-            .unshifted_codepoint = if (utf8.len > 0) @intCast(utf8[0]) else 0,</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        const effect = core_win.keyCallback(key_event) catch |err| {</div><div class="diff-removed">-            log.err("error in key callback err={}", .{err});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        // Surface closed.</div><div class="diff-removed">-        if (effect == .closed) return;</div><div class="diff-removed">-</div><div class="diff-removed">-        // If it wasn't consumed, we set it on our self so that charcallback</div><div class="diff-removed">-        // can make another attempt. Otherwise, we set null so the charcallback</div><div class="diff-removed">-        // is ignored.</div><div class="diff-removed">-        core_win.rt_surface.key_event = null;</div><div class="diff-removed">-        if (effect == .ignored and</div><div class="diff-removed">-            (action == .press or action == .repeat))</div><div class="diff-removed">-        {</div><div class="diff-removed">-            core_win.rt_surface.key_event = key_event;</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn focusCallback(window: glfw.Window, focused: bool) void {</div><div class="diff-removed">-        const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div class="diff-removed">-        core_win.focusCallback(focused) catch |err| {</div><div class="diff-removed">-            log.err("error in focus callback err={}", .{err});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn refreshCallback(window: glfw.Window) void {</div><div class="diff-removed">-        const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div class="diff-removed">-        core_win.refreshCallback() catch |err| {</div><div class="diff-removed">-            log.err("error in refresh callback err={}", .{err});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn scrollCallback(window: glfw.Window, xoff: f64, yoff: f64) void {</div><div class="diff-removed">-        // Glfw doesn't support any of the scroll mods.</div><div class="diff-removed">-        const scroll_mods: input.ScrollMods = .{};</div><div class="diff-removed">-</div><div class="diff-removed">-        const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div class="diff-removed">-        core_win.scrollCallback(xoff, yoff, scroll_mods) catch |err| {</div><div class="diff-removed">-            log.err("error in scroll callback err={}", .{err});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn cursorPosCallback(</div><div class="diff-removed">-        window: glfw.Window,</div><div class="diff-removed">-        unscaled_xpos: f64,</div><div class="diff-removed">-        unscaled_ypos: f64,</div><div class="diff-removed">-    ) void {</div><div class="diff-removed">-        const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div class="diff-removed">-</div><div class="diff-removed">-        // Convert our unscaled x/y to scaled.</div><div class="diff-removed">-        const pos = core_win.rt_surface.cursorPosToPixels(.{</div><div class="diff-removed">-            .xpos = unscaled_xpos,</div><div class="diff-removed">-            .ypos = unscaled_ypos,</div><div class="diff-removed">-        }) catch |err| {</div><div class="diff-removed">-            log.err(</div><div class="diff-removed">-                "error converting cursor pos to scaled pixels in cursor pos callback err={}",</div><div class="diff-removed">-                .{err},</div><div class="diff-removed">-            );</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        core_win.cursorPosCallback(.{</div><div class="diff-removed">-            .x = @floatCast(pos.xpos),</div><div class="diff-removed">-            .y = @floatCast(pos.ypos),</div><div class="diff-removed">-        }, null) catch |err| {</div><div class="diff-removed">-            log.err("error in cursor pos callback err={}", .{err});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn mouseButtonCallback(</div><div class="diff-removed">-        window: glfw.Window,</div><div class="diff-removed">-        glfw_button: glfw.MouseButton,</div><div class="diff-removed">-        glfw_action: glfw.Action,</div><div class="diff-removed">-        glfw_mods: glfw.Mods,</div><div class="diff-removed">-    ) void {</div><div class="diff-removed">-        const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div class="diff-removed">-</div><div class="diff-removed">-        // Convert glfw button to input button</div><div class="diff-removed">-        const mods: input.Mods = .{</div><div class="diff-removed">-            .shift = glfw_mods.shift,</div><div class="diff-removed">-            .ctrl = glfw_mods.control,</div><div class="diff-removed">-            .alt = glfw_mods.alt,</div><div class="diff-removed">-            .super = glfw_mods.super,</div><div class="diff-removed">-        };</div><div class="diff-removed">-        const button: input.MouseButton = switch (glfw_button) {</div><div class="diff-removed">-            .left => .left,</div><div class="diff-removed">-            .right => .right,</div><div class="diff-removed">-            .middle => .middle,</div><div class="diff-removed">-            .four => .four,</div><div class="diff-removed">-            .five => .five,</div><div class="diff-removed">-            .six => .six,</div><div class="diff-removed">-            .seven => .seven,</div><div class="diff-removed">-            .eight => .eight,</div><div class="diff-removed">-        };</div><div class="diff-removed">-        const action: input.MouseButtonState = switch (glfw_action) {</div><div class="diff-removed">-            .press => .press,</div><div class="diff-removed">-            .release => .release,</div><div class="diff-removed">-            else => unreachable,</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        _ = core_win.mouseButtonCallback(action, button, mods) catch |err| {</div><div class="diff-removed">-            log.err("error in scroll callback err={}", .{err});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn dropCallback(window: glfw.Window, paths: [][*:0]const u8) void {</div><div class="diff-removed">-        const surface = window.getUserPointer(CoreSurface) orelse return;</div><div class="diff-removed">-</div><div class="diff-removed">-        var list = std.ArrayList(u8).init(surface.alloc);</div><div class="diff-removed">-        defer list.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-        for (paths) |path| {</div><div class="diff-removed">-            const path_slice = std.mem.span(path);</div><div class="diff-removed">-</div><div class="diff-removed">-            // preallocate worst case of escaping every char + space</div><div class="diff-removed">-            list.ensureTotalCapacity(path_slice.len * 2 + 1) catch |err| {</div><div class="diff-removed">-                log.err("error in drop callback err={}", .{err});</div><div class="diff-removed">-                return;</div><div class="diff-removed">-            };</div><div class="diff-removed">-</div><div class="diff-removed">-            const writer = list.writer();</div><div class="diff-removed">-            for (path_slice) |c| {</div><div class="diff-removed">-                if (std.mem.indexOfScalar(u8, "\\ ()[]{}<>\"'`!#$&;|*?\t", c)) |_| {</div><div class="diff-removed">-                    writer.print("\\{c}", .{c}) catch unreachable; //  memory preallocated</div><div class="diff-removed">-                } else writer.writeByte(c) catch unreachable; // same here</div><div class="diff-removed">-            }</div><div class="diff-removed">-            writer.writeByte(' ') catch unreachable; // separate paths</div><div class="diff-removed">-</div><div class="diff-removed">-            surface.textCallback(list.items) catch |err| {</div><div class="diff-removed">-                log.err("error in drop callback err={}", .{err});</div><div class="diff-removed">-                return;</div><div class="diff-removed">-            };</div><div class="diff-removed">-</div><div class="diff-removed">-            list.clearRetainingCapacity(); // avoid unnecessary reallocations</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-};</div><div>\ No newline at end of file</div><div class="diff-added">+            .ctrl = glfw_mods.control,</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    