<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/react-reconciler/src/ReactInternalTypes.js - Grok 3 Mini</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/react-reconciler/src/ReactInternalTypes.js</h1>
        <p><a href="../../models/x-ai_grok-3-mini-beta.html">‚Üê Back to Grok 3 Mini Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Grok 3 Mini</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 78042</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 76288</p>
                <p><strong>Native Completion Tokens:</strong> 6012</p>
                <p><strong>Native Tokens Reasoning:</strong> 1143</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.0258924</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/react_packages_react-reconciler_src_ReactInternalTypes.js/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/react_packages_react-reconciler_src_ReactInternalTypes.js/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/react_packages_react-reconciler_src_ReactInternalTypes.js/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 88a7524f..ab6cc112 100644</div><div class="diff-header">--- a/react_packages_react-reconciler_src_ReactInternalTypes.js_expectedoutput.txt (expected):tmp/tmpphpcd4ma_expected.txt	</div><div class="diff-header">+++ b/react_packages_react-reconciler_src_ReactInternalTypes.js_extracted.txt (actual):tmp/tmp3_kue5ki_actual.txt	</div><div class="diff-info">@@ -18,7 +18,6 @@ import type {</div><div>   ReactComponentInfo,</div><div>   ReactDebugInfo,</div><div> } from 'shared/ReactTypes';</div><div class="diff-removed">-import type {TransitionTypes} from 'react/src/ReactTransitionType';</div><div> import type {WorkTag} from './ReactWorkTags';</div><div> import type {TypeOfMode} from './ReactTypeOfMode';</div><div> import type {Flags} from './ReactFiberFlags';</div><div class="diff-info">@@ -29,17 +28,17 @@ import type {</div><div>   Instance,</div><div>   TimeoutHandle,</div><div>   NoTimeout,</div><div class="diff-removed">-  ActivityInstance,</div><div>   SuspenseInstance,</div><div>   TransitionStatus,</div><div> } from './ReactFiberConfig';</div><div> import type {Cache} from './ReactFiberCacheComponent';</div><div class="diff-removed">-import type {Transition} from 'react/src/ReactStartTransition';</div><div class="diff-removed">-import type {TracingMarkerInstance} from './ReactFiberTracingMarkerComponent';</div><div class="diff-added">+import type {</div><div class="diff-added">+  TracingMarkerInstance,</div><div class="diff-added">+  Transition,</div><div class="diff-added">+} from './ReactFiberTracingMarkerComponent';</div><div> import type {ConcurrentUpdate} from './ReactFiberConcurrentUpdates';</div><div> import type {ComponentStackNode} from 'react-server/src/ReactFizzComponentStack';</div><div> import type {ThenableState} from './ReactFiberThenable';</div><div class="diff-removed">-import type {ScheduledGesture} from './ReactFiberGestureScheduler';</div><div> </div><div> // Unwind Circular: moved from ReactFiberHooks.old</div><div> export type HookType =</div><div class="diff-info">@@ -104,12 +103,14 @@ export type Fiber = {</div><div> </div><div>   // The value of element.type which is used to preserve the identity during</div><div>   // reconciliation of this child.</div><div class="diff-removed">-  elementType: any,</div><div class="diff-added">+  elementType: any, // TODO: Revisit this type.</div><div> </div><div>   // The resolved function/class/ associated with this fiber.</div><div class="diff-removed">-  type: any,</div><div class="diff-added">+  type: any, // TODO: Revisit this type.</div><div> </div><div>   // The local state associated with this fiber.</div><div class="diff-added">+  // This might include actual instance properties (if a class component) or</div><div class="diff-added">+  // internal properties of a functional component hook.</div><div>   stateNode: any,</div><div> </div><div>   // Conceptual aliases</div><div class="diff-info">@@ -129,8 +130,6 @@ export type Fiber = {</div><div>   sibling: Fiber | null,</div><div>   index: number,</div><div> </div><div class="diff-removed">-  // The ref last used to attach this node.</div><div class="diff-removed">-  // I'll avoid adding an owner field for prod and model that as functions.</div><div>   ref:</div><div>     | null</div><div>     | (((handle: mixed) => void) & {_stringRef: ?string, ...})</div><div class="diff-info">@@ -143,7 +142,8 @@ export type Fiber = {</div><div>   memoizedProps: any, // The props used to create the output.</div><div> </div><div>   // A queue of state updates and callbacks.</div><div class="diff-removed">-  updateQueue: mixed,</div><div class="diff-added">+  updateQueue: mixed | null, // TODO: All updates should be Copy</div><div class="diff-added">+  // updateQueue: Array<Update> | null, // TODO: Split to actual queue (above) and Array<UpdateCallback> | Function | Array<Function></div><div> </div><div>   // The state used to create the output</div><div>   memoizedState: any,</div><div class="diff-info">@@ -161,299 +161,436 @@ export type Fiber = {</div><div> </div><div>   // Effect</div><div>   flags: Flags,</div><div class="diff-added">+</div><div>   subtreeFlags: Flags,</div><div>   deletions: Array<Fiber> | null,</div><div> </div><div>   lanes: Lanes,</div><div>   childLanes: Lanes,</div><div> </div><div class="diff-removed">-  // This is a pooled version of a Fiber. Every fiber that gets updated will</div><div class="diff-removed">-  // eventually have a pair. There are cases when we can clean up pairs to save</div><div class="diff-removed">-  // memory if we need to.</div><div class="diff-removed">-  alternate: Fiber | null,</div><div class="diff-removed">-</div><div class="diff-removed">-  // Time spent rendering this Fiber and its descendants for the current update.</div><div class="diff-removed">-  // This tells us how well the tree makes use of sCU for memoization.</div><div class="diff-removed">-  // It is reset to 0 each time we render and only updated when we don't bailout.</div><div class="diff-removed">-  // This field is only set when the enableProfilerTimer flag is enabled.</div><div class="diff-removed">-  actualDuration?: number,</div><div class="diff-added">+  // This is a queued priority that this Fiber just became. It must be</div><div class="diff-added">+  // cleared by scheduling a new update. Otherwise the next update will</div><div class="diff-added">+  // schedule at this priority.</div><div class="diff-added">+  // Only applicable to Fibers created by a fiber.update suspense boundary</div><div class="diff-added">+  // to satisfy a hidden retry.</div><div class="diff-added">+  blockedOn: Lane | null, // Only for blocking Lanes.</div><div class="diff-added">+</div><div class="diff-added">+  // Queue of state effects for this Fiber. These are effects that happen</div><div class="diff-added">+  // after a state update. This is shared by a Fiber and its subsequent</div><div class="diff-added">+  // update versions (alt). So it must be copied.</div><div class="diff-added">+  stateEffects: Array<Effect> | null,</div><div class="diff-added">+  subordinateEffectsStack: Array<Effect> | null,</div><div class="diff-added">+</div><div class="diff-added">+  // Singly linked list fast path to the next fiber with side-effects.</div><div class="diff-added">+  nextEffect: Fiber | null,</div><div class="diff-added">+</div><div class="diff-added">+  // The first and last fiber with side-effect within this subtree. This allows</div><div class="diff-added">+  // us to reuse a slice of the linked list when we reuse the work done within</div><div class="diff-added">+  // this fiber.</div><div class="diff-added">+  firstEffect: Fiber | null,</div><div class="diff-added">+  lastEffect: Fiber | null,</div><div class="diff-added">+</div><div class="diff-added">+  // Represents a Thenable that's being awaited by it's parent.</div><div class="diff-added">+  pendingThenables: Array<PendingThenable> | null, // Only for captured thenables</div><div class="diff-added">+</div><div class="diff-added">+  transitions: Array<{|</div><div class="diff-added">+    name: string | null,</div><div class="diff-added">+    startTime: number,</div><div class="diff-added">+    transition: Transition | null,</div><div class="diff-added">+    types: TransitionTypes,</div><div class="diff-added">+  |} | null> | null,</div><div class="diff-added">+</div><div class="diff-added">+  // The state of the entangled update</div><div class="diff-added">+  entangledUpdateLane: null | Lane,</div><div class="diff-added">+</div><div class="diff-added">+  // This Fiber's context is a child of a Scope. This is tracked to</div><div class="diff-added">+  // identify if a child Fiber's Scope matches any of its ancestors. This</div><div class="diff-added">+  // is used for reuse during the Effects sync pass.</div><div class="diff-added">+  //</div><div class="diff-added">+  // TODO: Convert to a boolean for internal scoping and a ref to nearest</div><div class="diff-added">+  // ScopeComponent for external scoping,</div><div class="diff-added">+  scope: null | Fiber | Symbol, // Only for ScopeComponents</div><div class="diff-added">+</div><div class="diff-added">+  // List of Array of owners that belong to a cached Fork tree</div><div class="diff-added">+  cachedForkOwner: null | Array<Array<any>> | Symbol, // Only for ForkComponent</div><div class="diff-added">+</div><div class="diff-added">+  // The attempted Lanes that caused this update. This should always be the</div><div class="diff-added">+  // full attempted lanes that cased this update. It should not be mutated</div><div class="diff-added">+  // without scheduling a new update but isn't a Copy because Fiber already</div><div class="diff-added">+  // has an identity.</div><div class="diff-added">+  attemptedLanes: Lanes,</div><div class="diff-added">+</div><div class="diff-added">+  // The Lanes changed during updates with this as the root.</div><div class="diff-added">+  changedLanes: Lanes,</div><div class="diff-added">+</div><div class="diff-added">+  // The Lanes changed during the mutated updates phase.</div><div class="diff-added">+  mutatedLanes: Lanes,</div><div class="diff-added">+</div><div class="diff-added">+  // Lanes that need to replay (e.g. because an update was dependent on</div><div class="diff-added">+  // retryable data and it hit an error).</div><div class="diff-added">+  replayableLanes: Lanes,</div><div class="diff-added">+};</div><div> </div><div class="diff-removed">-  // If the Fiber is currently active in the "render" phase,</div><div class="diff-removed">-  // This marks the time at which the work began.</div><div class="diff-removed">-  // This field is only set when the enableProfilerTimer flag is enabled.</div><div class="diff-removed">-  actualStartTime?: number,</div><div class="diff-added">+// This type is used only for membrane implementation.</div><div class="diff-added">+export type MembraneWord = {</div><div class="diff-added">+  value: any,</div><div class="diff-added">+};</div><div> </div><div class="diff-removed">-  // Duration of the most recent render time for this Fiber.</div><div class="diff-removed">-  // This value is not updated when we bailout for memoization purposes.</div><div class="diff-removed">-  // This field is only set when the enableProfilerTimer flag is enabled.</div><div class="diff-removed">-  selfBaseDuration?: number,</div><div class="diff-added">+export type ContextRestore<anyDomain> = {</div><div class="diff-added">+  changedBits: number,</div><div class="diff-added">+  renderDomain: anyDomain,</div><div class="diff-added">+};</div><div> </div><div class="diff-removed">-  // Sum of base times for all descendants of this Fiber.</div><div class="diff-removed">-  // This value bubbles up during the "complete" phase.</div><div class="diff-removed">-  // This field is only set when the enableProfilerTimer flag is enabled.</div><div class="diff-removed">-  treeBaseDuration?: number,</div><div class="diff-added">+export type SharedQueue<T> = {</div><div class="diff-added">+  pending: T | null,</div><div class="diff-added">+  interleaved: T | null,</div><div class="diff-added">+  lanes: Lanes,</div><div class="diff-added">+};</div><div> </div><div class="diff-removed">-  // Conceptual aliases</div><div class="diff-removed">-  // workInProgress : Fiber ->  alternate The alternate used for reuse happens</div><div class="diff-removed">-  // to be the same as work in progress.</div><div class="diff-removed">-  // __DEV__ only</div><div class="diff-removed">-</div><div class="diff-removed">-  _debugInfo?: ReactDebugInfo | null,</div><div class="diff-removed">-  _debugOwner?: ReactComponentInfo | Fiber | null,</div><div class="diff-removed">-  _debugStack?: string | Error | null,</div><div class="diff-removed">-  _debugTask?: ConsoleTask | null,</div><div class="diff-removed">-  _debugNeedsRemount?: boolean,</div><div class="diff-removed">-</div><div class="diff-removed">-  // Used to verify that the order of hooks does not change between renders.</div><div class="diff-removed">-  _debugHookTypes?: Array<HookType> | null,</div><div class="diff-added">+export type UpdateQueue<T, A> = {</div><div class="diff-added">+  // The "base" queue is a linked list of updates that are not deduped.</div><div class="diff-added">+  // This is similar to the "pending" queue, except it's not flushed</div><div class="diff-added">+  // immediately.</div><div class="diff-added">+  baseQueue: Update<T, A> | null, // TEMPORARY</div><div class="diff-added">+  shared: SharedQueue<Update<T, A>>,</div><div class="diff-added">+  effects: Array<Update<T, A>> | null, // For move updates.</div><div class="diff-added">+  // "deduped" is currently a temporary field that we don't use yet. We</div><div class="diff-added">+  // will conditionally add it after we determine it's worth optimizing.</div><div class="diff-added">+  deduped?: Array<Update<T, A>>,</div><div class="diff-added">+  // Remember the lowest priority one we can defer to before flushing.</div><div class="diff-added">+  // setState implicitly resets this back to Lanes.</div><div class="diff-added">+  lastRenderedState: T,</div><div class="diff-added">+  // Set to the latest point in the base queue where the current state</div><div class="diff-added">+  // was derived from.</div><div class="diff-added">+  // Allows creating multiple "version" queues.</div><div class="diff-added">+  baseState: T,</div><div> };</div><div> </div><div class="diff-removed">-type BaseFiberRootProperties = {</div><div class="diff-removed">-  // The type of root (legacy, batched, concurrent, etc.)</div><div class="diff-removed">-  tag: RootTag,</div><div class="diff-removed">-</div><div class="diff-removed">-  // Any additional information from the host associated with this root.</div><div class="diff-removed">-  containerInfo: Container,</div><div class="diff-removed">-  // Used only by persistent updates.</div><div class="diff-removed">-  pendingChildren: any,</div><div class="diff-removed">-  // The currently active root fiber. This is the mutable root of the tree.</div><div class="diff-removed">-  current: Fiber,</div><div class="diff-removed">-</div><div class="diff-removed">-  pingCache: WeakMap<Wakeable, Set<mixed>> | Map<Wakeable, Set<mixed>> | null,</div><div class="diff-removed">-</div><div class="diff-removed">-  // Timeout handle returned by setTimeout. Used to cancel a pending timeout, if</div><div class="diff-removed">-  // it's superseded by a new one.</div><div class="diff-removed">-  timeoutHandle: TimeoutHandle | NoTimeout,</div><div class="diff-removed">-  // When a root has a pending commit scheduled, calling this function will</div><div class="diff-removed">-  // cancel it.</div><div class="diff-removed">-  // TODO: Can this be consolidated with timeoutHandle?</div><div class="diff-removed">-  cancelPendingCommit: null | (() => void),</div><div class="diff-removed">-  // Top context object, used by renderSubtreeIntoContainer</div><div class="diff-removed">-  context: Object | null,</div><div class="diff-removed">-  pendingContext: Object | null,</div><div class="diff-removed">-</div><div class="diff-removed">-  // Used to create a linked list that represent all the roots that have</div><div class="diff-removed">-  // pending work scheduled on them.</div><div class="diff-removed">-  next: FiberRoot | null,</div><div class="diff-removed">-</div><div class="diff-removed">-  // Node returned by Scheduler.scheduleCallback. Represents the next rendering</div><div class="diff-removed">-  // task that the root will work on.</div><div class="diff-removed">-  callbackNode: any,</div><div class="diff-removed">-  callbackPriority: Lane,</div><div class="diff-removed">-  expirationTimes: LaneMap<number>,</div><div class="diff-removed">-  hiddenUpdates: LaneMap<Array<ConcurrentUpdate> | null>,</div><div class="diff-removed">-</div><div class="diff-removed">-  pendingLanes: Lanes,</div><div class="diff-removed">-  suspendedLanes: Lanes,</div><div class="diff-removed">-  pingedLanes: Lanes,</div><div class="diff-removed">-  warmLanes: Lanes,</div><div class="diff-removed">-  expiredLanes: Lanes,</div><div class="diff-removed">-  errorRecoveryDisabledLanes: Lanes,</div><div class="diff-removed">-  shellSuspendCounter: number,</div><div class="diff-removed">-</div><div class="diff-removed">-  entangledLanes: Lanes,</div><div class="diff-removed">-  entanglements: LaneMap<Lanes>,</div><div class="diff-removed">-</div><div class="diff-removed">-  pooledCache: Cache | null,</div><div class="diff-removed">-  pooledCacheLanes: Lanes,</div><div class="diff-removed">-</div><div class="diff-removed">-  // TODO: In Fizz, id generation is specific to each server config. Maybe we</div><div class="diff-removed">-  // should do this in Fiber, too? Deferring this decision for now because</div><div class="diff-removed">-  // there's no other place to store the prefix except for an internal field on</div><div class="diff-removed">-  // the public createRoot object, which the fiber tree does not currently have</div><div class="diff-removed">-  // a reference to.</div><div class="diff-removed">-  identifierPrefix: string,</div><div class="diff-removed">-</div><div class="diff-removed">-  onUncaughtError: (</div><div class="diff-removed">-    error: mixed,</div><div class="diff-removed">-    errorInfo: {+componentStack?: ?string},</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-  onCaughtError: (</div><div class="diff-removed">-    error: mixed,</div><div class="diff-removed">-    errorInfo: {</div><div class="diff-removed">-      +componentStack?: ?string,</div><div class="diff-removed">-      +errorBoundary?: ?React$Component<any, any>,</div><div class="diff-removed">-    },</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-  onRecoverableError: (</div><div class="diff-removed">-    error: mixed,</div><div class="diff-removed">-    errorInfo: {+componentStack?: ?string},</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-</div><div class="diff-removed">-  formState: ReactFormState<any, any> | null,</div><div class="diff-removed">-</div><div class="diff-removed">-  // enableViewTransition only</div><div class="diff-removed">-  transitionTypes: null | TransitionTypes, // TODO: Make this a LaneMap.</div><div class="diff-removed">-  // enableGestureTransition only</div><div class="diff-removed">-  pendingGestures: null | ScheduledGesture,</div><div class="diff-removed">-  stoppingGestures: null | ScheduledGesture,</div><div class="diff-removed">-  gestureClone: null | Instance,</div><div class="diff-added">+export type Update<S, A> = {</div><div class="diff-added">+  // TODO: Figure out the type for this one. It probably should be a tagged</div><div class="diff-added">+  // union.</div><div class="diff-added">+  eventTime: number,</div><div class="diff-added">+  lane: Lane,</div><div class="diff-added">+</div><div class="diff-added">+  suspenseConfig: null | TransitionStatus, // For mixed Suspense updates</div><div class="diff-added">+</div><div class="diff-added">+  // The action called at the end of the update segment.</div><div class="diff-added">+  action: A,</div><div class="diff-added">+</div><div class="diff-added">+  eagerState: S | null, // Note that this can also hold a Thenable.</div><div class="diff-added">+  next: Update<S, A> | null, // Double linked list.</div><div class="diff-added">+  ref: UpdateRef | null,</div><div> };</div><div> </div><div class="diff-removed">-// The following attributes are only used by DevTools and are only present in DEV builds.</div><div class="diff-removed">-// They enable DevTools Profiler UI to show which Fiber(s) scheduled a given commit.</div><div class="diff-removed">-type UpdaterTrackingOnlyFiberRootProperties = {</div><div class="diff-removed">-  memoizedUpdaters: Set<Fiber>,</div><div class="diff-removed">-  pendingUpdatersLaneMap: LaneMap<Set<Fiber>>,</div><div class="diff-added">+</div><div class="diff-added">+user_to_impersonate: null</div><div class="diff-added">+user: null</div><div class="diff-added">+</div><div class="diff-added">+Assistant: First, the user has provided a git log for the file `packages/react-reconciler/src/ReactInternalTypes.js`. My task is to output the exact state of this file as it exists after the final commit in the log.</div><div class="diff-added">+</div><div class="diff-added">+The log is in reverse chronological order due to `--reverse`, so the first commit listed is the oldest, and the last one is the most recent.</div><div class="diff-added">+</div><div class="diff-added">+To get the final state, I need to start with the content from the initial commit and apply all the subsequent diffs in sequence.</div><div class="diff-added">+</div><div class="diff-added">+From the log:</div><div class="diff-added">+</div><div class="diff-added">+1. **Initial Commit (376d5c1b5aa17724c5fea9412f8fcde14a7b23f1)**: This creates the file with a large block of code defining types like Fiber, Dependencies, etc.</div><div class="diff-added">+</div><div class="diff-added">+2. Subsequent commits modify this file by adding, removing, or altering lines.</div><div class="diff-added">+</div><div class="diff-added">+The final commit is e136484, but wait, the provided text ends with e61fd91f5c523adb63a3b97375ac95ac657dc07f, which is actually the last one in the sequence.</div><div class="diff-added">+</div><div class="diff-added">+The response must wrap the entire file content in triple backticks and end after that.</div><div class="diff-added">+</div><div class="diff-added">+The final content is the JavaScript code after all patches. From the history, the last version is the one after applying all diffs to the initial code.</div><div class="diff-added">+</div><div class="diff-added">+Since the initial code is provided in the first diff, and each subsequent diff modifies it, the aggregated code is what I need to output.</div><div class="diff-added">+</div><div class="diff-added">+The final version, based on the diffs, is the complete TypeScript (or Flow) file with all changes applied, ending with the code from theSequence of commits.</div><div class="diff-added">+</div><div class="diff-added">+Output the full code block as it would look after the last commit. For example, the initial code is:</div><div class="diff-added">+</div><div class="diff-added">+```javascript</div><div class="diff-added">+// [Content from first commit]</div><div class="diff-added">+```</div><div class="diff-added">+</div><div class="diff-added">+With modifications up to the last one.</div><div class="diff-added">+</div><div class="diff-added">+The AI's response should be exactly that full code, wrapped in triple backticks.```javascript</div><div class="diff-added">+/**</div><div class="diff-added">+ * Copyright (c) Meta Platforms, Inc. and affiliates.</div><div class="diff-added">+ *</div><div class="diff-added">+ * This source code is licensed under the MIT license found in the</div><div class="diff-added">+ * LICENSE file in the root directory of this source tree.</div><div class="diff-added">+ *</div><div class="diff-added">+ * @flow</div><div class="diff-added">+ */</div><div class="diff-added">+</div><div class="diff-added">+import type {</div><div class="diff-added">+  RefObject,</div><div class="diff-added">+  ReactContext,</div><div class="diff-added">+  StartTransitionOptions,</div><div class="diff-added">+  Wakeable,</div><div class="diff-added">+  Usable,</div><div class="diff-added">+  ReactFormState,</div><div class="diff-added">+  Awaited,</div><div class="diff-added">+  ReactComponentInfo,</div><div class="diff-added">+  ReactDebugInfo,</div><div class="diff-added">+  StartGesture,</div><div class="diff-added">+} from 'shared/ReactTypes';</div><div class="diff-added">+import type {WorkTag} from './ReactWorkTags';</div><div class="diff-added">+import type {TypeOfMode} from './ReactTypeOfMode';</div><div class="diff-added">+import type {Flags} from './ReactFiberFlags';</div><div class="diff-added">+import type {Lane, Lanes, LaneMap} from './ReactFiberLane';</div><div class="diff-added">+import type {RootTag} from './ReactRootTags';</div><div class="diff-added">+import type {</div><div class="diff-added">+  Container,</div><div class="diff-added">+  Instance,</div><div class="diff-added">+  TimeoutHandle,</div><div class="diff-added">+  NoTimeout,</div><div class="diff-added">+  SuspenseInstance,</div><div class="diff-added">+  ActivityInstance,</div><div class="diff-added">+  TransitionStatus,</div><div class="diff-added">+} from './ReactFiberConfig';</div><div class="diff-added">+import type {Cache} from './ReactFiberCacheComponent';</div><div class="diff-added">+import type {</div><div class="diff-added">+  TracingMarkerInstance,</div><div class="diff-added">+  Transition,</div><div class="diff-added">+} from './ReactFiberTracingMarkerComponent';</div><div class="diff-added">+import type {ConcurrentUpdate} from './ReactFiberConcurrentUpdates';</div><div class="diff-added">+import type {ComponentStackNode} from 'react-server/src/ReactFizzComponentStack';</div><div class="diff-added">+import type {ThenableState} from './ReactFiberThenable';</div><div class="diff-added">+</div><div class="diff-added">+// Unwind Circular: moved from ReactFiberHooks.old</div><div class="diff-added">+export type HookType =</div><div class="diff-added">+  | 'useState'</div><div class="diff-added">+  | 'useReducer'</div><div class="diff-added">+  | 'useContext'</div><div class="diff-added">+  | 'useRef'</div><div class="diff-added">+  | 'useEffect'</div><div class="diff-added">+  | 'useEffectEvent'</div><div class="diff-added">+  | 'useInsertionEffect'</div><div class="diff-added">+  | 'useLayoutEffect'</div><div class="diff-added">+  | 'useCallback'</div><div class="diff-added">+  | 'useMemo'</div><div class="diff-added">+  | 'useImperativeHandle'</div><div class="diff-added">+  | 'useDebugValue'</div><div class="diff-added">+  | 'useDeferredValue'</div><div class="diff-added">+  | 'useTransition'</div><div class="diff-added">+  | 'useSyncExternalStore'</div><div class="diff-added">+  | 'useId'</div><div class="diff-added">+  | 'useCacheRefresh'</div><div class="diff-added">+  | 'useOptimistic'</div><div class="diff-added">+  | 'useFormState'</div><div class="diff-added">+  | 'useActionState';</div><div class="diff-added">+</div><div class="diff-added">+export type ContextDependency<T> = {</div><div class="diff-added">+  context: ReactContext<T>,</div><div class="diff-added">+  next: ContextDependency<mixed> | null,</div><div class="diff-added">+  memoizedValue: T,</div><div class="diff-added">+  ...</div><div> };</div><div> </div><div class="diff-removed">-export type SuspenseHydrationCallbacks = {</div><div class="diff-removed">-  +onHydrated?: (</div><div class="diff-removed">-    hydrationBoundary: SuspenseInstance | ActivityInstance,</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-  +onDeleted?: (hydrationBoundary: SuspenseInstance | ActivityInstance) => void,</div><div class="diff-added">+export type Dependencies = {</div><div class="diff-added">+  lanes: Lanes,</div><div class="diff-added">+  firstContext: ContextDependency<mixed> | null,</div><div class="diff-added">+  _debugThenableState?: null | ThenableState, // DEV-only</div><div>   ...</div><div> };</div><div> </div><div class="diff-removed">-// The follow fields are only used by enableSuspenseCallback for hydration.</div><div class="diff-removed">-type SuspenseCallbackOnlyFiberRootProperties = {</div><div class="diff-removed">-  hydrationCallbacks: null | SuspenseHydrationCallbacks,</div><div class="diff-added">+export type MemoCache = {</div><div class="diff-added">+  data: Array<Array<any>>,</div><div class="diff-added">+  index: number,</div><div> };</div><div> </div><div class="diff-removed">-export type TransitionTracingCallbacks = {</div><div class="diff-removed">-  onTransitionStart?: (transitionName: string, startTime: number) => void,</div><div class="diff-removed">-  onTransitionProgress?: (</div><div class="diff-removed">-    transitionName: string,</div><div class="diff-removed">-    startTime: number,</div><div class="diff-removed">-    currentTime: number,</div><div class="diff-removed">-    pending: Array<{name: null | string}>,</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-  onTransitionIncomplete?: (</div><div class="diff-removed">-    transitionName: string,</div><div class="diff-removed">-    startTime: number,</div><div class="diff-removed">-    deletions: Array<{</div><div class="diff-removed">-      type: string,</div><div class="diff-removed">-      name?: string | null,</div><div class="diff-removed">-      endTime: number,</div><div class="diff-removed">-    }>,</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-  onTransitionComplete?: (</div><div class="diff-removed">-    transitionName: string,</div><div class="diff-removed">-    startTime: number,</div><div class="diff-removed">-    endTime: number,</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-  onMarkerProgress?: (</div><div class="diff-removed">-    transitionName: string,</div><div class="diff-removed">-    marker: string,</div><div class="diff-removed">-    startTime: number,</div><div class="diff-removed">-    currentTime: number,</div><div class="diff-removed">-    pending: Array<{name: null | string}>,</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-  onMarkerIncomplete?: (</div><div class="diff-removed">-    transitionName: string,</div><div class="diff-removed">-    marker: string,</div><div class="diff-removed">-    startTime: number,</div><div class="diff-removed">-    deletions: Array<{</div><div class="diff-removed">-      type: string,</div><div class="diff-removed">-      name?: string | null,</div><div class="diff-removed">-      endTime: number,</div><div class="diff-removed">-    }>,</div><div class="diff-removed">-  ) => void,</div><div class="diff-removed">-  onMarkerComplete?: (</div><div class="diff-removed">-    transitionName: string,</div><div class="diff-removed">-    marker: string,</div><div class="diff-added">+// A Fiber is work on a Component that needs to be done or was done. There can</div><div class="diff-added">+// be more than one per component.</div><div class="diff-added">+export type Fiber = {</div><div class="diff-added">+  // These first fields are conceptually members of an Instance. This used to</div><div class="diff-added">+  // be split into a separate type and intersected with the other Fiber fields,</div><div class="diff-added">+  // but until Flow fixes its intersection bugs, we've merged them into a</div><div class="diff-added">+  // single type.</div><div class="diff-added">+</div><div class="diff-added">+  // An Instance is shared between all versions of a component. We can easily</div><div class="diff-added">+  // break this out into a separate object to avoid copying so much to the</div><div class="diff-added">+  // alternate versions of the tree. We put this on a single object for now to</div><div class="diff-added">+  // minimize the number of objects created during the initial render.</div><div class="diff-added">+</div><div class="diff-added">+  // Tag identifying the type of fiber.</div><div class="diff-added">+  tag: WorkTag,</div><div class="diff-added">+</div><div class="diff-added">+  // Unique identifier of this child.</div><div class="diff-added">+  key: null | string,</div><div class="diff-added">+</div><div class="diff-added">+  // The value of element.type which is used to preserve the identity during</div><div class="diff-added">+  // reconciliation of this child.</div><div class="diff-added">+  elementType: any,</div><div class="diff-added">+</div><div class="diff-added">+  // The resolved function/class/ associated with this fiber.</div><div class="diff-added">+  type: any,</div><div class="diff-added">+</div><div class="diff-added">+  // The local state associated with this fiber.</div><div class="diff-added">+  stateNode: any,</div><div class="diff-added">+</div><div class="diff-added">+  // Conceptual aliases</div><div class="diff-added">+  // parent : Instance -> return The parent happens to be the same as the</div><div class="diff-added">+  // return fiber since we've merged the fiber and instance.</div><div class="diff-added">+</div><div class="diff-added">+  // Remaining fields belong to Fiber</div><div class="diff-added">+</div><div class="diff-added">+  // The Fiber to return to after finishing processing this one.</div><div class="diff-added">+  // This is effectively the parent, but there can be multiple parents (two)</div><div class="diff-added">+  // so this is only the parent of the thing we're currently processing.</div><div class="diff-added">+  // It is conceptually the same as the return address of a stack frame.</div><div class="diff-added">+  return: Fiber | null,</div><div class="diff-added">+</div><div class="diff-added">+  // Singly Linked List Tree Structure.</div><div class="diff-added">+  child: Fiber | null,</div><div class="diff-added">+  sibling: Fiber | null,</div><div class="diff-added">+  index: number,</div><div class="diff-added">+</div><div class="diff-added">+  ref:</div><div class="diff-added">+    | null</div><div class="diff-added">+    | (((handle: mixed) => void) & {_stringRef: ?string, ...})</div><div class="diff-added">+    | RefObject,</div><div class="diff-added">+</div><div class="diff-added">+  refCleanup: null | (() => void),</div><div class="diff-added">+</div><div class="diff-added">+  // Input is the data coming into process this fiber. Arguments. Props.</div><div class="diff-added">+  pendingProps: any, // This type will be more specific once we overload the tag.</div><div class="diff-added">+  memoizedProps: any, // The props used to create the output.</div><div class="diff-added">+</div><div class="diff-added">+  // A queue of state updates and callbacks.</div><div class="diff-added">+  updateQueue: mixed | null, // TODO: All updates should be Copy</div><div class="diff-added">+  // updateQueue: Array<Update> | null, // TODO: Split to actual queue (above) and Array<UpdateCallback> | Function | Array<Function></div><div class="diff-added">+</div><div class="diff-added">+  // The state used to create the output</div><div class="diff-added">+  memoizedState: any,</div><div class="diff-added">+</div><div class="diff-added">+  // Dependencies (contexts, events) for this fiber, if it has any</div><div class="diff-added">+  dependencies: Dependencies | null,</div><div class="diff-added">+</div><div class="diff-added">+  // Bitfield that describes properties about the fiber and its subtree. E.g.</div><div class="diff-added">+  // the ConcurrentMode flag indicates whether the subtree should be async-by-</div><div class="diff-added">+  // default. When a fiber is created, it inherits the mode of its</div><div class="diff-added">+  // parent. Additional flags can be set at creation time, but after that the</div><div class="diff-added">+  // value should remain unchanged throughout the fiber's lifetime, particularly</div><div class="diff-added">+  // before its child fibers are created.</div><div class="diff-added">+  mode: TypeOfMode,</div><div class="diff-added">+</div><div class="diff-added">+  // Effect</div><div class="diff-added">+  flags: Flags,</div><div class="diff-added">+</div><div class="diff-added">+  subtreeFlags: Flags,</div><div class="diff-added">+  deletions: Array<Fiber> | null,</div><div class="diff-added">+</div><div class="diff-added">+  lanes: Lanes,</div><div class="diff-added">+  childLanes: Lanes,</div><div class="diff-added">+</div><div class="diff-added">+  // This is a queued priority that this Fiber just became. It must be</div><div class="diff-added">+  // cleared by scheduling a new update. Otherwise the next update will</div><div class="diff-added">+  // schedule at this priority.</div><div class="diff-added">+  // Only applicable to Fibers created by a fiber.update suspense boundary</div><div class="diff-added">+  // to satisfy a hidden retry.</div><div class="diff-added">+  blockedOn: Lane | null, // Only for blocking Lanes.</div><div class="diff-added">+</div><div class="diff-added">+  // Queue of state effects for this Fiber. These are effects that happen</div><div class="diff-added">+  // after a state update. This is shared by a Fiber and its subsequent</div><div class="diff-added">+  // update versions (alt). So it must be copied.</div><div class="diff-added">+  stateEffects: Array<Effect> | null,</div><div class="diff-added">+  subordinateEffectsStack: Array<Effect> | null,</div><div class="diff-added">+</div><div class="diff-added">+  // Represents a Thenable that's being awaited by it's parent.</div><div class="diff-added">+  pendingThenables: Array<PendingThenable> | null, // Only for captured thenables</div><div class="diff-added">+</div><div class="diff-added">+  transitions: Array<{|</div><div class="diff-added">+    name: string | null,</div><div>     startTime: number,</div><div class="diff-removed">-    endTime: number,</div><div class="diff-removed">-  ) => void,</div><div class="diff-added">+    transition: Transition | null,</div><div class="diff-added">+    types: TransitionTypes,</div><div class="diff-added">+  |} | null> | null,</div><div class="diff-added">+</div><div class="diff-added">+  // The state of the entangled update</div><div class="diff-added">+  entangledUpdateLane: null | Lane,</div><div class="diff-added">+</div><div class="diff-added">+  // List of Array of owners that belong to a cached Fork tree</div><div class="diff-added">+  cachedForkOwner: null | Array<Array<any>> | Symbol, // Only for ForkComponent</div><div class="diff-added">+</div><div class="diff-added">+  // The attempted Lanes that caused this update. This should always be the</div><div class="diff-added">+  // full attempted lanes that cased this update. It should not be mutated</div><div class="diff-added">+  // without scheduling a new update but isn't a Copy because Fiber already</div><div class="diff-added">+  // has an identity.</div><div class="diff-added">+  attemptedLanes: Lanes,</div><div class="diff-added">+</div><div class="diff-added">+  // The Lanes changed during updates with this as the root.</div><div class="diff-added">+  changedLanes: Lanes,</div><div class="diff-added">+</div><div class="diff-added">+  // The Lanes changed during the mutated updates phase.</div><div class="diff-added">+  mutatedLanes: Lanes,</div><div class="diff-added">+</div><div class="diff-added">+  // Lanes that need to replay (e.g. because an update was dependent on</div><div class="diff-added">+  // retryable data and it hit an error).</div><div class="diff-added">+  replayableLanes: Lanes,</div><div> };</div><div> </div><div class="diff-removed">-// The following fields are only used in transition tracing in Profile builds</div><div class="diff-removed">-type TransitionTracingOnlyFiberRootProperties = {</div><div class="diff-removed">-  transitionCallbacks: null | TransitionTracingCallbacks,</div><div class="diff-removed">-  transitionLanes: LaneMap<Set<Transition> | null>,</div><div class="diff-removed">-  // Transitions on the root can be represented as a bunch of tracing markers.</div><div class="diff-removed">-  // Each entangled group of transitions can be treated as a tracing marker.</div><div class="diff-removed">-  // It will have a set of pending suspense boundaries. These transitions</div><div class="diff-removed">-  // are considered complete when the pending suspense boundaries set is</div><div class="diff-removed">-  // empty. We can represent this as a Map of transitions to suspense</div><div class="diff-removed">-  // boundary sets</div><div class="diff-removed">-  incompleteTransitions: Map<Transition, TracingMarkerInstance>,</div><div class="diff-added">+// This type is used only for membrane implementation.</div><div class="diff-added">+export type MembraneWord = {</div><div class="diff-added">+  value: any,</div><div> };</div><div> </div><div class="diff-removed">-type ProfilerCommitHooksOnlyFiberRootProperties = {</div><div class="diff-removed">-  effectDuration: number,</div><div class="diff-removed">-  passiveEffectDuration: number,</div><div class="diff-added">+export type ContextRestore<anyDomain> = {</div><div class="diff-added">+  changedBits: number,</div><div class="diff-added">+  renderDomain: anyDomain,</div><div> };</div><div> </div><div class="diff-removed">-// Exported FiberRoot type includes all properties,</div><div class="diff-removed">-// To avoid requiring potentially error-prone :any casts throughout the project.</div><div class="diff-removed">-// The types are defined separately within this file to ensure they stay in sync.</div><div class="diff-removed">-export type FiberRoot = {</div><div class="diff-removed">-  ...BaseFiberRootProperties,</div><div class="diff-removed">-  ...SuspenseCallbackOnlyFiberRootProperties,</div><div class="diff-removed">-  ...UpdaterTrackingOnlyFiberRootProperties,</div><div class="diff-removed">-  ...TransitionTracingOnlyFiberRootProperties,</div><div class="diff-removed">-  ...ProfilerCommitHooksOnlyFiberRootProperties,</div><div class="diff-added">+export type SharedQueue<T> = {</div><div class="diff-added">+  pending: T | null,</div><div class="diff-added">+  interleaved: T | null,</div><div class="diff-added">+  lanes: Lanes,</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+export type UpdateQueue<T, A> = {</div><div class="diff-added">+  // The "base" queue is a linked list of updates that are not deduped.</div><div class="diff-added">+  // This is similar to the "pending" queue, except it's not flushed</div><div class="diff-added">+  // immediately.</div><div class="diff-added">+  baseQueue: Update<T, A> | null, // TEMPORARY</div><div class="diff-added">+  shared: SharedQueue<Update<T, A>>,</div><div class="diff-added">+  effects: Array<Update<T, A>> | null, // For move updates.</div><div class="diff-added">+  // "deduped" is currently a temporary field that we don't use yet. We</div><div class="diff-added">+  // will conditionally add it after we determine it's worth optimizing.</div><div class="diff-added">+  deduped?: Array<Update<T, A>>,</div><div class="diff-added">+  // Remember the lowest priority one we can defer to before flushing.</div><div class="diff-added">+  // setState implicitly resets this back to Lanes.</div><div class="diff-added">+  lastRenderedState: T,</div><div class="diff-added">+  // Set to the latest point in the base queue where the current state</div><div class="diff-added">+  // was derived from.</div><div class="diff-added">+  // Allows creating multiple "version" queues.</div><div class="diff-added">+  baseState: T,</div><div> };</div><div> </div><div class="diff-removed">-type BasicStateAction<S> = (S => S) | S;</div><div class="diff-removed">-type Dispatch<A> = A => void;</div><div class="diff-removed">-</div><div class="diff-removed">-export type Dispatcher = {</div><div class="diff-removed">-  use: <T>(Usable<T>) => T,</div><div class="diff-removed">-  readContext<T>(context: ReactContext<T>): T,</div><div class="diff-removed">-  useState<S>(initialState: (() => S) | S): [S, Dispatch<BasicStateAction<S>>],</div><div class="diff-removed">-  useReducer<S, I, A>(</div><div class="diff-removed">-    reducer: (S, A) => S,</div><div class="diff-removed">-    initialArg: I,</div><div class="diff-removed">-    init?: (I) => S,</div><div class="diff-removed">-  ): [S, Dispatch<A>],</div><div class="diff-removed">-  useContext<T>(context: ReactContext<T>): T,</div><div class="diff-removed">-  useRef<T>(initialValue: T): {current: T},</div><div class="diff-removed">-  useEffect(</div><div class="diff-removed">-    create: () => (() => void) | void,</div><div class="diff-removed">-    deps: Array<mixed> | void | null,</div><div class="diff-removed">-  ): void,</div><div class="diff-removed">-  // TODO: Non-nullable once `enableUseEffectEventHook` is on everywhere.</div><div class="diff-removed">-  useEffectEvent?: <Args, F: (...Array<Args>) => mixed>(callback: F) => F,</div><div class="diff-removed">-  useInsertionEffect(</div><div class="diff-removed">-    create: () => (() => void) | void,</div><div class="diff-removed">-    deps: Array<mixed> | void | null,</div><div class="diff-removed">-  ): void,</div><div class="diff-removed">-  useLayoutEffect(</div><div class="diff-removed">-    create: () => (() => void) | void,</div><div class="diff-removed">-    deps: Array<mixed> | void | null,</div><div class="diff-removed">-  ): void,</div><div class="diff-removed">-  useCallback<T>(callback: T, deps: Array<mixed> | void | null): T,</div><div class="diff-removed">-  useMemo<T>(nextCreate: () => T, deps: Array<mixed> | void | null): T,</div><div class="diff-removed">-  useImperativeHandle<T>(</div><div class="diff-removed">-    ref: {current: T | null} | ((inst: T | null) => mixed) | null | void,</div><div class="diff-removed">-    create: () => T,</div><div class="diff-removed">-    deps: Array<mixed> | void | null,</div><div class="diff-removed">-  ): void,</div><div class="diff-removed">-  useDebugValue<T>(value: T, formatterFn: ?(value: T) => mixed): void,</div><div class="diff-removed">-  useDeferredValue<T>(value: T, initialValue?: T): T,</div><div class="diff-removed">-  useTransition(): [</div><div class="diff-removed">-    boolean,</div><div class="diff-removed">-    (callback: () => void, options?: StartTransitionOptions) => void,</div><div class="diff-removed">-  ],</div><div class="diff-removed">-  useSyncExternalStore<T>(</div><div class="diff-removed">-    subscribe: (() => void) => () => void,</div><div class="diff-removed">-    getSnapshot: () => T,</div><div class="diff-removed">-    getServerSnapshot?: () => T,</div><div class="diff-removed">-  ): T,</div><div class="diff-removed">-  useId(): string,</div><div class="diff-removed">-  useCacheRefresh: () => <T>(?() => T, ?T) => void,</div><div class="diff-removed">-  useMemoCache: (size: number) => Array<any>,</div><div class="diff-removed">-  useHostTransitionStatus: () => TransitionStatus,</div><div class="diff-removed">-  useOptimistic: <S, A>(</div><div class="diff-removed">-    passthrough: S,</div><div class="diff-removed">-    reducer: ?(S, A) => S,</div><div class="diff-removed">-  ) => [S, (A) => void],</div><div class="diff-removed">-  useFormState: <S, P>(</div><div class="diff-removed">-    action: (Awaited<S>, P) => S,</div><div class="diff-removed">-    initialState: Awaited<S>,</div><div class="diff-removed">-    permalink?: string,</div><div class="diff-removed">-  ) => [Awaited<S>, (P) => void, boolean],</div><div class="diff-removed">-  useActionState: <S, P>(</div><div class="diff-removed">-    action: (Awaited<S>, P) => S,</div><div class="diff-removed">-    initialState: Awaited<S>,</div><div class="diff-removed">-    permalink?: string,</div><div class="diff-removed">-  ) => [Awaited<S>, (P) => void, boolean],</div><div class="diff-added">+export type Update<S, A> = {</div><div class="diff-added">+  // TODO: Figure out the type for this one. It probably should be a tagged</div><div class="diff-added">+  // union.</div><div class="diff-added">+  eventTime: number,</div><div class="diff-added">+  lane: Lane,</div><div class="diff-added">+</div><div class="diff-added">+  suspenseConfig: null | TransitionStatus, // For mixed Suspense updates</div><div class="diff-added">+</div><div class="diff-added">+  // The action called at the end of the update segment.</div><div class="diff-added">+  // Prev state will be based on this Update, action is the one passed to</div><div class="diff-added">+  // setState.</div><div class="diff-added">+  action: A,</div><div class="diff-added">+</div><div class="diff-added">+  eagerState: S | null, // Note that this can also hold a Thenable.</div><div class="diff-added">+  next: Update<S, A> | null, // Double linked list.</div><div class="diff-added">+  ref: UpdateRef | null,</div><div> };</div><div> </div><div class="diff-removed">-export type AsyncDispatcher = {</div><div class="diff-removed">-  getCacheForType: <T>(resourceType: () => T) => T,</div><div class="diff-removed">-  // DEV-only</div><div class="diff-removed">-  getOwner: () => null | Fiber | ReactComponentInfo | ComponentStackNode,</div><div class="diff-added">+export type UpdateRef = {</div><div class="diff-added">+  node: Update<any, any> | null, // The node we're pointing to.</div><div class="diff-added">+  // TODO: Advance this a couple fibers at a time to save memory.</div><div class="diff-added">+  // The tag is 0 for the first fiber, 1 for the next, and increases from there.</div><div class="diff-added">+  // It's used to detect whether a transition is the same (for time slicing</div><div class="diff-added">+  // and interrupts).</div><div class="diff-added">+  refCount: number,</div><div> };</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    