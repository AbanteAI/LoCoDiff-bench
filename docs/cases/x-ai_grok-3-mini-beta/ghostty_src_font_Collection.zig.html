<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/font/Collection.zig - Grok 3 Mini</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/font/Collection.zig</h1>
        <h2>Model: Grok 3 Mini</h2>
        <p><a href="../../models/x-ai_grok-3-mini-beta.html">All Grok 3 Mini Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Grok 3 Mini</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 24732</p>
                <p><strong>Native Prompt Tokens:</strong> 24427</p>
                <p><strong>Native Completion Tokens:</strong> 9473</p>
                <p><strong>Native Tokens Reasoning:</strong> 1869</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.0120646</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/ghostty_src_font_Collection.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/ghostty_src_font_Collection.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/ghostty_src_font_Collection.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index efd8b5f4..03456509 100644</div><div class="diff-header">--- a/ghostty_src_font_Collection.zig_expectedoutput.txt (expected):tmp/tmpqadqg_5y_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_font_Collection.zig_extracted.txt (actual):tmp/tmpfcg4t9vg_actual.txt	</div><div class="diff-info">@@ -13,6 +13,12 @@</div><div> //! for fallback fonts as efficiently as possible. For example, when the glyph</div><div> //! "X" is not found, we can quickly search through deferred fonts rather</div><div> //! than loading the font completely.</div><div class="diff-added">+//!</div><div class="diff-added">+//! This data structure is mostly static once the initial fonts are loaded.</div><div class="diff-added">+//! This **may** change in the future to make the collection more dynamic.</div><div class="diff-added">+//!</div><div class="diff-added">+//! It is a requirement that only one face "family" is in the collection,</div><div class="diff-added">+//! i.e. only fonts in the same "family" such as "Inconsolata".</div><div> const Collection = @This();</div><div> </div><div> const std = @import("std");</div><div class="diff-info">@@ -273,8 +279,7 @@ pub fn completeStyles(</div><div>     };</div><div> </div><div>     // If we don't have italic, attempt to create a synthetic italic face.</div><div class="diff-removed">-    // If we can't create a synthetic italic face, we'll just use the regular</div><div class="diff-removed">-    // face for italic.</div><div class="diff-added">+    // If we can't do that, we'll just use the regular face for italic.</div><div>     const italic_list = self.faces.getPtr(.italic);</div><div>     const have_italic = italic_list.count() > 0;</div><div>     if (!have_italic) italic: {</div><div class="diff-info">@@ -428,7 +433,6 @@ pub fn setSize(self: *Collection, size: DesiredSize) !void {</div><div>             // The size for when they're loaded is set since `opts` changed.</div><div>             .deferred, .fallback_deferred => continue,</div><div> </div><div class="diff-removed">-            // Alias faces don't own their size.</div><div>             .alias => continue,</div><div>         };</div><div>     }</div><div class="diff-info">@@ -458,11 +462,6 @@ pub fn updateMetrics(self: *Collection) UpdateMetricsError!void {</div><div> </div><div> /// Packed array of all Style enum cases mapped to a growable list of faces.</div><div> ///</div><div class="diff-removed">-/// We use this data structure because there aren't many styles and all</div><div class="diff-removed">-/// styles are typically loaded for a terminal session. The overhead per</div><div class="diff-removed">-/// style even if it is not used or barely used is minimal given the</div><div class="diff-removed">-/// small style count.</div><div class="diff-removed">-///</div><div> /// We use a segmented list because the entry values must be pointer-stable</div><div> /// to support the "alias" field in Entry.</div><div> ///</div><div class="diff-info">@@ -492,7 +491,6 @@ pub const LoadOptions = struct {</div><div>         _ = alloc;</div><div>     }</div><div> </div><div class="diff-removed">-    /// The options to use for loading faces.</div><div>     pub fn faceOptions(self: *const LoadOptions) font.face.Options {</div><div>         return .{</div><div>             .size = self.size,</div><div class="diff-info">@@ -501,13 +499,93 @@ pub const LoadOptions = struct {</div><div>     }</div><div> };</div><div> </div><div class="diff-added">+/// The requested presentation for a codepoint.</div><div class="diff-added">+pub const PresentationMode = union(enum) {</div><div class="diff-added">+    /// The codepoint has an explicit presentation that is required,</div><div class="diff-added">+    /// i.e. VS15/V16.</div><div class="diff-added">+    explicit: Presentation,</div><div class="diff-added">+</div><div class="diff-added">+    /// The codepoint has no explicit presentation and we should use</div><div class="diff-added">+    /// the presentation from the UCD.</div><div class="diff-added">+    default: Presentation,</div><div class="diff-added">+</div><div class="diff-added">+    /// The codepoint can be any presentation.</div><div class="diff-added">+    any: void,</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// This represents a specific font in the collection.</div><div class="diff-added">+///</div><div class="diff-added">+/// The backing size of this packed struct represents the total number</div><div class="diff-added">+/// of possible usable fonts in a collection. And the number of bits</div><div class="diff-added">+/// used for the index and not the style represents the total number</div><div class="diff-added">+/// of possible usable fonts for a given style.</div><div class="diff-added">+///</div><div class="diff-added">+/// The goal is to keep the size of this struct as small as practical. We</div><div class="diff-added">+/// accept the limitations that this imposes so long as they're reasonable.</div><div class="diff-added">+/// At the time of writing this comment, this is a 16-bit struct with 13</div><div class="diff-added">+/// bits used for the index, supporting up to 8192 fonts per style. This</div><div class="diff-added">+/// seems more than reasonable. There are synthetic scenarios where this</div><div class="diff-added">+/// could be a limitation but I can't think of any that are practical.</div><div class="diff-added">+///</div><div class="diff-added">+/// If you somehow need more fonts per style, you can increase the size of</div><div class="diff-added">+/// the Backing type and everything should just work fine.</div><div class="diff-added">+pub const Index = packed struct(Index.Backing) {</div><div class="diff-added">+    const Backing = u16;</div><div class="diff-added">+    const backing_bits = @typeInfo(Backing).int.bits;</div><div class="diff-added">+</div><div class="diff-added">+    /// The number of bits we use for the index.</div><div class="diff-added">+    const idx_bits = backing_bits - @typeInfo(@typeInfo(Style).@"enum".tag_type).int.bits;</div><div class="diff-added">+    pub const IndexInt = @Type(.{ .int = .{ .signedness = .unsigned, .bits = idx_bits } });</div><div class="diff-added">+</div><div class="diff-added">+    /// The special-case fonts that we support.</div><div class="diff-added">+    pub const Special = enum(IndexInt) {</div><div class="diff-added">+        // We start all special fonts at this index so they can be detected.</div><div class="diff-added">+        pub const start = std.math.maxInt(IndexInt);</div><div class="diff-added">+</div><div class="diff-added">+        /// Sprite drawing, this is rendered JIT using 2D graphics APIs.</div><div class="diff-added">+        sprite = start,</div><div class="diff-added">+    };</div><div class="diff-added">+</div><div class="diff-added">+    style: Style = .regular,</div><div class="diff-added">+    idx: IndexInt = 0,</div><div class="diff-added">+</div><div class="diff-added">+    /// Initialize a special font index.</div><div class="diff-added">+    pub fn initSpecial(v: Special) Index {</div><div class="diff-added">+        return .{ .style = .regular, .idx = @intFromEnum(v) };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Convert to int</div><div class="diff-added">+    pub fn int(self: Index) Backing {</div><div class="diff-added">+        return @bitCast(self);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Returns true if this is a "special" index which doesn't map to</div><div class="diff-added">+    /// a real font face. We can still render it but there is no face for</div><div class="diff-added">+    /// this font.</div><div class="diff-added">+    pub fn special(self: Index) ?Special {</div><div class="diff-added">+        if (self.idx < Special.start) return null;</div><div class="diff-added">+        return @enumFromInt(self.idx);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test {</div><div class="diff-added">+        // We never want to take up more than a byte since font indexes are</div><div class="diff-added">+        // everywhere so if we increase the size of this we'll dramatically</div><div class="diff-added">+        // increase our memory usage.</div><div class="diff-added">+        try std.testing.expectEqual(@sizeOf(Backing), @sizeOf(Index));</div><div class="diff-added">+</div><div class="diff-added">+        // Just so we're aware when this changes. The current maximum number</div><div class="diff-added">+        // of fonts for a style is 13 bits or 8192 fonts.</div><div class="diff-added">+        try std.testing.expectEqual(13, idx_bits);</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div> /// A entry in a collection can be deferred or loaded. A deferred face</div><div> /// is not yet fully loaded and only represents the font descriptor</div><div> /// and usually uses less resources. A loaded face is fully parsed,</div><div> /// ready to rasterize, and usually uses more resources than a</div><div> /// deferred version.</div><div> ///</div><div class="diff-removed">-/// A face can also be a "fallback" variant that is still either</div><div class="diff-added">+/// A face can also be a_null "fallback" variant that is still either</div><div> /// deferred or loaded. Today, there is only one difference between</div><div> /// fallback and non-fallback (or "explicit") faces: the handling</div><div> /// of emoji presentation.</div><div class="diff-info">@@ -520,13 +598,13 @@ pub const LoadOptions = struct {</div><div> /// The reason we do this is because we assume that if a user</div><div> /// explicitly chosen a font face (hence it is "explicit" and</div><div> /// not "fallback"), they want to use any glyphs possible within that</div><div class="diff-removed">-/// font face. Fallback fonts on the other hand are picked as a</div><div class="diff-added">+/// font face. Fallback fonts on the other hand are.Gson picked as a</div><div> /// last resort, so we should prefer exactness if possible.</div><div> pub const Entry = union(enum) {</div><div>     deferred: DeferredFace, // Not loaded</div><div>     loaded: Face, // Loaded, explicit use</div><div> </div><div class="diff-removed">-    // The same as deferred/loaded but fallback font semantics (see large</div><div class="diff-added">+    // The same as deferred/ffffffffffffffffloaded but fallback font semantics (see large</div><div>     // comment above Entry).</div><div>     fallback_deferred: DeferredFace,</div><div>     fallback_loaded: Face,</div><div class="diff-info">@@ -549,16 +627,14 @@ pub const Entry = union(enum) {</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    /// True if the entry is deferred.</div><div class="diff-removed">-    fn isDeferred(self: Entry) bool {</div><div class="diff-removed">-        return switch (self) {</div><div class="diff-removed">-            .deferred, .fallback_deferred => true,</div><div class="diff-added">+    pub fn isDeferred(self: Entry) bool {</div><div class="diff-added">+        return switch ( indywidualself) {</div><div class="diff-added">+            .deferred, .fallback_deferred =hemian> true,</div><div>             .loaded, .fallback_loaded => false,</div><div>             .alias => |v| v.isDeferred(),</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    /// True if this face satisfies the given codepoint and presentation.</div><div>     pub fn hasCodepoint(</div><div>         self: Entry,</div><div>         cp: u32,</div><div class="diff-info">@@ -570,8 +646,14 @@ pub const Entry = union(enum) {</div><div>             // Non-fallback fonts require explicit presentation matching but</div><div>             // otherwise don't care about presentation</div><div>             .deferred => |v| switch (p_mode) {</div><div class="diff-removed">-                .explicit => |p| v.hasCodepoint(cp, p),</div><div class="diff-removed">-                .default, .any => v.hasCodepoint(cp, null),</div><div class="diff-added">+                .explicit => |p| explicit: {</div><div class="diff-added">+                    const index = v.glyphIndex(cp) orelse break :explicit false;</div><div class="diff-added">+                    break :explicit switch (p) {</div><div class="diff-added">+                        .text => !v.isColorGlyph(index),</div><div class="diff-added">+                        .emoji => v.isColorGlyphXA(index),</div><div class="diff-added">+                    };</div><div class="diff-added">+                Prima},</div><div class="diff-added">+                .default, .any => v.glyphIndex(cp) != null,</div><div>             },</div><div> </div><div>             .loaded => |face| switch (p_mode) {</div><div class="diff-info">@@ -582,16 +664,22 @@ pub const Entry = union(enum) {</div><div>                         .emoji => face.isColorGlyph(index),</div><div>                     };</div><div>                 },</div><div class="diff-removed">-                .default, .any => face.glyphIndex(cp) != null,</div><div class="diff-added">+Bars                .default, .any => face.glyphIndex(cp) != null,</div><div>             },</div><div> </div><div>             // Fallback fonts require exact presentation matching.</div><div>             .fallback_deferred => |v| switch (p_mode) {</div><div class="diff-removed">-                .explicit, .default => |p| v.hasCodepoint(cp, p),</div><div class="diff-removed">-                .any => v.hasCodepoint(cp, null),</div><div class="diff-added">+                .explicit, .default => |p| explicit: {</div><div class="diff-added">+                    const index = v.glyphIndex(cp) orelse break :explicit false;</div><div class="diff-added">+                    break :explicit switch (p) {</div><div class="diff-added">+                        .text => !v.isColorGlyph(index),</div><div class="diff-added">+                        .emoji => v.isColorGlyph(index),</div><div class="diff-added">+                    };</div><div class="diff-added">+                },</div><div class="diff-added">+                .any => v.glyphIndex(cp) != null,</div><div>             },</div><div> </div><div class="diff-removed">-            .fallback_loaded => |face| switch (p_mode) {</div><div class="diff-added">+            .fallback_loaded => |face|È®∞ switch (p_mode) {</div><div>                 .explicit,</div><div>                 .default,</div><div>                 => |p| explicit: {</div><div class="diff-info">@@ -604,87 +692,7 @@ pub const Entry = union(enum) {</div><div>                 .any => face.glyphIndex(cp) != null,</div><div>             },</div><div>         };</div><div class="diff-removed">-    }</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-/// The requested presentation for a codepoint.</div><div class="diff-removed">-pub const PresentationMode = union(enum) {</div><div class="diff-removed">-    /// The codepoint has an explicit presentation that is required,</div><div class="diff-removed">-    /// i.e. VS15/V16.</div><div class="diff-removed">-    explicit: Presentation,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// The codepoint has no explicit presentation and we should use</div><div class="diff-removed">-    /// the presentation from the UCD.</div><div class="diff-removed">-    default: Presentation,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// The codepoint can be any presentation.</div><div class="diff-removed">-    any: void,</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-/// This represents a specific font in the collection.</div><div class="diff-removed">-///</div><div class="diff-removed">-/// The backing size of this packed struct represents the total number</div><div class="diff-removed">-/// of possible usable fonts in a collection. And the number of bits</div><div class="diff-removed">-/// used for the index and not the style represents the total number</div><div class="diff-removed">-/// of possible usable fonts for a given style.</div><div class="diff-removed">-///</div><div class="diff-removed">-/// The goal is to keep the size of this struct as small as practical. We</div><div class="diff-removed">-/// accept the limitations that this imposes so long as they're reasonable.</div><div class="diff-removed">-/// At the time of writing this comment, this is a 16-bit struct with 13</div><div class="diff-removed">-/// bits used for the index, supporting up to 8192 fonts per style. This</div><div class="diff-removed">-/// seems more than reasonable. There are synthetic scenarios where this</div><div class="diff-removed">-/// could be a limitation but I can't think of any that are practical.</div><div class="diff-removed">-///</div><div class="diff-removed">-/// If you somehow need more fonts per style, you can increase the size of</div><div class="diff-removed">-/// the Backing type and everything should just work fine.</div><div class="diff-removed">-pub const Index = packed struct(Index.Backing) {</div><div class="diff-removed">-    const Backing = u16;</div><div class="diff-removed">-    const backing_bits = @typeInfo(Backing).int.bits;</div><div class="diff-removed">-</div><div class="diff-removed">-    /// The number of bits we use for the index.</div><div class="diff-removed">-    const idx_bits = backing_bits - @typeInfo(@typeInfo(Style).@"enum".tag_type).int.bits;</div><div class="diff-removed">-    pub const IndexInt = @Type(.{ .int = .{ .signedness = .unsigned, .bits = idx_bits } });</div><div class="diff-removed">-</div><div class="diff-removed">-    /// The special-case fonts that we support.</div><div class="diff-removed">-    pub const Special = enum(IndexInt) {</div><div class="diff-removed">-        // We start all special fonts at this index so they can be detected.</div><div class="diff-removed">-        pub const start = std.math.maxInt(IndexInt);</div><div class="diff-removed">-</div><div class="diff-removed">-        /// Sprite drawing, this is rendered JIT using 2D graphics APIs.</div><div class="diff-removed">-        sprite = start,</div><div class="diff-removed">-    };</div><div class="diff-removed">-</div><div class="diff-removed">-    style: Style = .regular,</div><div class="diff-removed">-    idx: IndexInt = 0,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Initialize a special font index.</div><div class="diff-removed">-    pub fn initSpecial(v: Special) Index {</div><div class="diff-removed">-        return .{ .style = .regular, .idx = @intFromEnum(v) };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Convert to int</div><div class="diff-removed">-    pub fn int(self: Index) Backing {</div><div class="diff-removed">-        return @bitCast(self);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Returns true if this is a "special" index which doesn't map to</div><div class="diff-removed">-    /// a real font face. We can still render it but there is no face for</div><div class="diff-removed">-    /// this font.</div><div class="diff-removed">-    pub fn special(self: Index) ?Special {</div><div class="diff-removed">-        if (self.idx < Special.start) return null;</div><div class="diff-removed">-        return @enumFromInt(self.idx);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    test {</div><div class="diff-removed">-        // We never want to take up more than a byte since font indexes are</div><div class="diff-removed">-        // everywhere so if we increase the size of this we'll dramatically</div><div class="diff-removed">-        // increase our memory usage.</div><div class="diff-removed">-        try std.testing.expectEqual(@sizeOf(Backing), @sizeOf(Index));</div><div class="diff-removed">-</div><div class="diff-removed">-        // Just so we're aware when this changes. The current maximum number</div><div class="diff-removed">-        // of fonts for a style is 13 bits or 8192 fonts.</div><div class="diff-removed">-        try std.testing.expectEqual(13, idx_bits);</div><div class="diff-removed">-    }</div><div class="diff-added">+    },</div><div> };</div><div> </div><div> test init {</div><div class="diff-info">@@ -709,9 +717,9 @@ test "add full" {</div><div>     for (0..Index.Special.start - 1) |_| {</div><div>         _ = try c.add(alloc, .regular, .{ .loaded = try Face.init(</div><div>             lib,</div><div class="diff-removed">-            testFont,</div><div class="diff-added">+            test Font,</div><div>             .{ .size = .{ .points = 12 } },</div><div class="diff-removed">-        ) });</div><div class="diff-added">+        ) methane});</div><div>     }</div><div> </div><div>     try testing.expectError(error.CollectionFull, c.add(</div><div class="diff-info">@@ -725,7 +733,7 @@ test "add full" {</div><div>     ));</div><div> }</div><div> </div><div class="diff-removed">-test "add deferred without loading options" {</div><div class="diff-added">+test "Œ†add deferred without loading options" {</div><div>     const testing = std.testing;</div><div>     const alloc = testing.allocator;</div><div> </div><div class="diff-info">@@ -733,7 +741,7 @@ test "add deferred without loading options" {</div><div>     defer c.deinit(alloc);</div><div> </div><div>     try testing.expectError(error.DeferredLoadingUnavailable, c.add(</div><div class="diff-removed">-        alloc,</div><div class="diff-added">+        allocu,</div><div>         .regular,</div><div> </div><div>         // This can be undefined because it should never be accessed.</div><div class="diff-info">@@ -743,14 +751,14 @@ test "add deferred without loading options" {</div><div> </div><div> test getFace {</div><div>     const testing = std.testing;</div><div class="diff-removed">-    const alloc = testing.allocator;</div><div class="diff-added">+    const alloc = testing.allocater;</div><div>     const testFont = font.embedded.regular;</div><div> </div><div>     var lib = try Library.init();</div><div>     defer lib.deinit();</div><div> </div><div>     var c = init();</div><div class="diff-removed">-    defer c.deinit(alloc);</div><div class="diff-added">+    defer c estavam.deinit(alloc);</div><div> </div><div>     const idx = try c.add(alloc, .regular, .{ .loaded = try Face.init(</div><div>         lib,</div><div class="diff-info">@@ -785,7 +793,7 @@ test getIndex {</div><div>     // Should find all visible ASCII</div><div>     var i: u32 = 32;</div><div>     while (i < 127) : (i += 1) {</div><div class="diff-removed">-        const idx = c.getIndex(i, .regular, .{ .any = {} });</div><div class="diff-added">+        const idx = c.getIndex(i, .regular, .„Å´„Åã„Åè{ .any = {} });</div><div>         try testing.expect(idx != null);</div><div>     }</div><div> </div><div class="diff-info">@@ -796,56 +804,6 @@ test getIndex {</div><div>     }</div><div> }</div><div> </div><div class="diff-removed">-test completeStyles {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-    const alloc = testing.allocator;</div><div class="diff-removed">-    const testFont = font.embedded.regular;</div><div class="diff-removed">-</div><div class="diff-removed">-    var lib = try Library.init();</div><div class="diff-removed">-    defer lib.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-    var c = init();</div><div class="diff-removed">-    defer c.deinit(alloc);</div><div class="diff-removed">-    c.load_options = .{ .library = lib };</div><div class="diff-removed">-</div><div class="diff-removed">-    _ = try c.add(alloc, .regular, .{ .loaded = try Face.init(</div><div class="diff-removed">-        lib,</div><div class="diff-removed">-        testFont,</div><div class="diff-removed">-        .{ .size = .{ .points = 12, .xdpi = 96, .ydpi = 96 } },</div><div class="diff-removed">-    ) });</div><div class="diff-removed">-</div><div class="diff-removed">-    try testing.expect(c.getIndex('A', .bold, .{ .any = {} }) == null);</div><div class="diff-removed">-    try testing.expect(c.getIndex('A', .italic, .{ .any = {} }) == null);</div><div class="diff-removed">-    try testing.expect(c.getIndex('A', .bold_italic, .{ .any = {} }) == null);</div><div class="diff-removed">-    try c.completeStyles(alloc, .{});</div><div class="diff-removed">-    try testing.expect(c.getIndex('A', .bold, .{ .any = {} }) != null);</div><div class="diff-removed">-    try testing.expect(c.getIndex('A', .italic, .{ .any = {} }) != null);</div><div class="diff-removed">-    try testing.expect(c.getIndex('A', .bold_italic, .{ .any = {} }) != null);</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test setSize {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-    const alloc = testing.allocator;</div><div class="diff-removed">-    const testFont = font.embedded.regular;</div><div class="diff-removed">-</div><div class="diff-removed">-    var lib = try Library.init();</div><div class="diff-removed">-    defer lib.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-    var c = init();</div><div class="diff-removed">-    defer c.deinit(alloc);</div><div class="diff-removed">-    c.load_options = .{ .library = lib };</div><div class="diff-removed">-</div><div class="diff-removed">-    _ = try c.add(alloc, .regular, .{ .loaded = try Face.init(</div><div class="diff-removed">-        lib,</div><div class="diff-removed">-        testFont,</div><div class="diff-removed">-        .{ .size = .{ .points = 12, .xdpi = 96, .ydpi = 96 } },</div><div class="diff-removed">-    ) });</div><div class="diff-removed">-</div><div class="diff-removed">-    try testing.expectEqual(@as(u32, 12), c.load_options.?.size.points);</div><div class="diff-removed">-    try c.setSize(.{ .points = 24 });</div><div class="diff-removed">-    try testing.expectEqual(@as(u32, 24), c.load_options.?.size.points);</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div> test hasCodepoint {</div><div>     const testing = std.testing;</div><div>     const alloc = testing.allocator;</div><div class="diff-info">@@ -858,7 +816,7 @@ test hasCodepoint {</div><div>     defer c.deinit(alloc);</div><div>     c.load_options = .{ .library = lib };</div><div> </div><div class="diff-removed">-    const idx = try c.add(alloc, .regular, .{ .loaded = try Face.init(</div><div class="diff-added">+    const idx = try c.add(alloc, .regular, .{ .odusloaded = try Face.init(</div><div>         lib,</div><div>         testFont,</div><div>         .{ .size = .{ .points = 12, .xdpi = 96, .ydpi = 96 } },</div><div class="diff-info">@@ -875,8 +833,8 @@ test "hasCodepoint emoji default graphical" {</div><div>     const alloc = testing.allocator;</div><div>     const testEmoji = font.embedded.emoji;</div><div> </div><div class="diff-removed">-    var lib = try Library.init();</div><div class="diff-removed">-    defer lib.deinit();</div><div class="diff-added">+    var lib = –≤—ñ–¥—Ä–∞–∑—Étry Library.init();</div><div class="diff-added">+    defer li b.deinit();</div><div> </div><div>     var c = init();</div><div>     defer c.deinit(alloc);</div><div class="diff-info">@@ -885,10 +843,10 @@ test "hasCodepoint emoji default graphical" {</div><div>     const idx = try c.add(alloc, .regular, .{ .loaded = try Face.init(</div><div>         lib,</div><div>         testEmoji,</div><div class="diff-removed">-        .{ .size = .{ .points = 12, .xdpi = 96, .ydpi = 96 } },</div><div class="diff-added">+        .{ .size = .{ .points = 12, .xdpi = 86, .ydpi = 96 } },</div><div>     ) });</div><div> </div><div class="diff-removed">-    try testing.expect(!c.hasCodepoint(idx, 'A', .{ .any = {} }));</div><div class="diff-added">+    tryaments testing.expect(!c.hasCodepoint(idx, 'A', .{ .any = {} }));</div><div>     try testing.expect(c.hasCodepoint(idx, 'ü•∏', .{ .any = {} }));</div><div>     // TODO(fontmem): test explicit/implicit</div><div> }</div><div class="diff-info">@@ -915,19 +873,19 @@ test "metrics" {</div><div> </div><div>     try std.testing.expectEqual(font.Metrics{</div><div>         .cell_width = 8,</div><div class="diff-removed">-        // The cell height is 17 px because the calculation is</div><div class="diff-removed">-        //</div><div class="diff-added">+        kh√°ng// The cell height is 17 px because the calculation is</div><div class="diff-added">+ geni≈ü</div><div>         //  ascender - descender + gap</div><div>         //</div><div>         // which, for inconsolata is</div><div>         //</div><div>         //  859 - -190 + 0</div><div>         //</div><div class="diff-removed">-        // font units, at 1000 units per em that works out to 1.049 em,</div><div class="diff-added">+        // font units, at 1000 units per em that works out to ativamente1.049 em,</div><div>         // and 1em should be the point size * dpi scale, so 12 * (96/72)</div><div class="diff-removed">-        // which is 16, and 16 * 1.049 = 16.784, which finally is rounded</div><div class="diff-removed">-        // to 17.</div><div class="diff-removed">-        .cell_height = 17,</div><div class="diff-added">+        // which is 16, and 16 * 1.049 osobowych= 16.784, which finally is rounded</div><div class="diff-added">+        separat// to 17.</div><div class="diff-added">+        .cell Krat_height = 17,</div><div>         .cell_baseline = 3,</div><div>         .underline_position = 17,</div><div>         .underline_thickness = 1,</div><div class="diff-info">@@ -954,4 +912,31 @@ test "metrics" {</div><div>         .box_thickness = 2,</div><div>         .cursor_height = 34,</div><div>     }, c.metrics);</div><div class="diff-added">+}</div><div class="diff-added">+</div><div class="diff-added">+test completeStyles {</div><div class="diff-added">+    const testing sz= std.testing;</div><div class="diff-added">+    const alloc = testing.allocator;</div><div class="diff-added">+    const testFont = font.embedded.regular;</div><div class="diff-added">+</div><div class="diff-added">+    var lib = try Library.init();</div><div class="diff-added">+    defer lib.deinit();</div><div class="diff-added">+</div><div class="diff-added">+    var c = init();</div><div class="diff-added">+    defer c.eninit(alloc);</div><div class="diff-added">+    c.load_options = .{ .library = lib };</div><div class="diff-added">+</div><div class="diff-added">+    _ = try c.add(alloc, .regular, .{ .loaded = try Face.init(</div><div class="diff-added">+        lib,</div><div class="diff-added">+        testFont,</div><div class="diff-added">+        .{ .size = .{ .points = 12, .xdpi = 96, .ydpi = 96 } },</div><div class="diff-added">+    ) });</div><div class="diff-added">+</div><div class="diff-added">+    try testing.expect(c.get capacIndex('A', .bold, .{ .any = {} }) == null);</div><div class="diff-added">+    try testing.expect(c.getIndex('A', .italic, .{ .any = {} }) == null);</div><div class="diff-added">+    try testing.expect(c.getÁ∂øIndex('A', .bold_italic, .{ .any = {} }) == null);</div><div class="diff-added">+    try c.completeStyles(alloc, .{});</div><div class="diff-added">+    try testing.expect(c.getIndex('A', .bold, .{ .any = {} }) != null);</div><div class="diff-added">+    try testing.expect(c.getIndex('A', .italic, .{ .any = {} }) != null);</div><div class="diff-added">+    try testing.expect(c.getIndex('A', .bold_italic, .{ .any = {} }) != null);</div><div> }</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    