<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/react-dom/src/__tests__/ReactCompositeComponent-test.js - Grok 3 Mini</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/react-dom/src/__tests__/ReactCompositeComponent-test.js</h1>
        <p><a href="../../models/x-ai_grok-3-mini-beta.html">‚Üê Back to Grok 3 Mini Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Grok 3 Mini</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 86495</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 88665</p>
                <p><strong>Native Completion Tokens:</strong> 4387</p>
                <p><strong>Native Tokens Reasoning:</strong> 1028</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.028793</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/x-ai_grok-3-mini-beta/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 52bccce2..f7104195 100644</div><div class="diff-header">--- a/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js_expectedoutput.txt (expected):tmp/tmpkz2no0rh_expected.txt	</div><div class="diff-header">+++ b/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js_extracted.txt (actual):tmp/tmpq8xh_7ov_actual.txt	</div><div class="diff-info">@@ -18,7 +18,6 @@ let ReactSharedInternals;</div><div> let Scheduler;</div><div> let assertLog;</div><div> let act;</div><div class="diff-removed">-let assertConsoleErrorDev;</div><div> </div><div> describe('ReactCompositeComponent', () => {</div><div>   const hasOwnProperty = Object.prototype.hasOwnProperty;</div><div class="diff-info">@@ -63,18 +62,6 @@ describe('ReactCompositeComponent', () => {</div><div>     );</div><div>   }</div><div> </div><div class="diff-removed">-  beforeEach(() => {</div><div class="diff-removed">-    jest.resetModules();</div><div class="diff-removed">-    React = require('react');</div><div class="diff-removed">-    ReactDOM = require('react-dom');</div><div class="diff-removed">-    ReactDOMClient = require('react-dom/client');</div><div class="diff-removed">-    ReactSharedInternals =</div><div class="diff-removed">-      require('react').__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;</div><div class="diff-removed">-    Scheduler = require('scheduler');</div><div class="diff-removed">-    assertLog = require('internal-test-utils').assertLog;</div><div class="diff-removed">-    ({act, assertConsoleErrorDev} = require('internal-test-utils'));</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div>   describe('MorphingComponent', () => {</div><div>     let instance;</div><div>     let childInstance;</div><div class="diff-info">@@ -126,7 +113,18 @@ describe('ReactCompositeComponent', () => {</div><div>           );</div><div>         }</div><div>       };</div><div class="diff-added">+</div><div class="diff-added">+      React = require('react');</div><div class="diff-added">+      ReactDOM = require('react-dom');</div><div class="diff-added">+      ReactDOMClient = require('react-dom/client');</div><div class="diff-added">+      ReactSharedInternals =</div><div class="diff-added">+        require('react')</div><div class="diff-added">+          .__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;</div><div class="diff-added">+      Scheduler = require('scheduler');</div><div class="diff-added">+      assertLog = require('internal-test-utils').assertLog;</div><div class="diff-added">+      act = require('internal-test-utils').act;</div><div>     });</div><div class="diff-added">+</div><div>     it('should support rendering to different child types over time', async () => {</div><div>       const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div>       await act(() => {</div><div class="diff-info">@@ -211,65 +209,81 @@ describe('ReactCompositeComponent', () => {</div><div>     });</div><div>   });</div><div> </div><div class="diff-removed">-  it('should not support module pattern components', async () => {</div><div class="diff-removed">-    function Child({test}) {</div><div class="diff-removed">-      return {</div><div class="diff-removed">-        render() {</div><div class="diff-removed">-          return <div>{test}</div>;</div><div class="diff-removed">-        },</div><div class="diff-removed">-      };</div><div class="diff-removed">-    }</div><div class="diff-added">+  if (require('shared/ReactFeatureFlags').disableModulePatternComponents) {</div><div class="diff-added">+    it('should not support module pattern components', async () => {</div><div class="diff-added">+      function Child({test}) {</div><div class="diff-added">+        return {</div><div class="diff-added">+          render() {</div><div class="diff-added">+            return <div>{test}</div>;</div><div class="diff-added">+          },</div><div class="diff-added">+        };</div><div class="diff-added">+      }</div><div> </div><div class="diff-removed">-    const el = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(el);</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<Child test="test" />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow(</div><div class="diff-removed">-      'Objects are not valid as a React child (found: object with keys {render}).',</div><div class="diff-removed">-    );</div><div class="diff-added">+      const el = document.createElement('div');</div><div class="diff-added">+      const root = ReactDOMClient.createRoot(el);</div><div class="diff-added">+      await expect(async () => {</div><div class="diff-added">+        await act(() => {</div><div class="diff-added">+          root.render(<Child test="test" />);</div><div class="diff-added">+        });</div><div class="diff-added">+      }).rejects.toThrow(</div><div class="diff-added">+        'Objects are not valid as a React child (found: object with keys {render}).',</div><div class="diff-added">+      );</div><div> </div><div class="diff-removed">-    expect(el.textContent).toBe('');</div><div class="diff-removed">-  });</div><div class="diff-added">+      expect(el.textContent).toBe('');</div><div class="diff-added">+    });</div><div class="diff-added">+  } else {</div><div class="diff-added">+    it('should support module pattern components', () => {</div><div class="diff-added">+      function Child({test}) {</div><div class="diff-added">+        return {</div><div class="diff-added">+          render() {</div><div class="diff-added">+            return <div>{test}</div>;</div><div class="diff-added">+          },</div><div class="diff-added">+        };</div><div class="diff-added">+      }</div><div class="diff-added">+</div><div class="diff-added">+      const el = document.createElement('div');</div><div class="diff-added">+      const root = ReactDOMClient.createRoot(el);</div><div class="diff-added">+      expect(() => {</div><div class="diff-added">+        ReactDOM.flushSync(() => {</div><div class="diff-added">+          root.render(<Child test="test" />);</div><div class="diff-added">+        });</div><div class="diff-added">+      }).toErrorDev(</div><div class="diff-added">+        'Warning: The <Child /> component appears to be a function component that returns a class instance. ' +</div><div class="diff-added">+          'Change Child to a class that extends React.Component instead. ' +</div><div class="diff-added">+          "If you can't use a class try assigning the prototype on the function as a workaround. " +</div><div class="diff-added">+          '`Child.prototype = React.Component.prototype`. ' +</div><div class="diff-added">+          "Don't use an arrow function since it cannot be called with `new` by React.",</div><div class="diff-added">+      );</div><div class="diff-added">+</div><div class="diff-added">+      expect(el.textContent).toBe('test');</div><div class="diff-added">+    });</div><div class="diff-added">+  }</div><div> </div><div>   it('should use default values for undefined props', async () => {</div><div>     class Component extends React.Component {</div><div>       static defaultProps = {prop: 'testKey'};</div><div> </div><div>       render() {</div><div class="diff-removed">-        return <span />;</div><div class="diff-added">+        return <div />;</div><div>       }</div><div>     }</div><div> </div><div class="diff-removed">-    function refFn1(ref) {</div><div class="diff-removed">-      instance1 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function refFn2(ref) {</div><div class="diff-removed">-      instance2 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function refFn3(ref) {</div><div class="diff-removed">-      instance3 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     let instance1;</div><div>     let instance2;</div><div>     let instance3;</div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn1} />);</div><div class="diff-added">+      root.render(<Component ref={ref => (instance1 = ref)} />);</div><div>     });</div><div>     expect(instance1.props).toEqual({prop: 'testKey'});</div><div> </div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn2} prop={undefined} />);</div><div class="diff-added">+      root.render(<Component ref={ref => (instance2 = ref)} prop={undefined} />);</div><div>     });</div><div>     expect(instance2.props).toEqual({prop: 'testKey'});</div><div> </div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn3} prop={null} />);</div><div class="diff-added">+      root.render(<Component ref={ref => (instance3 = ref)} prop={null} />);</div><div>     });</div><div>     expect(instance3.props).toEqual({prop: null});</div><div>   });</div><div class="diff-info">@@ -279,7 +293,7 @@ describe('ReactCompositeComponent', () => {</div><div>       static defaultProps = {prop: 'testKey'};</div><div> </div><div>       render() {</div><div class="diff-removed">-        return <span />;</div><div class="diff-added">+        return <div />;</div><div>       }</div><div>     }</div><div> </div><div class="diff-info">@@ -309,16 +323,17 @@ describe('ReactCompositeComponent', () => {</div><div> </div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<MyComponent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<MyComponent />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div>       "Can't call forceUpdate on a component that is not yet mounted. " +</div><div>         'This is a no-op, but it might indicate a bug in your application. ' +</div><div>         'Instead, assign to `this.state` directly or define a `state = {};` ' +</div><div>         'class property with the desired state in the MyComponent component.\n' +</div><div>         '    in MyComponent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+    );</div><div> </div><div>     // No additional warning should be recorded</div><div>     const container2 = document.createElement('div');</div><div class="diff-info">@@ -343,16 +358,17 @@ describe('ReactCompositeComponent', () => {</div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div> </div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<MyComponent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<MyComponent />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div>       "Can't call setState on a component that is not yet mounted. " +</div><div>         'This is a no-op, but it might indicate a bug in your application. ' +</div><div>         'Instead, assign to `this.state` directly or define a `state = {};` ' +</div><div>         'class property with the desired state in the MyComponent component.\n' +</div><div>         '    in MyComponent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+    );</div><div> </div><div>     // No additional warning should be recorded</div><div>     const container2 = document.createElement('div');</div><div class="diff-info">@@ -387,7 +403,7 @@ describe('ReactCompositeComponent', () => {</div><div> </div><div>     instance.forceUpdate();</div><div> </div><div class="diff-removed">-    root.unmount(container);</div><div class="diff-added">+    root.unmount();</div><div> </div><div>     instance.forceUpdate();</div><div>     instance.forceUpdate();</div><div class="diff-info">@@ -417,7 +433,6 @@ describe('ReactCompositeComponent', () => {</div><div>         </div>,</div><div>       );</div><div>     });</div><div class="diff-removed">-</div><div>     assertLog(['render 0']);</div><div> </div><div>     await act(() => {</div><div class="diff-info">@@ -464,8 +479,6 @@ describe('ReactCompositeComponent', () => {</div><div>     await act(() => {</div><div>       instance.setState({value: 1});</div><div>     });</div><div class="diff-removed">-    instance.setState({value: 1});</div><div class="diff-removed">-</div><div>     root.unmount();</div><div>     expect(cbCalled).toBe(false);</div><div>   });</div><div class="diff-info">@@ -497,917 +510,6 @@ describe('ReactCompositeComponent', () => {</div><div>       });</div><div>     }).rejects.toThrow(TypeError);</div><div>   });</div><div class="diff-added">+}</div><div> </div><div class="diff-removed">-  it('should warn about `setState` in render', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = {value: 0};</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        Scheduler.log('render ' + this.state.value);</div><div class="diff-removed">-        if (this.state.value === 0) {</div><div class="diff-removed">-          this.setState({value: 1});</div><div class="diff-removed">-        }</div><div class="diff-removed">-        return <div>foo {this.state.value}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Cannot update during an existing state transition (such as within ' +</div><div class="diff-removed">-        '`render`). Render methods should be a pure function of props and state.\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // The setState call is queued and then executed as a second pass. This</div><div class="diff-removed">-    // behavior is undefined though so we're free to change it to suit the</div><div class="diff-removed">-    // implementation details.</div><div class="diff-removed">-    assertLog(['render 0', 'render 1']);</div><div class="diff-removed">-    expect(instance.state.value).toBe(1);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Forcing a rerender anywhere will cause the update to happen.</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component prop={123} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['render 1']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should cleanup even if render() fatals', async () => {</div><div class="diff-removed">-    const ownerEnabled = __DEV__;</div><div class="diff-removed">-</div><div class="diff-removed">-    let stashedDispatcher;</div><div class="diff-removed">-    class BadComponent extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        // Stash the dispatcher that was available in render so we can check</div><div class="diff-removed">-        // that its internals also reset.</div><div class="diff-removed">-        stashedDispatcher = ReactSharedInternals.A;</div><div class="diff-removed">-        throw new Error();</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const instance = <BadComponent />;</div><div class="diff-removed">-    expect(ReactSharedInternals.A).toBe(null);</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(instance);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ReactSharedInternals.A).toBe(null);</div><div class="diff-removed">-    if (ownerEnabled) {</div><div class="diff-removed">-      expect(stashedDispatcher.getOwner()).toBe(null);</div><div class="diff-removed">-    } else {</div><div class="diff-removed">-      expect(stashedDispatcher.getOwner).toBe(undefined);</div><div class="diff-removed">-    }</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should call componentWillUnmount before unmounting', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    let innerUnmounted = false;</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return (</div><div class="diff-removed">-          <div></div><div class="diff-removed">-            <Inner /></div><div class="diff-removed">-            Text</div><div class="diff-removed">-          </div></div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Inner extends React.Component {</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        innerUnmounted = true;</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    root.unmount();</div><div class="diff-removed">-    expect(innerUnmounted).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when shouldComponentUpdate() returns undefined', async () => {</div><div class="diff-removed">-    class ClassComponent extends React.Component {</div><div class="diff-removed">-      state = {bogus: false};</div><div class="diff-removed">-</div><div class="diff-removed">-      shouldComponentUpdate() {</div><div class="diff-removed">-        return undefined;</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<ClassComponent ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      instance.setState({bogus: true});</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'ClassComponent.shouldComponentUpdate(): Returned undefined instead of a ' +</div><div class="diff-removed">-        'boolean value. Make sure to return true or false.\n' +</div><div class="diff-removed">-        '    in ClassComponent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when componentDidUnmount method is defined', async () => {</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      componentDidUnmount = () => {};</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Component has a method called ' +</div><div class="diff-removed">-        'componentDidUnmount(). But there is no such lifecycle method. ' +</div><div class="diff-removed">-        'Did you mean componentWillUnmount()?\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when componentDidReceiveProps method is defined', () => {</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      componentDidReceiveProps = () => {};</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Component has a method called ' +</div><div class="diff-removed">-        'componentDidReceiveProps(). But there is no such lifecycle method. ' +</div><div class="diff-removed">-        'If you meant to update the state in response to changing props, ' +</div><div class="diff-removed">-        'use componentWillReceiveProps(). If you meant to fetch data or ' +</div><div class="diff-removed">-        'run side-effects or mutations after React has updated the UI, use componentDidUpdate().\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when defaultProps was defined as an instance property', () => {</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      constructor(props) {</div><div class="diff-removed">-        super(props);</div><div class="diff-removed">-        this.defaultProps = {name: 'Abhay'};</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Setting defaultProps as an instance property on Component is not supported ' +</div><div class="diff-removed">-        'and will be ignored. Instead, define defaultProps as a static property on Component.\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should skip update when rerendering element in container', async () => {</div><div class="diff-removed">-    class Parent extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div>{this.props.children}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Child extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        Scheduler.log('Child render');</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const child = <Child />;</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent>{child}</Parent>);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['Child render']);</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent>{child}</Parent>);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should disallow nested render calls', () => {</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    class Inner extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Outer extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        root.render(<Inner />);</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Outer />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Render methods should be a pure function of props and state; ' +</div><div class="diff-removed">-        'triggering nested component updates from render is not allowed. If ' +</div><div class="diff-removed">-        'necessary, trigger nested updates in componentDidUpdate.\n\n' +</div><div class="diff-removed">-        'Check the render method of Outer.\n' +</div><div class="diff-removed">-        '    in Outer (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('only renders once if updated in componentWillReceiveProps', async () => {</div><div class="diff-removed">-    let renders = 0;</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = {updated: false};</div><div class="diff-removed">-</div><div class="diff-removed">-      UNSAFE_componentWillReceiveProps(props) {</div><div class="diff-removed">-        expect(props.update).toBe(1);</div><div class="diff-removed">-        expect(renders).toBe(1);</div><div class="diff-removed">-        this.setState({updated: true});</div><div class="diff-removed">-        expect(renders).toBe(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        renders++;</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component update={0} ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(renders).toBe(1);</div><div class="diff-removed">-    expect(instance.state.updated).toBe(false);</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component update={1} ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(renders).toBe(2);</div><div class="diff-removed">-    expect(instance.state.updated).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('only renders once if updated in componentWillReceiveProps when batching', async () => {</div><div class="diff-removed">-    let renders = 0;</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = {updated: false};</div><div class="diff-removed">-</div><div class="diff-removed">-      UNSAFE_componentWillReceiveProps(props) {</div><div class="diff-removed">-        expect(props.update).toBe(1);</div><div class="diff-removed">-        expect(renders).toBe(1);</div><div class="diff-removed">-        this.setState({updated: true});</div><div class="diff-removed">-        expect(renders).toBe(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        renders++;</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component update={0} ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(renders).toBe(1);</div><div class="diff-removed">-    expect(instance.state.updated).toBe(false);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component update={1} ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(renders).toBe(2);</div><div class="diff-removed">-    expect(instance.state.updated).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when mutated props are passed', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-</div><div class="diff-removed">-    class Foo extends React.Component {</div><div class="diff-removed">-      constructor(props) {</div><div class="diff-removed">-        const _props = {idx: props.idx + '!'};</div><div class="diff-removed">-        super(_props);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Foo idx="qwe" />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'When calling super() in `Foo`, make sure to pass ' +</div><div class="diff-removed">-        "up the same props that your component's constructor was passed.\n" +</div><div class="diff-removed">-        '    in Foo (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should only call componentWillUnmount once', async () => {</div><div class="diff-removed">-    let app;</div><div class="diff-removed">-    let count = 0;</div><div class="diff-removed">-</div><div class="diff-removed">-    class App extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        if (this.props.stage === 1) {</div><div class="diff-removed">-          return <UnunmountableComponent />;</div><div class="diff-removed">-        } else {</div><div class="diff-removed">-          return null;</div><div class="diff-removed">-        }</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class UnunmountableComponent extends React.Component {</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        app.setState({});</div><div class="diff-removed">-        count++;</div><div class="diff-removed">-        throw Error('always fails');</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div>Hello {this.props.name}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-</div><div class="diff-removed">-    const setRef = ref => {</div><div class="diff-removed">-      if (ref) {</div><div class="diff-removed">-        app = ref;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    };</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<App ref={setRef} stage={1} />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<App ref={setRef} stage={2} />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-    expect(count).toBe(1);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('prepares new child before unmounting old', async () => {</div><div class="diff-removed">-    class Spy extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-removed">-        Scheduler.log(this.props.name + ' componentWillMount');</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        Scheduler.log(this.props.name + ' render');</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      componentDidMount() {</div><div class="diff-removed">-        Scheduler.log(this.props.name + ' componentDidMount');</div><div class="diff-removed">-      }</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        Scheduler.log(this.props.name + ' componentWillUnmount');</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Wrapper extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <Spy key={this.props.name} name={this.props.name} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Wrapper name="A" />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog(['A componentWillMount', 'A render', 'A componentDidMount']);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Wrapper name="B" />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog([</div><div class="diff-removed">-      'B componentWillMount',</div><div class="diff-removed">-      'B render',</div><div class="diff-removed">-      'A componentWillUnmount',</div><div class="diff-removed">-      'B componentDidMount',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('respects a shallow shouldComponentUpdate implementation', async () => {</div><div class="diff-removed">-    class PlasticWrap extends React.Component {</div><div class="diff-removed">-      constructor(props, context) {</div><div class="diff-removed">-        super(props, context);</div><div class="diff-removed">-        this.state = {</div><div class="diff-removed">-          color: 'green',</div><div class="diff-removed">-        };</div><div class="diff-removed">-        this.appleRef = React.createRef();</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <Apple color={this.state.color} ref={this.appleRef} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Apple extends React.Component {</div><div class="diff-removed">-      state = {</div><div class="diff-removed">-        cut: false,</div><div class="diff-removed">-        slices: 1,</div><div class="diff-removed">-      };</div><div class="diff-removed">-</div><div class="diff-removed">-      shouldComponentUpdate(nextProps, nextState) {</div><div class="diff-removed">-        return shallowCompare(this, nextProps, nextState);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      cut() {</div><div class="diff-removed">-        this.setState({</div><div class="diff-removed">-          cut: true,</div><div class="diff-removed">-          slices: 10,</div><div class="diff-removed">-        });</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      eatSlice() {</div><div class="diff-removed">-        this.setState({</div><div class="diff-removed">-          slices: this.state.slices - 1,</div><div class="diff-removed">-        });</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        const {color} = this.props;</div><div class="diff-removed">-        const {cut, slices} = this.state;</div><div class="diff-removed">-</div><div class="diff-removed">-        Scheduler.log(`${color} ${cut} ${slices}`);</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<PlasticWrap ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['green false 1']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Do not re-render based on props</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState({color: 'green'});</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render based on props</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState({color: 'red'});</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['red false 1']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render base on state</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.appleRef.current.cut();</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['red true 10']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // No re-render based on state</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.appleRef.current.cut();</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render based on state again</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.appleRef.current.eatSlice();</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['red true 9']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('does not do a deep comparison for a shallow shouldComponentUpdate implementation', async () => {</div><div class="diff-removed">-    function getInitialState() {</div><div class="diff-removed">-      return {</div><div class="diff-removed">-        foo: [1, 2, 3],</div><div class="diff-removed">-        bar: {a: 4, b: 5, c: 6},</div><div class="diff-removed">-      };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const initialSettings = getInitialState();</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = initialSettings;</div><div class="diff-removed">-</div><div class="diff-removed">-      shouldComponentUpdate(nextProps, nextState) {</div><div class="diff-removed">-        return shallowCompare(this, nextProps, nextState);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        const {foo, bar} = this.state;</div><div class="diff-removed">-        Scheduler.log(`{foo:[${foo}],bar:{a:${bar.a},b:${bar.b},c:${bar.c}}`);</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['{foo:[1,2,3],bar:{a:4,b:5,c:6}']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Do not re-render if state is equal</div><div class="diff-removed">-    const settings = {</div><div class="diff-removed">-      foo: initialSettings.foo,</div><div class="diff-removed">-      bar: initialSettings.bar,</div><div class="diff-removed">-    };</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState(settings);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render because one field changed</div><div class="diff-removed">-    initialSettings.foo = [1, 2, 3];</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState(initialSettings);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['{foo:[1,2,3],bar:{a:4,b:5,c:6}']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render because the object changed</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState(getInitialState());</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['{foo:[1,2,3],bar:{a:4,b:5,c:6}']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should call setState callback with no arguments', async () => {</div><div class="diff-removed">-    let mockArgs;</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      componentDidMount() {</div><div class="diff-removed">-        this.setState({}, (...args) => (mockArgs = args));</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return false;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(mockArgs.length).toEqual(0);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('this.state should be updated on setState callback inside componentWillMount', async () => {</div><div class="diff-removed">-    const div = document.createElement('div');</div><div class="diff-removed">-    let stateSuccessfullyUpdated = false;</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      constructor(props, context) {</div><div class="diff-removed">-        super(props, context);</div><div class="diff-removed">-        this.state = {</div><div class="diff-removed">-          hasUpdatedState: false,</div><div class="diff-removed">-        };</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-removed">-        this.setState(</div><div class="diff-removed">-          {hasUpdatedState: true},</div><div class="diff-removed">-          () => (stateSuccessfullyUpdated = this.state.hasUpdatedState),</div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div>{this.props.children}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(div);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(stateSuccessfullyUpdated).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should call the setState callback even if shouldComponentUpdate = false', async () => {</div><div class="diff-removed">-    const mockFn = jest.fn().mockReturnValue(false);</div><div class="diff-removed">-    const div = document.createElement('div');</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      constructor(props, context) {</div><div class="diff-removed">-        super(props, context);</div><div class="diff-removed">-        this.state = {</div><div class="diff-removed">-          hasUpdatedState: false,</div><div class="diff-removed">-        };</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-removed">-        instance = this;</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      shouldComponentUpdate() {</div><div class="diff-removed">-        return mockFn();</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div>{this.state.hasUpdatedState}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(div);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(instance).toBeDefined();</div><div class="diff-removed">-    expect(mockFn).not.toBeCalled();</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState({hasUpdatedState: true}, () => {</div><div class="diff-removed">-        expect(mockFn).toBeCalled();</div><div class="diff-removed">-        expect(instance.state.hasUpdatedState).toBe(true);</div><div class="diff-removed">-        Scheduler.log('setState callback called');</div><div class="diff-removed">-      });</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog(['setState callback called']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should return a meaningful warning when constructor is returned', async () => {</div><div class="diff-removed">-    class RenderTextInvalidConstructor extends React.Component {</div><div class="diff-removed">-      constructor(props) {</div><div class="diff-removed">-        super(props);</div><div class="diff-removed">-        return {something: false};</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<RenderTextInvalidConstructor />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'No `render` method found on the RenderTextInvalidConstructor instance: ' +</div><div class="diff-removed">-        'did you accidentally return an object from the constructor?\n' +</div><div class="diff-removed">-        '    in RenderTextInvalidConstructor (at **)',</div><div class="diff-removed">-      'No `render` method found on the RenderTextInvalidConstructor instance: ' +</div><div class="diff-removed">-        'did you accidentally return an object from the constructor?\n' +</div><div class="diff-removed">-        '    in RenderTextInvalidConstructor (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn about reassigning this.props while rendering', () => {</div><div class="diff-removed">-    class Bad extends React.Component {</div><div class="diff-removed">-      componentDidMount() {}</div><div class="diff-removed">-      componentDidUpdate() {}</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        this.props = {...this.props};</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Bad />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'It looks like Bad is reassigning its own `this.props` while rendering. ' +</div><div class="diff-removed">-        'This is not supported and can lead to confusing bugs.\n' +</div><div class="diff-removed">-        '    in Bad (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should return error if render is not defined', async () => {</div><div class="diff-removed">-    class RenderTestUndefinedRender extends React.Component {}</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<RenderTestUndefinedRender />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'No `render` method found on the RenderTestUndefinedRender instance: ' +</div><div class="diff-removed">-        'you may have forgotten to define `render`.\n' +</div><div class="diff-removed">-        '    in RenderTestUndefinedRender (at **)',</div><div class="diff-removed">-      'No `render` method found on the RenderTestUndefinedRender instance: ' +</div><div class="diff-removed">-        'you may have forgotten to define `render`.\n' +</div><div class="diff-removed">-        '    in RenderTestUndefinedRender (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // Regression test for accidental breaking change</div><div class="diff-removed">-  // https://github.com/facebook/react/issues/13580</div><div class="diff-removed">-  it('should support classes shadowing isReactComponent', async () => {</div><div class="diff-removed">-    class Shadow extends React.Component {</div><div class="diff-removed">-      isReactComponent() {}</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Shadow />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(container.firstChild.tagName).toBe('DIV');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should not warn on updating function component from componentWillMount', async () => {</div><div class="diff-removed">-    let setState;</div><div class="diff-removed">-    let ref;</div><div class="diff-removed">-    function A() {</div><div class="diff-removed">-      const [state, _setState] = React.useState(null);</div><div class="diff-removed">-      setState = _setState;</div><div class="diff-removed">-      return <div ref={r => (ref = r)}>{state}</div>;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    class B extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-removed">-        setState(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Parent() {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <A /></div><div class="diff-removed">-          <B /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ref.textContent).toBe('1');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should not warn on updating function component from componentWillUpdate', async () => {</div><div class="diff-removed">-    let setState;</div><div class="diff-removed">-    let ref;</div><div class="diff-removed">-    function A() {</div><div class="diff-removed">-      const [state, _setState] = React.useState();</div><div class="diff-removed">-      setState = _setState;</div><div class="diff-removed">-      return <div ref={r => (ref = r)}>{state}</div>;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    class B extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillUpdate() {</div><div class="diff-removed">-        setState(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Parent() {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <A /></div><div class="diff-removed">-          <B /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ref.textContent).toBe('1');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should not warn on updating function component from componentWillReceiveProps', async () => {</div><div class="diff-removed">-    let setState;</div><div class="diff-removed">-    let ref;</div><div class="diff-removed">-    function A() {</div><div class="diff-removed">-      const [state, _setState] = React.useState();</div><div class="diff-removed">-      setState = _setState;</div><div class="diff-removed">-      return <div ref={r => (ref = r)}>{state}</div>;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class B extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillReceiveProps() {</div><div class="diff-removed">-        setState(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Parent() {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <A /></div><div class="diff-removed">-          <B /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ref.textContent).toBe('1');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn on updating function component from render', () => {</div><div class="diff-removed">-    let setState;</div><div class="diff-removed">-    let ref;</div><div class="diff-removed">-    function A() {</div><div class="diff-removed">-      const [state, _setState] = React.useState(0);</div><div class="diff-removed">-      setState = _setState;</div><div class="diff-removed">-      return <div ref={r => (ref = r)}>{state}</div>;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class B extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        setState(c => c + 1);</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Parent() {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <A /></div><div class="diff-removed">-          <B /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Cannot update a component (`A`) while rendering a different component (`B`). ' +</div><div class="diff-removed">-        'To locate the bad setState() call inside `B`, ' +</div><div class="diff-removed">-        'follow the stack trace as described in https://react.dev/link/setstate-in-render\n' +</div><div class="diff-removed">-        '    in Parent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // We error, but still update the state.</div><div class="diff-removed">-    expect(ref.textContent).toBe('1');</div><div class="diff-removed">-</div><div class="diff-removed">-    // Dedupe.</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    // We error, but still update the state.</div><div class="diff-removed">-    expect(ref.textContent).toBe('2');</div><div class="diff-removed">-  });</div><div class="diff-removed">-});</div><div>\ No newline at end of file</div><div class="diff-added">+So, the above is the final, exact content of the file based on the provided Git history.</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    