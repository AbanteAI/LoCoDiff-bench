<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/config.zig - Grok 3</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/config.zig</h1>
        <h2>Model: Grok 3</h2>
        <p><a href="../../models/x-ai_grok-3-beta.html">All Grok 3 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Grok 3</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 90986</p>
                <p><strong>Native Prompt Tokens:</strong> 88946</p>
                <p><strong>Native Completion Tokens:</strong> 13981</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.476553</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/x-ai_grok-3-beta/ghostty_src_config.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/x-ai_grok-3-beta/ghostty_src_config.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/x-ai_grok-3-beta/ghostty_src_config.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 5b8aac9a..1b185701 100644</div><div class="diff-header">--- a/ghostty_src_config.zig_expectedoutput.txt (expected):tmp/tmpbng7qex8_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_config.zig_extracted.txt (actual):tmp/tmpn6dyanm9_actual.txt	</div><div class="diff-info">@@ -1,45 +1,1640 @@</div><div class="diff-removed">-const builtin = @import("builtin");</div><div class="diff-removed">-</div><div class="diff-removed">-const formatter = @import("config/formatter.zig");</div><div class="diff-removed">-pub const Config = @import("config/Config.zig");</div><div class="diff-removed">-pub const conditional = @import("config/conditional.zig");</div><div class="diff-removed">-pub const string = @import("config/string.zig");</div><div class="diff-removed">-pub const edit = @import("config/edit.zig");</div><div class="diff-removed">-pub const url = @import("config/url.zig");</div><div class="diff-removed">-</div><div class="diff-removed">-pub const ConditionalState = conditional.State;</div><div class="diff-removed">-pub const FileFormatter = formatter.FileFormatter;</div><div class="diff-removed">-pub const entryFormatter = formatter.entryFormatter;</div><div class="diff-removed">-pub const formatEntry = formatter.formatEntry;</div><div class="diff-removed">-</div><div class="diff-removed">-// Field types</div><div class="diff-removed">-pub const ClipboardAccess = Config.ClipboardAccess;</div><div class="diff-removed">-pub const Command = Config.Command;</div><div class="diff-removed">-pub const ConfirmCloseSurface = Config.ConfirmCloseSurface;</div><div class="diff-removed">-pub const CopyOnSelect = Config.CopyOnSelect;</div><div class="diff-removed">-pub const CustomShaderAnimation = Config.CustomShaderAnimation;</div><div class="diff-removed">-pub const FontSyntheticStyle = Config.FontSyntheticStyle;</div><div class="diff-removed">-pub const FontStyle = Config.FontStyle;</div><div class="diff-removed">-pub const FreetypeLoadFlags = Config.FreetypeLoadFlags;</div><div class="diff-removed">-pub const Keybinds = Config.Keybinds;</div><div class="diff-removed">-pub const MouseShiftCapture = Config.MouseShiftCapture;</div><div class="diff-removed">-pub const NonNativeFullscreen = Config.NonNativeFullscreen;</div><div class="diff-removed">-pub const OptionAsAlt = Config.OptionAsAlt;</div><div class="diff-removed">-pub const RepeatableCodepointMap = Config.RepeatableCodepointMap;</div><div class="diff-removed">-pub const RepeatableFontVariation = Config.RepeatableFontVariation;</div><div class="diff-removed">-pub const RepeatableString = Config.RepeatableString;</div><div class="diff-removed">-pub const RepeatableStringMap = @import("config/RepeatableStringMap.zig");</div><div class="diff-removed">-pub const RepeatablePath = Config.RepeatablePath;</div><div class="diff-removed">-pub const ShellIntegrationFeatures = Config.ShellIntegrationFeatures;</div><div class="diff-removed">-pub const WindowPaddingColor = Config.WindowPaddingColor;</div><div class="diff-removed">-</div><div class="diff-removed">-// Alternate APIs</div><div class="diff-removed">-pub const CAPI = @import("config/CAPI.zig");</div><div class="diff-removed">-pub const Wasm = if (!builtin.target.cpu.arch.isWasm()) struct {} else @import("config/Wasm.zig");</div><div class="diff-added">+const std = @import("std");</div><div class="diff-added">+const Allocator = std.mem.Allocator;</div><div class="diff-added">+const ArenaAllocator = std.heap.ArenaAllocator;</div><div class="diff-added">+const fontpkg = @import("font/main.zig");</div><div class="diff-added">+const inputpkg = @import("input.zig");</div><div class="diff-added">+const terminal = @import("terminal/main.zig");</div><div class="diff-added">+const internal_os = @import("os/main.zig");</div><div class="diff-added">+const cli_args = @import("cli_args.zig");</div><div> </div><div class="diff-removed">-test {</div><div class="diff-removed">-    @import("std").testing.refAllDecls(@This());</div><div class="diff-added">+const log = std.log.scoped(.config);</div><div class="diff-added">+</div><div class="diff-added">+/// Used on Unixes for some defaults.</div><div class="diff-added">+const c = @cImport({</div><div class="diff-added">+    @cInclude("unistd.h");</div><div class="diff-added">+});</div><div class="diff-added">+</div><div class="diff-added">+/// Config is the main config struct. These fields map directly to the</div><div class="diff-added">+/// CLI flag names hence we use a lot of `@""` syntax to support hyphens.</div><div class="diff-added">+pub const Config = struct {</div><div class="diff-added">+    /// The font families to use.</div><div class="diff-added">+    @"font-family": ?[:0]const u8 = null,</div><div class="diff-added">+    @"font-family-bold": ?[:0]const u8 = null,</div><div class="diff-added">+    @"font-family-italic": ?[:0]const u8 = null,</div><div class="diff-added">+    @"font-family-bold-italic": ?[:0]const u8 = null,</div><div class="diff-added">+</div><div class="diff-added">+    /// Apply a font feature. This can be repeated multiple times to enable</div><div class="diff-added">+    /// multiple font features. You can NOT set multiple font features with</div><div class="diff-added">+    /// a single value (yet).</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// The font feature will apply to all fonts rendered by Ghostty. A</div><div class="diff-added">+    /// future enhancement will allow targeting specific faces.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// A valid value is the name of a feature. Prefix the feature with a</div><div class="diff-added">+    /// "-" to explicitly disable it. Example: "ss20" or "-ss20".</div><div class="diff-added">+    @"font-feature": RepeatableString = .{},</div><div class="diff-added">+</div><div class="diff-added">+    /// Font size in points</div><div class="diff-added">+    @"font-size": u8 = switch (builtin.os.tag) {</div><div class="diff-added">+        // On Mac we default a little bigger since this tends to look better.</div><div class="diff-added">+        // This is purely subjective but this is easy to modify.</div><div class="diff-added">+        .macos => 13,</div><div class="diff-added">+        else => 12,</div><div class="diff-added">+    },</div><div class="diff-added">+</div><div class="diff-added">+    /// A repeatable configuration to set one or more font variations values</div><div class="diff-added">+    /// for a variable font. A variable font is a single font, usually</div><div class="diff-added">+    /// with a filename ending in "-VF.ttf" or "-VF.otf" that contains</div><div class="diff-added">+    /// one or more configurable axes for things such as weight, slant,</div><div class="diff-added">+    /// etc. Not all fonts support variations; only fonts that explicitly</div><div class="diff-added">+    /// state they are variable fonts will work.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// The format of this is "id=value" where "id" is the axis identifier.</div><div class="diff-added">+    /// An axis identifier is always a 4 character string, such as "wght".</div><div class="diff-added">+    /// To get the list of supported axes, look at your font documentation</div><div class="diff-added">+    /// or use a font inspection tool.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Invalid ids and values are usually ignored. For example, if a font</div><div class="diff-added">+    /// only supports weights from 100 to 700, setting "wght=800" will</div><div class="diff-added">+    /// do nothing (it will not be clamped to 700). You must consult your</div><div class="diff-added">+    /// font's documentation to see what values are supported.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Common axes are: "wght" (weight), "slnt" (slant), "ital" (italic),</div><div class="diff-added">+    /// "opsz" (optical size), "wdth" (width), "GRAD" (gradient), etc.</div><div class="diff-added">+    @"font-variation": RepeatableFontVariation = .{},</div><div class="diff-added">+    @"font-variation-bold": RepeatableFontVariation = .{},</div><div class="diff-added">+    @"font-variation-italic": RepeatableFontVariation = .{},</div><div class="diff-added">+    @"font-variation-bold-italic": RepeatableFontVariation = .{},</div><div class="diff-added">+</div><div class="diff-added">+    /// Draw fonts with a thicker stroke, if supported. This is only supported</div><div class="diff-added">+    /// currently on macOS.</div><div class="diff-added">+    @"font-thicken": bool = false,</div><div class="diff-added">+</div><div class="diff-added">+    /// Background color for the window.</div><div class="diff-added">+    background: Color = .{ .r = 0x28, .g = 0x2C, .b = 0x34 },</div><div class="diff-added">+</div><div class="diff-added">+    /// Foreground color for the window.</div><div class="diff-added">+    foreground: Color = .{ .r = 0xFF, .g = 0xFF, .b = 0xFF },</div><div class="diff-added">+</div><div class="diff-added">+    /// The foreground and background color for selection. If this is not</div><div class="diff-added">+    /// set, then the selection color is just the inverted window background</div><div class="diff-added">+    /// and foreground (note: not to be confused with the cell bg/fg).</div><div class="diff-added">+    @"selection-foreground": ?Color = null,</div><div class="diff-added">+    @"selection-background": ?Color = null,</div><div class="diff-added">+</div><div class="diff-added">+    /// Color palette for the 256 color form that many terminal applications</div><div class="diff-added">+    /// use. The syntax of this configuration is "N=HEXCODE" where "n"</div><div class="diff-added">+    /// is 0 to 255 (for the 256 colors) and HEXCODE is a typical RGB</div><div class="diff-added">+    /// color code such as "#AABBCC". The 0 to 255 correspond to the</div><div class="diff-added">+    /// terminal color table.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// For definitions on all the codes:</div><div class="diff-added">+    /// https://www.ditig.com/256-colors-cheat-sheet</div><div class="diff-added">+    palette: Palette = .{},</div><div class="diff-added">+</div><div class="diff-added">+    /// The color of the cursor. If this is not set, a default will be chosen.</div><div class="diff-added">+    @"cursor-color": ?Color = null,</div><div class="diff-added">+</div><div class="diff-added">+    /// The style of the cursor. This sets the default style. A running</div><div class="diff-added">+    /// program can still request an explicit cursor style using escape</div><div class="diff-added">+    /// sequences (such as CSI q). Shell configurations will often request</div><div class="diff-added">+    /// specific cursor styles.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Caveat: Shell integration currently defaults to always be a bar</div><div class="diff-added">+    /// In order to fix it, we probably would want to add something similar to Kitty's</div><div class="diff-added">+    /// shell integration options (no-cursor). For more information see:</div><div class="diff-added">+    /// https://sw.kovidgoyal.net/kitty/conf/#opt-kitty.shell_integration</div><div class="diff-added">+    @"cursor-style": terminal.Cursor.Style = .bar,</div><div class="diff-added">+</div><div class="diff-added">+    /// Whether the cursor shall blink</div><div class="diff-added">+    @"cursor-style-blink": bool = true,</div><div class="diff-added">+</div><div class="diff-added">+    /// The color of the text under the cursor. If this is not set, a default</div><div class="diff-added">+    /// will be chosen.</div><div class="diff-added">+    @"cursor-text": ?Color = null,</div><div class="diff-added">+</div><div class="diff-added">+    /// The opacity level (opposite of transparency) of the background.</div><div class="diff-added">+    /// A value of 1 is fully opaque and a value of 0 is fully transparent.</div><div class="diff-added">+    /// A value less than 0 or greater than 1 will be clamped to the nearest</div><div class="diff-added">+    /// valid value.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Changing this value at runtime (and reloading config) will only</div><div class="diff-added">+    /// affect new windows, tabs, and splits.</div><div class="diff-added">+    @"background-opacity": f64 = 1.0,</div><div class="diff-added">+</div><div class="diff-added">+    /// A positive value enables blurring of the background when</div><div class="diff-added">+    /// background-opacity is less than 1. The value is the blur radius to</div><div class="diff-added">+    /// apply. A value of 20 is reasonable for a good looking blur.</div><div class="diff-added">+    /// Higher values will cause strange rendering issues as well as</div><div class="diff-added">+    /// performance issues.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// This is only supported on macOS.</div><div class="diff-added">+    @"background-blur-radius": u8 = 0,</div><div class="diff-added">+</div><div class="diff-added">+    /// The command to run, usually a shell. If this is not an absolute path,</div><div class="diff-added">+    /// it'll be looked up in the PATH. If this is not set, a default will</div><div class="diff-added">+    /// be looked up from your system. The rules for the default lookup are:</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   - SHELL environment variable</div><div class="diff-added">+    ///   - passwd entry (user information)</div><div class="diff-added">+    ///</div><div class="diff-added">+    command: ?[]const u8 = null,</div><div class="diff-added">+</div><div class="diff-added">+    /// The directory to change to after starting the command.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// The default is "inherit" except in special scenarios listed next.</div><div class="diff-added">+    /// If ghostty can detect it is launched on macOS from launchd</div><div class="diff-added">+    /// (double-clicked), then it defaults to "home".</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// The value of this must be an absolute value or one of the special</div><div class="diff-added">+    /// values below:</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   - "home" - The home directory of the executing user.</div><div class="diff-added">+    ///   - "inherit" - The working directory of the launching process.</div><div class="diff-added">+    ///</div><div class="diff-added">+    @"working-directory": ?[]const u8 = null,</div><div class="diff-added">+</div><div class="diff-added">+    /// Key bindings. The format is "trigger=action". Duplicate triggers</div><div class="diff-added">+    /// will overwrite previously set values.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Trigger: "+"-separated list of keys and modifiers. Example:</div><div class="diff-added">+    /// "ctrl+a", "ctrl+shift+b", "up". Some notes:</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   - modifiers cannot repeat, "ctrl+ctrl+a" is invalid.</div><div class="diff-added">+    ///   - modifiers and key can be in any order, "shift+a+ctrl" is weird,</div><div class="diff-added">+    ///     but valid.</div><div class="diff-added">+    ///   - only a single key input is allowed, "ctrl+a+b" is invalid.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Action is the action to take when the trigger is satisfied. It takes</div><div class="diff-added">+    /// the format "action" or "action:param". The latter form is only valid</div><div class="diff-added">+    /// if the action requires a parameter.</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   - "ignore" - Do nothing, ignore the key input. This can be used to</div><div class="diff-added">+    ///     black hole certain inputs to have no effect.</div><div class="diff-added">+    ///   - "unbind" - Remove the binding. This makes it so the previous action</div><div class="diff-added">+    ///     is removed, and the key will be sent through to the child command</div><div class="diff-added">+    ///     if it is printable.</div><div class="diff-added">+    ///   - "csi:text" - Send a CSI sequence. i.e. "csi:A" sends "cursor up".</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Some notes for the action:</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   - The parameter is taken as-is after the ":". Double quotes or</div><div class="diff-added">+    ///     other mechanisms are included and NOT parsed. If you want to</div><div class="diff-added">+    ///     send a string value that includes spaces, wrap the entire</div><div class="diff-added">+    ///     trigger/action in double quotes. Example: --keybind="up=csi:A B"</div><div class="diff-added">+    ///</div><div class="diff-added">+    keybind: Keybinds = .{},</div><div class="diff-added">+</div><div class="diff-added">+    /// Window padding. This applies padding between the terminal cells and</div><div class="diff-added">+    /// the window border. The "x" option applies to the left and right</div><div class="diff-added">+    /// padding and the "y" option is top and bottom. The value is in points,</div><div class="diff-added">+    /// meaning that it will be scaled appropriately for screen DPI.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// If this value is set too large, the screen will render nothing, because</div><div class="diff-added">+    /// the grid will be completely squished by the padding. It is up to you</div><div class="diff-added">+    /// as the user to pick a reasonable value. If you pick an unreasonable</div><div class="diff-added">+    /// value, a warning will appear in the logs.</div><div class="diff-added">+    @"window-padding-x": u32 = 2,</div><div class="diff-added">+    @"window-padding-y": u32 = 2,</div><div class="diff-added">+</div><div class="diff-added">+    /// The viewport dimensions are usually not perfectly divisible by</div><div class="diff-added">+    /// the cell size. In this case, some extra padding on the end of a</div><div class="diff-added">+    /// column and the bottom of the final row may exist. If this is true,</div><div class="diff-added">+    /// then this extra padding is automatically balanced between all four</div><div class="diff-added">+    /// edges to minimize imbalance on one side. If this is false, the top</div><div class="diff-added">+    /// left grid cell will always hug the edge with zero padding other than</div><div class="diff-added">+    /// what may be specified with the other "window-padding" options.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// If other "window-padding" fields are set and this is true, this will</div><div class="diff-added">+    /// still apply. The other padding is applied first and may affect how</div><div class="diff-added">+    /// many grid cells actually exist, and this is applied last in order</div><div class="diff-added">+    /// to balance the padding given a certain viewport size and grid cell size.</div><div class="diff-added">+    @"window-padding-balance": bool = false,</div><div class="diff-added">+</div><div class="diff-added">+    /// If true, new windows and tabs will inherit the font size of the previously</div><div class="diff-added">+    /// focused window. If no window was previously focused, the default</div><div class="diff-added">+    /// font size will be used. If this is false, the default font size</div><div class="diff-added">+    /// specified in the configuration "font-size" will be used.</div><div class="diff-added">+    @"window-inherit-font-size": bool = true,</div><div class="diff-added">+</div><div class="diff-added">+    /// If false, windows won't have native decorations, i.e. titlebar and</div><div class="diff-added">+    /// borders.</div><div class="diff-added">+    /// Currently only supported with GTK.</div><div class="diff-added">+    @"window-decoration": bool = true,</div><div class="diff-added">+</div><div class="diff-added">+    /// Whether to allow programs running in the terminal to read/write to</div><div class="diff-added">+    /// the system clipboard (OSC 52, for googling). The default is to</div><div class="diff-added">+    /// disallow clipboard reading but allow writing.</div><div class="diff-added">+    @"clipboard-read": bool = false,</div><div class="diff-added">+    @"clipboard-write": bool = true,</div><div class="diff-added">+</div><div class="diff-added">+    /// Trims trailing whitespace on data that is copied to the clipboard.</div><div class="diff-added">+    /// This does not affect data sent to the clipboard via "clipboard-write".</div><div class="diff-added">+    @"clipboard-trim-trailing-spaces": bool = true,</div><div class="diff-added">+</div><div class="diff-added">+    /// The total amount of bytes that can be used for image data (i.e.</div><div class="diff-added">+    /// the Kitty image protocol) per terminal screen. The maximum value</div><div class="diff-added">+    /// is 4,294,967,295 (4GB). The default is 320MB. If this is set to zero,</div><div class="diff-added">+    /// then all image protocols will be disabled.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// This value is separate for primary and alternate screens so the</div><div class="diff-added">+    /// effective limit per surface is double.</div><div class="diff-added">+    @"image-storage-limit": u32 = 320 * 1000 * 1000,</div><div class="diff-added">+</div><div class="diff-added">+    /// Whether to automatically copy selected text to the clipboard. "true"</div><div class="diff-added">+    /// will only copy on systems that support a selection clipboard.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// The value "clipboard" will copy to the system clipboard, making this</div><div class="diff-added">+    /// work on macOS. Note that middle-click will also paste from the system</div><div class="diff-added">+    /// clipboard in this case.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Note that if this is disabled, middle-click paste will also be</div><div class="diff-added">+    /// disabled.</div><div class="diff-added">+    @"copy-on-select": CopyOnSelect = .true,</div><div class="diff-added">+</div><div class="diff-added">+    /// The time in milliseconds between clicks to consider a click a repeat</div><div class="diff-added">+    /// (double, triple, etc.) or an entirely new single click. A value of</div><div class="diff-added">+    /// zero will use a platform-specific default. The default on macOS</div><div class="diff-added">+    /// is determined by the OS settings. On every other platform it is 500ms.</div><div class="diff-added">+    @"click-repeat-interval": u32 = 0,</div><div class="diff-added">+</div><div class="diff-added">+    /// Additional configuration files to read.</div><div class="diff-added">+    @"config-file": RepeatableString = .{},</div><div class="diff-added">+</div><div class="diff-added">+    /// Confirms that a surface should be closed before closing it. This defaults</div><div class="diff-added">+    /// to true. If set to false, surfaces will close without any confirmation.</div><div class="diff-added">+    /// If set to always, a confirmation dialog is shown before closing a surface,</div><div class="diff-added">+    /// even if shell integration indicates no running processes.</div><div class="diff-added">+    @"confirm-close-surface": ConfirmCloseSurface = .true,</div><div class="diff-added">+</div><div class="diff-added">+    /// Whether to enable shell integration auto-injection or not. Shell</div><div class="diff-added">+    /// integration greatly enhances the terminal experience by enabling</div><div class="diff-added">+    /// a number of features:</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   * Working directory reporting so new tabs, splits inherit the</div><div class="diff-added">+    ///     previous terminal's working directory.</div><div class="diff-added">+    ///   * Prompt marking that enables the "scroll_to_prompt" keybinding.</div><div class="diff-added">+    ///   * If you're sitting at a prompt, closing a terminal will not ask</div><div class="diff-added">+    ///     for confirmation.</div><div class="diff-added">+    ///   * Resizing the window with a complex prompt usually paints much</div><div class="diff-added">+    ///     better.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Allowable values are:</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   * "none" - Do not do any automatic injection. You can still manually</div><div class="diff-added">+    ///     configure your shell to enable the integration.</div><div class="diff-added">+    ///   * "detect" - Detect the shell based on the filename.</div><div class="diff-added">+    ///   * "fish", "zsh" - Use this specific shell injection scheme.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// The default value is "detect".</div><div class="diff-added">+    @"shell-integration": ShellIntegration = .detect,</div><div class="diff-added">+</div><div class="diff-added">+    /// If anything other than false, fullscreen mode on macOS will not use the</div><div class="diff-added">+    /// native fullscreen, but make the window fullscreen without animations and</div><div class="diff-added">+    /// using a new space. It's faster than the native fullscreen mode since it</div><div class="diff-added">+    /// doesn't use animations.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Allowable values are:</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   * "visible-menu" - Use non-native macOS fullscreen, keep the menu bar visible</div><div class="diff-added">+    ///   * "true" - Use non-native macOS fullscreen, hide the menu bar</div><div class="diff-added">+    ///   * "false" - Use native macOS fullscreeen</div><div class="diff-added">+    @"macos-non-native-fullscreen": NonNativeFullscreen = .false,</div><div class="diff-added">+</div><div class="diff-added">+    /// If true, the Option key will be treated as Alt. This makes terminal</div><div class="diff-added">+    /// sequences expecting Alt to work properly, but will break Unicode</div><div class="diff-added">+    /// input sequences on macOS if you use them via the alt key. You may</div><div class="diff-added">+    /// set this to false to restore the macOS alt-key unicode sequences</div><div class="diff-added">+    /// but this will break terminal sequences expecting Alt to work.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Note that if an Option-sequence doesn't produce a printable</div><div class="diff-added">+    /// character, it will be treated as Alt regardless of this setting.</div><div class="diff-added">+    /// (i.e. alt+ctrl+a).</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// This does not work with GLFW builds.</div><div class="diff-added">+    @"macos-option-as-alt": OptionAsAlt = .false,</div><div class="diff-added">+</div><div class="diff-added">+    /// If true (default), then the Ghostty GTK application will run in</div><div class="diff-added">+    /// single-instance mode: each new `ghostty` process launched will result</div><div class="diff-added">+    /// in a new window, if there is already a running process.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// If false, each new ghostty process will launch a separate application.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Debug builds of Ghostty have a separate single-instance ID.</div><div class="diff-added">+    @"gtk-single-instance": bool = true,</div><div class="diff-added">+</div><div class="diff-added">+    /// This is set by the CLI parser for deinit.</div><div class="diff-added">+    _arena: ?ArenaAllocator = null,</div><div class="diff-added">+</div><div class="diff-added">+    /// Key is an enum of all the available configuration keys. This is used</div><div class="diff-added">+    /// when paired with diff to determine what fields have changed in a config,</div><div class="diff-added">+    /// amongst other things.</div><div class="diff-added">+    pub const Key = key: {</div><div class="diff-added">+        const field_infos = std.meta.fields(Config);</div><div class="diff-added">+        var enumFields: [field_infos.len]std.builtin.Type.EnumField = undefined;</div><div class="diff-added">+        var i: usize = 0;</div><div class="diff-added">+        inline for (field_infos) |field| {</div><div class="diff-added">+            // Ignore fields starting with "_" since they're internal and</div><div class="diff-added">+            // not copied ever.</div><div class="diff-added">+            if (field.name[0] == '_') continue;</div><div class="diff-added">+</div><div class="diff-added">+            enumFields[i] = .{</div><div class="diff-added">+                .name = field.name,</div><div class="diff-added">+                .value = i,</div><div class="diff-added">+            };</div><div class="diff-added">+            i += 1;</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        var decls = [_]std.builtin.Type.Declaration{};</div><div class="diff-added">+        break :key @Type(.{</div><div class="diff-added">+            .Enum = .{</div><div class="diff-added">+                .tag_type = std.math.IntFittingRange(0, field_infos.len - 1),</div><div class="diff-added">+                .fields = enumFields[0..i],</div><div class="diff-added">+                .decls = &decls,</div><div class="diff-added">+                .is_exhaustive = true,</div><div class="diff-added">+            },</div><div class="diff-added">+        });</div><div class="diff-added">+    };</div><div class="diff-added">+</div><div class="diff-added">+    pub fn deinit(self: *Config) void {</div><div class="diff-added">+        if (self._arena) |arena| arena.deinit();</div><div class="diff-added">+        self.* = undefined;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load the configuration according to the default rules:</div><div class="diff-added">+    ///</div><div class="diff-added">+    ///   1. Defaults</div><div class="diff-added">+    ///   2. XDG Config File</div><div class="diff-added">+    ///   3. CLI flags</div><div class="diff-added">+    ///   4. Recursively defined configuration files</div><div class="diff-added">+    ///</div><div class="diff-added">+    pub fn load(alloc_gpa: Allocator) !Config {</div><div class="diff-added">+        var result = try default(alloc_gpa);</div><div class="diff-added">+        errdefer result.deinit();</div><div class="diff-added">+</div><div class="diff-added">+        // If we have a configuration file in our home directory, parse that first.</div><div class="diff-added">+        try result.loadDefaultFiles(alloc_gpa);</div><div class="diff-added">+</div><div class="diff-added">+        // Parse the config from the CLI args</div><div class="diff-added">+        try result.loadCliArgs(alloc_gpa);</div><div class="diff-added">+</div><div class="diff-added">+        // Parse the config files that were added from our file and CLI args.</div><div class="diff-added">+        try result.loadRecursiveFiles(alloc_gpa);</div><div class="diff-added">+        try result.finalize();</div><div class="diff-added">+</div><div class="diff-added">+        return result;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    pub fn default(alloc_gpa: Allocator) Allocator.Error!Config {</div><div class="diff-added">+        // Build up our basic config</div><div class="diff-added">+        var result: Config = .{</div><div class="diff-added">+            ._arena = ArenaAllocator.init(alloc_gpa),</div><div class="diff-added">+        };</div><div class="diff-added">+        errdefer result.deinit();</div><div class="diff-added">+        const alloc = result._arena.?.allocator();</div><div class="diff-added">+</div><div class="diff-added">+        // Add our default keybindings</div><div class="diff-added">+        try result.keybind.set.put(</div><div class="diff-added">+            alloc,</div><div class="diff-added">+            .{ .key = .space, .mods = .{ .super = true, .alt = true, .ctrl = true } },</div><div class="diff-added">+            .{ .reload_config = {} },</div><div class="diff-added">+        );</div><div class="diff-added">+</div><div class="diff-added">+        {</div><div class="diff-added">+            // On macOS we default to super but Linux ctrl+shift since</div><div class="diff-added">+            // ctrl+c is to kill the process.</div><div class="diff-added">+            const mods: inputpkg.Mods = if (builtin.target.isDarwin())</div><div class="diff-added">+                .{ .super = true }</div><div class="diff-added">+            else</div><div class="diff-added">+                .{ .ctrl = true, .shift = true };</div><div class="diff-added">+</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .c, .mods = mods },</div><div class="diff-added">+                .{ .copy_to_clipboard = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .v, .mods = mods },</div><div class="diff-added">+                .{ .paste_from_clipboard = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        // Fonts</div><div class="diff-added">+        try result.keybind.set.put(</div><div class="diff-added">+            alloc,</div><div class="diff-added">+            .{ .key = .equal, .mods = ctrlOrSuper(.{}) },</div><div class="diff-added">+            .{ .increase_font_size = 1 },</div><div class="diff-added">+        );</div><div class="diff-added">+        try result.keybind.set.put(</div><div class="diff-added">+            alloc,</div><div class="diff-added">+            .{ .key = .minus, .mods = ctrlOrSuper(.{}) },</div><div class="diff-added">+            .{ .decrease_font_size = 1 },</div><div class="diff-added">+        );</div><div class="diff-added">+        try result.keybind.set.put(</div><div class="diff-added">+            alloc,</div><div class="diff-added">+            .{ .key = .zero, .mods = ctrlOrSuper(.{}) },</div><div class="diff-added">+            .{ .reset_font_size = {} },</div><div class="diff-added">+        );</div><div class="diff-added">+</div><div class="diff-added">+        try result.keybind.set.put(</div><div class="diff-added">+            alloc,</div><div class="diff-added">+            .{ .key = .j, .mods = ctrlOrSuper(.{ .shift = true }) },</div><div class="diff-added">+            .{ .write_scrollback_file = {} },</div><div class="diff-added">+        );</div><div class="diff-added">+</div><div class="diff-added">+        // Windowing</div><div class="diff-added">+        if (comptime !builtin.target.isDarwin()) {</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .n, .mods = .{ .ctrl = true, .shift = true } },</div><div class="diff-added">+                .{ .new_window = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .w, .mods = .{ .ctrl = true, .shift = true } },</div><div class="diff-added">+                .{ .close_surface = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .q, .mods = .{ .ctrl = true, .shift = true } },</div><div class="diff-added">+                .{ .quit = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .f4, .mods = .{ .alt = true } },</div><div class="diff-added">+                .{ .close_window = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .t, .mods = .{ .ctrl = true, .shift = true } },</div><div class="diff-added">+                .{ .new_tab = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .left, .mods = .{ .ctrl = true, .shift = true } },</div><div class="diff-added">+                .{ .previous_tab = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .right, .mods = .{ .ctrl = true, .shift = true } },</div><div class="diff-added">+                .{ .next_tab = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .o, .mods = .{ .ctrl = true, .shift = true } },</div><div class="diff-added">+                .{ .new_split = .right },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .e, .mods = .{ .ctrl = true, .shift = true } },</div><div class="diff-added">+                .{ .new_split = .down },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .left_bracket, .mods = .{ .ctrl = true, .super = true } },</div><div class="diff-added">+                .{ .goto_split = .previous },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .right_bracket, .mods = .{ .ctrl = true, .super = true } },</div><div class="diff-added">+                .{ .goto_split = .next },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .up, .mods = .{ .ctrl = true, .alt = true } },</div><div class="diff-added">+                .{ .goto_split = .top },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .down, .mods = .{ .ctrl = true, .alt = true } },</div><div class="diff-added">+                .{ .goto_split = .bottom },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .left, .mods = .{ .ctrl = true, .alt = true } },</div><div class="diff-added">+                .{ .goto_split = .left },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .right, .mods = .{ .ctrl = true, .alt = true } },</div><div class="diff-added">+                .{ .goto_split = .right },</div><div class="diff-added">+            );</div><div class="diff-added">+</div><div class="diff-added">+            // Viewport scrolling</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .home, .mods = .{ .shift = true } },</div><div class="diff-added">+                .{ .scroll_to_top = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .end, .mods = .{ .shift = true } },</div><div class="diff-added">+                .{ .scroll_to_bottom = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .page_up, .mods = .{ .shift = true } },</div><div class="diff-added">+                .{ .scroll_page_up = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .page_down, .mods = .{ .shift = true } },</div><div class="diff-added">+                .{ .scroll_page_down = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+</div><div class="diff-added">+            // Semantic prompts</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .page_up, .mods = .{ .shift = true, .ctrl = true } },</div><div class="diff-added">+                .{ .jump_to_prompt = -1 },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .page_down, .mods = .{ .shift = true, .ctrl = true } },</div><div class="diff-added">+                .{ .jump_to_prompt = 1 },</div><div class="diff-added">+            );</div><div class="diff-added">+        }</div><div class="diff-added">+        {</div><div class="diff-added">+            // Cmd+N for goto tab N</div><div class="diff-added">+            const start = @intFromEnum(inputpkg.Key.one);</div><div class="diff-added">+            const end = @intFromEnum(inputpkg.Key.nine);</div><div class="diff-added">+            var i: usize = start;</div><div class="diff-added">+            while (i <= end) : (i += 1) {</div><div class="diff-added">+                // On macOS we default to super but everywhere else</div><div class="diff-added">+                // is alt.</div><div class="diff-added">+                const mods: inputpkg.Mods = if (builtin.target.isDarwin())</div><div class="diff-added">+                    .{ .super = true }</div><div class="diff-added">+                else</div><div class="diff-added">+                    .{ .alt = true };</div><div class="diff-added">+</div><div class="diff-added">+                try result.keybind.set.put(</div><div class="diff-added">+                    alloc,</div><div class="diff-added">+                    .{ .key = @enumFromInt(i), .mods = mods },</div><div class="diff-added">+                    .{ .goto_tab = (i - start) + 1 },</div><div class="diff-added">+                );</div><div class="diff-added">+            }</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        // Toggle fullscreen</div><div class="diff-added">+        try result.keybind.set.put(</div><div class="diff-added">+            alloc,</div><div class="diff-added">+            .{ .key = .enter, .mods = ctrlOrSuper(.{}) },</div><div class="diff-added">+            .{ .toggle_fullscreen = {} },</div><div class="diff-added">+        );</div><div class="diff-added">+</div><div class="diff-added">+        // Toggle zoom a split</div><div class="diff-added">+        try result.keybind.set.put(</div><div class="diff-added">+            alloc,</div><div class="diff-added">+            .{ .key = .enter, .mods = ctrlOrSuper(.{ .shift = true }) },</div><div class="diff-added">+            .{ .toggle_split_zoom = {} },</div><div class="diff-added">+        );</div><div class="diff-added">+</div><div class="diff-added">+        // Mac-specific keyboard bindings.</div><div class="diff-added">+        if (comptime builtin.target.isDarwin()) {</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .q, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .quit = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .k, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .clear_screen = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+</div><div class="diff-added">+            // Viewport scrolling</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .home, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .scroll_to_top = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .end, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .scroll_to_bottom = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .page_up, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .scroll_page_up = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .page_down, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .scroll_page_down = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+</div><div class="diff-added">+            // Semantic prompts</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .up, .mods = .{ .super = true, .shift = true } },</div><div class="diff-added">+                .{ .jump_to_prompt = -1 },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .down, .mods = .{ .super = true, .shift = true } },</div><div class="diff-added">+                .{ .jump_to_prompt = 1 },</div><div class="diff-added">+            );</div><div class="diff-added">+</div><div class="diff-added">+            // Mac windowing</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .n, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .new_window = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .w, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .close_surface = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .w, .mods = .{ .super = true, .shift = true } },</div><div class="diff-added">+                .{ .close_window = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .t, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .new_tab = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .left_bracket, .mods = .{ .super = true, .shift = true } },</div><div class="diff-added">+                .{ .previous_tab = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .right_bracket, .mods = .{ .super = true, .shift = true } },</div><div class="diff-added">+                .{ .next_tab = {} },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .d, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .new_split = .right },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .d, .mods = .{ .super = true, .shift = true } },</div><div class="diff-added">+                .{ .new_split = .down },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .left_bracket, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .goto_split = .previous },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .right_bracket, .mods = .{ .super = true } },</div><div class="diff-added">+                .{ .goto_split = .next },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .up, .mods = .{ .super = true, .alt = true } },</div><div class="diff-added">+                .{ .goto_split = .top },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .down, .mods = .{ .super = true, .alt = true } },</div><div class="diff-added">+                .{ .goto_split = .bottom },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .left, .mods = .{ .super = true, .alt = true } },</div><div class="diff-added">+                .{ .goto_split = .left },</div><div class="diff-added">+            );</div><div class="diff-added">+            try result.keybind.set.put(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                .{ .key = .right, .mods = .{ .super = true, .alt = true } },</div><div class="diff-added">+                .{ .goto_split = .right },</div><div class="diff-added">+            );</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        return result;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// This sets either "ctrl" or "super" to true (but not both)</div><div class="diff-added">+    /// on mods depending on if the build target is Mac or not. On</div><div class="diff-added">+    /// Mac, we default to super (i.e. super+c for copy) and on</div><div class="diff-added">+    /// non-Mac we default to ctrl (i.e. ctrl+c for copy).</div><div class="diff-added">+    fn ctrlOrSuper(mods: inputpkg.Mods) inputpkg.Mods {</div><div class="diff-added">+        var copy = mods;</div><div class="diff-added">+        if (comptime builtin.target.isDarwin()) {</div><div class="diff-added">+            copy.super = true;</div><div class="diff-added">+        } else {</div><div class="diff-added">+            copy.ctrl = true;</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        return copy;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load the configuration from the default file locations. Currently,</div><div class="diff-added">+    /// this loads from $XDG_CONFIG_HOME/ghostty/config.</div><div class="diff-added">+    pub fn loadDefaultFiles(self: *Config, alloc: Allocator) !void {</div><div class="diff-added">+        const home_config_path = try internal_os.xdg.config(alloc, .{ .subdir = "ghostty/config" });</div><div class="diff-added">+        defer alloc.free(home_config_path);</div><div class="diff-added">+</div><div class="diff-added">+        const cwd = std.fs.cwd();</div><div class="diff-added">+        if (cwd.openFile(home_config_path, .{})) |file| {</div><div class="diff-added">+            defer file.close();</div><div class="diff-added">+            std.log.info("reading configuration file path={s}", .{home_config_path});</div><div class="diff-added">+</div><div class="diff-added">+            var buf_reader = std.io.bufferedReader(file.reader());</div><div class="diff-added">+            var iter = cli_args.lineIterator(buf_reader.reader());</div><div class="diff-added">+            try cli_args.parse(Config, alloc, self, &iter);</div><div class="diff-added">+        } else |err| switch (err) {</div><div class="diff-added">+            error.FileNotFound => std.log.info(</div><div class="diff-added">+                "homedir config not found, not loading path={s}",</div><div class="diff-added">+                .{home_config_path},</div><div class="diff-added">+            ),</div><div class="diff-added">+</div><div class="diff-added">+            else => std.log.warn(</div><div class="diff-added">+                "error reading homedir config file, not loading err={} path={s}",</div><div class="diff-added">+                .{ err, home_config_path },</div><div class="diff-added">+            ),</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load and parse the CLI args.</div><div class="diff-added">+    pub fn loadCliArgs(self: *Config, alloc_gpa: Allocator) !void {</div><div class="diff-added">+        switch (builtin.os.tag) {</div><div class="diff-added">+            .windows => {},</div><div class="diff-added">+</div><div class="diff-added">+            // Fast-path if we are non-Windows and no args, do nothing.</div><div class="diff-added">+            else => if (std.os.argv.len <= 1) return,</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        // Parse the config from the CLI args</div><div class="diff-added">+        var iter = try std.process.argsWithAllocator(alloc_gpa);</div><div class="diff-added">+        defer iter.deinit();</div><div class="diff-added">+        try cli_args.parse(Config, alloc_gpa, self, &iter);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load and parse the config files that were added in the "config-file" key.</div><div class="diff-added">+    pub fn loadRecursiveFiles(self: *Config, alloc: Allocator) !void {</div><div class="diff-added">+        // TODO(mitchellh): we should parse the files form the homedir first</div><div class="diff-added">+        // TODO(mitchellh): support nesting (config-file in a config file)</div><div class="diff-added">+        // TODO(mitchellh): detect cycles when nesting</div><div class="diff-added">+</div><div class="diff-added">+        if (self.@"config-file".list.items.len == 0) return;</div><div class="diff-added">+</div><div class="diff-added">+        const cwd = std.fs.cwd();</div><div class="diff-added">+        const len = self.@"config-file".list.items.len;</div><div class="diff-added">+        for (self.@"config-file".list.items) |path| {</div><div class="diff-added">+            var file = try cwd.openFile(path, .{});</div><div class="diff-added">+            defer file.close();</div><div class="diff-added">+</div><div class="diff-added">+            var buf_reader = std.io.bufferedReader(file.reader());</div><div class="diff-added">+            var iter = cli_args.lineIterator(buf_reader.reader());</div><div class="diff-added">+            try cli_args.parse(Config, alloc, self, &iter);</div><div class="diff-added">+</div><div class="diff-added">+            // We don't currently support adding more config files to load</div><div class="diff-added">+            // from within a loaded config file. This can be supported</div><div class="diff-added">+            // later.</div><div class="diff-added">+            if (self.@"config-file".list.items.len > len)</div><div class="diff-added">+                return error.ConfigFileInConfigFile;</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    pub fn finalize(self: *Config) !void {</div><div class="diff-added">+        // If we have a font-family set and don't set the others, default</div><div class="diff-added">+        // the others to the font family. This way, if someone does</div><div class="diff-added">+        // --font-family=foo, then we try to get the stylized versions of</div><div class="diff-added">+        // "foo" as well.</div><div class="diff-added">+        if (self.@"font-family") |family| {</div><div class="diff-added">+            const fields = &[_][]const u8{</div><div class="diff-added">+                "font-family-bold",</div><div class="diff-added">+                "font-family-italic",</div><div class="diff-added">+                "font-family-bold-italic",</div><div class="diff-added">+            };</div><div class="diff-added">+            inline for (fields) |field| {</div><div class="diff-added">+                if (@field(self, field) == null) {</div><div class="diff-added">+                    @field(self, field) = family;</div><div class="diff-added">+                }</div><div class="diff-added">+            }</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        // The default for the working directory depends on the system.</div><div class="diff-added">+        const wd = self.@"working-directory" orelse switch (builtin.os.tag) {</div><div class="diff-added">+            .macos => if (c.getppid() == 1) "home" else "inherit",</div><div class="diff-added">+            else => "inherit",</div><div class="diff-added">+        };</div><div class="diff-added">+</div><div class="diff-added">+        // If we are missing either a command or home directory, we need</div><div class="diff-added">+        // to look up defaults which is kind of expensive. We only do this</div><div class="diff-added">+        // on desktop.</div><div class="diff-added">+        const wd_home = std.mem.eql(u8, "home", wd);</div><div class="diff-added">+        if (comptime !builtin.target.isWasm()) {</div><div class="diff-added">+            if (self.command == null or wd_home) command: {</div><div class="diff-added">+                const alloc = self._arena.?.allocator();</div><div class="diff-added">+</div><div class="diff-added">+                // First look up the command using the SHELL env var if needed.</div><div class="diff-added">+                // We don't do this in flatpak because SHELL in Flatpak is always</div><div class="diff-added">+                // set to /bin/sh.</div><div class="diff-added">+                if (self.command) |cmd|</div><div class="diff-added">+                    log.info("shell src=config value={s}", .{cmd})</div><div class="diff-added">+                else {</div><div class="diff-added">+                    if (!internal_os.isFlatpak()) {</div><div class="diff-added">+                        if (std.process.getEnvVarOwned(alloc, "SHELL")) |value| {</div><div class="diff-added">+                            log.info("default shell source=env value={s}", .{value});</div><div class="diff-added">+                            self.command = value;</div><div class="diff-added">+</div><div class="diff-added">+                            // If we don't need the working directory, then we can exit now.</div><div class="diff-added">+                            if (!wd_home) break :command;</div><div class="diff-added">+                        } else |_| {}</div><div class="diff-added">+                    }</div><div class="diff-added">+                }</div><div class="diff-added">+</div><div class="diff-added">+                // We need the passwd entry for the remainder</div><div class="diff-added">+                const pw = try internal_os.passwd.get(alloc);</div><div class="diff-added">+                if (self.command == null) {</div><div class="diff-added">+                    if (pw.shell) |sh| {</div><div class="diff-added">+                        log.info("default shell src=passwd value={s}", .{sh});</div><div class="diff-added">+                        self.command = sh;</div><div class="diff-added">+                    }</div><div class="diff-added">+                }</div><div class="diff-added">+</div><div class="diff-added">+                if (wd_home) {</div><div class="diff-added">+                    if (pw.home) |home| {</div><div class="diff-added">+                        log.info("default working directory src=passwd value={s}", .{home});</div><div class="diff-added">+                        self.@"working-directory" = home;</div><div class="diff-added">+                    }</div><div class="diff-added">+                }</div><div class="diff-added">+</div><div class="diff-added">+                if (self.command == null) {</div><div class="diff-added">+                    log.warn("no default shell found, will default to using sh", .{});</div><div class="diff-added">+                }</div><div class="diff-added">+            }</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        // If we have the special value "inherit" then set it to null which</div><div class="diff-added">+        // does the same. In the future we should change to a tagged union.</div><div class="diff-added">+        if (std.mem.eql(u8, wd, "inherit")) self.@"working-directory" = null;</div><div class="diff-added">+</div><div class="diff-added">+        // Default our click interval</div><div class="diff-added">+        if (self.@"click-repeat-interval" == 0) {</div><div class="diff-added">+            self.@"click-repeat-interval" = internal_os.clickInterval() orelse 500;</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Create a shallow copy of this config. This will share all the memory</div><div class="diff-added">+    /// allocated with the previous config but will have a new arena for</div><div class="diff-added">+    /// any changes or new allocations. The config should have `deinit`</div><div class="diff-added">+    /// called when it is complete.</div><div class="diff-added">+    ///</div><div class="diff-added">+    /// Beware: these shallow clones are not meant for a long lifetime,</div><div class="diff-added">+    /// they are just meant to exist temporarily for the duration of some</div><div class="diff-added">+    /// modifications. It is very important that the original config not</div><div class="diff-added">+    /// be deallocated while shallow clones exist.</div><div class="diff-added">+    pub fn shallowClone(self: *const Config, alloc_gpa: Allocator) Config {</div><div class="diff-added">+        var result = self.*;</div><div class="diff-added">+        result._arena = ArenaAllocator.init(alloc_gpa);</div><div class="diff-added">+        return result;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Create a copy of this configuration. This is useful as a starting</div><div class="diff-added">+    /// point for modifying a configuration since a config can NOT be</div><div class="diff-added">+    /// modified once it is in use by an app or surface.</div><div class="diff-added">+    pub fn clone(self: *const Config, alloc_gpa: Allocator) !Config {</div><div class="diff-added">+        // Start with an empty config with a new arena we're going</div><div class="diff-added">+        // to use for all our copies.</div><div class="diff-added">+        var result: Config = .{</div><div class="diff-added">+            ._arena = ArenaAllocator.init(alloc_gpa),</div><div class="diff-added">+        };</div><div class="diff-added">+        errdefer result.deinit();</div><div class="diff-added">+        const alloc = result._arena.?.allocator();</div><div class="diff-added">+</div><div class="diff-added">+        inline for (@typeInfo(Config).Struct.fields) |field| {</div><div class="diff-added">+            if (!@hasField(Key, field.name)) continue;</div><div class="diff-added">+            @field(result, field.name) = try cloneValue(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                field.type,</div><div class="diff-added">+                @field(self, field.name),</div><div class="diff-added">+            );</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        return result;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    fn cloneValue(alloc: Allocator, comptime T: type, src: T) !T {</div><div class="diff-added">+        // Do known named types first</div><div class="diff-added">+        switch (T) {</div><div class="diff-added">+            []const u8 => return try alloc.dupe(u8, src),</div><div class="diff-added">+            [:0]const u8 => return try alloc.dupeZ(u8, src),</div><div class="diff-added">+</div><div class="diff-added">+            else => {},</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        // Back into types of types</div><div class="diff-added">+        switch (@typeInfo(T)) {</div><div class="diff-added">+            inline .Bool,</div><div class="diff-added">+            .Int,</div><div class="diff-added">+            .Float,</div><div class="diff-added">+            .Enum,</div><div class="diff-added">+            => return src,</div><div class="diff-added">+</div><div class="diff-added">+            .Optional => |info| return try cloneValue(</div><div class="diff-added">+                alloc,</div><div class="diff-added">+                info.child,</div><div class="diff-added">+                src orelse return null,</div><div class="diff-added">+            ),</div><div class="diff-added">+</div><div class="diff-added">+            .Struct => return try src.clone(alloc),</div><div class="diff-added">+</div><div class="diff-added">+            else => {</div><div class="diff-added">+                @compileLog(T);</div><div class="diff-added">+                @compileError("unsupported field type");</div><div class="diff-added">+            },</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Returns an iterator that goes through each changed field from</div><div class="diff-added">+    /// old to new. The order of old or new do not matter.</div><div class="diff-added">+    pub fn changeIterator(old: *const Config, new: *const Config) ChangeIterator {</div><div class="diff-added">+        return .{</div><div class="diff-added">+            .old = old,</div><div class="diff-added">+            .new = new,</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Returns true if the given key has changed from old to new. This</div><div class="diff-added">+    /// requires the key to be comptime known to make this more efficient.</div><div class="diff-added">+    pub fn changed(self: *const Config, new: *const Config, comptime key: Key) bool {</div><div class="diff-added">+        // Get the field at comptime</div><div class="diff-added">+        const field = comptime field: {</div><div class="diff-added">+            const fields = std.meta.fields(Config);</div><div class="diff-added">+            for (fields) |field| {</div><div class="diff-added">+                if (@field(Key, field.name) == key) {</div><div class="diff-added">+                    break :field field;</div><div class="diff-added">+                }</div><div class="diff-added">+            }</div><div class="diff-added">+</div><div class="diff-added">+            unreachable;</div><div class="diff-added">+        };</div><div class="diff-added">+</div><div class="diff-added">+        const old_value = @field(self, field.name);</div><div class="diff-added">+        const new_value = @field(new, field.name);</div><div class="diff-added">+        return !equal(field.type, old_value, new_value);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// This yields a key for every changed field between old and new.</div><div class="diff-added">+    pub const ChangeIterator = struct {</div><div class="diff-added">+        old: *const Config,</div><div class="diff-added">+        new: *const Config,</div><div class="diff-added">+        i: usize = 0,</div><div class="diff-added">+</div><div class="diff-added">+        pub fn next(self: *ChangeIterator) ?Key {</div><div class="diff-added">+            const fields = comptime std.meta.fields(Key);</div><div class="diff-added">+            while (self.i < fields.len) {</div><div class="diff-added">+                switch (self.i) {</div><div class="diff-added">+                    inline 0...(fields.len - 1) => |i| {</div><div class="diff-added">+                        const field = fields[i];</div><div class="diff-added">+                        const key = @field(Key, field.name);</div><div class="diff-added">+                        self.i += 1;</div><div class="diff-added">+                        if (self.old.changed(self.new, key)) return key;</div><div class="diff-added">+                    },</div><div class="diff-added">+</div><div class="diff-added">+                    else => unreachable,</div><div class="diff-added">+                }</div><div class="diff-added">+            }</div><div class="diff-added">+</div><div class="diff-added">+            return null;</div><div class="diff-added">+        }</div><div class="diff-added">+    };</div><div> </div><div class="diff-removed">-    // Vim syntax file, not used at runtime but we want to keep it tested.</div><div class="diff-removed">-    _ = @import("config/vim.zig");</div><div class="diff-added">+    test "clone default" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+        const alloc = testing.allocator;</div><div class="diff-added">+</div><div class="diff-added">+        var source = try Config.default(alloc);</div><div class="diff-added">+        defer source.deinit();</div><div class="diff-added">+        var dest = try source.clone(alloc);</div><div class="diff-added">+        defer dest.deinit();</div><div class="diff-added">+</div><div class="diff-added">+        // Should have no changes</div><div class="diff-added">+        var it = source.changeIterator(&dest);</div><div class="diff-added">+        try testing.expectEqual(@as(?Key, null), it.next());</div><div class="diff-added">+</div><div class="diff-added">+        // I want to do this but this doesn't work (the API doesn't work)</div><div class="diff-added">+        // try testing.expectEqualDeep(dest, source);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test "changed" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+        const alloc = testing.allocator;</div><div class="diff-added">+</div><div class="diff-added">+        var source = try Config.default(alloc);</div><div class="diff-added">+        defer source.deinit();</div><div class="diff-added">+        var dest = try source.clone(alloc);</div><div class="diff-added">+        defer dest.deinit();</div><div class="diff-added">+        dest.@"font-family" = "something else";</div><div class="diff-added">+</div><div class="diff-added">+        try testing.expect(source.changed(&dest, .@"font-family"));</div><div class="diff-added">+        try testing.expect(!source.changed(&dest, .@"font-size"));</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// A config-specific helper to determine if two values of the same</div><div class="diff-added">+/// type are equal. This isn't the same as std.mem.eql or std.testing.equals</div><div class="diff-added">+/// because we expect structs to implement their own equality.</div><div class="diff-added">+///</div><div class="diff-added">+/</div><div class="diff-added">+/// This also doesn't support ALL Zig types, because we only add to it</div><div class="diff-added">+/// as we need types for the config.</div><div class="diff-added">+fn equal(comptime T: type, old: T, new: T) bool {</div><div class="diff-added">+    // Do known named types first</div><div class="diff-added">+    switch (T) {</div><div class="diff-added">+        inline []const u8,</div><div class="diff-added">+        [:0]const u8,</div><div class="diff-added">+        => return std.mem.eql(u8, old, new),</div><div class="diff-added">+</div><div class="diff-added">+        else => {},</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    // Back into types of types</div><div class="diff-added">+    switch (@typeInfo(T)) {</div><div class="diff-added">+        .Void => return true,</div><div class="diff-added">+</div><div class="diff-added">+        inline .Bool,</div><div class="diff-added">+        .Int,</div><div class="diff-added">+        .Float,</div><div class="diff-added">+        .Enum,</div><div class="diff-added">+        => return old == new,</div><div class="diff-added">+</div><div class="diff-added">+        .Optional => |info| {</div><div class="diff-added">+            if (old == null and new == null) return true;</div><div class="diff-added">+            if (old == null or new == null) return false;</div><div class="diff-added">+            return equal(info.child, old.?, new.?);</div><div class="diff-added">+        },</div><div class="diff-added">+</div><div class="diff-added">+        .Struct => |info| {</div><div class="diff-added">+            if (@hasDecl(T, "equal")) return old.equal(new);</div><div class="diff-added">+</div><div class="diff-added">+            // If a struct doesn't declare an "equal" function, we fall back</div><div class="diff-added">+            // to a recursive field-by-field compare.</div><div class="diff-added">+            inline for (info.fields) |field_info| {</div><div class="diff-added">+                if (!equal(</div><div class="diff-added">+                    field_info.type,</div><div class="diff-added">+                    @field(old, field_info.name),</div><div class="diff-added">+                    @field(new, field_info.name),</div><div class="diff-added">+                )) return false;</div><div class="diff-added">+            }</div><div class="diff-added">+            return true;</div><div class="diff-added">+        },</div><div class="diff-added">+</div><div class="diff-added">+        .Union => |info| {</div><div class="diff-added">+            const tag_type = info.tag_type.?;</div><div class="diff-added">+            const old_tag = std.meta.activeTag(old);</div><div class="diff-added">+            const new_tag = std.meta.activeTag(new);</div><div class="diff-added">+            if (old_tag != new_tag) return false;</div><div class="diff-added">+</div><div class="diff-added">+            inline for (info.fields) |field_info| {</div><div class="diff-added">+                if (@field(tag_type, field_info.name) == old_tag) {</div><div class="diff-added">+                    return equal(</div><div class="diff-added">+                        field_info.type,</div><div class="diff-added">+                        @field(old, field_info.name),</div><div class="diff-added">+                        @field(new, field_info.name),</div><div class="diff-added">+                    );</div><div class="diff-added">+                }</div><div class="diff-added">+            }</div><div class="diff-added">+</div><div class="diff-added">+            unreachable;</div><div class="diff-added">+        },</div><div class="diff-added">+</div><div class="diff-added">+        else => {</div><div class="diff-added">+            @compileLog(T);</div><div class="diff-added">+            @compileError("unsupported field type");</div><div class="diff-added">+        },</div><div class="diff-added">+    }</div><div class="diff-added">+}</div><div class="diff-added">+</div><div class="diff-added">+/// Valid values for macos-non-native-fullscreen</div><div class="diff-added">+/// c_int because it needs to be extern compatible</div><div class="diff-added">+/// If this is changed, you must also update ghostty.h</div><div class="diff-added">+pub const NonNativeFullscreen = enum(c_int) {</div><div class="diff-added">+    false,</div><div class="diff-added">+    true,</div><div class="diff-added">+    @"visible-menu",</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// Valid values for macos-option-as-alt.</div><div class="diff-added">+pub const OptionAsAlt = enum {</div><div class="diff-added">+    false,</div><div class="diff-added">+    true,</div><div class="diff-added">+    left,</div><div class="diff-added">+    right,</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// Confirm close surface options</div><div class="diff-added">+pub const ConfirmCloseSurface = enum {</div><div class="diff-added">+    /// Disables confirmation entirely.</div><div class="diff-added">+    false,</div><div class="diff-added">+</div><div class="diff-added">+    /// Confirmation is only requested when appropriate (via shell integration).</div><div class="diff-added">+    true,</div><div class="diff-added">+</div><div class="diff-added">+    /// Confirmation is always requested regardless of shell integration state.</div><div class="diff-added">+    always,</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// Color represents a color using RGB.</div><div class="diff-added">+pub const Color = struct {</div><div class="diff-added">+    r: u8,</div><div class="diff-added">+    g: u8,</div><div class="diff-added">+    b: u8,</div><div class="diff-added">+</div><div class="diff-added">+    pub const Error = error{</div><div class="diff-added">+        InvalidFormat,</div><div class="diff-added">+    };</div><div class="diff-added">+</div><div class="diff-added">+    /// Convert this to the terminal RGB struct</div><div class="diff-added">+    pub fn toTerminalRGB(self: Color) terminal.color.RGB {</div><div class="diff-added">+        return .{ .r = self.r, .g = self.g, .b = self.b };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    pub fn parseCLI(input: ?[]const u8) !Color {</div><div class="diff-added">+        return fromHex(input orelse return error.ValueRequired);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Deep copy of the struct. Required by Config.</div><div class="diff-added">+    pub fn clone(self: Color, _: Allocator) !Color {</div><div class="diff-added">+        return self;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Compare if two of our value are equal. Required by Config.</div><div class="diff-added">+    pub fn equal(self: Color, other: Color) bool {</div><div class="diff-added">+        return std.meta.eql(self, other);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// fromHex parses a color from a hex value such as #RRGGBB. The "#"</div><div class="diff-added">+    /// is optional.</div><div class="diff-added">+    pub fn fromHex(input: []const u8) !Color {</div><div class="diff-added">+        // Trim the beginning '#' if it exists</div><div class="diff-added">+        const trimmed = if (input.len != 0 and input[0] == '#') input[1..] else input;</div><div class="diff-added">+</div><div class="diff-added">+        // We expect exactly 6 for RRGGBB</div><div class="diff-added">+        if (trimmed.len != 6) return Error.InvalidFormat;</div><div class="diff-added">+</div><div class="diff-added">+        // Parse the colors two at a time.</div><div class="diff-added">+        var result: Color = undefined;</div><div class="diff-added">+        comptime var i: usize = 0;</div><div class="diff-added">+        inline while (i < 6) : (i += 2) {</div><div class="diff-added">+            const v: u8 =</div><div class="diff-added">+                ((try std.fmt.charToDigit(trimmed[i], 16)) * 16) +</div><div class="diff-added">+                try std.fmt.charToDigit(trimmed[i + 1], 16);</div><div class="diff-added">+</div><div class="diff-added">+            @field(result, switch (i) {</div><div class="diff-added">+                0 => "r",</div><div class="diff-added">+                2 => "g",</div><div class="diff-added">+                4 => "b",</div><div class="diff-added">+                else => unreachable,</div><div class="diff-added">+            }) = v;</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        return result;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test "fromHex" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+</div><div class="diff-added">+        try testing.expectEqual(Color{ .r = 0, .g = 0, .b = 0 }, try Color.fromHex("#000000"));</div><div class="diff-added">+        try testing.expectEqual(Color{ .r = 10, .g = 11, .b = 12 }, try Color.fromHex("#0A0B0C"));</div><div class="diff-added">+        try testing.expectEqual(Color{ .r = 10, .g = 11, .b = 12 }, try Color.fromHex("0A0B0C"));</div><div class="diff-added">+        try testing.expectEqual(Color{ .r = 255, .g = 255, .b = 255 }, try Color.fromHex("FFFFFF"));</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// Palette is the 256 color palette for 256-color mode. This is still</div><div class="diff-added">+/// used by many terminal applications.</div><div class="diff-added">+pub const Palette = struct {</div><div class="diff-added">+    const Self = @This();</div><div class="diff-added">+</div><div class="diff-added">+    /// The actual value that is updated as we parse.</div><div class="diff-added">+    value: terminal.color.Palette = terminal.color.default,</div><div class="diff-added">+</div><div class="diff-added">+    pub const Error = error{</div><div class="diff-added">+        InvalidFormat,</div><div class="diff-added">+    };</div><div class="diff-added">+</div><div class="diff-added">+    pub fn parseCLI(</div><div class="diff-added">+        self: *Self,</div><div class="diff-added">+        input: ?[]const u8,</div><div class="diff-added">+    ) !void {</div><div class="diff-added">+        const value = input orelse return error.ValueRequired;</div><div class="diff-added">+        const eqlIdx = std.mem.indexOf(u8, value, "=") orelse</div><div class="diff-added">+            return Error.InvalidFormat;</div><div class="diff-added">+</div><div class="diff-added">+        const key = try std.fmt.parseInt(u8, value[0..eqlIdx], 10);</div><div class="diff-added">+        const rgb = try Color.parseCLI(value[eqlIdx + 1 ..]);</div><div class="diff-added">+        self.value[key] = .{ .r = rgb.r, .g = rgb.g, .b = rgb.b };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Deep copy of the struct. Required by Config.</div><div class="diff-added">+    pub fn clone(self: Self, _: Allocator) !Self {</div><div class="diff-added">+        return self;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Compare if two of our value are equal. Required by Config.</div><div class="diff-added">+    pub fn equal(self: Self, other: Self) bool {</div><div class="diff-added">+        return std.meta.eql(self, other);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test "parseCLI" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+</div><div class="diff-added">+        var p: Self = .{};</div><div class="diff-added">+        try p.parseCLI("0=#AABBCC");</div><div class="diff-added">+        try testing.expect(p.value[0].r == 0xAA);</div><div class="diff-added">+        try testing.expect(p.value[0].g == 0xBB);</div><div class="diff-added">+        try testing.expect(p.value[0].b == 0xCC);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test "parseCLI overflow" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+</div><div class="diff-added">+        var p: Self = .{};</div><div class="diff-added">+        try testing.expectError(error.Overflow, p.parseCLI("256=#AABBCC"));</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// RepeatableString is a string value that can be repeated to accumulate</div><div class="diff-added">+/// a list of strings. This isn't called "StringList" because I find that</div><div class="diff-added">+/// sometimes leads to confusion that it _accepts_ a list such as</div><div class="diff-added">+/// comma-separated values.</div><div class="diff-added">+pub const RepeatableString = struct {</div><div class="diff-added">+    const Self = @This();</div><div class="diff-added">+</div><div class="diff-added">+    // Allocator for the list is the arena for the parent config.</div><div class="diff-added">+    list: std.ArrayListUnmanaged([]const u8) = .{},</div><div class="diff-added">+</div><div class="diff-added">+    pub fn parseCLI(self: *Self, alloc: Allocator, input: ?[]const u8) !void {</div><div class="diff-added">+        const value = input orelse return error.ValueRequired;</div><div class="diff-added">+        const copy = try alloc.dupe(u8, value);</div><div class="diff-added">+        try self.list.append(alloc, copy);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Deep copy of the struct. Required by Config.</div><div class="diff-added">+    pub fn clone(self: *const Self, alloc: Allocator) !Self {</div><div class="diff-added">+        return .{</div><div class="diff-added">+            .list = try self.list.clone(alloc),</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Compare if two of our value are equal. Required by Config.</div><div class="diff-added">+    pub fn equal(self: Self, other: Self) bool {</div><div class="diff-added">+        const itemsA = self.list.items;</div><div class="diff-added">+        const itemsB = other.list.items;</div><div class="diff-added">+        if (itemsA.len != itemsB.len) return false;</div><div class="diff-added">+        for (itemsA, itemsB) |a, b| {</div><div class="diff-added">+            if (!std.mem.eql(u8, a, b)) return false;</div><div class="diff-added">+        } else return true;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test "parseCLI" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+        var arena = ArenaAllocator.init(testing.allocator);</div><div class="diff-added">+        defer arena.deinit();</div><div class="diff-added">+        const alloc = arena.allocator();</div><div class="diff-added">+</div><div class="diff-added">+        var list: Self = .{};</div><div class="diff-added">+        try list.parseCLI(alloc, "A");</div><div class="diff-added">+        try list.parseCLI(alloc, "B");</div><div class="diff-added">+</div><div class="diff-added">+        try testing.expectEqual(@as(usize, 2), list.list.items.len);</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// FontVariation is a repeatable configuration value that sets a single</div><div class="diff-added">+/// font variation value. Font variations are configurations for what</div><div class="diff-added">+/// are often called "variable fonts." The font files usually end in</div><div class="diff-added">+/// "-VF.ttf."</div><div class="diff-added">+///</div><div class="diff-added">+/// The value for this is in the format of `id=value` where `id` is the</div><div class="diff-added">+/// 4-character font variation axis identifier and `value` is the</div><div class="diff-added">+/// floating point value for that axis. For more details on font variations</div><div class="diff-added">+/// see the MDN font-variation-settings documentation since this copies that</div><div class="diff-added">+/// behavior almost exactly:</div><div class="diff-added">+///</div><div class="diff-added">+/// https://developer.mozilla.org/en-US/docs/Web/ghostty_src_config.zig_extracted.txt (actual): std.ArrayListUnmanaged(fontpkg.face.Variation) = .{},</div><div class="diff-added">+</div><div class="diff-added">+    pub fn parseCLI(self: *Self, alloc: Allocator, input_: ?[]const u8) !void {</div><div class="diff-added">+        const input = input_ orelse return error.ValueRequired;</div><div class="diff-added">+        const eql_idx = std.mem.indexOf(u8, input, "=") orelse return error.InvalidFormat;</div><div class="diff-added">+        const whitespace = " \t";</div><div class="diff-added">+        const key = std.mem.trim(u8, input[0..eql_idx], whitespace);</div><div class="diff-added">+        const value = std.mem.trim(u8, input[eql_idx + 1 ..], whitespace);</div><div class="diff-added">+        if (key.len != 4) return error.InvalidFormat;</div><div class="diff-added">+        try self.list.append(alloc, .{</div><div class="diff-added">+            .id = fontpkg.face.Variation.Id.init(@ptrCast(key.ptr)),</div><div class="diff-added">+            .value = std.fmt.parseFloat(f64, value) catch return error.InvalidFormat,</div><div class="diff-added">+        });</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Deep copy of the struct. Required by Config.</div><div class="diff-added">+    pub fn clone(self: *const Self, alloc: Allocator) !Self {</div><div class="diff-added">+        return .{</div><div class="diff-added">+            .list = try self.list.clone(alloc),</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Compare if two of our value are equal. Required by Config.</div><div class="diff-added">+    pub fn equal(self: Self, other: Self) bool {</div><div class="diff-added">+        const itemsA = self.list.items;</div><div class="diff-added">+        const itemsB = other.list.items;</div><div class="diff-added">+        if (itemsA.len != itemsB.len) return false;</div><div class="diff-added">+        for (itemsA, itemsB) |a, b| {</div><div class="diff-added">+            if (!std.meta.eql(a, b)) return false;</div><div class="diff-added">+        } else return true;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test "parseCLI" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+        var arena = ArenaAllocator.init(testing.allocator);</div><div class="diff-added">+        defer arena.deinit();</div><div class="diff-added">+        const alloc = arena.allocator();</div><div class="diff-added">+</div><div class="diff-added">+        var list: Self = .{};</div><div class="diff-added">+        try list.parseCLI(alloc, "wght=200");</div><div class="diff-added">+        try list.parseCLI(alloc, "slnt=-15");</div><div class="diff-added">+</div><div class="diff-added">+        try testing.expectEqual(@as(usize, 2), list.list.items.len);</div><div class="diff-added">+        try testing.expectEqual(fontpkg.face.Variation{</div><div class="diff-added">+            .id = fontpkg.face.Variation.Id.init("wght"),</div><div class="diff-added">+            .value = 200,</div><div class="diff-added">+        }, list.list.items[0]);</div><div class="diff-added">+        try testing.expectEqual(fontpkg.face.Variation{</div><div class="diff-added">+            .id = fontpkg.face.Variation.Id.init("slnt"),</div><div class="diff-added">+            .value = -15,</div><div class="diff-added">+        }, list.list.items[1]);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test "parseCLI with whitespace" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+        var arena = ArenaAllocator.init(testing.allocator);</div><div class="diff-added">+        defer arena.deinit();</div><div class="diff-added">+        const alloc = arena.allocator();</div><div class="diff-added">+</div><div class="diff-added">+        var list: Self = .{};</div><div class="diff-added">+        try list.parseCLI(alloc, "wght =200");</div><div class="diff-added">+        try list.parseCLI(alloc, "slnt= -15");</div><div class="diff-added">+</div><div class="diff-added">+        try testing.expectEqual(@as(usize, 2), list.list.items.len);</div><div class="diff-added">+        try testing.expectEqual(fontpkg.face.Variation{</div><div class="diff-added">+            .id = fontpkg.face.Variation.Id.init("wght"),</div><div class="diff-added">+            .value = 200,</div><div class="diff-added">+        }, list.list.items[0]);</div><div class="diff-added">+        try testing.expectEqual(fontpkg.face.Variation{</div><div class="diff-added">+            .id = fontpkg.face.Variation.Id.init("slnt"),</div><div class="diff-added">+            .value = -15,</div><div class="diff-added">+        }, list.list.items[1]);</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// Stores a set of keybinds.</div><div class="diff-added">+pub const Keybinds = struct {</div><div class="diff-added">+    set: inputpkg.Binding.Set = .{},</div><div class="diff-added">+</div><div class="diff-added">+    pub fn parseCLI(self: *Keybinds, alloc: Allocator, input: ?[]const u8) !void {</div><div class="diff-added">+        var copy: ?[]u8 = null;</div><div class="diff-added">+        var value = value: {</div><div class="diff-added">+            const value = input orelse return error.ValueRequired;</div><div class="diff-added">+</div><div class="diff-added">+            // If we don't have a colon, use the value as-is, no copy</div><div class="diff-added">+            if (std.mem.indexOf(u8, value, ":") == null)</div><div class="diff-added">+                break :value value;</div><div class="diff-added">+</div><div class="diff-added">+            // If we have a colon, we copy the whole value for now. We could</div><div class="diff-added">+            // do this more efficiently later if we wanted to.</div><div class="diff-added">+            const buf = try alloc.alloc(u8, value.len);</div><div class="diff-added">+            copy = buf;</div><div class="diff-added">+</div><div class="diff-added">+            std.mem.copy(u8, buf, value);</div><div class="diff-added">+            break :value buf;</div><div class="diff-added">+        };</div><div class="diff-added">+        errdefer if (copy) |v| alloc.free(v);</div><div class="diff-added">+</div><div class="diff-added">+        const binding = try inputpkg.Binding.parse(value);</div><div class="diff-added">+        switch (binding.action) {</div><div class="diff-added">+            .unbind => self.set.remove(binding.trigger),</div><div class="diff-added">+            else => try self.set.put(alloc, binding.trigger, binding.action),</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Deep copy of the struct. Required by Config.</div><div class="diff-added">+    pub fn clone(self: *const Keybinds, alloc: Allocator) !Keybinds {</div><div class="diff-added">+        return .{</div><div class="diff-added">+            .set = .{</div><div class="diff-added">+                .bindings = try self.set.bindings.clone(alloc),</div><div class="diff-added">+            },</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Compare if two of our value are equal. Required by Config.</div><div class="diff-added">+    pub fn equal(self: Keybinds, other: Keybinds) bool {</div><div class="diff-added">+        const self_map = self.set.bindings;</div><div class="diff-added">+        const other_map = other.set.bindings;</div><div class="diff-added">+        if (self_map.count() != other_map.count()) return false;</div><div class="diff-added">+</div><div class="diff-added">+        var it = self_map.iterator();</div><div class="diff-added">+        while (it.next()) |self_entry| {</div><div class="diff-added">+            const other_entry = other_map.getEntry(self_entry.key_ptr.*) orelse</div><div class="diff-added">+                return false;</div><div class="diff-added">+            if (!equal(</div><div class="diff-added">+                inputpkg.Binding.Action,</div><div class="diff-added">+                self_entry.value_ptr.*,</div><div class="diff-added">+                other_entry.value_ptr.*,</div><div class="diff-added">+            )) return false;</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        return true;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    test "parseCLI" {</div><div class="diff-added">+        const testing = std.testing;</div><div class="diff-added">+        var arena = ArenaAllocator.init(testing.allocator);</div><div class="diff-added">+        defer arena.deinit();</div><div class="diff-added">+        const alloc = arena.allocator();</div><div class="diff-added">+</div><div class="diff-added">+        var set: Keybinds = .{};</div><div class="diff-added">+        try set.parseCLI(alloc, "shift+a=copy_to_clipboard");</div><div class="diff-added">+        try set.parseCLI(alloc, "shift+a=csi:hello");</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// Options for copy on select behavior.</div><div class="diff-added">+pub const CopyOnSelect = enum {</div><div class="diff-added">+    /// Disables copy on select entirely.</div><div class="diff-added">+    false,</div><div class="diff-added">+</div><div class="diff-added">+    /// Copy on select is enabled, but goes to the selection clipboard.</div><div class="diff-added">+    /// This is not supported on platforms such as macOS. This is the default.</div><div class="diff-added">+    true,</div><div class="diff-added">+</div><div class="diff-added">+    /// Copy on select is enabled and goes to the system clipboard.</div><div class="diff-added">+    clipboard,</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+/// Shell integration values</div><div class="diff-added">+pub const ShellIntegration = enum {</div><div class="diff-added">+    none,</div><div class="diff-added">+    detect,</div><div class="diff-added">+    fish,</div><div class="diff-added">+    zsh,</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+// Wasm API.</div><div class="diff-added">+pub const Wasm = if (!builtin.target.cpu.arch.isWasm()) struct {} else struct {</div><div class="diff-added">+    const wasm = @import("os/wasm.zig");</div><div class="diff-added">+    const alloc = wasm.alloc;</div><div class="diff-added">+</div><div class="diff-added">+    /// Create a new configuration filled with the initial default values.</div><div class="diff-added">+    export fn config_new() ?*Config {</div><div class="diff-added">+        const result = alloc.create(Config) catch |err| {</div><div class="diff-added">+            log.err("error allocating config err={}", .{err});</div><div class="diff-added">+            return null;</div><div class="diff-added">+        };</div><div class="diff-added">+</div><div class="diff-added">+        result.* = Config.default(alloc) catch |err| {</div><div class="diff-added">+            log.err("error creating config err={}", .{err});</div><div class="diff-added">+            return null;</div><div class="diff-added">+        };</div><div class="diff-added">+</div><div class="diff-added">+        return result;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    export fn config_free(ptr: ?*Config) void {</div><div class="diff-added">+        if (ptr) |v| {</div><div class="diff-added">+            v.deinit();</div><div class="diff-added">+            alloc.destroy(v);</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load the configuration from a string in the same format as</div><div class="diff-added">+    /// the file-based syntax for the desktop version of the terminal.</div><div class="diff-added">+    export fn config_load_string(</div><div class="diff-added">+        self: *Config,</div><div class="diff-added">+        str: [*]const u8,</div><div class="diff-added">+        len: usize,</div><div class="diff-added">+    ) void {</div><div class="diff-added">+        config_load_string_(self, str[0..len]) catch |err| {</div><div class="diff-added">+            log.err("error loading config err={}", .{err});</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    fn config_load_string_(self: *Config, str: []const u8) !void {</div><div class="diff-added">+        var fbs = std.io.fixedBufferStream(str);</div><div class="diff-added">+        var iter = cli_args.lineIterator(fbs.reader());</div><div class="diff-added">+        try cli_args.parse(Config, alloc, self, &iter);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    export fn config_finalize(self: *Config) void {</div><div class="diff-added">+        self.finalize() catch |err| {</div><div class="diff-added">+            log.err("error finalizing config err={}", .{err});</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+// C API.</div><div class="diff-added">+pub const CAPI = struct {</div><div class="diff-added">+    const global = &@import("main.zig").state;</div><div class="diff-added">+</div><div class="diff-added">+    /// Create a new configuration filled with the initial default values.</div><div class="diff-added">+    export fn ghostty_config_new() ?*Config {</div><div class="diff-added">+        const result = global.alloc.create(Config) catch |err| {</div><div class="diff-added">+            log.err("error allocating config err={}", .{err});</div><div class="diff-added">+            return null;</div><div class="diff-added">+        };</div><div class="diff-added">+</div><div class="diff-added">+        result.* = Config.default(global.alloc) catch |err| {</div><div class="diff-added">+            log.err("error creating config err={}", .{err});</div><div class="diff-added">+            return null;</div><div class="diff-added">+        };</div><div class="diff-added">+</div><div class="diff-added">+        return result;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    export fn ghostty_config_free(ptr: ?*Config) void {</div><div class="diff-added">+        if (ptr) |v| {</div><div class="diff-added">+            v.deinit();</div><div class="diff-added">+            global.alloc.destroy(v);</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load the configuration from the CLI args.</div><div class="diff-added">+    export fn ghostty_config_load_cli_args(self: *Config) void {</div><div class="diff-added">+        self.loadCliArgs(global.alloc) catch |err| {</div><div class="diff-added">+            log.err("error loading config err={}", .{err});</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load the configuration from a string in the same format as</div><div class="diff-added">+    /// the file-based syntax for the desktop version of the terminal.</div><div class="diff-added">+    export fn ghostty_config_load_string(</div><div class="diff-added">+        self: *Config,</div><div class="diff-added">+        str: [*]const u8,</div><div class="diff-added">+        len: usize,</div><div class="diff-added">+    ) void {</div><div class="diff-added">+        config_load_string_(self, str[0..len]) catch |err| {</div><div class="diff-added">+            log.err("error loading config err={}", .{err});</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    fn config_load_string_(self: *Config, str: []const u8) !void {</div><div class="diff-added">+        var fbs = std.io.fixedBufferStream(str);</div><div class="diff-added">+        var iter = cli_args.lineIterator(fbs.reader());</div><div class="diff-added">+        try cli_args.parse(Config, global.alloc, self, &iter);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load the configuration from the default file locations. This</div><div class="diff-added">+    /// is usually done first. The default file locations are locations</div><div class="diff-added">+    /// such as the home directory.</div><div class="diff-added">+    export fn ghostty_config_load_default_files(self: *Config) void {</div><div class="diff-added">+        self.loadDefaultFiles(global.alloc) catch |err| {</div><div class="diff-added">+            log.err("error loading config err={}", .{err});</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Load the configuration from the user-specified configuration</div><div class="diff-added">+    /// file locations in the previously loaded configuration. This will</div><div class="diff-added">+    /// recursively continue to load up to a built-in limit.</div><div class="diff-added">+    export fn ghostty_config_load_recursive_files(self: *Config) void {</div><div class="diff-added">+        self.loadRecursiveFiles(global.alloc) catch |err| {</div><div class="diff-added">+            log.err("error loading config err={}", .{err});</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    export fn ghostty_config_finalize(self: *Config) void {</div><div class="diff-added">+        self.finalize() catch |err| {</div><div class="diff-added">+            log.err("error finalizing config err={}", .{err});</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    export fn ghostty_config_trigger(</div><div class="diff-added">+        self: *Config,</div><div class="diff-added">+        str: [*]const u8,</div><div class="diff-added">+        len: usize,</div><div class="diff-added">+    ) inputpkg.Binding.Trigger {</div><div class="diff-added">+        return config_trigger_(self, str[0..len]) catch |err| err: {</div><div class="diff-added">+            log.err("error finding trigger err={}", .{err});</div><div class="diff-added">+            break :err .{};</div><div class="diff-added">+        };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    fn config_trigger_(</div><div class="diff-added">+        self: *Config,</div><div class="diff-added">+        str: []const u8,</div><div class="diff-added">+    ) !inputpkg.Binding.Trigger {</div><div class="diff-added">+        const action = try inputpkg.Binding.Action.parse(str);</div><div class="diff-added">+        return self.keybind.set.getTrigger(action) orelse .{};</div><div class="diff-added">+    }</div><div class="diff-added">+};</div><div class="diff-added">+</div><div class="diff-added">+test {</div><div class="diff-added">+    std.testing.refAllDecls(@This());</div><div> }</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    