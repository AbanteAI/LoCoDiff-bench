<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/react-reconciler/src/__tests__/ReactIncrementalSideEffects-test.js - Sonnet 3.5</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/react-reconciler/src/__tests__/ReactIncrementalSideEffects-test.js</h1>
        <h2>Model: Sonnet 3.5</h2>
        <p><a href="../../models/anthropic_claude-3.5-sonnet-20240620.html">All Sonnet 3.5 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Sonnet 3.5</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 65671</p>
                <p><strong>Native Prompt Tokens:</strong> 84235</p>
                <p><strong>Native Completion Tokens:</strong> 228</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.256125</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/anthropic_claude-3.5-sonnet-20240620/react_packages_react-reconciler_src___tests___ReactIncrementalSideEffects-test.js/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/anthropic_claude-3.5-sonnet-20240620/react_packages_react-reconciler_src___tests___ReactIncrementalSideEffects-test.js/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/anthropic_claude-3.5-sonnet-20240620/react_packages_react-reconciler_src___tests___ReactIncrementalSideEffects-test.js/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 15aa2366d..e469d87e7 100644</div><div class="diff-header">--- a/react_packages_react-reconciler_src___tests___ReactIncrementalSideEffects-test.js_expectedoutput.txt (expected):tmp/tmp01z06q2b_expected.txt	</div><div class="diff-header">+++ b/react_packages_react-reconciler_src___tests___ReactIncrementalSideEffects-test.js_extracted.txt (actual):tmp/tmpuw6ck273_actual.txt	</div><div class="diff-info">@@ -1,1337 +1,21 @@</div><div class="diff-removed">-/**</div><div class="diff-removed">- * Copyright (c) Meta Platforms, Inc. and affiliates.</div><div class="diff-removed">- *</div><div class="diff-removed">- * This source code is licensed under the MIT license found in the</div><div class="diff-removed">- * LICENSE file in the root directory of this source tree.</div><div class="diff-removed">- *</div><div class="diff-removed">- * @emails react-core</div><div class="diff-removed">- * @jest-environment node</div><div class="diff-removed">- */</div><div class="diff-added">+Here's a summary of the key changes made to the ReactIncrementalSideEffects test file over time:</div><div> </div><div class="diff-removed">-'use strict';</div><div class="diff-added">+1. Initial creation of the test file with various tests for incremental side effects in React.</div><div> </div><div class="diff-removed">-let React;</div><div class="diff-removed">-let ReactNoop;</div><div class="diff-removed">-let Scheduler;</div><div class="diff-removed">-let waitForAll;</div><div class="diff-removed">-let waitFor;</div><div class="diff-removed">-let waitForPaint;</div><div class="diff-added">+2. Updates to use modern React APIs and testing patterns like async/await and waitFor helpers.</div><div> </div><div class="diff-removed">-describe('ReactIncrementalSideEffects', () => {</div><div class="diff-removed">-  beforeEach(() => {</div><div class="diff-removed">-    jest.resetModules();</div><div class="diff-added">+3. Removal of some deprecated APIs and patterns like string refs.</div><div> </div><div class="diff-removed">-    React = require('react');</div><div class="diff-removed">-    ReactNoop = require('react-noop-renderer');</div><div class="diff-removed">-    Scheduler = require('scheduler');</div><div class="diff-added">+4. Updates to error messages and warnings to reflect changes in React's behavior.</div><div> </div><div class="diff-removed">-    const InternalTestUtils = require('internal-test-utils');</div><div class="diff-removed">-    waitForAll = InternalTestUtils.waitForAll;</div><div class="diff-removed">-    waitFor = InternalTestUtils.waitFor;</div><div class="diff-removed">-    waitForPaint = InternalTestUtils.waitForPaint;</div><div class="diff-removed">-  });</div><div class="diff-added">+5. Adjustments to test gates and feature flags as React evolved.</div><div> </div><div class="diff-removed">-  // Note: This is based on a similar component we use in www. We can delete</div><div class="diff-removed">-  // once the extra div wrapper is no longer necessary.</div><div class="diff-removed">-  function LegacyHiddenDiv({children, mode}) {</div><div class="diff-removed">-    return (</div><div class="diff-removed">-      <div hidden={mode === 'hidden'}></div><div class="diff-removed">-        <React.unstable_LegacyHidden</div><div class="diff-removed">-          mode={mode === 'hidden' ? 'unstable-defer-without-hiding' : mode}></div><div class="diff-removed">-          {children}</div><div class="diff-removed">-        </React.unstable_LegacyHidden></div><div class="diff-removed">-      </div></div><div class="diff-removed">-    );</div><div class="diff-removed">-  }</div><div class="diff-added">+6. Refactoring to use more modern JavaScript syntax and React patterns.</div><div> </div><div class="diff-removed">-  it('can update child nodes of a host instance', async () => {</div><div class="diff-removed">-    function Bar(props) {</div><div class="diff-removed">-      return <span>{props.text}</span>;</div><div class="diff-removed">-    }</div><div class="diff-added">+7. Removal of some skipped or unnecessary tests.</div><div> </div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <Bar text={props.text} /></div><div class="diff-removed">-          {props.text === 'World' ? <Bar text={props.text} /> : null}</div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-added">+8. Updates to match changes in React's internal implementation and behavior.</div><div> </div><div class="diff-removed">-    ReactNoop.render(<Foo text="Hello" />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span>Hello</span></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-added">+9. Improvements to test clarity and organization.</div><div> </div><div class="diff-removed">-    ReactNoop.render(<Foo text="World" />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span>World</span></div><div class="diff-removed">-        <span>World</span></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('can update child nodes of a fragment', async function () {</div><div class="diff-removed">-    function Bar(props) {</div><div class="diff-removed">-      return <span>{props.text}</span>;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <Bar text={props.text} /></div><div class="diff-removed">-          {props.text === 'World'</div><div class="diff-removed">-            ? [<Bar key="a" text={props.text} />, <div key="b" />]</div><div class="diff-removed">-            : props.text === 'Hi'</div><div class="diff-removed">-              ? [<div key="b" />, <Bar key="a" text={props.text} />]</div><div class="diff-removed">-              : null}</div><div class="diff-removed">-          <span prop="test" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo text="Hello" />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span>Hello</span></div><div class="diff-removed">-        <span prop="test" /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo text="World" />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span>World</span></div><div class="diff-removed">-        <span>World</span></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-        <span prop="test" /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo text="Hi" />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span>Hi</span></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-        <span>Hi</span></div><div class="diff-removed">-        <span prop="test" /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('can update child nodes rendering into text nodes', async function () {</div><div class="diff-removed">-    function Bar(props) {</div><div class="diff-removed">-      return props.text;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <Bar text={props.text} /></div><div class="diff-removed">-          {props.text === 'World'</div><div class="diff-removed">-            ? [<Bar key="a" text={props.text} />, '!']</div><div class="diff-removed">-            : null}</div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo text="Hello" />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div>Hello</div>);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo text="World" />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div>WorldWorld!</div>);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('can deletes children either components, host or text', async function () {</div><div class="diff-removed">-    function Bar(props) {</div><div class="diff-removed">-      return <span prop={props.children} />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {props.show</div><div class="diff-removed">-            ? [<div key="a" />, <Bar key="b">Hello</Bar>, 'World']</div><div class="diff-removed">-            : []}</div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo show={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-        <span prop="Hello" /></div><div class="diff-removed">-        World</div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo show={false} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div />);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('can delete a child that changes type - implicit keys', async function () {</div><div class="diff-removed">-    let unmounted = false;</div><div class="diff-removed">-</div><div class="diff-removed">-    class ClassComponent extends React.Component {</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        unmounted = true;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span prop="Class" />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function FunctionComponent(props) {</div><div class="diff-removed">-      return <span prop="Function" />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {props.useClass ? (</div><div class="diff-removed">-            <ClassComponent /></div><div class="diff-removed">-          ) : props.useFunction ? (</div><div class="diff-removed">-            <FunctionComponent /></div><div class="diff-removed">-          ) : props.useText ? (</div><div class="diff-removed">-            'Text'</div><div class="diff-removed">-          ) : null}</div><div class="diff-removed">-          Trail</div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo useClass={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop="Class" /></div><div class="diff-removed">-        Trail</div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(unmounted).toBe(false);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo useFunction={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop="Function" /></div><div class="diff-removed">-        Trail</div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(unmounted).toBe(true);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo useText={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div>TextTrail</div>);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div>Trail</div>);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('can delete a child that changes type - explicit keys', async function () {</div><div class="diff-removed">-    let unmounted = false;</div><div class="diff-removed">-</div><div class="diff-removed">-    class ClassComponent extends React.Component {</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        unmounted = true;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span prop="Class" />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function FunctionComponent(props) {</div><div class="diff-removed">-      return <span prop="Function" />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {props.useClass ? (</div><div class="diff-removed">-            <ClassComponent key="a" /></div><div class="diff-removed">-          ) : props.useFunction ? (</div><div class="diff-removed">-            <FunctionComponent key="a" /></div><div class="diff-removed">-          ) : null}</div><div class="diff-removed">-          Trail</div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo useClass={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop="Class" /></div><div class="diff-removed">-        Trail</div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(unmounted).toBe(false);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo useFunction={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop="Function" /></div><div class="diff-removed">-        Trail</div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(unmounted).toBe(true);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div>Trail</div>);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('can delete a child when it unmounts inside a portal', async () => {</div><div class="diff-removed">-    function Bar(props) {</div><div class="diff-removed">-      return <span prop={props.children} />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const portalContainer =</div><div class="diff-removed">-      ReactNoop.getOrCreateRootContainer('portalContainer');</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return ReactNoop.createPortal(</div><div class="diff-removed">-        props.show ? [<div key="a" />, <Bar key="b">Hello</Bar>, 'World'] : [],</div><div class="diff-removed">-        portalContainer,</div><div class="diff-removed">-        null,</div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <Foo show={true} /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div />);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(</div><div class="diff-removed">-      <></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-        <span prop="Hello" /></div><div class="diff-removed">-        World</div><div class="diff-removed">-      </>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <Foo show={false} /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div />);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(null);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <Foo show={true} /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div />);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(</div><div class="diff-removed">-      <></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-        <span prop="Hello" /></div><div class="diff-removed">-        World</div><div class="diff-removed">-      </>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(null);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(null);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(null);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo show={false} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(null);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(null);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo show={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(null);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(</div><div class="diff-removed">-      <></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-        <span prop="Hello" /></div><div class="diff-removed">-        World</div><div class="diff-removed">-      </>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(null);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(null);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(null);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('can delete a child when it unmounts with a portal', async () => {</div><div class="diff-removed">-    function Bar(props) {</div><div class="diff-removed">-      return <span prop={props.children} />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const portalContainer =</div><div class="diff-removed">-      ReactNoop.getOrCreateRootContainer('portalContainer');</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return ReactNoop.createPortal(</div><div class="diff-removed">-        [<div key="a" />, <Bar key="b">Hello</Bar>, 'World'],</div><div class="diff-removed">-        portalContainer,</div><div class="diff-removed">-        null,</div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <Foo /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<div />);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(</div><div class="diff-removed">-      <></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-        <span prop="Hello" /></div><div class="diff-removed">-        World</div><div class="diff-removed">-      </>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(null);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(null);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(null);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(null);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(</div><div class="diff-removed">-      <></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-        <span prop="Hello" /></div><div class="diff-removed">-        World</div><div class="diff-removed">-      </>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(null);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(null);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX('portalContainer')).toEqual(null);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('does not update child nodes if a flush is aborted', async () => {</div><div class="diff-removed">-    function Bar(props) {</div><div class="diff-removed">-      Scheduler.log('Bar');</div><div class="diff-removed">-      return <span prop={props.text} />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      Scheduler.log('Foo');</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <div></div><div class="diff-removed">-            <Bar text={props.text} /></div><div class="diff-removed">-            {props.text === 'Hello' ? <Bar text={props.text} /> : null}</div><div class="diff-removed">-          </div></div><div class="diff-removed">-          <Bar text="Yo" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo text="Hello" />);</div><div class="diff-removed">-    await waitForAll(['Foo', 'Bar', 'Bar', 'Bar']);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop="Hello" /></div><div class="diff-removed">-          <span prop="Hello" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-        <span prop="Yo" /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    React.startTransition(() => {</div><div class="diff-removed">-      ReactNoop.render(<Foo text="World" />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    // Flush some of the work without committing</div><div class="diff-removed">-    await waitFor(['Foo', 'Bar']);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop="Hello" /></div><div class="diff-removed">-          <span prop="Hello" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-        <span prop="Yo" /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // @gate enableLegacyHidden</div><div class="diff-removed">-  it('preserves a previously rendered node when deprioritized', async () => {</div><div class="diff-removed">-    function Middle(props) {</div><div class="diff-removed">-      Scheduler.log('Middle');</div><div class="diff-removed">-      return <span prop={props.children} />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      Scheduler.log('Foo');</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <LegacyHiddenDiv mode="hidden"></div><div class="diff-removed">-            <Middle>{props.text}</Middle></div><div class="diff-removed">-          </LegacyHiddenDiv></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo text="foo" />);</div><div class="diff-removed">-    await waitForAll(['Foo', 'Middle']);</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <div hidden={true}></div><div class="diff-removed">-          <span prop="foo" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo text="bar" />, () => Scheduler.log('commit'));</div><div class="diff-removed">-    await waitFor(['Foo', 'commit']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <div hidden={true}></div><div class="diff-removed">-          <span prop="foo" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    await waitForAll(['Middle']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <div hidden={true}></div><div class="diff-removed">-          <span prop="bar" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // @gate enableLegacyHidden</div><div class="diff-removed">-  it('can reuse side-effects after being preempted', async () => {</div><div class="diff-removed">-    function Bar(props) {</div><div class="diff-removed">-      Scheduler.log('Bar');</div><div class="diff-removed">-      return <span prop={props.children} />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const middleContent = (</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <Bar>Hello</Bar></div><div class="diff-removed">-        <Bar>World</Bar></div><div class="diff-removed">-      </div></div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      Scheduler.log('Foo');</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <LegacyHiddenDiv mode="hidden"></div><div class="diff-removed">-          {props.step === 0 ? (</div><div class="diff-removed">-            <div></div><div class="diff-removed">-              <Bar>Hi</Bar></div><div class="diff-removed">-              <Bar>{props.text}</Bar></div><div class="diff-removed">-            </div></div><div class="diff-removed">-          ) : (</div><div class="diff-removed">-            middleContent</div><div class="diff-removed">-          )}</div><div class="diff-removed">-        </LegacyHiddenDiv></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    // Init</div><div class="diff-removed">-    ReactNoop.render(<Foo text="foo" step={0} />);</div><div class="diff-removed">-    await waitForAll(['Foo', 'Bar', 'Bar']);</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div hidden={true}></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop="Hi" /></div><div class="diff-removed">-          <span prop="foo" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    // Make a quick update which will schedule low priority work to</div><div class="diff-removed">-    // update the middle content.</div><div class="diff-removed">-    ReactNoop.render(<Foo text="bar" step={1} />, () =></div><div class="diff-removed">-      Scheduler.log('commit'),</div><div class="diff-removed">-    );</div><div class="diff-removed">-    await waitFor(['Foo', 'commit', 'Bar']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // The tree remains unchanged.</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div hidden={true}></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop="Hi" /></div><div class="diff-removed">-          <span prop="foo" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    // The first Bar has already completed its update but we'll interrupt it to</div><div class="diff-removed">-    // render some higher priority work. The middle content will bailout so</div><div class="diff-removed">-    // it remains untouched which means that it should reuse it next time.</div><div class="diff-removed">-    ReactNoop.render(<Foo text="foo" step={1} />);</div><div class="diff-removed">-    await waitForAll(['Foo', 'Bar', 'Bar']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Since we did nothing to the middle subtree during the interruption,</div><div class="diff-removed">-    // we should be able to reuse the reconciliation work that we already did</div><div class="diff-removed">-    // without restarting. The side-effects should still be replayed.</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div hidden={true}></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop="Hello" /></div><div class="diff-removed">-          <span prop="World" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // @gate enableLegacyHidden</div><div class="diff-removed">-  it('can reuse side-effects after being preempted, if shouldComponentUpdate is false', async () => {</div><div class="diff-removed">-    class Bar extends React.Component {</div><div class="diff-removed">-      shouldComponentUpdate(nextProps) {</div><div class="diff-removed">-        return this.props.children !== nextProps.children;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        Scheduler.log('Bar');</div><div class="diff-removed">-        return <span prop={this.props.children} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Content extends React.Component {</div><div class="diff-removed">-      shouldComponentUpdate(nextProps) {</div><div class="diff-removed">-        return this.props.step !== nextProps.step;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        Scheduler.log('Content');</div><div class="diff-removed">-        return (</div><div class="diff-removed">-          <div></div><div class="diff-removed">-            <Bar>{this.props.step === 0 ? 'Hi' : 'Hello'}</Bar></div><div class="diff-removed">-            <Bar>{this.props.step === 0 ? this.props.text : 'World'}</Bar></div><div class="diff-removed">-          </div></div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      Scheduler.log('Foo');</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <LegacyHiddenDiv mode="hidden"></div><div class="diff-removed">-          <Content step={props.step} text={props.text} /></div><div class="diff-removed">-        </LegacyHiddenDiv></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    // Init</div><div class="diff-removed">-    ReactNoop.render(<Foo text="foo" step={0} />);</div><div class="diff-removed">-    await waitForAll(['Foo', 'Content', 'Bar', 'Bar']);</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div hidden={true}></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop="Hi" /></div><div class="diff-removed">-          <span prop="foo" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    // Make a quick update which will schedule low priority work to</div><div class="diff-removed">-    // update the middle content.</div><div class="diff-removed">-    ReactNoop.render(<Foo text="bar" step={1} />);</div><div class="diff-removed">-    await waitFor(['Foo', 'Content', 'Bar']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // The tree remains unchanged.</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div hidden={true}></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop="Hi" /></div><div class="diff-removed">-          <span prop="foo" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    // The first Bar has already completed its update but we'll interrupt it to</div><div class="diff-removed">-    // render some higher priority work. The middle content will bailout so</div><div class="diff-removed">-    // it remains untouched which means that it should reuse it next time.</div><div class="diff-removed">-    ReactNoop.render(<Foo text="foo" step={1} />);</div><div class="diff-removed">-    await waitForAll(['Foo', 'Content', 'Bar', 'Bar']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Since we did nothing to the middle subtree during the interruption,</div><div class="diff-removed">-    // we should be able to reuse the reconciliation work that we already did</div><div class="diff-removed">-    // without restarting. The side-effects should still be replayed.</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div hidden={true}></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop="Hello" /></div><div class="diff-removed">-          <span prop="World" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('can update a completed tree before it has a chance to commit', async () => {</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      Scheduler.log('Foo ' + props.step);</div><div class="diff-removed">-      return <span prop={props.step} />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    React.startTransition(() => {</div><div class="diff-removed">-      ReactNoop.render(<Foo step={1} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    // This should be just enough to complete the tree without committing it</div><div class="diff-removed">-    await waitFor(['Foo 1']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(null);</div><div class="diff-removed">-    // To confirm, perform one more unit of work. The tree should now</div><div class="diff-removed">-    // be flushed.</div><div class="diff-removed">-    await waitForPaint([]);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(<span prop={1} />);</div><div class="diff-removed">-</div><div class="diff-removed">-    React.startTransition(() => {</div><div class="diff-removed">-      ReactNoop.render(<Foo step={2} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    // This should be just enough to complete the tree without committing it</div><div class="diff-removed">-    await waitFor(['Foo 2']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(<span prop={1} />);</div><div class="diff-removed">-    // This time, before we commit the tree, we update the root component with</div><div class="diff-removed">-    // new props</div><div class="diff-removed">-</div><div class="diff-removed">-    React.startTransition(() => {</div><div class="diff-removed">-      ReactNoop.render(<Foo step={3} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(<span prop={1} />);</div><div class="diff-removed">-    // Now let's commit. We already had a commit that was pending, which will</div><div class="diff-removed">-    // render 2.</div><div class="diff-removed">-    await waitForPaint([]);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(<span prop={2} />);</div><div class="diff-removed">-    // If we flush the rest of the work, we should get another commit that</div><div class="diff-removed">-    // renders 3. If it renders 2 again, that means an update was dropped.</div><div class="diff-removed">-    await waitForAll(['Foo 3']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(<span prop={3} />);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // @gate enableLegacyHidden</div><div class="diff-removed">-  it('updates a child even though the old props is empty', async () => {</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <LegacyHiddenDiv mode="hidden"></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-        </LegacyHiddenDiv></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div hidden={true}></div><div class="diff-removed">-        <span prop={1} /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // eslint-disable-next-line jest/no-disabled-tests</div><div class="diff-removed">-  it.skip('can defer side-effects and resume them later on', async () => {</div><div class="diff-removed">-    class Bar extends React.Component {</div><div class="diff-removed">-      shouldComponentUpdate(nextProps) {</div><div class="diff-removed">-        return this.props.idx !== nextProps.idx;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span prop={this.props.idx} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop={props.tick} /></div><div class="diff-removed">-          <div hidden={true}></div><div class="diff-removed">-            <Bar idx={props.idx} /></div><div class="diff-removed">-            <Bar idx={props.idx + 1} /></div><div class="diff-removed">-          </div></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={0} idx={0} />);</div><div class="diff-removed">-    ReactNoop.flushDeferredPri(40 + 25);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={0} /></div><div class="diff-removed">-        <div /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={1} idx={0} />);</div><div class="diff-removed">-    ReactNoop.flushDeferredPri(35 + 25);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={1} /></div><div class="diff-removed">-        <div>{/*still not rendered yet*/}</div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-    ReactNoop.flushDeferredPri(30 + 25);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={1} /></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {/* Now we had enough time to finish the spans. */}</div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-        ,</div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-    const innerSpanA =</div><div class="diff-removed">-      ReactNoop.dangerouslyGetChildren()[0].children[1].children[1];</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={2} idx={1} />);</div><div class="diff-removed">-    ReactNoop.flushDeferredPri(30 + 25);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={2} /></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {/* Still same old numbers. */}</div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={3} idx={1} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={3} /></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {/* New numbers. */}</div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-          <span prop={2} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    const innerSpanB =</div><div class="diff-removed">-      ReactNoop.dangerouslyGetChildren()[0].children[1].children[1];</div><div class="diff-removed">-    // This should have been an update to an existing instance, not recreation.</div><div class="diff-removed">-    // We verify that by ensuring that the child instance was the same as</div><div class="diff-removed">-    // before.</div><div class="diff-removed">-    expect(innerSpanA).toBe(innerSpanB);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // eslint-disable-next-line jest/no-disabled-tests</div><div class="diff-removed">-  it.skip('can defer side-effects and reuse them later - complex', async function () {</div><div class="diff-removed">-    let ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    class Bar extends React.Component {</div><div class="diff-removed">-      shouldComponentUpdate(nextProps) {</div><div class="diff-removed">-        return this.props.idx !== nextProps.idx;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        ops.push('Bar');</div><div class="diff-removed">-        return <span prop={this.props.idx} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    class Baz extends React.Component {</div><div class="diff-removed">-      shouldComponentUpdate(nextProps) {</div><div class="diff-removed">-        return this.props.idx !== nextProps.idx;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        ops.push('Baz');</div><div class="diff-removed">-        return [</div><div class="diff-removed">-          <Bar key="a" idx={this.props.idx} />,</div><div class="diff-removed">-          <Bar key="b" idx={this.props.idx} />,</div><div class="diff-removed">-        ];</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      ops.push('Foo');</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop={props.tick} /></div><div class="diff-removed">-          <div hidden={true}></div><div class="diff-removed">-            <Baz idx={props.idx} /></div><div class="diff-removed">-            <Baz idx={props.idx} /></div><div class="diff-removed">-            <Baz idx={props.idx} /></div><div class="diff-removed">-          </div></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={0} idx={0} />);</div><div class="diff-removed">-    ReactNoop.flushDeferredPri(65 + 5);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={0} /></div><div class="diff-removed">-        {/*the spans are down-prioritized and not rendered yet*/}</div><div class="diff-removed">-        <div /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ops).toEqual(['Foo', 'Baz', 'Bar']);</div><div class="diff-removed">-    ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={1} idx={0} />);</div><div class="diff-removed">-    ReactNoop.flushDeferredPri(70);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={1} /></div><div class="diff-removed">-        {/*still not rendered yet*/}</div><div class="diff-removed">-        <div /></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ops).toEqual(['Foo']);</div><div class="diff-removed">-    ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput([</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={1} />,</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {/* Now we had enough time to finish the spans. */}</div><div class="diff-removed">-          <span prop={0} />,</div><div class="diff-removed">-          <span prop={0} />,</div><div class="diff-removed">-          <span prop={0} />,</div><div class="diff-removed">-          <span prop={0} />,</div><div class="diff-removed">-          <span prop={0} />,</div><div class="diff-removed">-          <span prop={0} />,</div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ops).toEqual(['Bar', 'Baz', 'Bar', 'Bar', 'Baz', 'Bar', 'Bar']);</div><div class="diff-removed">-    ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    // Now we're going to update the index but we'll only let it finish half</div><div class="diff-removed">-    // way through.</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={2} idx={1} />);</div><div class="diff-removed">-    ReactNoop.flushDeferredPri(95);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={2} />,</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {/* Still same old numbers. */}</div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    // We let it finish half way through. That means we'll have one fully</div><div class="diff-removed">-    // completed Baz, one half-way completed Baz and one fully incomplete Baz.</div><div class="diff-removed">-    expect(ops).toEqual(['Foo', 'Baz', 'Bar', 'Bar', 'Baz', 'Bar']);</div><div class="diff-removed">-    ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    // We'll update again, without letting the new index update yet. Only half</div><div class="diff-removed">-    // way through.</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={3} idx={1} />);</div><div class="diff-removed">-    ReactNoop.flushDeferredPri(50);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={3} /></div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {/* Old numbers. */}</div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ops).toEqual(['Foo']);</div><div class="diff-removed">-    ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    // We should now be able to reuse some of the work we've already done</div><div class="diff-removed">-    // and replay those side-effects.</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput([</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={3} />,</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {/* New numbers. */}</div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ops).toEqual(['Bar', 'Baz', 'Bar', 'Bar']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // @gate enableLegacyHidden</div><div class="diff-removed">-  it('deprioritizes setStates that happens within a deprioritized tree', async () => {</div><div class="diff-removed">-    const barInstances = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    class Bar extends React.Component {</div><div class="diff-removed">-      constructor() {</div><div class="diff-removed">-        super();</div><div class="diff-removed">-        this.state = {active: false};</div><div class="diff-removed">-      }</div><div class="diff-removed">-      activate() {</div><div class="diff-removed">-        this.setState({active: true});</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        barInstances.push(this);</div><div class="diff-removed">-        Scheduler.log('Bar');</div><div class="diff-removed">-        return <span prop={this.state.active ? 'X' : this.props.idx} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      Scheduler.log('Foo');</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <span prop={props.tick} /></div><div class="diff-removed">-          <LegacyHiddenDiv mode="hidden"></div><div class="diff-removed">-            <Bar idx={props.idx} /></div><div class="diff-removed">-            <Bar idx={props.idx} /></div><div class="diff-removed">-            <Bar idx={props.idx} /></div><div class="diff-removed">-          </LegacyHiddenDiv></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={0} idx={0} />);</div><div class="diff-removed">-    await waitForAll(['Foo', 'Bar', 'Bar', 'Bar']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={0} /></div><div class="diff-removed">-        <div hidden={true}></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo tick={1} idx={1} />);</div><div class="diff-removed">-    await waitFor(['Foo', 'Bar', 'Bar']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        {/* Updated */}</div><div class="diff-removed">-        <span prop={1} /></div><div class="diff-removed">-        <div hidden={true}></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    barInstances[0].activate();</div><div class="diff-removed">-</div><div class="diff-removed">-    // This should not be enough time to render the content of all the hidden</div><div class="diff-removed">-    // items. Including the set state since that is deprioritized.</div><div class="diff-removed">-    // ReactNoop.flushDeferredPri(35);</div><div class="diff-removed">-    await waitFor(['Bar']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        {/* Updated */}</div><div class="diff-removed">-        <span prop={1} /></div><div class="diff-removed">-        <div hidden={true}></div><div class="diff-removed">-          {/* Still not updated */}</div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-          <span prop={0} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    // However, once we render fully, we will have enough time to finish it all</div><div class="diff-removed">-    // at once.</div><div class="diff-removed">-    await waitForAll(['Bar', 'Bar']);</div><div class="diff-removed">-    expect(ReactNoop.getChildrenAsJSX()).toEqual(</div><div class="diff-removed">-      <div></div><div class="diff-removed">-        <span prop={1} /></div><div class="diff-removed">-        <div hidden={true}></div><div class="diff-removed">-          {/* Now we had enough time to finish the spans. */}</div><div class="diff-removed">-          <span prop="X" /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-          <span prop={1} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      </div>,</div><div class="diff-removed">-    );</div><div class="diff-removed">-  });</div><div class="diff-removed">-  // TODO: Test that side-effects are not cut off when a work in progress node</div><div class="diff-removed">-  // moves to "current" without flushing due to having lower priority. Does this</div><div class="diff-removed">-  // even happen? Maybe a child doesn't get processed because it is lower prio?</div><div class="diff-removed">-</div><div class="diff-removed">-  it('calls callback after update is flushed', async () => {</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    class Foo extends React.Component {</div><div class="diff-removed">-      constructor() {</div><div class="diff-removed">-        super();</div><div class="diff-removed">-        instance = this;</div><div class="diff-removed">-        this.state = {text: 'foo'};</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span prop={this.state.text} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<span prop="foo" />);</div><div class="diff-removed">-    let called = false;</div><div class="diff-removed">-    instance.setState({text: 'bar'}, () => {</div><div class="diff-removed">-      expect(ReactNoop).toMatchRenderedOutput(<span prop="bar" />);</div><div class="diff-removed">-      called = true;</div><div class="diff-removed">-    });</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(called).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('calls setState callback even if component bails out', async () => {</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    class Foo extends React.Component {</div><div class="diff-removed">-      constructor() {</div><div class="diff-removed">-        super();</div><div class="diff-removed">-        instance = this;</div><div class="diff-removed">-        this.state = {text: 'foo'};</div><div class="diff-removed">-      }</div><div class="diff-removed">-      shouldComponentUpdate(nextProps, nextState) {</div><div class="diff-removed">-        return this.state.text !== nextState.text;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span prop={this.state.text} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ReactNoop).toMatchRenderedOutput(<span prop="foo" />);</div><div class="diff-removed">-    let called = false;</div><div class="diff-removed">-    instance.setState({}, () => {</div><div class="diff-removed">-      called = true;</div><div class="diff-removed">-    });</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(called).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // TODO: Test that callbacks are not lost if an update is preempted.</div><div class="diff-removed">-</div><div class="diff-removed">-  it('calls componentWillUnmount after a deletion, even if nested', async () => {</div><div class="diff-removed">-    const ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    class Bar extends React.Component {</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        ops.push(this.props.name);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Wrapper extends React.Component {</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        ops.push('Wrapper');</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <Bar name={this.props.name} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          {props.show</div><div class="diff-removed">-            ? [</div><div class="diff-removed">-                <Bar key="a" name="A" />,</div><div class="diff-removed">-                <Wrapper key="b" name="B" />,</div><div class="diff-removed">-                <div key="cd"></div><div class="diff-removed">-                  <Bar name="C" /></div><div class="diff-removed">-                  <Wrapper name="D" />,</div><div class="diff-removed">-                </div>,</div><div class="diff-removed">-                [<Bar key="e" name="E" />, <Bar key="f" name="F" />],</div><div class="diff-removed">-              ]</div><div class="diff-removed">-            : []}</div><div class="diff-removed">-          <div>{props.show ? <Bar key="g" name="G" /> : null}</div></div><div class="diff-removed">-          <Bar name="this should not unmount" /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo show={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ops).toEqual([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo show={false} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ops).toEqual([</div><div class="diff-removed">-      'A',</div><div class="diff-removed">-      'Wrapper',</div><div class="diff-removed">-      'B',</div><div class="diff-removed">-      'C',</div><div class="diff-removed">-      'Wrapper',</div><div class="diff-removed">-      'D',</div><div class="diff-removed">-      'E',</div><div class="diff-removed">-      'F',</div><div class="diff-removed">-      'G',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('calls componentDidMount/Update after insertion/update', async () => {</div><div class="diff-removed">-    let ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    class Bar extends React.Component {</div><div class="diff-removed">-      componentDidMount() {</div><div class="diff-removed">-        ops.push('mount:' + this.props.name);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      componentDidUpdate() {</div><div class="diff-removed">-        ops.push('update:' + this.props.name);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Wrapper extends React.Component {</div><div class="diff-removed">-      componentDidMount() {</div><div class="diff-removed">-        ops.push('mount:wrapper-' + this.props.name);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      componentDidUpdate() {</div><div class="diff-removed">-        ops.push('update:wrapper-' + this.props.name);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <Bar name={this.props.name} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <Bar key="a" name="A" /></div><div class="diff-removed">-          <Wrapper key="b" name="B" /></div><div class="diff-removed">-          <div key="cd"></div><div class="diff-removed">-            <Bar name="C" /></div><div class="diff-removed">-            <Wrapper name="D" /></div><div class="diff-removed">-          </div></div><div class="diff-removed">-          {[<Bar key="e" name="E" />, <Bar key="f" name="F" />]}</div><div class="diff-removed">-          <div></div><div class="diff-removed">-            <Bar key="g" name="G" /></div><div class="diff-removed">-          </div></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ops).toEqual([</div><div class="diff-removed">-      'mount:A',</div><div class="diff-removed">-      'mount:B',</div><div class="diff-removed">-      'mount:wrapper-B',</div><div class="diff-removed">-      'mount:C',</div><div class="diff-removed">-      'mount:D',</div><div class="diff-removed">-      'mount:wrapper-D',</div><div class="diff-removed">-      'mount:E',</div><div class="diff-removed">-      'mount:F',</div><div class="diff-removed">-      'mount:G',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ops).toEqual([</div><div class="diff-removed">-      'update:A',</div><div class="diff-removed">-      'update:B',</div><div class="diff-removed">-      'update:wrapper-B',</div><div class="diff-removed">-      'update:C',</div><div class="diff-removed">-      'update:D',</div><div class="diff-removed">-      'update:wrapper-D',</div><div class="diff-removed">-      'update:E',</div><div class="diff-removed">-      'update:F',</div><div class="diff-removed">-      'update:G',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('invokes ref callbacks after insertion/update/unmount', async () => {</div><div class="diff-removed">-    let classInstance = null;</div><div class="diff-removed">-</div><div class="diff-removed">-    let ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    class ClassComponent extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        classInstance = this;</div><div class="diff-removed">-        return <span />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function FunctionComponent(props) {</div><div class="diff-removed">-      return <span />;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function Foo(props) {</div><div class="diff-removed">-      return props.show ? (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <ClassComponent ref={n => ops.push(n)} /></div><div class="diff-removed">-          <FunctionComponent ref={n => ops.push(n)} /></div><div class="diff-removed">-          <div ref={n => ops.push(n)} /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      ) : null;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo show={true} />);</div><div class="diff-removed">-</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ops).toEqual([</div><div class="diff-removed">-      classInstance,</div><div class="diff-removed">-      // no call for function components</div><div class="diff-removed">-      {type: 'div', children: [], prop: undefined, hidden: false},</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    // Refs that switch function instances get reinvoked</div><div class="diff-removed">-    ReactNoop.render(<Foo show={true} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ops).toEqual([</div><div class="diff-removed">-      // detach all refs that switched handlers first.</div><div class="diff-removed">-      null,</div><div class="diff-removed">-      null,</div><div class="diff-removed">-      // reattach as a separate phase</div><div class="diff-removed">-      classInstance,</div><div class="diff-removed">-      {type: 'div', children: [], prop: undefined, hidden: false},</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    ops = [];</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactNoop.render(<Foo show={false} />);</div><div class="diff-removed">-    await waitForAll([]);</div><div class="diff-removed">-    expect(ops).toEqual([</div><div class="diff-removed">-      // unmount</div><div class="diff-removed">-      null,</div><div class="diff-removed">-      null,</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // TODO: Test that mounts, updates, refs, unmounts and deletions happen in the</div><div class="diff-removed">-  // expected way for aborted and resumed render life-cycles.</div><div class="diff-removed">-});</div><div>\ No newline at end of file</div><div class="diff-added">+The file started as a comprehensive test suite for React's incremental rendering and side effect handling, and evolved along with React itself to test newer features and behaviors while removing tests for deprecated functionality. The overall purpose of thoroughly testing React's rendering behavior remained consistent throughout the changes.</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    