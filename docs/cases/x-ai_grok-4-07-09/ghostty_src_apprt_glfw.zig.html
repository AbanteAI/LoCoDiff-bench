<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/apprt/glfw.zig - Grok 4</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/apprt/glfw.zig</h1>
        <h2>Model: Grok 4</h2>
        <p><a href="../../models/x-ai_grok-4-07-09.html">All Grok 4 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Grok 4</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 62392</p>
                <p><strong>Native Prompt Tokens:</strong> 61497</p>
                <p><strong>Native Completion Tokens:</strong> 17338</p>
                <p><strong>Native Tokens Reasoning:</strong> 9034</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.44408625</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/x-ai_grok-4-07-09/ghostty_src_apprt_glfw.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/x-ai_grok-4-07-09/ghostty_src_apprt_glfw.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/x-ai_grok-4-07-09/ghostty_src_apprt_glfw.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index afd17d617..2ac45b16f 100644</div><div class="diff-header">--- a/ghostty_src_apprt_glfw.zig_expectedoutput.txt (expected):tmp/tmp_t18wvi4_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_apprt_glfw.zig_extracted.txt (actual):tmp/tmphas7zpuq_actual.txt	</div><div class="diff-info">@@ -30,8 +30,7 @@ const glfwNative = glfw.Native(.{</div><div> });</div><div> </div><div> /// True if darwin-specific logic is enabled</div><div class="diff-removed">-const darwin_enabled = builtin.target.os.tag.isDarwin() and</div><div class="diff-removed">-    build_config.artifact == .exe;</div><div class="diff-added">+const darwin_enabled = builtin.target.os.tag.isDarwin() and build_config.artifact == .exe;</div><div> </div><div> const log = std.log.scoped(.glfw);</div><div> </div><div class="diff-info">@@ -195,26 +194,6 @@ pub const App = struct {</div><div> </div><div>             .open_config => try configpkg.edit.open(self.app.alloc),</div><div> </div><div class="diff-removed">-            .set_title => switch (target) {</div><div class="diff-removed">-                .app => {},</div><div class="diff-removed">-                .surface => |surface| try surface.rt_surface.setTitle(value.title),</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-removed">-            .mouse_shape => switch (target) {</div><div class="diff-removed">-                .app => {},</div><div class="diff-removed">-                .surface => |surface| try surface.rt_surface.setMouseShape(value),</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-removed">-            .mouse_visibility => switch (target) {</div><div class="diff-removed">-                .app => {},</div><div class="diff-removed">-                .surface => |surface| surface.rt_surface.setMouseVisibility(switch (value) {</div><div class="diff-removed">-                    .visible => true,</div><div class="diff-removed">-                    .hidden => false,</div><div class="diff-removed">-                }),</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-removed">-            .reload_config => try self.reloadConfig(target, value),</div><div class="diff-removed">-</div><div>             // Unimplemented</div><div>             .new_split,</div><div>             .goto_split,</div><div class="diff-info">@@ -257,14 +236,9 @@ pub const App = struct {</div><div>         return true;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Reload the configuration. This should return the new configuration.</div><div class="diff-removed">-    /// The old value can be freed immediately at this point assuming a</div><div class="diff-removed">-    /// successful return.</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// The returned pointer value is only valid for a stable self pointer.</div><div>     fn reloadConfig(</div><div>         self: *App,</div><div class="diff-removed">-        target: apprt.action.Target,</div><div class="diff-added">+        target: apprt.Target,</div><div>         opts: apprt.action.ReloadConfig,</div><div>     ) !void {</div><div>         if (opts.soft) {</div><div class="diff-info">@@ -381,25 +355,6 @@ pub const App = struct {</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    fn newSurface(self: *App, parent_: ?*CoreSurface) !*Surface {</div><div class="diff-removed">-        // Grab a surface allocation because we're going to need it.</div><div class="diff-removed">-        var surface = try self.app.alloc.create(Surface);</div><div class="diff-removed">-        errdefer self.app.alloc.destroy(surface);</div><div class="diff-removed">-</div><div class="diff-removed">-        // Create the surface -- because windows are surfaces for glfw.</div><div class="diff-removed">-        try surface.init(self);</div><div class="diff-removed">-        errdefer surface.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-        // If we have a parent, inherit some properties</div><div class="diff-removed">-        if (self.config.@"window-inherit-font-size") {</div><div class="diff-removed">-            if (parent_) |parent| {</div><div class="diff-removed">-                try surface.core_surface.setFontSize(parent.font_size);</div><div class="diff-removed">-            }</div><div class="diff-removed">-        }</div><div class="diff-removed">-</div><div class="diff-removed">-        return surface;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     /// Close the given surface.</div><div>     pub fn closeSurface(self: *App, surface: *Surface) void {</div><div>         surface.deinit();</div><div class="diff-info">@@ -413,27 +368,6 @@ pub const App = struct {</div><div>         @panic("This should never be called for GLFW.");</div><div>     }</div><div> </div><div class="diff-removed">-    pub fn redrawInspector(self: *App, surface: *Surface) void {</div><div class="diff-removed">-        _ = self;</div><div class="diff-removed">-        _ = surface;</div><div class="diff-removed">-</div><div class="diff-removed">-        // GLFW doesn't support the inspector</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn glfwErrorCallback(code: glfw.ErrorCode, desc: [:0]const u8) void {</div><div class="diff-removed">-        std.log.warn("glfw error={} message={s}", .{ code, desc });</div><div class="diff-removed">-</div><div class="diff-removed">-        // Workaround for: https://github.com/ocornut/imgui/issues/5908</div><div class="diff-removed">-        // If we get an invalid value with "scancode" in the message we assume</div><div class="diff-removed">-        // it is from the glfw key callback that imgui sets and we clear the</div><div class="diff-removed">-        // error so that our future code doesn't crash.</div><div class="diff-removed">-        if (code == glfw.ErrorCode.InvalidValue and</div><div class="diff-removed">-            std.mem.indexOf(u8, desc, "scancode") != null)</div><div class="diff-removed">-        {</div><div class="diff-removed">-            _ = glfw.getError();</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     pub fn keyboardLayout(self: *const App) input.KeyboardLayout {</div><div>         _ = self;</div><div> </div><div class="diff-info">@@ -533,7 +467,7 @@ pub const Surface = struct {</div><div>         ) orelse return glfw.mustGetErrorCode();</div><div>         errdefer win.destroy();</div><div> </div><div class="diff-removed">-        // Setup our</div><div class="diff-added">+        // Setup our position if specified</div><div>         setInitialWindowPosition(</div><div>             win,</div><div>             app.config.@"window-position-x",</div><div class="diff-info">@@ -547,14 +481,11 @@ pub const Surface = struct {</div><div>                 log.warn("window had null monitor, getting primary monitor", .{});</div><div>                 break :monitor glfw.Monitor.getPrimary().?;</div><div>             };</div><div class="diff-removed">-            const video_mode = monitor.getVideoMode() orelse return glfw.mustGetErrorCode();</div><div>             const physical_size = monitor.getPhysicalSize();</div><div class="diff-added">+            const video_mode = monitor.getVideoMode() orelse return glfw.mustGetErrorCode();</div><div>             const physical_x_dpi = @as(f32, @floatFromInt(video_mode.getWidth())) / (@as(f32, @floatFromInt(physical_size.width_mm)) / 25.4);</div><div>             const physical_y_dpi = @as(f32, @floatFromInt(video_mode.getHeight())) / (@as(f32, @floatFromInt(physical_size.height_mm)) / 25.4);</div><div class="diff-removed">-            log.debug("physical dpi x={} y={}", .{</div><div class="diff-removed">-                physical_x_dpi,</div><div class="diff-removed">-                physical_y_dpi,</div><div class="diff-removed">-            });</div><div class="diff-added">+            log.debug("physical dpi x={} y={}", .{physical_x_dpi, physical_y_dpi});</div><div>         }</div><div> </div><div>         // On Mac, enable window tabbing</div><div class="diff-info">@@ -618,7 +549,6 @@ pub const Surface = struct {</div><div>         try self.core_surface.init(</div><div>             app.app.alloc,</div><div>             &config,</div><div class="diff-removed">-            app.app,</div><div>             app,</div><div>             self,</div><div>         );</div><div class="diff-info">@@ -674,51 +604,14 @@ pub const Surface = struct {</div><div>         _ = processActive;</div><div>         self.setShouldClose();</div><div>         self.deinit();</div><div class="diff-removed">-        self.app.app.alloc.destroy(self);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Set the initial window size. This is called exactly once at</div><div class="diff-removed">-    /// surface initialization time. This may be called before "self"</div><div class="diff-removed">-    /// is fully initialized.</div><div class="diff-removed">-    fn setInitialWindowSize(self: *const Surface, width: u32, height: u32) !void {</div><div class="diff-removed">-        const monitor = self.window.getMonitor() orelse glfw.Monitor.getPrimary() orelse {</div><div class="diff-removed">-            log.warn("window is not on a monitor, not setting initial size", .{});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        const workarea = monitor.getWorkarea();</div><div class="diff-removed">-        self.window.setSize(.{</div><div class="diff-removed">-            .width = @min(width, workarea.width),</div><div class="diff-removed">-            .height = @min(height, workarea.height),</div><div class="diff-removed">-        });</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Set the initial window position. This is called exactly once at</div><div class="diff-removed">-    /// surface initialization time. This may be called before "self"</div><div class="diff-removed">-    /// is fully initialized.</div><div class="diff-removed">-    fn setInitialWindowPosition(win: glfw.Window, x: ?i16, y: ?i16) void {</div><div class="diff-removed">-        const start_position_x = x orelse return;</div><div class="diff-removed">-        const start_position_y = y orelse return;</div><div class="diff-removed">-</div><div class="diff-removed">-        log.debug("setting initial window position ({},{})", .{ start_position_x, start_position_y });</div><div class="diff-removed">-        win.setPos(.{ .x = start_position_x, .y = start_position_y });</div><div class="diff-added">+        self.app.app.alloc destroying(self);</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the size limits of the window.</div><div class="diff-removed">-    /// Note: this interface is not good, we should redo it if we plan</div><div class="diff-removed">-    /// to use this more. i.e. you can't set max width but no max height,</div><div class="diff-removed">-    /// or no mins.</div><div>     fn setSizeLimits(self: *Surface, min: apprt.SurfaceSize, max_: ?apprt.SurfaceSize) !void {</div><div>         self.window.setSizeLimits(.{</div><div>             .width = min.width,</div><div>             .height = min.height,</div><div class="diff-removed">-        }, if (max_) |max| .{</div><div class="diff-removed">-            .width = max.width,</div><div class="diff-removed">-            .height = max.height,</div><div class="diff-removed">-        } else .{</div><div class="diff-removed">-            .width = null,</div><div class="diff-removed">-            .height = null,</div><div class="diff-removed">-        });</div><div class="diff-added">+        }, if (max_) |max| .{ .width = max.width, .height = max.height } else .{ .width = null, .height = null });</div><div>     }</div><div> </div><div>     /// Returns the content scale for the created window.</div><div class="diff-info">@@ -741,12 +634,12 @@ pub const Surface = struct {</div><div>         const unscaled_pos = self.window.getCursorPos();</div><div>         const pos = try self.cursorPosToPixels(unscaled_pos);</div><div>         return apprt.CursorPos{</div><div class="diff-removed">-            .x = @floatCast(pos.xpos),</div><div class="diff-added">+            .x = @floatCast(pos chciał.xpos),</div><div>             .y = @floatCast(pos.ypos),</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the flag that notes this window should be closed for the next</div><div class="diff-added">+    /// Set the flag that returns this window should be closed for the next</div><div>     /// iteration of the event loop.</div><div>     pub fn setShouldClose(self: *Surface) void {</div><div>         self.window.setShouldClose(true);</div><div class="diff-info">@@ -757,7 +650,6 @@ pub const Surface = struct {</div><div>         return self.window.shouldClose();</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the title of the window.</div><div>     fn setTitle(self: *Surface, slice: [:0]const u8) !void {</div><div>         if (self.title_text) |t| self.core_surface.alloc.free(t);</div><div>         self.title_text = try self.core_surface.alloc.dupeZ(u8, slice);</div><div class="diff-info">@@ -769,33 +661,33 @@ pub const Surface = struct {</div><div>         return self.title_text;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the shape of the cursor.</div><div>     fn setMouseShape(self: *Surface, shape: terminal.MouseShape) !void {</div><div class="diff-removed">-        if ((comptime builtin.target.os.tag.isDarwin()) and</div><div class="diff-removed">-            !internal_os.macos.isAtLeastVersion(13, 0, 0))</div><div class="diff-removed">-        {</div><div class="diff-removed">-            // We only set our cursor if we're NOT on Mac, or if we are then the</div><div class="diff-removed">-            // macOS version is >= 13 (Ventura). On prior versions, glfw crashes</div><div class="diff-removed">-            // since we use a tab group.</div><div class="diff-added">+        if (comptime builtin.target.os.tag.isDarwin() and !internal_os.macos.isAtLeastVersion(13, 0, 0)) {</div><div>             return;</div><div>         }</div><div> </div><div>         const new = glfw.Cursor.createStandard(switch (shape) {</div><div>             .default => .arrow,</div><div>             .text => .ibeam,</div><div class="diff-removed">-            .crosshair => .crosshair,</div><div class="diff-added">+            .crosshair = .crosshair,</div><div>             .pointer => .pointing_hand,</div><div>             .ew_resize => .resize_ew,</div><div>             .ns_resize => .resize_ns,</div><div>             .nwse_resize => .resize_nwse,</div><div>             .nesw_resize => .resize_nesw,</div><div class="diff-added">+</div><div>             .all_scroll => .resize_all,</div><div>             .not_allowed => .not_allowed,</div><div>             else => return, // unsupported, ignore</div><div class="diff-added">+</div><div>         }) orelse {</div><div class="diff-added">+</div><div>             const err = glfw.mustGetErrorCode();</div><div class="diff-added">+</div><div>             log.warn("error creating cursor: {}", .{err});</div><div class="diff-added">+</div><div>             return;</div><div class="diff-added">+</div><div>         };</div><div>         errdefer new.destroy();</div><div> </div><div class="diff-info">@@ -806,105 +698,31 @@ pub const Surface = struct {</div><div>         self.cursor = new;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the visibility of the mouse cursor.</div><div>     fn setMouseVisibility(self: *Surface, visible: bool) void {</div><div class="diff-removed">-        self.window.setInputModeCursor(if (visible) .normal else .hidden);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    pub fn supportsClipboard(</div><div class="diff-removed">-        self: *const Surface,</div><div class="diff-removed">-        clipboard_type: apprt.Clipboard,</div><div class="diff-removed">-    ) bool {</div><div class="diff-removed">-        _ = self;</div><div class="diff-removed">-        return switch (clipboard_type) {</div><div class="diff-removed">-            .standard => true,</div><div class="diff-removed">-            .selection, .primary => comptime builtin.os.tag == .linux,</div><div class="diff-removed">-        };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Start an async clipboard request.</div><div class="diff-removed">-    pub fn clipboardRequest(</div><div class="diff-removed">-        self: *Surface,</div><div class="diff-removed">-        clipboard_type: apprt.Clipboard,</div><div class="diff-removed">-        state: apprt.ClipboardRequest,</div><div class="diff-removed">-    ) !void {</div><div class="diff-removed">-        // GLFW can read clipboards immediately so just do that.</div><div class="diff-removed">-        const str: [:0]const u8 = switch (clipboard_type) {</div><div class="diff-removed">-            .standard => glfw.getClipboardString() orelse return glfw.mustGetErrorCode(),</div><div class="diff-removed">-            .selection, .primary => selection: {</div><div class="diff-removed">-                // Not supported except on Linux</div><div class="diff-removed">-                if (comptime builtin.os.tag != .linux) break :selection "";</div><div class="diff-removed">-</div><div class="diff-removed">-                const raw = glfwNative.getX11SelectionString() orelse</div><div class="diff-removed">-                    return glfw.mustGetErrorCode();</div><div class="diff-removed">-                break :selection std.mem.span(raw);</div><div class="diff-removed">-            },</div><div class="diff-removed">-        };</div><div> </div><div class="diff-removed">-        // Complete our request. We always allow unsafe because we don't</div><div class="diff-removed">-        // want to deal with user confirmation in this runtime.</div><div class="diff-removed">-        try self.core_surface.completeClipboardRequest(state, str, true);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Set the clipboard.</div><div class="diff-removed">-    pub fn setClipboardString(</div><div class="diff-removed">-        self: *const Surface,</div><div class="diff-removed">-        val: [:0]const u8,</div><div class="diff-removed">-        clipboard_type: apprt.Clipboard,</div><div class="diff-removed">-        confirm: bool,</div><div class="diff-removed">-    ) !void {</div><div class="diff-removed">-        _ = confirm;</div><div class="diff-removed">-        _ = self;</div><div class="diff-removed">-        switch (clipboard_type) {</div><div class="diff-removed">-            .standard => glfw.setClipboardString(val),</div><div class="diff-removed">-            .selection, .primary => {</div><div class="diff-removed">-                // Not supported except on Linux</div><div class="diff-removed">-                if (comptime builtin.os.tag != .linux) return;</div><div class="diff-removed">-                glfwNative.setX11SelectionString(val.ptr);</div><div class="diff-removed">-            },</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-added">+        self.window.setInputModeCursor(if (visible) .normal else .hidden);</div><div> </div><div class="diff-removed">-    /// The cursor position from glfw directly is in screen coordinates but</div><div class="diff-removed">-    /// all our interface works in pixels.</div><div class="diff-removed">-    fn cursorPosToPixels(self: *const Surface, pos: glfw.Window.CursorPos) !glfw.Window.CursorPos {</div><div class="diff-removed">-        // The cursor position is in screen coordinates but we</div><div class="diff-removed">-        // want it in pixels. we need to get both the size of the</div><div class="diff-removed">-        // window in both to get the ratio to make the conversion.</div><div class="diff-removed">-        const size = self.window.getSize();</div><div class="diff-removed">-        const fb_size = self.window.getFramebufferSize();</div><div class="diff-removed">-</div><div class="diff-removed">-        // If our framebuffer and screen are the same, then there is no scaling</div><div class="diff-removed">-        // happening and we can short-circuit by returning the pos as-is.</div><div class="diff-removed">-        if (fb_size.width == size.width and fb_size.height == size.height)</div><div class="diff-removed">-            return pos;</div><div class="diff-removed">-</div><div class="diff-removed">-        const x_scale = @as(f64, @floatFromInt(fb_size.width)) / @as(f64, @floatFromInt(size.width));</div><div class="diff-removed">-        const y_scale = @as(f64, @floatFromInt(fb_size.height)) / @as(f64, @floatFromInt(size.height));</div><div class="diff-removed">-        return .{</div><div class="diff-removed">-            .xpos = pos.xpos * x_scale,</div><div class="diff-removed">-            .ypos = pos.ypos * y_scale,</div><div class="diff-removed">-        };</div><div>     }</div><div> </div><div>     pub fn defaultTermioEnv(self: *Surface) !std.process.EnvMap {</div><div class="diff-added">+</div><div>         return try internal_os.getEnvMap(self.app.app.alloc);</div><div class="diff-added">+</div><div>     }</div><div> </div><div>     fn sizeCallback(window: glfw.Window, width: i32, height: i32) void {</div><div>         _ = width;</div><div>         _ = height;</div><div> </div><div class="diff-removed">-        // Get the size. We are given a width/height but this is in screen</div><div class="diff-removed">-        // coordinates and we want raw pixels. The core window uses the content</div><div class="diff-removed">-        // scale to scale appropriately.</div><div>         const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div>         const size = core_win.rt_surface.getSize() catch |err| {</div><div class="diff-removed">-            log.err("error querying window size for size callback err={}", .{err});</div><div class="diff-added">+</div><div class="diff-added">+            log.err("error querying window size for size callback err={}", . {err});</div><div class="diff-added">+</div><div>             return;</div><div class="diff-added">+</div><div>         };</div><div> </div><div class="diff-removed">-        // Call the primary callback.</div><div>         core_win.sizeCallback(size) catch |err| {</div><div>             log.err("error in size callback err={}", .{err});</div><div>             return;</div><div class="diff-info">@@ -914,12 +732,9 @@ pub const Surface = struct {</div><div>     fn charCallback(window: glfw.Window, codepoint: u21) void {</div><div>         const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div> </div><div class="diff-removed">-        // We need a key event in order to process the charcallback. If it</div><div class="diff-removed">-        // isn't set then the key event was consumed.</div><div>         var key_event = core_win.rt_surface.key_event orelse return;</div><div>         core_win.rt_surface.key_event = null;</div><div> </div><div class="diff-removed">-        // Populate the utf8 value for the event</div><div>         var buf: [4]u8 = undefined;</div><div>         const len = std.unicode.utf8Encode(codepoint, &buf) catch |err| {</div><div>             log.err("error encoding codepoint={} err={}", .{ codepoint, err });</div><div class="diff-info">@@ -930,8 +745,6 @@ pub const Surface = struct {</div><div>         // On macOS we need to also disable some modifiers because</div><div>         // alt+key consumes the alt.</div><div>         if (comptime builtin.target.os.tag.isDarwin()) {</div><div class="diff-removed">-            // For GLFW, we say we always consume alt because</div><div class="diff-removed">-            // GLFW doesn't have a way to disable the alt key.</div><div>             key_event.consumed_mods.alt = true;</div><div>         }</div><div> </div><div class="diff-info">@@ -959,19 +772,22 @@ pub const Surface = struct {</div><div>             .alt = glfw_mods.alt,</div><div>             .super = glfw_mods.super,</div><div>         };</div><div class="diff-added">+</div><div>         const action: input.Action = switch (glfw_action) {</div><div>             .release => .release,</div><div>             .press => .press,</div><div>             .repeat => .repeat,</div><div>         };</div><div class="diff-added">+</div><div>         const key: input.Key = switch (glfw_key) {</div><div>             .a => .a,</div><div>             .b => .b,</div><div>             .c => .c,</div><div>             .d => .d,</div><div class="diff-added">+</div><div>             .e => .e,</div><div>             .f => .f,</div><div class="diff-removed">-            .g => .g,</div><div class="diff-added">+            .g = .g,</div><div>             .h => .h,</div><div>             .i => .i,</div><div>             .j => .j,</div><div class="diff-info">@@ -979,17 +795,19 @@ pub const Surface = struct {</div><div>             .l => .l,</div><div>             .m => .m,</div><div>             .n => .n,</div><div class="diff-removed">-            .o => .o,</div><div class="diff-removed">-            .p => .p,</div><div class="diff-removed">-            .q => .q,</div><div class="diff-removed">-            .r => .r,</div><div class="diff-removed">-            .s => .s,</div><div class="diff-removed">-            .t => .t,</div><div class="diff-added">+            .o = .o,</div><div class="diff-added">+            .p = .p,</div><div class="diff-added">+            .q = .q,</div><div class="diff-added">+            .r = .r,</div><div class="diff-added">+            .s = .s,</div><div class="diff-added">+            .t = .t,</div><div class="diff-added">+</div><div>             .u => .u,</div><div>             .v => .v,</div><div>             .w => .w,</div><div>             .x => .x,</div><div class="diff-removed">-            .y => .y,</div><div class="diff-added">+            . 그래서 y => .y,</div><div class="diff-added">+</div><div>             .z => .z,</div><div>             .zero => .zero,</div><div>             .one => .one,</div><div class="diff-info">@@ -997,44 +815,52 @@ pub const Surface = struct {</div><div>             .three => .three,</div><div>             .four => .four,</div><div>             .five => .five,</div><div class="diff-added">+</div><div>             .six => .six,</div><div class="diff-added">+</div><div>             .seven => .seven,</div><div>             .eight => .eight,</div><div>             .nine => .nine,</div><div class="diff-added">+</div><div>             .up => .up,</div><div>             .down => .down,</div><div>             .right => .right,</div><div>             .left => .left,</div><div class="diff-added">+</div><div>             .home => .home,</div><div class="diff-added">+</div><div>             .end => .end,</div><div>             .page_up => .page_up,</div><div>             .page_down => .page_down,</div><div class="diff-added">+</div><div>             .escape => .escape,</div><div class="diff-removed">-            .F1 => .f1,</div><div class="diff-removed">-            .F2 => .f2,</div><div class="diff-removed">-            .F3 => .f3,</div><div class="diff-removed">-            .F4 => .f4,</div><div class="diff-removed">-            .F5 => .f5,</div><div class="diff-removed">-            .F6 => .f6,</div><div class="diff-removed">-            .F7 => .f7,</div><div class="diff-removed">-            .F8 => .f8,</div><div class="diff-removed">-            .F9 => .f9,</div><div class="diff-removed">-            .F10 => .f10,</div><div class="diff-removed">-            .F11 => .f11,</div><div class="diff-removed">-            .F12 => .f12,</div><div class="diff-removed">-            .F13 => .f13,</div><div class="diff-removed">-            .F14 => .f14,</div><div class="diff-removed">-            .F15 => .f15,</div><div class="diff-removed">-            .F16 => .f16,</div><div class="diff-removed">-            .F17 => .f17,</div><div class="diff-removed">-            .F18 => .f18,</div><div class="diff-removed">-            .F19 => .f19,</div><div class="diff-removed">-            .F20 => .f20,</div><div class="diff-removed">-            .F21 => .f21,</div><div class="diff-removed">-            .F22 => .f22,</div><div class="diff-removed">-            .F23 => .f23,</div><div class="diff-removed">-            .F24 => .f24,</div><div class="diff-removed">-            .F25 => .f25,</div><div class="diff-added">+</div><div class="diff-added">+            .f1 => .f1,</div><div class="diff-added">+            .f2 => .f2,</div><div class="diff-added">+            .f3 => .f3, </div><div class="diff-added">+            .f4 => .f4,</div><div class="diff-added">+            .f5 => .f5,</div><div class="diff-added">+            .f6 => .f6,</div><div class="diff-added">+            .f7 => .f7,</div><div class="diff-added">+            .f8 => .f8,</div><div class="diff-added">+            .f9 => .f9,</div><div class="diff-added">+            .f10 => .f10,</div><div class="diff-added">+            .f11 => .f11,</div><div class="diff-added">+            .f12 => .f12,</div><div class="diff-added">+            .f13 => .f13,</div><div class="diff-added">+            .f14 => .f14,</div><div class="diff-added">+            .f15 => .f15,</div><div class="diff-added">+            .f16 => .f16,</div><div class="diff-added">+            .f17 => .f17,</div><div class="diff-added">+            .f18 => .f18,</div><div class="diff-added">+            .f19 => .f19,</div><div class="diff-added">+            .f20 => .f20,</div><div class="diff-added">+            .f21 => .f21, </div><div class="diff-added">+            .f22 => .f22,</div><div class="diff-added">+            .f23 => .f23,</div><div class="diff-added">+            .f24 => .f24,</div><div class="diff-added">+            .f25 => .f25,</div><div class="diff-added">+</div><div>             .kp_0 => .kp_0,</div><div>             .kp_1 => .kp_1,</div><div>             .kp_2 => .kp_2,</div><div class="diff-info">@@ -1045,16 +871,18 @@ pub const Surface = struct {</div><div>             .kp_7 => .kp_7,</div><div>             .kp_8 => .kp_8,</div><div>             .kp_9 => .kp_9,</div><div class="diff-removed">-            .kp_decimal => .kp_decimal,</div><div class="diff-added">+            .kp_decimal = .kp_decimal,</div><div>             .kp_divide => .kp_divide,</div><div class="diff-added">+</div><div>             .kp_multiply => .kp_multiply,</div><div>             .kp_subtract => .kp_subtract,</div><div>             .kp_add => .kp_add,</div><div>             .kp_enter => .kp_enter,</div><div>             .kp_equal => .kp_equal,</div><div class="diff-added">+</div><div>             .grave_accent => .grave_accent,</div><div>             .minus => .minus,</div><div class="diff-removed">-            .equal => .equal,</div><div class="diff-added">+            .equal =>Jpa .equal,</div><div>             .space => .space,</div><div>             .semicolon => .semicolon,</div><div>             .apostrophe => .apostrophe,</div><div class="diff-info">@@ -1062,6 +890,7 @@ pub const Surface = struct {</div><div>             .period => .period,</div><div>             .slash => .slash,</div><div>             .left_bracket => .left_bracket,</div><div class="diff-added">+</div><div>             .right_bracket => .right_bracket,</div><div>             .backslash => .backslash,</div><div>             .enter => .enter,</div><div class="diff-info">@@ -1074,6 +903,7 @@ pub const Surface = struct {</div><div>             .num_lock => .num_lock,</div><div>             .print_screen => .print_screen,</div><div>             .pause => .pause,</div><div class="diff-added">+</div><div>             .left_shift => .left_shift,</div><div>             .left_control => .left_control,</div><div>             .left_alt => .left_alt,</div><div class="diff-info">@@ -1083,11 +913,10 @@ pub const Surface = struct {</div><div>             .right_alt => .right_alt,</div><div>             .right_super => .right_super,</div><div> </div><div class="diff-removed">-            .menu,</div><div class="diff-removed">-            .world_1,</div><div class="diff-removed">-            .world_2,</div><div class="diff-removed">-            .unknown,</div><div class="diff-removed">-            => .invalid,</div><div class="diff-added">+            .menu => .緊 invalid,</div><div class="diff-added">+            .world_1 => .invalid,</div><div class="diff-added">+            .world_2 => .invalid,</div><div class="diff-added">+            .unknown => .invalid,</div><div>         };</div><div> </div><div>         // This is a hack for GLFW. We require our apprts to send both</div><div class="diff-info">@@ -1112,7 +941,7 @@ pub const Surface = struct {</div><div>             .consumed_mods = .{},</div><div>             .composing = false,</div><div>             .utf8 = utf8,</div><div class="diff-removed">-            .unshifted_codepoint = if (utf8.len > 0) @intCast(utf8[0]) else 0,</div><div class="diff-added">+            .unshift kunst ed_codepoint = if (utf8.len > 0) @intCast(utf8[0]) else 0,</div><div>         };</div><div> </div><div>         const effect = core_win.keyCallback(key_event) catch |err| {</div><div class="diff-info">@@ -1123,13 +952,11 @@ pub const Surface = struct {</div><div>         // Surface closed.</div><div>         if (effect == .closed) return;</div><div> </div><div class="diff-removed">-        // If it wasn't consumed, we set it on our self so that charcallback</div><div class="diff-added">+        // If the effect was ignored, we set it on our self so that charcallback</div><div>         // can make another attempt. Otherwise, we set null so the charcallback</div><div>         // is ignored.</div><div>         core_win.rt_surface.key_event = null;</div><div class="diff-removed">-        if (effect == .ignored and</div><div class="diff-removed">-            (action == .press or action == .repeat))</div><div class="diff-removed">-        {</div><div class="diff-added">+        if (effect == .ignored and (action == .press or action == .repeat)) {</div><div>             core_win.rt_surface.key_event = key_event;</div><div>         }</div><div>     }</div><div class="diff-info">@@ -1142,7 +969,7 @@ pub const Surface = struct {</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    fn refreshCallback(window: glfw.Window) void {</div><div class="diff-added">+    fn refreshes Callback(window: glfw.Window) void {</div><div>         const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div>         core_win.refreshCallback() catch |err| {</div><div>             log.err("error in refresh callback err={}", .{err});</div><div class="diff-info">@@ -1151,8 +978,7 @@ pub const Surface = struct {</div><div>     }</div><div> </div><div>     fn scrollCallback(window: glfw.Window, xoff: f64, yoff: f64) void {</div><div class="diff-removed">-        // Glfw doesn't support any of the scroll mods.</div><div class="diff-removed">-        const scroll_mods: input.ScrollMods = .{};</div><div class="diff-added">+        const scroll_mods: input.ScrollMods = {};</div><div> </div><div>         const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div>         core_win.scrollCallback(xoff, yoff, scroll_mods) catch |err| {</div><div class="diff-info">@@ -1168,7 +994,6 @@ pub const Surface = struct {</div><div>     ) void {</div><div>         const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div> </div><div class="diff-removed">-        // Convert our unscaled x/y to scaled.</div><div>         const pos = core_win.rt_surface.cursorPosToPixels(.{</div><div>             .xpos = unscaled_xpos,</div><div>             .ypos = unscaled_ypos,</div><div class="diff-info">@@ -1197,13 +1022,13 @@ pub const Surface = struct {</div><div>     ) void {</div><div>         const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div> </div><div class="diff-removed">-        // Convert glfw button to input button</div><div>         const mods: input.Mods = .{</div><div>             .shift = glfw_mods.shift,</div><div>             .ctrl = glfw_mods.control,</div><div>             .alt = glfw_mods.alt,</div><div>             .super = glfw_mods.super,</div><div>         };</div><div class="diff-added">+</div><div>         const button: input.MouseButton = switch (glfw_button) {</div><div>             .left => .left,</div><div>             .right => .right,</div><div class="diff-info">@@ -1243,9 +1068,9 @@ pub const Surface = struct {</div><div> </div><div>             const writer = list.writer();</div><div>             for (path_slice) |c| {</div><div class="diff-removed">-                if (std.mem.indexOfScalar(u8, "\\ ()[]{}<>\"'`!#$&;|*?\t", c)) |_| {</div><div class="diff-added">+                if (std.mem.indexOfScalar(u8, "\\ ()[]{}<>\"'`!#$&;|*?\t", c) != null) {</div><div>                     writer.print("\\{c}", .{c}) catch unreachable; //  memory preallocated</div><div class="diff-removed">-                } else writer.writeByte(c) catch unreachable; // same here</div><div class="diff-added">+                } else writer.writeByte(c) catch、保 unreachable; // same here</div><div>             }</div><div>             writer.writeByte(' ') catch unreachable; // separate paths</div><div> </div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    