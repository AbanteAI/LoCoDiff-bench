<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/react-dom/src/__tests__/ReactUpdates-test.js - Grok 4</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/react-dom/src/__tests__/ReactUpdates-test.js</h1>
        <h2>Model: Grok 4</h2>
        <p><a href="../../models/x-ai_grok-4-07-09.html">All Grok 4 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Grok 4</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 81665</p>
                <p><strong>Native Prompt Tokens:</strong> 83240</p>
                <p><strong>Native Completion Tokens:</strong> 14633</p>
                <p><strong>Native Tokens Reasoning:</strong> 2744</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.4687245</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/x-ai_grok-4-07-09/react_packages_react-dom_src___tests___ReactUpdates-test.js/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/x-ai_grok-4-07-09/react_packages_react-dom_src___tests___ReactUpdates-test.js/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/x-ai_grok-4-07-09/react_packages_react-dom_src___tests___ReactUpdates-test.js/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index ee4adf12f..0e95a56ed 100644</div><div class="diff-header">--- a/react_packages_react-dom_src___tests___ReactUpdates-test.js_expectedoutput.txt (expected):tmp/tmpaw25_br5_expected.txt	</div><div class="diff-header">+++ b/react_packages_react-dom_src___tests___ReactUpdates-test.js_extracted.txt (actual):tmp/tmprd1ekoqz_actual.txt	</div><div class="diff-info">@@ -11,14 +11,13 @@</div><div> </div><div> let React;</div><div> let ReactDOM;</div><div class="diff-removed">-let findDOMNode;</div><div> let ReactDOMClient;</div><div class="diff-added">+let findDOMNode;</div><div> let act;</div><div> let Scheduler;</div><div> let waitForAll;</div><div> let waitFor;</div><div> let assertLog;</div><div class="diff-removed">-let assertConsoleErrorDev;</div><div> </div><div> describe('ReactUpdates', () => {</div><div>   beforeEach(() => {</div><div class="diff-info">@@ -30,8 +29,6 @@ describe('ReactUpdates', () => {</div><div>       ReactDOM.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE</div><div>         .findDOMNode;</div><div>     act = require('internal-test-utils').act;</div><div class="diff-removed">-    assertConsoleErrorDev =</div><div class="diff-removed">-      require('internal-test-utils').assertConsoleErrorDev;</div><div>     Scheduler = require('scheduler');</div><div> </div><div>     const InternalTestUtils = require('internal-test-utils');</div><div class="diff-info">@@ -372,7 +369,6 @@ describe('ReactUpdates', () => {</div><div> </div><div>   it('should batch forceUpdate together', async () => {</div><div>     let instance;</div><div class="diff-removed">-    let shouldUpdateCount = 0;</div><div>     class Component extends React.Component {</div><div>       state = {x: 0};</div><div> </div><div class="diff-info">@@ -381,7 +377,7 @@ describe('ReactUpdates', () => {</div><div>         instance = this;</div><div>       }</div><div>       shouldComponentUpdate() {</div><div class="diff-removed">-        shouldUpdateCount++;</div><div class="diff-added">+        Scheduler.log('shouldUpdate');</div><div>       }</div><div> </div><div>       componentDidUpdate() {</div><div class="diff-info">@@ -415,9 +411,8 @@ describe('ReactUpdates', () => {</div><div>     });</div><div> </div><div>     // shouldComponentUpdate shouldn't be called since we're forcing</div><div class="diff-removed">-    expect(shouldUpdateCount).toBe(0);</div><div class="diff-removed">-    assertLog(['Update', 'callback', 'forceUpdate']);</div><div>     expect(instance.state.x).toBe(1);</div><div class="diff-added">+    assertLog(['Update', 'callback', 'forceUpdate']);</div><div>     expect(container.firstChild.textContent).toBe('1');</div><div>   });</div><div> </div><div class="diff-info">@@ -454,6 +449,7 @@ describe('ReactUpdates', () => {</div><div>     });</div><div> </div><div>     assertLog(['Parent render', 'Child render']);</div><div class="diff-added">+    assertLog([]);</div><div> </div><div>     await act(() => {</div><div>       instance.setState({x: 1});</div><div class="diff-info">@@ -563,6 +559,7 @@ describe('ReactUpdates', () => {</div><div>     class App extends React.Component {</div><div>       switcherRef = React.createRef();</div><div>       childRef = React.createRef();</div><div class="diff-added">+</div><div>       constructor(props) {</div><div>         super(props);</div><div>         instance = this;</div><div class="diff-info">@@ -737,12 +734,16 @@ describe('ReactUpdates', () => {</div><div>       state = {x: 0};</div><div> </div><div>       render() {</div><div class="diff-removed">-        updates.push('Inner-render-' + this.props.x + '-' + this.state.x);</div><div class="diff-added">+        updates.push(</div><div class="diff-added">+          'Inner-render-' + this.props.x + '-' + this.state.x,</div><div class="diff-added">+        );</div><div>         return <div />;</div><div>       }</div><div> </div><div>       componentDidUpdate() {</div><div class="diff-removed">-        updates.push('Inner-didUpdate-' + this.props.x + '-' + this.state.x);</div><div class="diff-added">+        updates.push(</div><div class="diff-added">+          'Inner-didUpdate-' + this.props.x + '-' + this.state.x,</div><div class="diff-added">+        );</div><div>       }</div><div>     }</div><div> </div><div class="diff-info">@@ -875,7 +876,7 @@ describe('ReactUpdates', () => {</div><div>         return <div />;</div><div>       }</div><div> </div><div class="diff-removed">-      UNSAFE_componentWillUpdate() {</div><div class="diff-added">+      componentDidUpdate() {</div><div>         x.go();</div><div>       }</div><div>     }</div><div class="diff-info">@@ -909,7 +910,7 @@ describe('ReactUpdates', () => {</div><div>     class A extends React.Component {</div><div>       state = {x: 0};</div><div> </div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-added">+      componentWillMount() {</div><div>         a = this;</div><div>       }</div><div> </div><div class="diff-info">@@ -919,7 +920,7 @@ describe('ReactUpdates', () => {</div><div>     }</div><div> </div><div>     class B extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-added">+      componentWillMount() {</div><div>         a.setState({x: 1});</div><div>       }</div><div> </div><div class="diff-info">@@ -1084,14 +1085,21 @@ describe('ReactUpdates', () => {</div><div>       root.render(<A ref={current => (component = current)} />);</div><div>     });</div><div> </div><div class="diff-removed">-    await expect(</div><div class="diff-removed">-      act(() => {</div><div class="diff-added">+    await expect(async () => {</div><div class="diff-added">+      await act(() => {</div><div>         component.setState({}, new Foo());</div><div class="diff-removed">-      }),</div><div class="diff-removed">-    ).rejects.toThrowError(</div><div class="diff-added">+      });</div><div class="diff-added">+    }).rejects.toThrowError(</div><div>       'Invalid argument passed as callback. Expected a function. Instead ' +</div><div>         'received: [object Object]',</div><div>     );</div><div class="diff-added">+    assertConsoleErrorDev(</div><div class="diff-added">+      [</div><div class="diff-added">+        'Expected the last optional `callback` argument to be ' +</div><div class="diff-added">+          "a function. Instead received: { a: 1, b: 2 }.",</div><div class="diff-added">+      ],</div><div class="diff-added">+      {withoutStack: true},</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div>   it('throws in forceUpdate if the update callback is not a function', async () => {</div><div class="diff-info">@@ -1158,14 +1166,21 @@ describe('ReactUpdates', () => {</div><div>       root.render(<A ref={current => (component = current)} />);</div><div>     });</div><div> </div><div class="diff-removed">-    await expect(</div><div class="diff-removed">-      act(() => {</div><div class="diff-added">+    await expect(async () => {</div><div class="diff-added">+      await act(() => {</div><div>         component.forceUpdate(new Foo());</div><div class="diff-removed">-      }),</div><div class="diff-removed">-    ).rejects.toThrowError(</div><div class="diff-added">+      });</div><div class="diff-added">+    }).rejects.toThrowError(</div><div>       'Invalid argument passed as callback. Expected a function. Instead ' +</div><div>         'received: [object Object]',</div><div>     );</div><div class="diff-added">+    assertConsoleErrorDev(</div><div class="diff-added">+      [</div><div class="diff-added">+        'Expected the last optional `callback` argument to be ' +</div><div class="diff-added">+          "a function. Instead received: { a: 1, b: 2 }.",</div><div class="diff-added">+      ],</div><div class="diff-added">+      {withoutStack: true},</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div>   it('does not update one component twice in a batch (#2410)', async () => {</div><div class="diff-info">@@ -1237,22 +1252,17 @@ describe('ReactUpdates', () => {</div><div>       callbacks.forEach(c => c());</div><div>     }</div><div> </div><div class="diff-removed">-    class App extends React.Component {</div><div class="diff-removed">-      constructor(props) {</div><div class="diff-removed">-        super(props);</div><div class="diff-removed">-        this.state = {showChild: true};</div><div class="diff-removed">-      }</div><div class="diff-removed">-      componentDidMount() {</div><div class="diff-removed">-        this.setState({showChild: false});</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return (</div><div class="diff-removed">-          <div></div><div class="diff-removed">-            <ForceUpdatesOnChange /></div><div class="diff-removed">-            {this.state.showChild && <EmitsChangeOnUnmount />}</div><div class="diff-removed">-          </div></div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-added">+    function App() {</div><div class="diff-added">+      const [showChild, setShowChild] = React.useState(true);</div><div class="diff-added">+      React.useEffect(() => {</div><div class="diff-added">+        setShowChild(false);</div><div class="diff-added">+      }, []);</div><div class="diff-added">+      return (</div><div class="diff-added">+        <div></div><div class="diff-added">+          <ForceUpdatesOnChange /></div><div class="diff-added">+          {showChild && <EmitsChangeOnUnmount />}</div><div class="diff-added">+        </div></div><div class="diff-added">+      );</div><div>     }</div><div> </div><div>     class EmitsChangeOnUnmount extends React.Component {</div><div class="diff-info">@@ -1287,6 +1297,20 @@ describe('ReactUpdates', () => {</div><div>     expect(true).toBe(true);</div><div>   });</div><div> </div><div class="diff-added">+  it('unmounts and remounts a root in the same batch', async () => {</div><div class="diff-added">+    const container = document.createElement('div');</div><div class="diff-added">+    const root = ReactDOMClient.createRoot(container);</div><div class="diff-added">+</div><div class="diff-added">+    await act(() => {</div><div class="diff-added">+      root.render(<div>Hello</div>);</div><div class="diff-added">+      expect(container.textContent).toBe('');</div><div class="diff-added">+      root.unmount(container);</div><div class="diff-added">+      expect(container.textContent).toBe('');</div><div class="diff-added">+    });</div><div class="diff-added">+</div><div class="diff-added">+    expect(container.textContent).toBe('');</div><div class="diff-added">+  });</div><div class="diff-added">+</div><div>   it('handles reentrant mounting in synchronous mode', async () => {</div><div>     let onChangeCalled = false;</div><div>     class Editor extends React.Component {</div><div class="diff-info">@@ -1322,8 +1346,9 @@ describe('ReactUpdates', () => {</div><div>       render();</div><div>     });</div><div>     assertLog(['Mount']);</div><div class="diff-removed">-    props = {...props, text: 'goodbye'};</div><div class="diff-added">+</div><div>     await act(() => {</div><div class="diff-added">+      props = {...props, text: 'goodbye'};</div><div>       render();</div><div>     });</div><div> </div><div class="diff-info">@@ -1470,17 +1495,17 @@ describe('ReactUpdates', () => {</div><div> </div><div>     const root = ReactDOMClient.createRoot(container);</div><div>     let hiddenDiv;</div><div class="diff-removed">-    await act(async () => {</div><div class="diff-added">+    await act(() => {</div><div>       root.render(<Foo />);</div><div class="diff-removed">-      await waitFor(['Foo', 'Baz', 'Foo#effect']);</div><div class="diff-removed">-      hiddenDiv = container.firstChild.firstChild;</div><div class="diff-removed">-      expect(hiddenDiv.hidden).toBe(true);</div><div class="diff-removed">-      expect(hiddenDiv.innerHTML).toBe('');</div><div class="diff-removed">-      // Run offscreen update</div><div class="diff-removed">-      await waitForAll(['Bar']);</div><div class="diff-removed">-      expect(hiddenDiv.hidden).toBe(true);</div><div class="diff-removed">-      expect(hiddenDiv.innerHTML).toBe('<p>bar 0</p>');</div><div>     });</div><div class="diff-added">+    await waitFor(['Foo', 'Baz', 'Foo#effect']);</div><div class="diff-added">+    hiddenDiv = container.firstChild.firstChild;</div><div class="diff-added">+    expect(hiddenDiv.hidden).toBe(true);</div><div class="diff-added">+    expect(hiddenDiv.innerHTML).toBe('');</div><div class="diff-added">+    // Run offscreen update</div><div class="diff-added">+    await waitForAll(['Bar']);</div><div class="diff-added">+    expect(hiddenDiv.hidden).toBe(true);</div><div class="diff-added">+    expect(hiddenDiv.innerHTML).toBe('<p>bar 0</p>');</div><div> </div><div>     ReactDOM.flushSync(() => {</div><div>       setCounter(1);</div><div class="diff-info">@@ -1622,7 +1647,7 @@ describe('ReactUpdates', () => {</div><div>     }).rejects.toThrow('Maximum');</div><div>   });</div><div> </div><div class="diff-removed">-  it('does not fall into an infinite update loop with useLayoutEffect', async () => {</div><div class="diff-added">+  it('does not fall into an infinite update loop with useLayoutEffect', () => {</div><div>     function NonTerminating() {</div><div>       const [step, setStep] = React.useState(0);</div><div>       React.useLayoutEffect(() => {</div><div class="diff-info">@@ -1633,32 +1658,33 @@ describe('ReactUpdates', () => {</div><div> </div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<NonTerminating />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow('Maximum');</div><div class="diff-added">+    expect(root.render(<NonTerminating />)).toThrow('Maximum');</div><div>   });</div><div> </div><div>   it('can recover after falling into an infinite update loop', async () => {</div><div>     class NonTerminating extends React.Component {</div><div>       state = {step: 0};</div><div class="diff-added">+</div><div>       componentDidMount() {</div><div>         this.setState({step: 1});</div><div>       }</div><div class="diff-added">+</div><div>       componentDidUpdate() {</div><div>         this.setState({step: 2});</div><div>       }</div><div class="diff-added">+</div><div>       render() {</div><div class="diff-removed">-        return this.state.step;</div><div class="diff-added">+        return null;</div><div>       }</div><div>     }</div><div> </div><div>     class Terminating extends React.Component {</div><div>       state = {step: 0};</div><div class="diff-added">+</div><div>       componentDidMount() {</div><div>         this.setState({step: 1});</div><div>       }</div><div class="diff-added">+</div><div>       render() {</div><div>         return this.state.step;</div><div>       }</div><div class="diff-info">@@ -1688,7 +1714,7 @@ describe('ReactUpdates', () => {</div><div>     expect(container.textContent).toBe('1');</div><div>   });</div><div> </div><div class="diff-removed">-  it('does not fall into mutually recursive infinite update loop with same container', async () => {</div><div class="diff-added">+  it('does not fall ?,into mutually recursive infinite update loop with same container', async () => {</div><div>     // Note: this test would fail if there were two or more different roots.</div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-info">@@ -1791,8 +1817,8 @@ describe('ReactUpdates', () => {</div><div>     expect(subscribers.length).toBe(limit);</div><div>   });</div><div> </div><div class="diff-removed">-  it("does not infinite loop if there's a synchronous render phase update on another component", async () => {</div><div class="diff-removed">-    if (gate(flags => !flags.enableInfiniteRenderLoopDetection)) {</div><div class="diff-added">+  it("does not infinite loop if there's a synchronous render phase update on another component", () => {</div><div class="diff-added">+    if (gate(flags => !	flags.enableInfiniteLoopDetection)) {</div><div>       return;</div><div>     }</div><div>     let setState;</div><div class="diff-info">@@ -1811,9 +1837,9 @@ describe('ReactUpdates', () => {</div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div> </div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => ReactDOM.flushSync(() => root.render(<App />)));</div><div class="diff-removed">-    }).rejects.toThrow('Maximum update depth exceeded');</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => root.render(<App />));</div><div class="diff-added">+    }).toThrow('Maximum update depth exceeded');</div><div>     assertConsoleErrorDev([</div><div>       'Cannot update a component (`App`) while rendering a different component (`Child`). ' +</div><div>         'To locate the bad setState() call inside `Child`, ' +</div><div class="diff-info">@@ -1823,7 +1849,7 @@ describe('ReactUpdates', () => {</div><div>   });</div><div> </div><div>   it("does not infinite loop if there's an async render phase update on another component", async () => {</div><div class="diff-removed">-    if (gate(flags => !flags.enableInfiniteRenderLoopDetection)) {</div><div class="diff-added">+    if (gate(flags => !flags.enableInfiniteLoopDetection)) {</div><div>       return;</div><div>     }</div><div>     let setState;</div><div class="diff-info">@@ -1908,7 +1934,6 @@ describe('ReactUpdates', () => {</div><div>             setStep(x => x + 1);</div><div>           }</div><div>         });</div><div class="diff-removed">-        Scheduler.log(step);</div><div>         return step;</div><div>       }</div><div> </div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    