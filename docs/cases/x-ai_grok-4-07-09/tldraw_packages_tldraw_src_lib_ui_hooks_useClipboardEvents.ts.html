<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/tldraw/src/lib/ui/hooks/useClipboardEvents.ts - Grok 4</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/tldraw/src/lib/ui/hooks/useClipboardEvents.ts</h1>
        <h2>Model: Grok 4</h2>
        <p><a href="../../models/x-ai_grok-4-07-09.html">All Grok 4 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Grok 4</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 40274</p>
                <p><strong>Native Prompt Tokens:</strong> 40132</p>
                <p><strong>Native Completion Tokens:</strong> 6333</p>
                <p><strong>Native Tokens Reasoning:</strong> 199</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.2153865</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/x-ai_grok-4-07-09/tldraw_packages_tldraw_src_lib_ui_hooks_useClipboardEvents.ts/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/x-ai_grok-4-07-09/tldraw_packages_tldraw_src_lib_ui_hooks_useClipboardEvents.ts/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/x-ai_grok-4-07-09/tldraw_packages_tldraw_src_lib_ui_hooks_useClipboardEvents.ts/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 5ea95b92f..1515f21b3 100644</div><div class="diff-header">--- a/tldraw_packages_tldraw_src_lib_ui_hooks_useClipboardEvents.ts_expectedoutput.txt (expected):tmp/tmp0khkfr2s_expected.txt	</div><div class="diff-header">+++ b/tldraw_packages_tldraw_src_lib_ui_hooks_useClipboardEvents.ts_extracted.txt (actual):tmp/tmp_xkw0fam_actual.txt	</div><div class="diff-info">@@ -109,10 +109,10 @@ const handleText = (</div><div> 	const validUrlList = getValidHttpURLList(data)</div><div> 	if (validUrlList) {</div><div> 		for (const url of validUrlList) {</div><div class="diff-removed">-			pasteUrl(editor, url, point)</div><div class="diff-added">+			pasteUrl(editor, url, point, sources)</div><div> 		}</div><div> 	} else if (isValidHttpURL(data)) {</div><div class="diff-removed">-		pasteUrl(editor, data, point)</div><div class="diff-added">+		pasteUrl(editor, data, point, sources)</div><div> 	} else if (isSvgText(data)) {</div><div> 		editor.markHistoryStoppingPoint('paste')</div><div> 		editor.putExternalContent({</div><div class="diff-info">@@ -162,6 +162,30 @@ type ClipboardThing =</div><div> 			source: Promise<string></div><div> 	  }</div><div> </div><div class="diff-added">+/**</div><div class="diff-added">+ * The result of processing a `ClipboardThing`.</div><div class="diff-added">+ * @internal</div><div class="diff-added">+ */</div><div class="diff-added">+type ClipboardResult =</div><div class="diff-added">+	| {</div><div class="diff-added">+			type: 'tldraw'</div><div class="diff-added">+			data: any</div><div class="diff-added">+	  }</div><div class="diff-added">+	| {</div><div class="diff-added">+			type: 'excalidraw'</div><div class="diff-added">+			data: any</div><div class="diff-added">+	  }</div><div class="diff-added">+	| {</div><div class="diff-added">+			type: 'text'</div><div class="diff-added">+			data: string</div><div class="diff-added">+			subtype: 'json' | 'html' | 'text' | 'url'</div><div class="diff-added">+	  }</div><div class="diff-added">+	| {</div><div class="diff-added">+			type: 'error'</div><div class="diff-added">+			data: string | null</div><div class="diff-added">+			reason: string</div><div class="diff-added">+	  }</div><div class="diff-added">+</div><div> /**</div><div>  * Handle a paste using event clipboard data. This is the "original"</div><div>  * paste method that uses the clipboard data from the paste event.</div><div class="diff-info">@@ -226,6 +250,7 @@ const handlePasteFromEventClipboardData = async (</div><div>  * @param editor - The editor</div><div>  * @param clipboardItems - The clipboard items to handle</div><div>  * @param point - The point to paste at</div><div class="diff-added">+ * @param fallbackFiles - Files from a native paste event. We will use these as a fallback if the clipboard API doesn't give us any files</div><div>  * @internal</div><div>  */</div><div> const handlePasteFromClipboardApi = async ({</div><div class="diff-info">@@ -501,26 +526,26 @@ async function handleClipboardThings(editor: Editor, things: ClipboardThing[], p</div><div> 					return</div><div> 				}</div><div> 			}</div><div class="diff-removed">-		}</div><div class="diff-removed">-</div><div class="diff-removed">-		// Allow you to paste YouTube or Google Maps embeds, for example.</div><div class="diff-removed">-		if (result.type === 'text' && result.subtype === 'text' && result.data.startsWith('<iframe ')) {</div><div class="diff-removed">-			// try to find an iframe</div><div class="diff-removed">-			const rootNode = new DOMParser().parseFromString(result.data, 'text/html')</div><div class="diff-removed">-			const bodyNode = rootNode.querySelector('body')</div><div> </div><div class="diff-removed">-			const isSingleIframe =</div><div class="diff-removed">-				bodyNode &&</div><div class="diff-removed">-				Array.from(bodyNode.children).filter((el) => el.nodeType === 1).length === 1 &&</div><div class="diff-removed">-				bodyNode.firstElementChild &&</div><div class="diff-removed">-				bodyNode.firstElementChild.tagName === 'IFRAME' &&</div><div class="diff-removed">-				bodyNode.firstElementChild.hasAttribute('src') &&</div><div class="diff-removed">-				bodyNode.firstElementChild.getAttribute('src') !== ''</div><div class="diff-removed">-</div><div class="diff-removed">-			if (isSingleIframe) {</div><div class="diff-removed">-				const src = bodyNode.firstElementChild.getAttribute('src')!</div><div class="diff-removed">-				handleText(editor, src, point, results)</div><div class="diff-removed">-				return</div><div class="diff-added">+			// Allow you to paste YouTube or Google Maps embeds, for example.</div><div class="diff-added">+			if (result.type === 'text' && result.subtype === 'text' && result.data.startsWith('<iframe ')) {</div><div class="diff-added">+				// try to find an iframe</div><div class="diff-added">+				const rootNode = new DOMParser().parseFromString(result.data, 'text/html')</div><div class="diff-added">+				const bodyNode = rootNode.querySelector('body')</div><div class="diff-added">+</div><div class="diff-added">+				const isSingleIframe =</div><div class="diff-added">+					bodyNode &&</div><div class="diff-added">+					Array.from(bodyNode.children).filter((el) => el.nodeType === 1).length === 1 &&</div><div class="diff-added">+					bodyNode.firstElementChild &&</div><div class="diff-added">+					bodyNode.firstElementChild.tagName === 'IFRAME' &&</div><div class="diff-added">+					bodyNode.firstElementChild.hasAttribute('src') &&</div><div class="diff-added">+					bodyNode.firstElementChild.getAttribute('src') !== ''</div><div class="diff-added">+</div><div class="diff-added">+				if (isSingleIframe) {</div><div class="diff-added">+					const src = bodyNode.firstElementChild.getAttribute('src')!</div><div class="diff-added">+					handleText(editor, src, point, results)</div><div class="diff-added">+					return</div><div class="diff-added">+				}</div><div> 			}</div><div> 		}</div><div> 	}</div><div class="diff-info">@@ -619,7 +644,7 @@ export function useMenuClipboardEvents() {</div><div> 			await handleNativeOrMenuCopy(editor)</div><div> 			trackEvent('copy', { source })</div><div> 		},</div><div class="diff-removed">-		[editor, trackEvent]</div><div class="diff-added">+		[trackEvent]</div><div> 	)</div><div> </div><div> 	const cut = useCallback(</div><div class="diff-info">@@ -631,7 +656,7 @@ export function useMenuClipboardEvents() {</div><div> 			editor.deleteShapes(editor.getSelectedShapeIds())</div><div> 			trackEvent('cut', { source })</div><div> 		},</div><div class="diff-removed">-		[editor, trackEvent]</div><div class="diff-added">+		[trackEvent]</div><div> 	)</div><div> </div><div> 	const paste = useCallback(</div><div class="diff-info">@@ -644,6 +669,7 @@ export function useMenuClipboardEvents() {</div><div> 			// If we're editing a shape, or we are focusing an editable input, then</div><div> 			// we would want the user's paste interaction to go to that element or</div><div> 			// input instead; e.g. when pasting text into a text shape's content</div><div class="diff-added">+</div><div> 			if (editor.getEditingShapeId() !== null) return</div><div> </div><div> 			if (Array.isArray(data) && data[0] instanceof ClipboardItem) {</div><div class="diff-info">@@ -656,7 +682,7 @@ export function useMenuClipboardEvents() {</div><div> 				})</div><div> 			}</div><div> 		},</div><div class="diff-removed">-		[editor, trackEvent]</div><div class="diff-added">+		[trackEvent]</div><div> 	)</div><div> </div><div> 	return {</div><div class="diff-info">@@ -671,9 +697,11 @@ export function useNativeClipboardEvents() {</div><div> 	const editor = useEditor()</div><div> 	const trackEvent = useUiEvents()</div><div> </div><div class="diff-removed">-	const appIsFocused = useValue('editor.isFocused', () => editor.getInstanceState().isFocused, [</div><div class="diff-removed">-		editor,</div><div class="diff-removed">-	])</div><div class="diff-added">+	const appIsFocused = useValue<'editor.isFocused'>(</div><div class="diff-added">+		'editor.isFocused',</div><div class="diff-added">+		() => editor.getInstanceState().isFocused,</div><div class="diff-added">+		[editor]</div><div class="diff-added">+	)</div><div> </div><div> 	useEffect(() => {</div><div> 		if (!appIsFocused) return</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    