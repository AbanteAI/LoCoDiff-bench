<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/react-dom/src/__tests__/ReactCompositeComponent-test.js - GPT-5 (minimal)</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/react-dom/src/__tests__/ReactCompositeComponent-test.js</h1>
        <h2>Model: GPT-5 (minimal)</h2>
        <p><a href="../../models/openai_gpt-5minimal.html">All GPT-5 (minimal) Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> GPT-5 (minimal)</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 86495</p>
                <p><strong>Native Prompt Tokens:</strong> 72002</p>
                <p><strong>Native Completion Tokens:</strong> 9070</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.1807025</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_gpt-5minimal/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_gpt-5minimal/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_gpt-5minimal/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 52bccce28..cb39d0076 100644</div><div class="diff-header">--- a/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js_expectedoutput.txt (expected):tmp/tmpuvffygj4_expected.txt	</div><div class="diff-header">+++ b/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js_extracted.txt (actual):tmp/tmpqgkryjuo_actual.txt	</div><div class="diff-info">@@ -14,11 +14,10 @@ let MorphingComponent;</div><div> let React;</div><div> let ReactDOM;</div><div> let ReactDOMClient;</div><div class="diff-removed">-let ReactSharedInternals;</div><div class="diff-added">+let ReactCurrentOwner;</div><div> let Scheduler;</div><div> let assertLog;</div><div> let act;</div><div class="diff-removed">-let assertConsoleErrorDev;</div><div> </div><div> describe('ReactCompositeComponent', () => {</div><div>   const hasOwnProperty = Object.prototype.hasOwnProperty;</div><div class="diff-info">@@ -63,16 +62,75 @@ describe('ReactCompositeComponent', () => {</div><div>     );</div><div>   }</div><div> </div><div class="diff-added">+  if (require('shared/ReactFeatureFlags').disableModulePatternComponents) {</div><div class="diff-added">+    it('should not support module pattern components', async () => {</div><div class="diff-added">+      function Child({test}) {</div><div class="diff-added">+        return {</div><div class="diff-added">+          render() {</div><div class="diff-added">+            return <div>{test}</div>;</div><div class="diff-added">+          },</div><div class="diff-added">+        };</div><div class="diff-added">+      }</div><div class="diff-added">+</div><div class="diff-added">+      const el = document.createElement('div');</div><div class="diff-added">+      const root = ReactDOMClient.createRoot(el);</div><div class="diff-added">+      expect(() => {</div><div class="diff-added">+        expect(() => {</div><div class="diff-added">+          ReactDOM.flushSync(() => {</div><div class="diff-added">+            root.render(<Child test="test" />);</div><div class="diff-added">+          });</div><div class="diff-added">+        }).toThrow(</div><div class="diff-added">+          'Objects are not valid as a React child (found: object with keys {render}).',</div><div class="diff-added">+        );</div><div class="diff-added">+      }).toErrorDev(</div><div class="diff-added">+        'Warning: The <Child /> component appears to be a function component that returns a class instance. ' +</div><div class="diff-added">+          'Change Child to a class that extends React.Component instead. ' +</div><div class="diff-added">+          "If you can't use a class try assigning the prototype on the function as a workaround. " +</div><div class="diff-added">+          '`Child.prototype = React.Component.prototype`. ' +</div><div class="diff-added">+          "Don't use an arrow function since it cannot be called with `new` by React.",</div><div class="diff-added">+      );</div><div class="diff-added">+</div><div class="diff-added">+      expect(el.textContent).toBe('');</div><div class="diff-added">+    });</div><div class="diff-added">+  } else {</div><div class="diff-added">+    it('should support module pattern components', () => {</div><div class="diff-added">+      function Child({test}) {</div><div class="diff-added">+        return {</div><div class="diff-added">+          render() {</div><div class="diff-added">+            return <div>{test}</div>;</div><div class="diff-added">+          },</div><div class="diff-added">+        };</div><div class="diff-added">+      }</div><div class="diff-added">+</div><div class="diff-added">+      const el = document.createElement('div');</div><div class="diff-added">+      const root = ReactDOMClient.createRoot(el);</div><div class="diff-added">+      expect(() => {</div><div class="diff-added">+        ReactDOM.flushSync(() => {</div><div class="diff-added">+          root.render(<Child test="test" />);</div><div class="diff-added">+        });</div><div class="diff-added">+      }).toErrorDev(</div><div class="diff-added">+        'Warning: The <Child /> component appears to be a function component that returns a class instance. ' +</div><div class="diff-added">+          'Change Child to a class that extends React.Component instead. ' +</div><div class="diff-added">+          "If you can't use a class try assigning the prototype on the function as a workaround. " +</div><div class="diff-added">+          '`Child.prototype = React.Component.prototype`. ' +</div><div class="diff-added">+          "Don't use an arrow function since it cannot be called with `new` by React.",</div><div class="diff-added">+      );</div><div class="diff-added">+</div><div class="diff-added">+      expect(el.textContent).toBe('test');</div><div class="diff-added">+    });</div><div class="diff-added">+  }</div><div class="diff-added">+</div><div>   beforeEach(() => {</div><div>     jest.resetModules();</div><div>     React = require('react');</div><div>     ReactDOM = require('react-dom');</div><div>     ReactDOMClient = require('react-dom/client');</div><div class="diff-removed">-    ReactSharedInternals =</div><div class="diff-removed">-      require('react').__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;</div><div class="diff-added">+    ReactCurrentOwner =</div><div class="diff-added">+      require('react').__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED</div><div class="diff-added">+        .ReactCurrentOwner;</div><div>     Scheduler = require('scheduler');</div><div>     assertLog = require('internal-test-utils').assertLog;</div><div class="diff-removed">-    ({act, assertConsoleErrorDev} = require('internal-test-utils'));</div><div class="diff-added">+    act = require('internal-test-utils').act;</div><div>   });</div><div> </div><div>   describe('MorphingComponent', () => {</div><div class="diff-info">@@ -211,28 +269,6 @@ describe('ReactCompositeComponent', () => {</div><div>     });</div><div>   });</div><div> </div><div class="diff-removed">-  it('should not support module pattern components', async () => {</div><div class="diff-removed">-    function Child({test}) {</div><div class="diff-removed">-      return {</div><div class="diff-removed">-        render() {</div><div class="diff-removed">-          return <div>{test}</div>;</div><div class="diff-removed">-        },</div><div class="diff-removed">-      };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const el = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(el);</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<Child test="test" />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow(</div><div class="diff-removed">-      'Objects are not valid as a React child (found: object with keys {render}).',</div><div class="diff-removed">-    );</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(el.textContent).toBe('');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div>   it('should use default values for undefined props', async () => {</div><div>     class Component extends React.Component {</div><div>       static defaultProps = {prop: 'testKey'};</div><div class="diff-info">@@ -242,34 +278,24 @@ describe('ReactCompositeComponent', () => {</div><div>       }</div><div>     }</div><div> </div><div class="diff-removed">-    function refFn1(ref) {</div><div class="diff-removed">-      instance1 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function refFn2(ref) {</div><div class="diff-removed">-      instance2 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function refFn3(ref) {</div><div class="diff-removed">-      instance3 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     let instance1;</div><div>     let instance2;</div><div>     let instance3;</div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn1} />);</div><div class="diff-added">+      root.render(<Component ref={ref => (instance1 = ref)} />);</div><div>     });</div><div>     expect(instance1.props).toEqual({prop: 'testKey'});</div><div> </div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn2} prop={undefined} />);</div><div class="diff-added">+      root.render(</div><div class="diff-added">+        <Component ref={ref => (instance2 = ref)} prop={undefined} />,</div><div class="diff-added">+      );</div><div>     });</div><div>     expect(instance2.props).toEqual({prop: 'testKey'});</div><div> </div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn3} prop={null} />);</div><div class="diff-added">+      root.render(<Component ref={ref => (instance3 = ref)} prop={null} />);</div><div>     });</div><div>     expect(instance3.props).toEqual({prop: null});</div><div>   });</div><div class="diff-info">@@ -309,16 +335,16 @@ describe('ReactCompositeComponent', () => {</div><div> </div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<MyComponent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      "Can't call forceUpdate on a component that is not yet mounted. " +</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<MyComponent />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      "Warning: Can't call forceUpdate on a component that is not yet mounted. " +</div><div>         'This is a no-op, but it might indicate a bug in your application. ' +</div><div>         'Instead, assign to `this.state` directly or define a `state = {};` ' +</div><div class="diff-removed">-        'class property with the desired state in the MyComponent component.\n' +</div><div class="diff-removed">-        '    in MyComponent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+        'class property with the desired state in the MyComponent component.',</div><div class="diff-added">+    );</div><div> </div><div>     // No additional warning should be recorded</div><div>     const container2 = document.createElement('div');</div><div class="diff-info">@@ -343,16 +369,16 @@ describe('ReactCompositeComponent', () => {</div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div> </div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<MyComponent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      "Can't call setState on a component that is not yet mounted. " +</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<MyComponent />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      "Warning: Can't call setState on a component that is not yet mounted. " +</div><div>         'This is a no-op, but it might indicate a bug in your application. ' +</div><div>         'Instead, assign to `this.state` directly or define a `state = {};` ' +</div><div class="diff-removed">-        'class property with the desired state in the MyComponent component.\n' +</div><div class="diff-removed">-        '    in MyComponent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+        'class property with the desired state in the MyComponent component.',</div><div class="diff-added">+    );</div><div> </div><div>     // No additional warning should be recorded</div><div>     const container2 = document.createElement('div');</div><div class="diff-info">@@ -478,24 +504,24 @@ describe('ReactCompositeComponent', () => {</div><div>       }</div><div>     }</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<ClassWithRenderNotExtended />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow(TypeError);</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'The <ClassWithRenderNotExtended /> component appears to have a render method, ' +</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      expect(() => {</div><div class="diff-added">+        ReactDOM.flushSync(() => {</div><div class="diff-added">+          root.render(<ClassWithRenderNotExtended />);</div><div class="diff-added">+        });</div><div class="diff-added">+      }).toThrow(TypeError);</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      'Warning: The <ClassWithRenderNotExtended /> component appears to have a render method, ' +</div><div>         "but doesn't extend React.Component. This is likely to cause errors. " +</div><div class="diff-removed">-        'Change ClassWithRenderNotExtended to extend React.Component instead.\n' +</div><div class="diff-removed">-        '    in ClassWithRenderNotExtended (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+        'Change ClassWithRenderNotExtended to extend React.Component instead.',</div><div class="diff-added">+    );</div><div> </div><div>     // Test deduplication</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div>         root.render(<ClassWithRenderNotExtended />);</div><div>       });</div><div class="diff-removed">-    }).rejects.toThrow(TypeError);</div><div class="diff-added">+    }).toThrow(TypeError);</div><div>   });</div><div> </div><div>   it('should warn about `setState` in render', async () => {</div><div class="diff-info">@@ -515,14 +541,14 @@ describe('ReactCompositeComponent', () => {</div><div> </div><div>     let instance;</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<Component ref={ref => (instance = ref)} />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div>       'Cannot update during an existing state transition (such as within ' +</div><div class="diff-removed">-        '`render`). Render methods should be a pure function of props and state.\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+        '`render`). Render methods should be a pure function of props and state.',</div><div class="diff-added">+    );</div><div> </div><div>     // The setState call is queued and then executed as a second pass. This</div><div>     // behavior is undefined though so we're free to change it to suit the</div><div class="diff-info">@@ -538,34 +564,23 @@ describe('ReactCompositeComponent', () => {</div><div>   });</div><div> </div><div>   it('should cleanup even if render() fatals', async () => {</div><div class="diff-removed">-    const ownerEnabled = __DEV__;</div><div class="diff-removed">-</div><div class="diff-removed">-    let stashedDispatcher;</div><div>     class BadComponent extends React.Component {</div><div>       render() {</div><div class="diff-removed">-        // Stash the dispatcher that was available in render so we can check</div><div class="diff-removed">-        // that its internals also reset.</div><div class="diff-removed">-        stashedDispatcher = ReactSharedInternals.A;</div><div>         throw new Error();</div><div>       }</div><div>     }</div><div> </div><div>     const instance = <BadComponent />;</div><div class="diff-removed">-    expect(ReactSharedInternals.A).toBe(null);</div><div class="diff-added">+    expect(ReactCurrentOwner.current).toBe(null);</div><div> </div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div>         root.render(instance);</div><div>       });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-added">+    }).toThrow();</div><div> </div><div class="diff-removed">-    expect(ReactSharedInternals.A).toBe(null);</div><div class="diff-removed">-    if (ownerEnabled) {</div><div class="diff-removed">-      expect(stashedDispatcher.getOwner()).toBe(null);</div><div class="diff-removed">-    } else {</div><div class="diff-removed">-      expect(stashedDispatcher.getOwner).toBe(undefined);</div><div class="diff-removed">-    }</div><div class="diff-added">+    expect(ReactCurrentOwner.current).toBe(null);</div><div>   });</div><div> </div><div>   it('should call componentWillUnmount before unmounting', async () => {</div><div class="diff-info">@@ -619,14 +634,14 @@ describe('ReactCompositeComponent', () => {</div><div>       root.render(<ClassComponent ref={ref => (instance = ref)} />);</div><div>     });</div><div> </div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      instance.setState({bogus: true});</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'ClassComponent.shouldComponentUpdate(): Returned undefined instead of a ' +</div><div class="diff-removed">-        'boolean value. Make sure to return true or false.\n' +</div><div class="diff-removed">-        '    in ClassComponent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        instance.setState({bogus: true});</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      'Warning: ClassComponent.shouldComponentUpdate(): Returned undefined instead of a ' +</div><div class="diff-added">+        'boolean value. Make sure to return true or false.',</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div>   it('should warn when componentDidUnmount method is defined', async () => {</div><div class="diff-info">@@ -639,15 +654,15 @@ describe('ReactCompositeComponent', () => {</div><div>     }</div><div> </div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Component has a method called ' +</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<Component />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      'Warning: Component has a method called ' +</div><div>         'componentDidUnmount(). But there is no such lifecycle method. ' +</div><div class="diff-removed">-        'Did you mean componentWillUnmount()?\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+        'Did you mean componentWillUnmount()?',</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div>   it('should warn when componentDidReceiveProps method is defined', () => {</div><div class="diff-info">@@ -661,17 +676,17 @@ describe('ReactCompositeComponent', () => {</div><div> </div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div> </div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Component has a method called ' +</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<Component />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      'Warning: Component has a method called ' +</div><div>         'componentDidReceiveProps(). But there is no such lifecycle method. ' +</div><div>         'If you meant to update the state in response to changing props, ' +</div><div>         'use componentWillReceiveProps(). If you meant to fetch data or ' +</div><div class="diff-removed">-        'run side-effects or mutations after React has updated the UI, use componentDidUpdate().\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+        'run side-effects or mutations after React has updated the UI, use componentDidUpdate().',</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div>   it('should warn when defaultProps was defined as an instance property', () => {</div><div class="diff-info">@@ -687,14 +702,14 @@ describe('ReactCompositeComponent', () => {</div><div>     }</div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div> </div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Setting defaultProps as an instance property on Component is not supported ' +</div><div class="diff-removed">-        'and will be ignored. Instead, define defaultProps as a static property on Component.\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<Component />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      'Warning: Setting defaultProps as an instance property on Component is not supported ' +</div><div class="diff-added">+        'and will be ignored. Instead, define defaultProps as a static property on Component.',</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div>   it('should skip update when rerendering element in container', async () => {</div><div class="diff-info">@@ -740,16 +755,16 @@ describe('ReactCompositeComponent', () => {</div><div>       }</div><div>     }</div><div> </div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Outer />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<Outer />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div>       'Render methods should be a pure function of props and state; ' +</div><div>         'triggering nested component updates from render is not allowed. If ' +</div><div class="diff-removed">-        'necessary, trigger nested updates in componentDidUpdate.\n\n' +</div><div class="diff-removed">-        'Check the render method of Outer.\n' +</div><div class="diff-removed">-        '    in Outer (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+        'necessary, trigger nested updates in componentDidUpdate.\n\nCheck the ' +</div><div class="diff-added">+        'render method of Outer.',</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div>   it('only renders once if updated in componentWillReceiveProps', async () => {</div><div class="diff-info">@@ -837,17 +852,17 @@ describe('ReactCompositeComponent', () => {</div><div>     }</div><div> </div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Foo idx="qwe" />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'When calling super() in `Foo`, make sure to pass ' +</div><div class="diff-removed">-        "up the same props that your component's constructor was passed.\n" +</div><div class="diff-removed">-        '    in Foo (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<Foo idx="qwe" />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      'Foo(...): When calling super() in `Foo`, make sure to pass ' +</div><div class="diff-added">+        "up the same props that your component's constructor was passed.",</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div class="diff-removed">-  it('should only call componentWillUnmount once', async () => {</div><div class="diff-added">+  it('should only call componentWillUnmount once', () => {</div><div>     let app;</div><div>     let count = 0;</div><div> </div><div class="diff-info">@@ -882,14 +897,14 @@ describe('ReactCompositeComponent', () => {</div><div>     };</div><div> </div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div>         root.render(<App ref={setRef} stage={1} />);</div><div>       });</div><div class="diff-removed">-      await act(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div>         root.render(<App ref={setRef} stage={2} />);</div><div>       });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-added">+    }).toThrow();</div><div>     expect(count).toBe(1);</div><div>   });</div><div> </div><div class="diff-info">@@ -921,13 +936,15 @@ describe('ReactCompositeComponent', () => {</div><div>     await act(() => {</div><div>       root.render(<Wrapper name="A" />);</div><div>     });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog(['A componentWillMount', 'A render', 'A componentDidMount']);</div><div>     await act(() => {</div><div>       root.render(<Wrapper name="B" />);</div><div>     });</div><div> </div><div>     assertLog([</div><div class="diff-added">+      'A componentWillMount',</div><div class="diff-added">+      'A render',</div><div class="diff-added">+      'A componentDidMount',</div><div class="diff-added">+</div><div>       'B componentWillMount',</div><div>       'B render',</div><div>       'A componentWillUnmount',</div><div class="diff-info">@@ -1172,7 +1189,7 @@ describe('ReactCompositeComponent', () => {</div><div>     assertLog(['setState callback called']);</div><div>   });</div><div> </div><div class="diff-removed">-  it('should return a meaningful warning when constructor is returned', async () => {</div><div class="diff-added">+  it('should return a meaningful warning when constructor is returned', () => {</div><div>     class RenderTextInvalidConstructor extends React.Component {</div><div>       constructor(props) {</div><div>         super(props);</div><div class="diff-info">@@ -1185,18 +1202,24 @@ describe('ReactCompositeComponent', () => {</div><div>     }</div><div> </div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<RenderTextInvalidConstructor />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'No `render` method found on the RenderTextInvalidConstructor instance: ' +</div><div class="diff-removed">-        'did you accidentally return an object from the constructor?\n' +</div><div class="diff-removed">-        '    in RenderTextInvalidConstructor (at **)',</div><div class="diff-removed">-      'No `render` method found on the RenderTextInvalidConstructor instance: ' +</div><div class="diff-removed">-        'did you accidentally return an object from the constructor?\n' +</div><div class="diff-removed">-        '    in RenderTextInvalidConstructor (at **)',</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      expect(() => {</div><div class="diff-added">+        ReactDOM.flushSync(() => {</div><div class="diff-added">+          root.render(<RenderTextInvalidConstructor />);</div><div class="diff-added">+        });</div><div class="diff-added">+      }).toThrow();</div><div class="diff-added">+    }).toErrorDev([</div><div class="diff-added">+      // Expect two errors because invokeGuardedCallback will dispatch an error event,</div><div class="diff-added">+      // Causing the warning to be logged again.</div><div class="diff-added">+      'Warning: RenderTextInvalidConstructor(...): No `render` method found on the returned component instance: ' +</div><div class="diff-added">+        'did you accidentally return an object from the constructor?',</div><div class="diff-added">+      'Warning: RenderTextInvalidConstructor(...): No `render` method found on the returned component instance: ' +</div><div class="diff-added">+        'did you accidentally return an object from the constructor?',</div><div class="diff-added">+      // And then two more because we retry errors.</div><div class="diff-added">+      'Warning: RenderTextInvalidConstructor(...): No `render` method found on the returned component instance: ' +</div><div class="diff-added">+        'did you accidentally return an object from the constructor?',</div><div class="diff-added">+      'Warning: RenderTextInvalidConstructor(...): No `render` method found on the returned component instance: ' +</div><div class="diff-added">+        'did you accidentally return an object from the constructor?',</div><div>     ]);</div><div>   });</div><div> </div><div class="diff-info">@@ -1212,32 +1235,39 @@ describe('ReactCompositeComponent', () => {</div><div> </div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Bad />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<Bad />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div>       'It looks like Bad is reassigning its own `this.props` while rendering. ' +</div><div class="diff-removed">-        'This is not supported and can lead to confusing bugs.\n' +</div><div class="diff-removed">-        '    in Bad (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+        'This is not supported and can lead to confusing bugs.',</div><div class="diff-added">+    );</div><div>   });</div><div> </div><div class="diff-removed">-  it('should return error if render is not defined', async () => {</div><div class="diff-added">+  it('should return error if render is not defined', () => {</div><div>     class RenderTestUndefinedRender extends React.Component {}</div><div> </div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<RenderTestUndefinedRender />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'No `render` method found on the RenderTestUndefinedRender instance: ' +</div><div class="diff-removed">-        'you may have forgotten to define `render`.\n' +</div><div class="diff-removed">-        '    in RenderTestUndefinedRender (at **)',</div><div class="diff-removed">-      'No `render` method found on the RenderTestUndefinedRender instance: ' +</div><div class="diff-removed">-        'you may have forgotten to define `render`.\n' +</div><div class="diff-removed">-        '    in RenderTestUndefinedRender (at **)',</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      expect(() => {</div><div class="diff-added">+        ReactDOM.flushSync(() => {</div><div class="diff-added">+          root.render(<RenderTestUndefinedRender />);</div><div class="diff-added">+        });</div><div class="diff-added">+      }).toThrow();</div><div class="diff-added">+    }).toErrorDev([</div><div class="diff-added">+      // Expect two errors because invokeGuardedCallback will dispatch an error event,</div><div class="diff-added">+      // Causing the warning to be logged again.</div><div class="diff-added">+      'Warning: RenderTestUndefinedRender(...): No `render` method found on the returned ' +</div><div class="diff-added">+        'component instance: you may have forgotten to define `render`.',</div><div class="diff-added">+      'Warning: RenderTestUndefinedRender(...): No `render` method found on the returned ' +</div><div class="diff-added">+        'component instance: you may have forgotten to define `render`.',</div><div class="diff-added">+</div><div class="diff-added">+      // And then two more because we retry errors.</div><div class="diff-added">+      'Warning: RenderTestUndefinedRender(...): No `render` method found on the returned ' +</div><div class="diff-added">+        'component instance: you may have forgotten to define `render`.',</div><div class="diff-added">+      'Warning: RenderTestUndefinedRender(...): No `render` method found on the returned ' +</div><div class="diff-added">+        'component instance: you may have forgotten to define `render`.',</div><div>     ]);</div><div>   });</div><div> </div><div class="diff-info">@@ -1389,15 +1419,13 @@ describe('ReactCompositeComponent', () => {</div><div>     }</div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Cannot update a component (`A`) while rendering a different component (`B`). ' +</div><div class="diff-removed">-        'To locate the bad setState() call inside `B`, ' +</div><div class="diff-removed">-        'follow the stack trace as described in https://react.dev/link/setstate-in-render\n' +</div><div class="diff-removed">-        '    in Parent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-added">+    expect(() => {</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<Parent />);</div><div class="diff-added">+      });</div><div class="diff-added">+    }).toErrorDev(</div><div class="diff-added">+      'Cannot update a component (`A`) while rendering a different component (`B`)',</div><div class="diff-added">+    );</div><div> </div><div>     // We error, but still update the state.</div><div>     expect(ref.textContent).toBe('1');</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    