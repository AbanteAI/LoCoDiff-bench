<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/terminal/Parser.zig - Gemini 2.5 Flash Thinking</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/terminal/Parser.zig</h1>
        <p><a href="../../models/google_gemini-2.5-flash-previewthinking.html">‚Üê Back to Gemini 2.5 Flash Thinking Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Gemini 2.5 Flash Thinking</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 32616</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 39917</p>
                <p><strong>Native Completion Tokens:</strong> 16734</p>
                <p><strong>Native Tokens Reasoning:</strong> 6276</p>
                <p><strong>Native Finish Reason:</strong> None</p>
                <p><strong>Runtime:</strong> N/As</p>
                <p><strong>Cost:</strong> $0.06455655</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/google_gemini-2.5-flash-previewthinking/ghostty_src_terminal_Parser.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/google_gemini-2.5-flash-previewthinking/ghostty_src_terminal_Parser.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/google_gemini-2.5-flash-previewthinking/ghostty_src_terminal_Parser.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div class="diff-header">--- ghostty_src_terminal_Parser.zig_expectedoutput.txt (expected)+++ ghostty_src_terminal_Parser.zig_extracted.txt (actual)@@ -190,6 +190,15 @@     }</div><div> };</div><div> </div><div class="diff-added">+/// Keeps track of the parameter sep used for CSI params. We allow colons</div><div class="diff-added">+/// to be used ONLY by the 'm' CSI action.</div><div class="diff-added">+pub const ParamSepState = enum(u8) {</div><div class="diff-added">+    none = 0,</div><div class="diff-added">+    semicolon = ';',</div><div class="diff-added">+    colon = ':',</div><div class="diff-added">+    mixed = 1,</div><div class="diff-added">+};</div><div class="diff-added">+</div><div> /// Maximum number of intermediate characters during parsing. This is</div><div> /// 4 because we also use the intermediates array for UTF8 decoding which</div><div> /// can be at most 4 bytes.</div><div class="diff-info">@@ -246,6 +255,24 @@ </div><div>     // After generating the actions, we set our next state.</div><div>     defer self.state = next_state;</div><div class="diff-added">+</div><div class="diff-added">+    // In debug mode, we log bad state transitions.</div><div class="diff-added">+    if (builtin.mode == .Debug) {</div><div class="diff-added">+        if (@intFromEnum(next_state) >= table[@enumToInt(State.ground)][@enumToInt(State.ground)].state) {</div><div class="diff-added">+             // We index the state table by the state ordinal. We intentionally remove State.anywhere</div><div class="diff-added">+             // as a real state in this enum. This means state ordinals won't line up perfectly.</div><div class="diff-added">+             // We check against the ground state's self-transition here which will always be a valid</div><div class="diff-added">+             // state transition.</div><div class="diff-added">+             // Note: This needs to be >= ground state ordinal because DSC states, for example, have</div><div class="diff-added">+             // large ordinals.</div><div class="diff-added">+        } else {</div><div class="diff-added">+            log.debug(</div><div class="diff-added">+                "state transition from '{}' -> '{}', likely binary input: {x}",</div><div class="diff-added">+                .{ self.state, next_state, c },</div><div class="diff-added">+            );</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div> </div><div>     // When going from one state to another, the actions take place in this order:</div><div>     //</div><div class="diff-info">@@ -313,6 +340,7 @@         .execute => Action{ .execute = c },</div><div>         .collect => collect: {</div><div>             self.collect(c);</div><div class="diff-added">+            // The client is expected to perform no action.</div><div>             break :collect null;</div><div>         },</div><div>         .param => param: {</div><div class="diff-info">@@ -333,6 +361,12 @@                 break :param null;</div><div>             }</div><div> </div><div class="diff-added">+            // Parameter value should be a digit.</div><div class="diff-added">+            if (c < '0' or c > '9') {</div><div class="diff-added">+                log.warn("parameter value expected digit, got {x}", .{c});</div><div class="diff-added">+                break :param null;</div><div class="diff-added">+            }</div><div class="diff-added">+</div><div>             // A numeric value. Add it to our accumulator.</div><div>             if (self.param_acc_idx > 0) {</div><div>                 self.param_acc *|= 10;</div><div class="diff-info">@@ -343,6 +377,7 @@             // we're out of bounds and we exit immediately.</div><div>             self.param_acc_idx, const overflow = @addWithOverflow(self.param_acc_idx, 1);</div><div>             if (overflow > 0) break :param null;</div><div class="diff-added">+</div><div> </div><div>             // The client is expected to perform no action.</div><div>             break :param null;</div><div class="diff-info">@@ -358,6 +393,8 @@             // Finalize parameters if we have one</div><div>             if (self.param_acc_idx > 0) {</div><div>                 self.params[self.params_idx] = self.param_acc;</div><div class="diff-added">+                // Assumes last byte wasn't ':'</div><div class="diff-added">+                // TODO: ensure last byte can't be ':'</div><div>                 self.params_idx += 1;</div><div>             }</div><div> </div><div class="diff-info">@@ -413,6 +450,7 @@         try testing.expect(a[0] == null);</div><div>         try testing.expect(a[1].? == .print);</div><div>         try testing.expect(a[2] == null);</div><div class="diff-added">+        try testing.expectEqual(@as(u21, 'a'), a[1].?.print);</div><div>     }</div><div> </div><div>     {</div><div class="diff-info">@@ -421,6 +459,7 @@         try testing.expect(a[0] == null);</div><div>         try testing.expect(a[1].? == .execute);</div><div>         try testing.expect(a[2] == null);</div><div class="diff-added">+        try testing.expectEqual(@as(u8, 0x19), a[1].?.execute);</div><div>     }</div><div> }</div><div> </div><div class="diff-info">@@ -458,6 +497,7 @@         const d = a[1].?.csi_dispatch;</div><div>         try testing.expect(d.final == 0x48);</div><div>         try testing.expect(d.params.len == 0);</div><div class="diff-added">+        try testing.expectEqual(d.params_sep.count(), 0);</div><div>     }</div><div> }</div><div> </div><div class="diff-info">@@ -468,7 +508,7 @@     _ = p.next(0x31); // 1</div><div>     _ = p.next(0x3B); // ;</div><div>     _ = p.next(0x34); // 4</div><div class="diff-removed">-</div><div class="diff-added">+    //</div><div>     {</div><div>         const a = p.next(0x48); // H</div><div>         try testing.expect(p.state == .ground);</div><div class="diff-info">@@ -481,6 +521,7 @@         try testing.expect(d.params.len == 2);</div><div>         try testing.expectEqual(@as(u16, 1), d.params[0]);</div><div>         try testing.expectEqual(@as(u16, 4), d.params[1]);</div><div class="diff-added">+        try testing.expectEqual(d.params_sep.count(), 0);</div><div>     }</div><div> }</div><div> </div><div class="diff-info">@@ -532,25 +573,6 @@     _ = p.next('[');</div><div>     {</div><div>         const a = p.next('H');</div><div class="diff-removed">-        try testing.expect(p.state == .ground);</div><div class="diff-removed">-        try testing.expect(a[0] == null);</div><div class="diff-removed">-        try testing.expect(a[1].? == .csi_dispatch);</div><div class="diff-removed">-        try testing.expect(a[2] == null);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "csi: SGR mixed colon and semicolon" {</div><div class="diff-removed">-    var p = init();</div><div class="diff-removed">-    _ = p.next(0x1B);</div><div class="diff-removed">-    for ("[38:5:1;48:5:0") |c| {</div><div class="diff-removed">-        const a = p.next(c);</div><div class="diff-removed">-        try testing.expect(a[0] == null);</div><div class="diff-removed">-        try testing.expect(a[1] == null);</div><div class="diff-removed">-        try testing.expect(a[2] == null);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const a = p.next('m');</div><div>         try testing.expect(p.state == .ground);</div><div>         try testing.expect(a[0] == null);</div><div>         try testing.expect(a[1].? == .csi_dispatch);</div><div class="diff-info">@@ -670,7 +692,6 @@         try testing.expect(a[2] == null);</div><div> </div><div>         const d = a[1].?.csi_dispatch;</div><div class="diff-removed">-        try testing.expect(d.final == 'm');</div><div>         try testing.expectEqual(14, d.params.len);</div><div>         try testing.expectEqual(@as(u16, 0), d.params[0]);</div><div>         try testing.expect(!d.params_sep.isSet(0));</div><div class="diff-info">@@ -798,6 +819,7 @@         try testing.expectEqual(@as(u16, '?'), d.intermediates[0]);</div><div>         try testing.expectEqual(@as(u16, '$'), d.intermediates[1]);</div><div>         try testing.expectEqual(@as(u16, 2026), d.params[0]);</div><div class="diff-added">+        try testing.expectEqual(d.params_sep.count(), 0);</div><div>     }</div><div> }</div><div> </div><div class="diff-info">@@ -824,6 +846,7 @@         try testing.expectEqual(@as(usize, 1), d.params.len);</div><div>         try testing.expectEqual(@as(u16, ' '), d.intermediates[0]);</div><div>         try testing.expectEqual(@as(u16, 3), d.params[0]);</div><div class="diff-added">+        try testing.expectEqual(d.params_sep.count(), 0);</div><div>     }</div><div> }</div><div> </div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    