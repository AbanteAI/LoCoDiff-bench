<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/font/face/coretext.zig - Gemini 2.5 Flash Thinking</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/font/face/coretext.zig</h1>
        <p><a href="../../models/google_gemini-2.5-flash-previewthinking.html">‚Üê Back to Gemini 2.5 Flash Thinking Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Gemini 2.5 Flash Thinking</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 78070</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 95357</p>
                <p><strong>Native Completion Tokens:</strong> 17422</p>
                <p><strong>Native Tokens Reasoning:</strong> 6273</p>
                <p><strong>Native Finish Reason:</strong> STOP</p>
                <p><strong>Cost:</strong> $0.07528055</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/google_gemini-2.5-flash-previewthinking/ghostty_src_font_face_coretext.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/google_gemini-2.5-flash-previewthinking/ghostty_src_font_face_coretext.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/google_gemini-2.5-flash-previewthinking/ghostty_src_font_face_coretext.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div class="diff-header">--- ghostty_src_font_face_coretext.zig_expectedoutput.txt (expected)+++ ghostty_src_font_face_coretext.zig_extracted.txt (actual)@@ -83,14 +83,14 @@     /// Initialize a face with a CTFont. This will take ownership over</div><div>     /// the CTFont. This does NOT copy or retain the CTFont.</div><div>     pub fn initFont(ct_font: *macos.text.Font, opts: font.face.Options) !Face {</div><div class="diff-removed">-        const traits = ct_font.getSymbolicTraits();</div><div class="diff-removed">-</div><div>         var hb_font = if (comptime harfbuzz_shaper) font: {</div><div>             var hb_font = try harfbuzz.coretext.createFont(ct_font);</div><div>             hb_font.setScale(opts.size.pixels(), opts.size.pixels());</div><div>             break :font hb_font;</div><div>         } else {};</div><div>         errdefer if (comptime harfbuzz_shaper) hb_font.destroy();</div><div class="diff-added">+</div><div class="diff-added">+        const traits = ct_font.getSymbolicTraits();</div><div> </div><div>         const color: ?ColorState = if (traits.color_glyphs)</div><div>             try ColorState.init(ct_font)</div><div class="diff-info">@@ -160,8 +160,8 @@         self.* = undefined;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Return a new face that is the same as this but has a transformation</div><div class="diff-removed">-    /// matrix applied to italicize it.</div><div class="diff-added">+    /// Return a new face that is the same as this but applies a synthetic</div><div class="diff-added">+    /// italic effect to it.</div><div>     pub fn syntheticItalic(self: *const Face, opts: font.face.Options) !Face {</div><div>         const ct_font = try self.font.copyWithAttributes(0.0, &italic_skew, null);</div><div>         errdefer ct_font.release();</div><div class="diff-info">@@ -280,6 +280,12 @@         glyph_index: u32,</div><div>         opts: font.face.RenderOptions,</div><div>     ) !font.Glyph {</div><div class="diff-added">+        // We reserve a region that's 1px wider and taller than we need</div><div class="diff-added">+        // in order to create a 1px separation between adjacent glyphs</div><div class="diff-added">+        // to prevent interpolation with adjacent glyphs while sampling</div><div class="diff-added">+        // from the atlas.</div><div class="diff-added">+        const padding = 1;</div><div class="diff-added">+</div><div>         var glyphs = [_]macos.graphics.Glyph{@intCast(glyph_index)};</div><div> </div><div>         // Get the bounding rect for rendering this glyph.</div><div class="diff-info">@@ -356,9 +362,10 @@ </div><div>         // This is just a safety check.</div><div>         if (atlas.format.depth() != color.depth) {</div><div class="diff-removed">-            log.warn("font atlas color depth doesn't equal font color depth atlas={} font={}", .{</div><div class="diff-added">+            log.warn("font atlas color depth doesn't equal font color depth atlas={} font={} expected={}", .{</div><div>                 atlas.format.depth(),</div><div>                 color.depth,</div><div class="diff-added">+                atlas.format.depth(),</div><div>             });</div><div>             return error.InvalidAtlasFormat;</div><div>         }</div><div class="diff-info">@@ -572,6 +579,7 @@             };</div><div>         };</div><div> </div><div class="diff-added">+</div><div>         const units_per_em: f64 = @floatFromInt(head.unitsPerEm);</div><div>         const px_per_em: f64 = ct_font.getSize();</div><div>         const px_per_unit: f64 = px_per_em / units_per_em;</div><div class="diff-info">@@ -633,22 +641,32 @@             };</div><div>         };</div><div> </div><div class="diff-removed">-        // Some fonts have degenerate 'post' tables where the underline</div><div class="diff-removed">-        // thickness (and often position) are 0. We consider them null</div><div class="diff-removed">-        // if this is the case and use our own fallbacks when we calculate.</div><div class="diff-removed">-        const has_broken_underline = post.underlineThickness == 0;</div><div class="diff-removed">-</div><div class="diff-removed">-        // If the underline position isn't 0 then we do use it,</div><div class="diff-removed">-        // even if the thickness is't properly specified.</div><div class="diff-removed">-        const underline_position: ?f64 = if (has_broken_underline and post.underlinePosition == 0)</div><div class="diff-removed">-            null</div><div class="diff-removed">-        else</div><div class="diff-removed">-            @as(f64, @floatFromInt(post.underlinePosition)) * px_per_unit;</div><div class="diff-removed">-</div><div class="diff-removed">-        const underline_thickness = if (has_broken_underline)</div><div class="diff-removed">-            null</div><div class="diff-removed">-        else</div><div class="diff-removed">-            @as(f64, @floatFromInt(post.underlineThickness)) * px_per_unit;</div><div class="diff-added">+        const underline_position: ?f64 = underline_position: {</div><div class="diff-added">+            const post = post orelse break :underline_position null;</div><div class="diff-added">+</div><div class="diff-added">+            // Some fonts have degenerate 'post' tables where the underline</div><div class="diff-added">+            // thickness (and often position) are 0. We consider them null</div><div class="diff-added">+            // if this is the case and use our own fallbacks when we calculate.</div><div class="diff-added">+            const has_broken_underline = post.underlineThickness == 0;</div><div class="diff-added">+</div><div class="diff-added">+            // If the underline position isn't 0 then we do use it,</div><div class="diff-added">+            // even if the thickness is't properly specified.</div><div class="diff-added">+            if (has_broken_underline and post.underlinePosition == 0)</div><div class="diff-added">+                break :underline_position null;</div><div class="diff-added">+            else</div><div class="diff-added">+                break :underline_position @as(f64, @floatFromInt(post.underlinePosition)) * px_per_unit;</div><div class="diff-added">+        };</div><div class="diff-added">+</div><div class="diff-added">+        const underline_thickness: ?f64 = underline_thickness: {</div><div class="diff-added">+            const post = post orelse break :underline_thickness null;</div><div class="diff-added">+</div><div class="diff-added">+            const has_broken_underline = post.underlineThickness == 0;</div><div class="diff-added">+</div><div class="diff-added">+            if (has_broken_underline)</div><div class="diff-added">+                break :underline_thickness null;</div><div class="diff-added">+            else</div><div class="diff-added">+                break :underline_thickness @as(f64, @floatFromInt(post.underlineThickness)) * px_per_unit;</div><div class="diff-added">+        };</div><div> </div><div>         // Similar logic to the underline above.</div><div>         const strikethrough_position, const strikethrough_thickness = st: {</div><div class="diff-info">@@ -689,6 +707,7 @@                     ct_font.getXHeight(),</div><div>             };</div><div>         };</div><div class="diff-added">+</div><div> </div><div>         // Cell width is calculated by calculating the widest width of the</div><div>         // visible ASCII characters. Usually 'M' is widest but we just take</div><div class="diff-info">@@ -724,7 +743,7 @@             break :cell_width max;</div><div>         };</div><div> </div><div class="diff-removed">-        return .{</div><div class="diff-added">+        return font.Metrics.FaceMetrics.calc(.{</div><div>             .cell_width = cell_width,</div><div>             .ascent = ascent,</div><div>             .descent = descent,</div><div class="diff-info">@@ -735,7 +754,7 @@             .strikethrough_thickness = strikethrough_thickness,</div><div>             .cap_height = cap_height,</div><div>             .ex_height = ex_height,</div><div class="diff-removed">-        };</div><div class="diff-added">+        });</div><div>     }</div><div> </div><div>     /// Copy the font table data for the given tag.</div><div class="diff-info">@@ -888,7 +907,7 @@ </div><div> test "emoji" {</div><div>     const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-added">+    const alloc = testing.allocator;</div><div>     const name = try macos.foundation.String.createWithBytes("Apple Color Emoji", .utf8, false);</div><div>     defer name.release();</div><div>     const desc = try macos.text.FontDescriptor.createWithNameAndSize(name, 12);</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    