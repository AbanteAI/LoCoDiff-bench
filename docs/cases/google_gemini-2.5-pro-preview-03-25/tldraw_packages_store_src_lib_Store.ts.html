<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/store/src/lib/Store.ts - Gemini 2.5 Pro (03-25)</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/store/src/lib/Store.ts</h1>
        <p><a href="../../models/google_gemini-2.5-pro-preview-03-25.html">‚Üê Back to Gemini 2.5 Pro (03-25) Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> Gemini 2.5 Pro (03-25)</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 51786</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 61758</p>
                <p><strong>Native Completion Tokens:</strong> 12394</p>
                <p><strong>Native Tokens Reasoning:</strong> 4253</p>
                <p><strong>Native Finish Reason:</strong> STOP</p>
                <p><strong>Runtime:</strong> N/As</p>
                <p><strong>Cost:</strong> $0.2011375</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/google_gemini-2.5-pro-preview-03-25/tldraw_packages_store_src_lib_Store.ts/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/google_gemini-2.5-pro-preview-03-25/tldraw_packages_store_src_lib_Store.ts/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/google_gemini-2.5-pro-preview-03-25/tldraw_packages_store_src_lib_Store.ts/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div class="diff-header">--- tldraw_packages_store_src_lib_Store.ts_expectedoutput.txt (expected)+++ tldraw_packages_store_src_lib_Store.ts_extracted.txt (actual)@@ -76,7 +76,7 @@ }</div><div> </div><div> /**</div><div class="diff-removed">- * A serialized snapshot of the record store's values.</div><div class="diff-added">+ * A serialized snapshot of the store's values.</div><div>  *</div><div>  * @public</div><div>  */</div><div class="diff-info">@@ -280,32 +280,6 @@ 		}</div><div> 	}</div><div> </div><div class="diff-removed">-	dispose() {</div><div class="diff-removed">-		this.cancelHistoryReactor()</div><div class="diff-removed">-	}</div><div class="diff-removed">-</div><div class="diff-removed">-	/**</div><div class="diff-removed">-	 * Filters out non-document changes from a diff. Returns null if there are no changes left.</div><div class="diff-removed">-	 * @param change - the records diff</div><div class="diff-removed">-	 * @param scope - the records scope</div><div class="diff-removed">-	 * @returns</div><div class="diff-removed">-	 */</div><div class="diff-removed">-	filterChangesByScope(change: RecordsDiff<R>, scope: RecordScope) {</div><div class="diff-removed">-		const result = {</div><div class="diff-removed">-			added: filterEntries(change.added, (_, r) => this.scopedTypes[scope].has(r.typeName)),</div><div class="diff-removed">-			updated: filterEntries(change.updated, (_, r) => this.scopedTypes[scope].has(r[1].typeName)),</div><div class="diff-removed">-			removed: filterEntries(change.removed, (_, r) => this.scopedTypes[scope].has(r.typeName)),</div><div class="diff-removed">-		}</div><div class="diff-removed">-		if (</div><div class="diff-removed">-			Object.keys(result.added).length === 0 &&</div><div class="diff-removed">-			Object.keys(result.updated).length === 0 &&</div><div class="diff-removed">-			Object.keys(result.removed).length === 0</div><div class="diff-removed">-		) {</div><div class="diff-removed">-			return null</div><div class="diff-removed">-		}</div><div class="diff-removed">-		return result</div><div class="diff-removed">-	}</div><div class="diff-removed">-</div><div> 	/**</div><div> 	 * Update the history with a diff of changes.</div><div> 	 *</div><div class="diff-info">@@ -322,6 +296,32 @@ 		this.history.set(this.history.get() + 1, changes)</div><div> 	}</div><div> </div><div class="diff-added">+	dispose() {</div><div class="diff-added">+		this.cancelHistoryReactor()</div><div class="diff-added">+	}</div><div class="diff-added">+</div><div class="diff-added">+	/**</div><div class="diff-added">+	 * Filters out non-document changes from a diff. Returns null if there are no changes left.</div><div class="diff-added">+	 * @param change - the records diff</div><div class="diff-added">+	 * @param scope - the records scope</div><div class="diff-added">+	 * @returns</div><div class="diff-added">+	 */</div><div class="diff-added">+	filterChangesByScope(change: RecordsDiff<R>, scope: RecordScope) {</div><div class="diff-added">+		const result = {</div><div class="diff-added">+			added: filterEntries(change.added, (_, r) => this.scopedTypes[scope].has(r.typeName)),</div><div class="diff-added">+			updated: filterEntries(change.updated, (_, r) => this.scopedTypes[scope].has(r[1].typeName)),</div><div class="diff-added">+			removed: filterEntries(change.removed, (_, r) => this.scopedTypes[scope].has(r.typeName)),</div><div class="diff-added">+		}</div><div class="diff-added">+		if (</div><div class="diff-added">+			Object.keys(result.added).length === 0 &&</div><div class="diff-added">+			Object.keys(result.updated).length === 0 &&</div><div class="diff-added">+			Object.keys(result.removed).length === 0</div><div class="diff-added">+		) {</div><div class="diff-added">+			return null</div><div class="diff-added">+		}</div><div class="diff-added">+		return result</div><div class="diff-added">+	}</div><div class="diff-added">+</div><div> 	validate(phase: 'initialize' | 'createRecord' | 'updateRecord' | 'tests') {</div><div> 		this.allRecords().forEach((record) => this.schema.validateRecord(this, record, phase, null))</div><div> 	}</div><div class="diff-info">@@ -337,27 +337,21 @@ 		this.atomic(() => {</div><div> 			const updates: Record<IdOf<UnknownRecord>, [from: R, to: R]> = {}</div><div> 			const additions: Record<IdOf<UnknownRecord>, R> = {}</div><div class="diff-removed">-</div><div> 			// Iterate through all records, creating, updating or removing as needed</div><div> 			let record: R</div><div class="diff-removed">-</div><div> 			// There's a chance that, despite having records, all of the values are</div><div> 			// identical to what they were before; and so we'd end up with an "empty"</div><div> 			// history entry. Let's keep track of whether we've actually made any</div><div> 			// changes (e.g. additions, deletions, or updates that produce a new value).</div><div> 			let didChange = false</div><div class="diff-removed">-</div><div> 			const source = this.isMergingRemoteChanges ? 'remote' : 'user'</div><div class="diff-removed">-</div><div> 			for (let i = 0, n = records.length; i < n; i++) {</div><div> 				record = records[i]</div><div class="diff-removed">-</div><div> 				const initialValue = this.records.__unsafe__getWithoutCapture(record.id)</div><div> 				// If we already have an atom for this record, update its value.</div><div> 				if (initialValue) {</div><div> 					// If we have a beforeUpdate callback, run it against the initial and next records</div><div> 					record = this.sideEffects.handleBeforeChange(initialValue, record, source)</div><div class="diff-removed">-</div><div> 					// Validate the record</div><div> 					const validated = this.schema.validateRecord(</div><div> 						this,</div><div class="diff-info">@@ -365,22 +359,16 @@ 						phaseOverride ?? 'updateRecord',</div><div> 						initialValue</div><div> 					)</div><div class="diff-removed">-</div><div> 					if (validated === initialValue) continue</div><div class="diff-removed">-</div><div> 					record = devFreeze(record)</div><div> 					this.records.set(record.id, record)</div><div class="diff-removed">-</div><div> 					didChange = true</div><div> 					updates[record.id] = [initialValue, record]</div><div> 					this.addDiffForAfterEvent(initialValue, record)</div><div> 				} else {</div><div> 					record = this.sideEffects.handleBeforeCreate(record, source)</div><div class="diff-removed">-</div><div> 					didChange = true</div><div class="diff-removed">-</div><div> 					// If we don't have an atom, create one.</div><div class="diff-removed">-</div><div> 					// Validate the record</div><div> 					record = this.schema.validateRecord(</div><div> 						this,</div><div class="diff-info">@@ -388,18 +376,14 @@ 						phaseOverride ?? 'createRecord',</div><div> 						null</div><div> 					)</div><div class="diff-removed">-</div><div> 					// freeze it</div><div> 					record = devFreeze(record)</div><div class="diff-removed">-</div><div> 					// Mark the change as a new addition.</div><div> 					additions[record.id] = record</div><div> 					this.addDiffForAfterEvent(null, record)</div><div class="diff-removed">-</div><div> 					this.records.set(record.id, record)</div><div> 				}</div><div> 			}</div><div class="diff-removed">-</div><div> 			// If we did change, update the history</div><div> 			if (!didChange) return</div><div> 			this.updateHistory({</div><div class="diff-info">@@ -420,27 +404,22 @@ 		this.atomic(() => {</div><div> 			const toDelete = new Set<IdOf<R>>(ids)</div><div> 			const source = this.isMergingRemoteChanges ? 'remote' : 'user'</div><div class="diff-removed">-</div><div> 			if (this.sideEffects.isEnabled()) {</div><div> 				for (const id of ids) {</div><div> 					const record = this.records.__unsafe__getWithoutCapture(id)</div><div> 					if (!record) continue</div><div class="diff-removed">-</div><div> 					if (this.sideEffects.handleBeforeDelete(record, source) === false) {</div><div> 						toDelete.delete(id)</div><div> 					}</div><div> 				}</div><div> 			}</div><div class="diff-removed">-</div><div> 			const actuallyDeleted = this.records.deleteMany(toDelete)</div><div> 			if (actuallyDeleted.length === 0) return</div><div class="diff-removed">-</div><div> 			const removed = {} as RecordsDiff<R>['removed']</div><div> 			for (const [id, record] of actuallyDeleted) {</div><div> 				removed[id] = record</div><div> 				this.addDiffForAfterEvent(record, null)</div><div> 			}</div><div class="diff-removed">-</div><div> 			// Update the history with the removed records.</div><div> 			this.updateHistory({ added: {}, updated: {}, removed } as RecordsDiff<R>)</div><div> 		})</div><div class="diff-info">@@ -515,7 +494,7 @@ 	 * Migrate a serialized snapshot of the store and its schema.</div><div> 	 *</div><div> 	 * ```ts</div><div class="diff-removed">-	 * const snapshot = store.getSnapshot()</div><div class="diff-added">+	 * const snapshot = store.getStoreSnapshot()</div><div> 	 * store.migrateSnapshot(snapshot)</div><div> 	 * ```</div><div> 	 *</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    