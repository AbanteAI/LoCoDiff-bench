<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/terminal/sgr.zig - o4-mini-medium</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/terminal/sgr.zig</h1>
        <p><a href="../../models/openai_o4-mini.html">‚Üê Back to o4-mini-medium Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> o4-mini-medium</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 30022</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 30020</p>
                <p><strong>Native Completion Tokens:</strong> 8182</p>
                <p><strong>Native Tokens Reasoning:</strong> 2560</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.00345114</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_o4-mini/ghostty_src_terminal_sgr.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_o4-mini/ghostty_src_terminal_sgr.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_o4-mini/ghostty_src_terminal_sgr.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index d82d3f38..9d4a9a97 100644</div><div class="diff-header">--- a/ghostty_src_terminal_sgr.zig_expectedoutput.txt (expected):tmp/tmpyjsvdocp_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_terminal_sgr.zig_extracted.txt (actual):tmp/tmpwoij_jzi_actual.txt	</div><div class="diff-info">@@ -81,7 +81,6 @@ pub const Attribute = union(enum) {</div><div> </div><div>     /// Set background color as 256-color palette.</div><div>     @"256_bg": u8,</div><div class="diff-removed">-</div><div>     /// Set foreground color as 256-color palette.</div><div>     @"256_fg": u8,</div><div> </div><div class="diff-info">@@ -111,7 +110,6 @@ pub const Parser = struct {</div><div>                 self.idx += 1;</div><div>                 return .unset;</div><div>             }</div><div class="diff-removed">-</div><div>             return null;</div><div>         }</div><div> </div><div class="diff-info">@@ -132,22 +130,18 @@ pub const Parser = struct {</div><div>                 const start = self.idx;</div><div>                 while (self.params_sep.isSet(self.idx)) self.idx += 1;</div><div>                 self.idx += 1;</div><div class="diff-removed">-                return .{ .unknown = .{</div><div class="diff-added">+                return .unknown = .{</div><div>                     .full = self.params,</div><div>                     .partial = slice[0 .. self.idx - start + 1],</div><div class="diff-removed">-                } };</div><div class="diff-added">+                };</div><div>             },</div><div>         };</div><div> </div><div>         switch (slice[0]) {</div><div>             0 => return .unset,</div><div class="diff-removed">-</div><div>             1 => return .bold,</div><div class="diff-removed">-</div><div>             2 => return .faint,</div><div class="diff-removed">-</div><div>             3 => return .italic,</div><div class="diff-removed">-</div><div>             4 => underline: {</div><div>                 if (colon) {</div><div>                     assert(slice.len >= 2);</div><div class="diff-info">@@ -155,7 +149,6 @@ pub const Parser = struct {</div><div>                         self.consumeUnknownColon();</div><div>                         break :underline;</div><div>                     }</div><div class="diff-removed">-</div><div>                     self.idx += 1;</div><div>                     switch (slice[1]) {</div><div>                         0 => return .reset_underline,</div><div class="diff-info">@@ -164,129 +157,61 @@ pub const Parser = struct {</div><div>                         3 => return .{ .underline = .curly },</div><div>                         4 => return .{ .underline = .dotted },</div><div>                         5 => return .{ .underline = .dashed },</div><div class="diff-removed">-</div><div class="diff-removed">-                        // For unknown underline styles, just render</div><div class="diff-removed">-                        // a single underline.</div><div>                         else => return .{ .underline = .single },</div><div>                     }</div><div>                 }</div><div class="diff-removed">-</div><div>                 return .{ .underline = .single };</div><div>             },</div><div class="diff-removed">-</div><div>             5 => return .blink,</div><div class="diff-removed">-</div><div>             6 => return .blink,</div><div class="diff-removed">-</div><div>             7 => return .inverse,</div><div class="diff-removed">-</div><div>             8 => return .invisible,</div><div class="diff-removed">-</div><div>             9 => return .strikethrough,</div><div class="diff-removed">-</div><div>             21 => return .{ .underline = .double },</div><div class="diff-removed">-</div><div>             22 => return .reset_bold,</div><div class="diff-removed">-</div><div>             23 => return .reset_italic,</div><div class="diff-removed">-</div><div>             24 => return .reset_underline,</div><div class="diff-removed">-</div><div>             25 => return .reset_blink,</div><div class="diff-removed">-</div><div>             27 => return .reset_inverse,</div><div class="diff-removed">-</div><div>             28 => return .reset_invisible,</div><div class="diff-removed">-</div><div>             29 => return .reset_strikethrough,</div><div class="diff-removed">-</div><div class="diff-removed">-            30...37 => return .{</div><div class="diff-removed">-                .@"8_fg" = @enumFromInt(slice[0] - 30),</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-added">+            30...37 => return .{ .@"8_fg" = @enumFromInt(slice[0] - 30) },</div><div>             38 => if (slice.len >= 2) switch (slice[1]) {</div><div class="diff-removed">-                // `2` indicates direct-color (r, g, b).</div><div class="diff-removed">-                // We need at least 3 more params for this to make sense.</div><div class="diff-removed">-                2 => if (self.parseDirectColor(</div><div class="diff-removed">-                    .direct_color_fg,</div><div class="diff-removed">-                    slice,</div><div class="diff-removed">-                    colon,</div><div class="diff-removed">-                )) |v| return v,</div><div class="diff-removed">-</div><div class="diff-removed">-                // `5` indicates indexed color.</div><div class="diff-added">+                2 => if (self.parseDirectColor(.direct_color_fg, slice, colon)) |v| return v,</div><div>                 5 => if (slice.len >= 3) {</div><div>                     self.idx += 2;</div><div class="diff-removed">-                    return .{</div><div class="diff-removed">-                        .@"256_fg" = @truncate(slice[2]),</div><div class="diff-removed">-                    };</div><div class="diff-added">+                    return .{ .@"256_fg" = @truncate(slice[2]) };</div><div>                 },</div><div>                 else => {},</div><div>             },</div><div class="diff-removed">-</div><div>             39 => return .reset_fg,</div><div class="diff-removed">-</div><div class="diff-removed">-            40...47 => return .{</div><div class="diff-removed">-                .@"8_bg" = @enumFromInt(slice[0] - 40),</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-added">+            40...47 => return .{ .@"8_bg" = @enumFromInt(slice[0] - 40) },</div><div>             48 => if (slice.len >= 2) switch (slice[1]) {</div><div class="diff-removed">-                // `2` indicates direct-color (r, g, b).</div><div class="diff-removed">-                // We need at least 3 more params for this to make sense.</div><div class="diff-removed">-                2 => if (self.parseDirectColor(</div><div class="diff-removed">-                    .direct_color_bg,</div><div class="diff-removed">-                    slice,</div><div class="diff-removed">-                    colon,</div><div class="diff-removed">-                )) |v| return v,</div><div class="diff-removed">-</div><div class="diff-removed">-                // `5` indicates indexed color.</div><div class="diff-added">+                2 => if (self.parseDirectColor(.direct_color_bg, slice, colon)) |v| return v,</div><div>                 5 => if (slice.len >= 3) {</div><div>                     self.idx += 2;</div><div class="diff-removed">-                    return .{</div><div class="diff-removed">-                        .@"256_bg" = @truncate(slice[2]),</div><div class="diff-removed">-                    };</div><div class="diff-added">+                    return .{ .@"256_bg" = @truncate(slice[2]) };</div><div>                 },</div><div>                 else => {},</div><div>             },</div><div class="diff-removed">-</div><div>             49 => return .reset_bg,</div><div class="diff-removed">-</div><div>             53 => return .overline,</div><div>             55 => return .reset_overline,</div><div class="diff-removed">-</div><div>             58 => if (slice.len >= 2) switch (slice[1]) {</div><div class="diff-removed">-                // `2` indicates direct-color (r, g, b).</div><div class="diff-removed">-                // We need at least 3 more params for this to make sense.</div><div class="diff-removed">-                2 => if (self.parseDirectColor(</div><div class="diff-removed">-                    .underline_color,</div><div class="diff-removed">-                    slice,</div><div class="diff-removed">-                    colon,</div><div class="diff-removed">-                )) |v| return v,</div><div class="diff-removed">-</div><div class="diff-removed">-                // `5` indicates indexed color.</div><div class="diff-added">+                2 => if (self.parseDirectColor(.underline_color, slice, colon)) |v| return v,</div><div>                 5 => if (slice.len >= 3) {</div><div>                     self.idx += 2;</div><div class="diff-removed">-                    return .{</div><div class="diff-removed">-                        .@"256_underline_color" = @truncate(slice[2]),</div><div class="diff-removed">-                    };</div><div class="diff-added">+                    return .{ .@"256_underline_color" = @truncate(slice[2]) };</div><div>                 },</div><div>                 else => {},</div><div>             },</div><div class="diff-removed">-</div><div>             59 => return .reset_underline_color,</div><div class="diff-removed">-</div><div class="diff-removed">-            90...97 => return .{</div><div class="diff-removed">-                // 82 instead of 90 to offset to "bright" colors</div><div class="diff-removed">-                .@"8_bright_fg" = @enumFromInt(slice[0] - 82),</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-removed">-            100...107 => return .{</div><div class="diff-removed">-                .@"8_bright_bg" = @enumFromInt(slice[0] - 92),</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-added">+            90...97 => return .{ .@"8_bright_fg" = @enumFromInt(slice[0] - 82) },</div><div class="diff-added">+            100...107 => return .{ .@"8_bright_bg" = @enumFromInt(slice[0] - 92) },</div><div>             else => {},</div><div>         }</div><div> </div><div class="diff-removed">-        return .{ .unknown = .{ .full = self.params, .partial = slice } };</div><div class="diff-added">+        return .unknown = .{ .full = self.params, .partial = slice };</div><div>     }</div><div> </div><div>     fn parseDirectColor(</div><div class="diff-info">@@ -297,15 +222,8 @@ pub const Parser = struct {</div><div>     ) ?Attribute {</div><div>         // Any direct color style must have at least 5 values.</div><div>         if (slice.len < 5) return null;</div><div class="diff-removed">-</div><div class="diff-removed">-        // Only used for direct color sets (38, 48, 58) and subparam 2.</div><div>         assert(slice[1] == 2);</div><div> </div><div class="diff-removed">-        // Note: We use @truncate because the value should be 0 to 255. If</div><div class="diff-removed">-        // it isn't, the behavior is undefined so we just... truncate it.</div><div class="diff-removed">-</div><div class="diff-removed">-        // If we don't have a colon, then we expect exactly 3 semicolon</div><div class="diff-removed">-        // separated values.</div><div>         if (!colon) {</div><div>             self.idx += 4;</div><div>             return @unionInit(Attribute, @tagName(tag), .{</div><div class="diff-info">@@ -315,8 +233,6 @@ pub const Parser = struct {</div><div>             });</div><div>         }</div><div> </div><div class="diff-removed">-        // We have a colon, we might have either 5 or 6 values depending</div><div class="diff-removed">-        // on if the colorspace is present.</div><div>         const count = self.countColon();</div><div>         switch (count) {</div><div>             3 => {</div><div class="diff-info">@@ -327,7 +243,6 @@ pub const Parser = struct {</div><div>                     .b = @truncate(slice[4]),</div><div>                 });</div><div>             },</div><div class="diff-removed">-</div><div>             4 => {</div><div>                 self.idx += 5;</div><div>                 return @unionInit(Attribute, @tagName(tag), .{</div><div class="diff-info">@@ -336,7 +251,6 @@ pub const Parser = struct {</div><div>                     .b = @truncate(slice[5]),</div><div>                 });</div><div>             },</div><div class="diff-removed">-</div><div>             else => {</div><div>                 self.consumeUnknownColon();</div><div>                 return null;</div><div class="diff-info">@@ -344,11 +258,7 @@ pub const Parser = struct {</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    /// Returns true if the present position has a colon separator.</div><div class="diff-removed">-    /// This always returns false for the last value since it has no</div><div class="diff-removed">-    /// separator.</div><div>     fn isColon(self: *Parser) bool {</div><div class="diff-removed">-        // The `- 1` here is because the last value has no separator.</div><div>         if (self.idx >= self.params.len - 1) return false;</div><div>         return self.params_sep.isSet(self.idx);</div><div>     }</div><div class="diff-info">@@ -362,8 +272,6 @@ pub const Parser = struct {</div><div>         return count;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Consumes all the remaining parameters separated by a colon and</div><div class="diff-removed">-    /// returns an unknown attribute.</div><div>     fn consumeUnknownColon(self: *Parser) void {</div><div>         const count = self.countColon();</div><div>         self.idx += count + 1;</div><div class="diff-info">@@ -383,34 +291,6 @@ fn testParseColon(params: []const u16) Attribute {</div><div> test "sgr: Parser" {</div><div>     try testing.expect(testParse(&[_]u16{}) == .unset);</div><div>     try testing.expect(testParse(&[_]u16{0}) == .unset);</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParse(&[_]u16{ 38, 2, 40, 44, 52 });</div><div class="diff-removed">-        try testing.expect(v == .direct_color_fg);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 40), v.direct_color_fg.r);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 44), v.direct_color_fg.g);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 52), v.direct_color_fg.b);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    try testing.expect(testParse(&[_]u16{ 38, 2, 44, 52 }) == .unknown);</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParse(&[_]u16{ 48, 2, 40, 44, 52 });</div><div class="diff-removed">-        try testing.expect(v == .direct_color_bg);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 40), v.direct_color_bg.r);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 44), v.direct_color_bg.g);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 52), v.direct_color_bg.b);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    try testing.expect(testParse(&[_]u16{ 48, 2, 44, 52 }) == .unknown);</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "sgr: Parser multiple" {</div><div class="diff-removed">-    var p: Parser = .{ .params = &[_]u16{ 0, 38, 2, 40, 44, 52 } };</div><div class="diff-removed">-    try testing.expect(p.next().? == .unset);</div><div class="diff-removed">-    try testing.expect(p.next().? == .direct_color_fg);</div><div class="diff-removed">-    try testing.expect(p.next() == null);</div><div class="diff-removed">-    try testing.expect(p.next() == null);</div><div> }</div><div> </div><div> test "sgr: unsupported with colon" {</div><div class="diff-info">@@ -447,7 +327,6 @@ test "sgr: bold" {</div><div>         const v = testParse(&[_]u16{1});</div><div>         try testing.expect(v == .bold);</div><div>     }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = testParse(&[_]u16{22});</div><div>         try testing.expect(v == .reset_bold);</div><div class="diff-info">@@ -459,7 +338,6 @@ test "sgr: italic" {</div><div>         const v = testParse(&[_]u16{3});</div><div>         try testing.expect(v == .italic);</div><div>     }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = testParse(&[_]u16{23});</div><div>         try testing.expect(v == .reset_italic);</div><div class="diff-info">@@ -470,93 +348,19 @@ test "sgr: underline" {</div><div>     {</div><div>         const v = testParse(&[_]u16{4});</div><div>         try testing.expect(v == .underline);</div><div class="diff-added">+        try testing.expect(v.underline == .single);</div><div>     }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = testParse(&[_]u16{24});</div><div>         try testing.expect(v == .reset_underline);</div><div>     }</div><div> }</div><div> </div><div class="diff-removed">-test "sgr: underline styles" {</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParseColon(&[_]u16{ 4, 2 });</div><div class="diff-removed">-        try testing.expect(v == .underline);</div><div class="diff-removed">-        try testing.expect(v.underline == .double);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParseColon(&[_]u16{ 4, 0 });</div><div class="diff-removed">-        try testing.expect(v == .reset_underline);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParseColon(&[_]u16{ 4, 1 });</div><div class="diff-removed">-        try testing.expect(v == .underline);</div><div class="diff-removed">-        try testing.expect(v.underline == .single);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParseColon(&[_]u16{ 4, 3 });</div><div class="diff-removed">-        try testing.expect(v == .underline);</div><div class="diff-removed">-        try testing.expect(v.underline == .curly);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParseColon(&[_]u16{ 4, 4 });</div><div class="diff-removed">-        try testing.expect(v == .underline);</div><div class="diff-removed">-        try testing.expect(v.underline == .dotted);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParseColon(&[_]u16{ 4, 5 });</div><div class="diff-removed">-        try testing.expect(v == .underline);</div><div class="diff-removed">-        try testing.expect(v.underline == .dashed);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "sgr: underline style with more" {</div><div class="diff-removed">-    var p: Parser = .{</div><div class="diff-removed">-        .params = &[_]u16{ 4, 2, 1 },</div><div class="diff-removed">-        .params_sep = sep: {</div><div class="diff-removed">-            var list = SepList.initEmpty();</div><div class="diff-removed">-            list.set(0);</div><div class="diff-removed">-            break :sep list;</div><div class="diff-removed">-        },</div><div class="diff-removed">-    };</div><div class="diff-removed">-</div><div class="diff-removed">-    try testing.expect(p.next().? == .underline);</div><div class="diff-removed">-    try testing.expect(p.next().? == .bold);</div><div class="diff-removed">-    try testing.expect(p.next() == null);</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "sgr: underline style with too many colons" {</div><div class="diff-removed">-    var p: Parser = .{</div><div class="diff-removed">-        .params = &[_]u16{ 4, 2, 3, 1 },</div><div class="diff-removed">-        .params_sep = sep: {</div><div class="diff-removed">-            var list = SepList.initEmpty();</div><div class="diff-removed">-            list.set(0);</div><div class="diff-removed">-            list.set(1);</div><div class="diff-removed">-            break :sep list;</div><div class="diff-removed">-        },</div><div class="diff-removed">-    };</div><div class="diff-removed">-</div><div class="diff-removed">-    try testing.expect(p.next().? == .unknown);</div><div class="diff-removed">-    try testing.expect(p.next().? == .bold);</div><div class="diff-removed">-    try testing.expect(p.next() == null);</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div> test "sgr: blink" {</div><div>     {</div><div>         const v = testParse(&[_]u16{5});</div><div>         try testing.expect(v == .blink);</div><div>     }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParse(&[_]u16{6});</div><div class="diff-removed">-        try testing.expect(v == .blink);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = testParse(&[_]u16{25});</div><div>         try testing.expect(v == .reset_blink);</div><div class="diff-info">@@ -568,25 +372,12 @@ test "sgr: inverse" {</div><div>         const v = testParse(&[_]u16{7});</div><div>         try testing.expect(v == .inverse);</div><div>     }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = testParse(&[_]u16{27});</div><div>         try testing.expect(v == .reset_inverse);</div><div>     }</div><div> }</div><div> </div><div class="diff-removed">-test "sgr: strikethrough" {</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParse(&[_]u16{9});</div><div class="diff-removed">-        try testing.expect(v == .strikethrough);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = testParse(&[_]u16{29});</div><div class="diff-removed">-        try testing.expect(v == .reset_strikethrough);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div> test "sgr: 8 color" {</div><div>     var p: Parser = .{ .params = &[_]u16{ 31, 43, 90, 103 } };</div><div> </div><div class="diff-info">@@ -595,19 +386,16 @@ test "sgr: 8 color" {</div><div>         try testing.expect(v == .@"8_fg");</div><div>         try testing.expect(v.@"8_fg" == .red);</div><div>     }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = p.next().?;</div><div>         try testing.expect(v == .@"8_bg");</div><div>         try testing.expect(v.@"8_bg" == .yellow);</div><div>     }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = p.next().?;</div><div>         try testing.expect(v == .@"8_bright_fg");</div><div>         try testing.expect(v.@"8_bright_fg" == .bright_black);</div><div>     }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = p.next().?;</div><div>         try testing.expect(v == .@"8_bright_bg");</div><div class="diff-info">@@ -622,12 +410,6 @@ test "sgr: 256 color" {</div><div>     try testing.expect(p.next() == null);</div><div> }</div><div> </div><div class="diff-removed">-test "sgr: 256 color underline" {</div><div class="diff-removed">-    var p: Parser = .{ .params = &[_]u16{ 58, 5, 9 } };</div><div class="diff-removed">-    try testing.expect(p.next().? == .@"256_underline_color");</div><div class="diff-removed">-    try testing.expect(p.next() == null);</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div> test "sgr: 24-bit bg color" {</div><div>     {</div><div>         const v = testParseColon(&[_]u16{ 48, 2, 1, 2, 3 });</div><div class="diff-info">@@ -646,7 +428,6 @@ test "sgr: underline color" {</div><div>         try testing.expectEqual(@as(u8, 2), v.underline_color.g);</div><div>         try testing.expectEqual(@as(u8, 3), v.underline_color.b);</div><div>     }</div><div class="diff-removed">-</div><div>     {</div><div>         const v = testParseColon(&[_]u16{ 58, 2, 0, 1, 2, 3 });</div><div>         try testing.expect(v == .underline_color);</div><div class="diff-info">@@ -667,36 +448,6 @@ test "sgr: invisible" {</div><div>     try testing.expect(p.next().? == .reset_invisible);</div><div> }</div><div> </div><div class="diff-removed">-test "sgr: underline, bg, and fg" {</div><div class="diff-removed">-    var p: Parser = .{</div><div class="diff-removed">-        .params = &[_]u16{ 4, 38, 2, 255, 247, 219, 48, 2, 242, 93, 147, 4 },</div><div class="diff-removed">-    };</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = p.next().?;</div><div class="diff-removed">-        try testing.expect(v == .underline);</div><div class="diff-removed">-        try testing.expectEqual(Attribute.Underline.single, v.underline);</div><div class="diff-removed">-    }</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = p.next().?;</div><div class="diff-removed">-        try testing.expect(v == .direct_color_fg);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 255), v.direct_color_fg.r);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 247), v.direct_color_fg.g);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 219), v.direct_color_fg.b);</div><div class="diff-removed">-    }</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = p.next().?;</div><div class="diff-removed">-        try testing.expect(v == .direct_color_bg);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 242), v.direct_color_bg.r);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 93), v.direct_color_bg.g);</div><div class="diff-removed">-        try testing.expectEqual(@as(u8, 147), v.direct_color_bg.b);</div><div class="diff-removed">-    }</div><div class="diff-removed">-    {</div><div class="diff-removed">-        const v = p.next().?;</div><div class="diff-removed">-        try testing.expect(v == .underline);</div><div class="diff-removed">-        try testing.expectEqual(Attribute.Underline.single, v.underline);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div> test "sgr: direct color fg missing color" {</div><div>     // This used to crash</div><div>     var p: Parser = .{ .params = &[_]u16{ 38, 5 } };</div><div class="diff-info">@@ -709,12 +460,14 @@ test "sgr: direct color bg missing color" {</div><div>     while (p.next()) |_| {}</div><div> }</div><div> </div><div class="diff-removed">-test "sgr: direct fg/bg/underline ignore optional color space" {</div><div class="diff-removed">-    // These behaviors have been verified against xterm.</div><div class="diff-added">+test "sgr: 256 color underline" {</div><div class="diff-added">+    var p: Parser = .{ .params = &[_]u16{ 58, 5, 9 } };</div><div class="diff-added">+    try testing.expect(p.next().? == .@"256_underline_color");</div><div class="diff-added">+    try testing.expect(p.next() == null);</div><div class="diff-added">+}</div><div> </div><div class="diff-removed">-    // Colon version should skip the optional color space identifier</div><div class="diff-added">+test "sgr: direct fg/bg/underline ignore optional color space" {</div><div>     {</div><div class="diff-removed">-        // 3 8 : 2 : Pi : Pr : Pg : Pb</div><div>         const v = testParseColon(&[_]u16{ 38, 2, 0, 1, 2, 3 });</div><div>         try testing.expect(v == .direct_color_fg);</div><div>         try testing.expectEqual(@as(u8, 1), v.direct_color_fg.r);</div><div class="diff-info">@@ -722,7 +475,6 @@ test "sgr: direct fg/bg/underline ignore optional color space" {</div><div>         try testing.expectEqual(@as(u8, 3), v.direct_color_fg.b);</div><div>     }</div><div>     {</div><div class="diff-removed">-        // 4 8 : 2 : Pi : Pr : Pg : Pb</div><div>         const v = testParseColon(&[_]u16{ 48, 2, 0, 1, 2, 3 });</div><div>         try testing.expect(v == .direct_color_bg);</div><div>         try testing.expectEqual(@as(u8, 1), v.direct_color_bg.r);</div><div class="diff-info">@@ -730,7 +482,6 @@ test "sgr: direct fg/bg/underline ignore optional color space" {</div><div>         try testing.expectEqual(@as(u8, 3), v.direct_color_bg.b);</div><div>     }</div><div>     {</div><div class="diff-removed">-        // 5 8 : 2 : Pi : Pr : Pg : Pb</div><div>         const v = testParseColon(&[_]u16{ 58, 2, 0, 1, 2, 3 });</div><div>         try testing.expect(v == .underline_color);</div><div>         try testing.expectEqual(@as(u8, 1), v.underline_color.r);</div><div class="diff-info">@@ -738,9 +489,7 @@ test "sgr: direct fg/bg/underline ignore optional color space" {</div><div>         try testing.expectEqual(@as(u8, 3), v.underline_color.b);</div><div>     }</div><div> </div><div class="diff-removed">-    // Semicolon version should not parse optional color space identifier</div><div>     {</div><div class="diff-removed">-        // 3 8 ; 2 ; Pr ; Pg ; Pb</div><div>         const v = testParse(&[_]u16{ 38, 2, 0, 1, 2, 3 });</div><div>         try testing.expect(v == .direct_color_fg);</div><div>         try testing.expectEqual(@as(u8, 0), v.direct_color_fg.r);</div><div class="diff-info">@@ -748,7 +497,6 @@ test "sgr: direct fg/bg/underline ignore optional color space" {</div><div>         try testing.expectEqual(@as(u8, 2), v.direct_color_fg.b);</div><div>     }</div><div>     {</div><div class="diff-removed">-        // 4 8 ; 2 ; Pr ; Pg ; Pb</div><div>         const v = testParse(&[_]u16{ 48, 2, 0, 1, 2, 3 });</div><div>         try testing.expect(v == .direct_color_bg);</div><div>         try testing.expectEqual(@as(u8, 0), v.direct_color_bg.r);</div><div class="diff-info">@@ -756,7 +504,6 @@ test "sgr: direct fg/bg/underline ignore optional color space" {</div><div>         try testing.expectEqual(@as(u8, 2), v.direct_color_bg.b);</div><div>     }</div><div>     {</div><div class="diff-removed">-        // 5 8 ; 2 ; Pr ; Pg ; Pb</div><div>         const v = testParse(&[_]u16{ 58, 2, 0, 1, 2, 3 });</div><div>         try testing.expect(v == .underline_color);</div><div>         try testing.expectEqual(@as(u8, 0), v.underline_color.r);</div><div class="diff-info">@@ -826,7 +573,6 @@ test "sgr: direct fg colon no colorspace and extra param" {</div><div> </div><div> // Kakoune sent this complex SGR sequence that caused invalid behavior.</div><div> test "sgr: kakoune input" {</div><div class="diff-removed">-    // This used to crash</div><div>     var p: Parser = .{</div><div>         .params = &[_]u16{ 0, 4, 3, 38, 2, 175, 175, 215, 58, 2, 0, 190, 80, 70 },</div><div>         .params_sep = sep: {</div><div class="diff-info">@@ -868,11 +614,7 @@ test "sgr: kakoune input" {</div><div>     //try testing.expect(p.next() == null);</div><div> }</div><div> </div><div class="diff-removed">-// Discussion #5930, another input sent by kakoune</div><div> test "sgr: kakoune input issue underline, fg, and bg" {</div><div class="diff-removed">-    // echo -e "\033[4:3;38;2;51;51;51;48;2;170;170;170;58;2;255;97;136mset everything in one sequence, broken\033[m"</div><div class="diff-removed">-</div><div class="diff-removed">-    // This used to crash</div><div>     var p: Parser = .{</div><div>         .params = &[_]u16{ 4, 3, 38, 2, 51, 51, 51, 48, 2, 170, 170, 170, 58, 2, 255, 97, 136 },</div><div>         .params_sep = sep: {</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    