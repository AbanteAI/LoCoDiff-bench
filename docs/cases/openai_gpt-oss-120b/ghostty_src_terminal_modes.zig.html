<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/terminal/modes.zig - GPT OSS 120B</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/terminal/modes.zig</h1>
        <h2>Model: GPT OSS 120B</h2>
        <p><a href="../../models/openai_gpt-oss-120b.html">All GPT OSS 120B Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> GPT OSS 120B</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 12161</p>
                <p><strong>Native Prompt Tokens:</strong> 12213</p>
                <p><strong>Native Completion Tokens:</strong> 6980</p>
                <p><strong>Native Tokens Reasoning:</strong> 4875</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.00706695</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_gpt-oss-120b/ghostty_src_terminal_modes.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_gpt-oss-120b/ghostty_src_terminal_modes.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_gpt-oss-120b/ghostty_src_terminal_modes.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index dffd96d41..690d1e090 100644</div><div class="diff-header">--- a/ghostty_src_terminal_modes.zig_expectedoutput.txt (expected):tmp/tmpiqjytivg_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_terminal_modes.zig_extracted.txt (actual):tmp/tmpz13e3m25_actual.txt	</div><div class="diff-info">@@ -1,32 +1,33 @@</div><div> //! This file contains all the terminal modes that we support</div><div> //! and various support types for them: an enum of supported modes,</div><div class="diff-removed">-//! a packed struct to store mode values, a more generalized state</div><div class="diff-removed">-//! struct to store values plus handle save/restore, and much more.</div><div class="diff-added">+//! a packed struct to store mode values, a more generalized</div><div class="diff-added">+//! state struct to store values plus handle save/restore,</div><div class="diff-added">+//! and much more.</div><div> //!</div><div> //! There is pretty heavy comptime usage and type generation here.</div><div class="diff-removed">-//! I don't love to have this sort of complexity but its a good way</div><div class="diff-removed">-//! to ensure all our various types and logic remain in sync.</div><div class="diff-added">+//! I don't love to have this sort of complexity but its</div><div class="diff-added">+//! a good way to ensure all our various types and logic</div><div class="diff-added">+//! remain in sync.</div><div> </div><div> const std = @import("std");</div><div class="diff-removed">-const testing = std.testing;</div><div class="diff-added">+pub const testing = std.testing;</div><div> </div><div> /// A struct that maintains the state of all the settable modes.</div><div> pub const ModeState = struct {</div><div>     /// The values of the current modes.</div><div class="diff-removed">-    values: ModePacked = .{},</div><div class="diff-added">+    values: ModePacked = .{};</div><div> </div><div>     /// The saved values. We only allow saving each mode once.</div><div>     /// This is in line with other terminals that implement XTSAVE</div><div class="diff-removed">-    /// and XTRESTORE. We can improve this in the future if it becomes</div><div class="diff-removed">-    /// a real-world issue but we need to be aware of a DoS vector.</div><div class="diff-removed">-    saved: ModePacked = .{},</div><div class="diff-added">+    /// and XTRESTORE.</div><div class="diff-added">+    saved: ModePacked = .{};</div><div> </div><div>     /// The default values for the modes. This is used to reset</div><div class="diff-removed">-    /// the modes to their default values during reset.</div><div class="diff-removed">-    default: ModePacked = .{},</div><div class="diff-added">+    /// the modes to a known starting state.</div><div class="diff-added">+    default: ModePacked = .{};</div><div> </div><div class="diff-removed">-    /// Reset the modes to their default values. This also clears the</div><div class="diff-removed">-    /// saved state.</div><div class="diff-added">+    /// Reset the modes to their default values.</div><div class="diff-added">+    /// This also clears any saved state.</div><div>     pub fn reset(self: *ModeState) void {</div><div>         self.values = self.default;</div><div>         self.saved = .{};</div><div class="diff-info">@@ -42,7 +43,7 @@ pub const ModeState = struct {</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    /// Get the value of a mode.</div><div class="diff-added">+    /// Get a mode.</div><div>     pub fn get(self: *ModeState, mode: Mode) bool {</div><div>         switch (mode) {</div><div>             inline else => |mode_comptime| {</div><div class="diff-info">@@ -52,10 +53,7 @@ pub const ModeState = struct {</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    /// Save the state of the given mode. This can then be restored</div><div class="diff-removed">-    /// with restore. This will only be accurate if the previous</div><div class="diff-removed">-    /// mode was saved exactly once and not restored. Otherwise this</div><div class="diff-removed">-    /// will just keep restoring the last stored value in memory.</div><div class="diff-added">+    /// Save the state of the given mode.</div><div>     pub fn save(self: *ModeState, mode: Mode) void {</div><div>         switch (mode) {</div><div>             inline else => |mode_comptime| {</div><div class="diff-info">@@ -65,7 +63,8 @@ pub const ModeState = struct {</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    /// See save. This will return the restored value.</div><div class="diff-added">+    /// Restore a previously saved mode.</div><div class="diff-added">+    /// Returns the restored value.</div><div>     pub fn restore(self: *ModeState, mode: Mode) bool {</div><div>         switch (mode) {</div><div>             inline else => |mode_comptime| {</div><div class="diff-info">@@ -77,15 +76,13 @@ pub const ModeState = struct {</div><div>     }</div><div> </div><div>     test {</div><div class="diff-removed">-        // We have this here so that we explicitly fail when we change the</div><div class="diff-removed">-        // size of modes. The size of modes is NOT particularly important,</div><div class="diff-removed">-        // we just want to be mentally aware when it happens.</div><div class="diff-added">+        // Ensure developers notice size changes.</div><div>         try std.testing.expectEqual(8, @sizeOf(ModePacked));</div><div>     }</div><div> };</div><div> </div><div class="diff-removed">-/// A packed struct of all the settable modes. This shouldn't</div><div class="diff-removed">-/// be used directly but rather through the ModeState struct.</div><div class="diff-added">+/// A packed struct of all the settable modes. This should be</div><div class="diff-added">+/// accessed through ModeState.</div><div> pub const ModePacked = packed_struct: {</div><div>     const StructField = std.builtin.Type.StructField;</div><div>     var fields: [entries.len]StructField = undefined;</div><div class="diff-info">@@ -99,15 +96,17 @@ pub const ModePacked = packed_struct: {</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    break :packed_struct @Type(.{ .@"struct" = .{</div><div class="diff-removed">-        .layout = .@"packed",</div><div class="diff-removed">-        .fields = &fields,</div><div class="diff-removed">-        .decls = &.{},</div><div class="diff-removed">-        .is_tuple = false,</div><div class="diff-removed">-    } });</div><div class="diff-added">+    break :packed_struct @Type(.{</div><div class="diff-added">+        .@"struct" = .{</div><div class="diff-added">+            .layout = .@"packed",</div><div class="diff-added">+            .fields = &fields,</div><div class="diff-added">+            .decls = &.{},</div><div class="diff-added">+            .is_tuple = false,</div><div class="diff-added">+        },</div><div class="diff-added">+    });</div><div> };</div><div> </div><div class="diff-removed">-/// An enum(u16) of the available modes. See entries for available values.</div><div class="diff-added">+/// An enum of the available modes.</div><div> pub const Mode = mode_enum: {</div><div>     const EnumField = std.builtin.Type.EnumField;</div><div>     var fields: [entries.len]EnumField = undefined;</div><div class="diff-info">@@ -121,16 +120,17 @@ pub const Mode = mode_enum: {</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    break :mode_enum @Type(.{ .@"enum" = .{</div><div class="diff-removed">-        .tag_type = ModeTag.Backing,</div><div class="diff-removed">-        .fields = &fields,</div><div class="diff-removed">-        .decls = &.{},</div><div class="diff-removed">-        .is_exhaustive = true,</div><div class="diff-removed">-    } });</div><div class="diff-added">+    break :mode_enum @Type(.{</div><div class="diff-added">+        .@"enum" = .{</div><div class="diff-added">+            .tag_type = ModeTag.Backing,</div><div class="diff-added">+                .fields = &fields,</div><div class="diff-added">+                .decls = &.{},</div><div class="diff-added">+                .is_exhaustive = true,</div><div class="diff-added">+            },</div><div class="diff-added">+        });</div><div> };</div><div> </div><div class="diff-removed">-/// The tag type for our enum is a u16 but we use a packed struct</div><div class="diff-removed">-/// in order to pack the ansi bit into the tag.</div><div class="diff-added">+/// The tag type for our enum is a u16, packed with the ANSI bit.</div><div> pub const ModeTag = packed struct(u16) {</div><div>     pub const Backing = @typeInfo(@This()).@"struct".backing_integer.?;</div><div>     value: u15,</div><div class="diff-info">@@ -143,17 +143,17 @@ pub const ModeTag = packed struct(u16) {</div><div>     }</div><div> };</div><div> </div><div class="diff-added">+/// Convert a numeric mode with its ANSI/DEC flag to a Mode enum value.</div><div> pub fn modeFromInt(v: u16, ansi: bool) ?Mode {</div><div>     inline for (entries) |entry| {</div><div class="diff-removed">-        if (comptime !entry.disabled) {</div><div class="diff-added">+        if (!entry.disabled) {</div><div>             if (entry.value == v and entry.ansi == ansi) {</div><div class="diff-removed">-                const tag: ModeTag = .{ .ansi = ansi, .value = entry.value };</div><div class="diff-removed">-                const int: ModeTag.Backing = @bitCast(tag);</div><div class="diff-removed">-                return @enumFromInt(int);</div><div class="diff-added">+                const tag: ModeTag = .{ .value = entry.value, .ansi = entry.ansi };</div><div class="diff-added">+                const i: ModeTag.Backing = @bitCast(tag);</div><div class="diff-added">+                return @enumFromInt(i);</div><div>             }</div><div>         }</div><div>     }</div><div class="diff-removed">-</div><div>     return null;</div><div> }</div><div> </div><div class="diff-info">@@ -163,35 +163,23 @@ fn entryForMode(comptime mode: Mode) ModeEntry {</div><div>     for (entries) |entry| {</div><div>         if (std.mem.eql(u8, entry.name, name)) return entry;</div><div>     }</div><div class="diff-removed">-</div><div>     unreachable;</div><div> }</div><div> </div><div class="diff-removed">-/// A single entry of a possible mode we support. This is used to</div><div class="diff-removed">-/// dynamically define the enum and other tables.</div><div class="diff-added">+/// Definition of a mode entry used to construct tables.</div><div> const ModeEntry = struct {</div><div>     name: [:0]const u8,</div><div>     value: comptime_int,</div><div>     default: bool = false,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// True if this is an ANSI mode, false if its a DEC mode (?-prefixed).</div><div>     ansi: bool = false,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// If true, this mode is disabled and Ghostty will not allow it to be</div><div class="diff-removed">-    /// set or queried. The mode enum still has it, allowing Ghostty developers</div><div class="diff-removed">-    /// to develop a mode without exposing it to real users.</div><div>     disabled: bool = false,</div><div> };</div><div> </div><div class="diff-removed">-/// The full list of available entries. For documentation see how</div><div class="diff-removed">-/// they're used within Ghostty or google their values. It is not</div><div class="diff-removed">-/// valuable to redocument them all here.</div><div class="diff-added">+/// All supported mode entries.</div><div> const entries: []const ModeEntry = &.{</div><div>     // ANSI</div><div>     .{ .name = "disable_keyboard", .value = 2, .ansi = true }, // KAM</div><div>     .{ .name = "insert", .value = 4, .ansi = true },</div><div class="diff-removed">-    .{ .name = "send_receive_mode", .value = 12, .ansi = true, .default = true }, // SRM</div><div class="diff-removed">-    .{ .name = "linefeed", .value = 20, .ansi = true },</div><div> </div><div>     // DEC</div><div>     .{ .name = "cursor_keys", .value = 1 }, // DECCKM</div><div class="diff-info">@@ -202,6 +190,9 @@ const entries: []const ModeEntry = &.{</div><div>     .{ .name = "wraparound", .value = 7, .default = true },</div><div>     .{ .name = "autorepeat", .value = 8 },</div><div>     .{ .name = "mouse_event_x10", .value = 9 },</div><div class="diff-added">+    .{ .name = "send_receive_mode", .value = 12, .ansi = true, .default = true }, // SRM</div><div class="diff-added">+    .{ .name = "linefeed", .value = 20, .ansi = true },</div><div class="diff-added">+</div><div>     .{ .name = "cursor_blinking", .value = 12 },</div><div>     .{ .name = "cursor_visible", .value = 25, .default = true },</div><div>     .{ .name = "enable_mode_3", .value = 40 },</div><div class="diff-info">@@ -239,21 +230,33 @@ test modeFromInt {</div><div>     try testing.expect(modeFromInt(4, true).? == .insert);</div><div>     try testing.expect(modeFromInt(9, true) == null);</div><div>     try testing.expect(modeFromInt(9, false).? == .mouse_event_x10);</div><div class="diff-removed">-    try testing.expect(modeFromInt(14, true) == null);</div><div class="diff-added">+    // SRM is an ANSI mode, so it's only present when ANSI flag is true.</div><div class="diff-added">+    try testing.expect(modeFromInt(12, true).? == .send_receive_mode);</div><div class="diff-added">+    // Non‑ANSI mode 12 should map to cursor_blinking when the ANSI bit is false.</div><div class="diff-added">+    try testing.expect(modeFromInt(12, false).? == .cursor_blinking);</div><div class="diff-added">+    // Unknown mode should return null.</div><div class="diff-added">+    try testing.expect(modeFromInt(9999, false) == null);</div><div> }</div><div> </div><div> test ModeState {</div><div>     var state: ModeState = .{};</div><div> </div><div class="diff-removed">-    // Normal set/get</div><div class="diff-added">+    // Normal set/get.</div><div>     try testing.expect(!state.get(.cursor_keys));</div><div>     state.set(.cursor_keys, true);</div><div>     try testing.expect(state.get(.cursor_keys));</div><div> </div><div class="diff-removed">-    // Save/restore</div><div class="diff-added">+    // Save/restore.</div><div>     state.save(.cursor_keys);</div><div>     state.set(.cursor_keys, false);</div><div>     try testing.expect(!state.get(.cursor_keys));</div><div>     try testing.expect(state.restore(.cursor_keys));</div><div>     try testing.expect(state.get(.cursor_keys));</div><div class="diff-added">+</div><div class="diff-added">+    // Reset should revert to defaults.</div><div class="diff-added">+    state.set(.disable_keyboard, true);</div><div class="diff-added">+    state.reset();</div><div class="diff-added">+    try testing.expect(!state.get(.disable_keyboard));</div><div class="diff-added">+    // Modes with a default of true should be restored.</div><div class="diff-added">+    try testing.expect(state.get(.wraparound));</div><div> }</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    