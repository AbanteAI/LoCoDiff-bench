<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/terminal/color.zig - GPT OSS 120B</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/terminal/color.zig</h1>
        <h2>Model: GPT OSS 120B</h2>
        <p><a href="../../models/openai_gpt-oss-120b.html">All GPT OSS 120B Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> GPT OSS 120B</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 10446</p>
                <p><strong>Native Prompt Tokens:</strong> 10539</p>
                <p><strong>Native Completion Tokens:</strong> 6068</p>
                <p><strong>Native Tokens Reasoning:</strong> 2790</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.00613185</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_gpt-oss-120b/ghostty_src_terminal_color.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_gpt-oss-120b/ghostty_src_terminal_color.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_gpt-oss-120b/ghostty_src_terminal_color.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index c8bb6a6aa..43c4a959e 100644</div><div class="diff-header">--- a/ghostty_src_terminal_color.zig_expectedoutput.txt (expected):tmp/tmpvbhjurzq_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_terminal_color.zig_extracted.txt (actual):tmp/tmp_iybuzr6_actual.txt	</div><div class="diff-info">@@ -25,7 +25,6 @@ pub const default: Palette = default: {</div><div>                     .g = if (g == 0) 0 else (g * 40 + 55),</div><div>                     .b = if (b == 0) 0 else (b * 40 + 55),</div><div>                 };</div><div class="diff-removed">-</div><div>                 i += 1;</div><div>             }</div><div>         }</div><div class="diff-info">@@ -68,7 +67,6 @@ pub const Name = enum(u8) {</div><div>     // Remainders are valid unnamed values in the 256 color palette.</div><div>     _,</div><div> </div><div class="diff-removed">-    /// Default colors for tagged values.</div><div>     pub fn default(self: Name) !RGB {</div><div>         return switch (self) {</div><div>             .black => RGB{ .r = 0x1D, .g = 0x1F, .b = 0x21 },</div><div class="diff-info">@@ -104,78 +102,22 @@ pub const RGB = packed struct(u24) {</div><div>         return self.r == other.r and self.g == other.g and self.b == other.b;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Calculates the contrast ratio between two colors. The contrast</div><div class="diff-removed">-    /// ration is a value between 1 and 21 where 1 is the lowest contrast</div><div class="diff-removed">-    /// and 21 is the highest contrast.</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// https://www.w3.org/TR/WCAG20/#contrast-ratiodef</div><div class="diff-removed">-    pub fn contrast(self: RGB, other: RGB) f64 {</div><div class="diff-removed">-        // pair[0] = lighter, pair[1] = darker</div><div class="diff-removed">-        const pair: [2]f64 = pair: {</div><div class="diff-removed">-            const self_lum = self.luminance();</div><div class="diff-removed">-            const other_lum = other.luminance();</div><div class="diff-removed">-            if (self_lum > other_lum) break :pair .{ self_lum, other_lum };</div><div class="diff-removed">-            break :pair .{ other_lum, self_lum };</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        return (pair[0] + 0.05) / (pair[1] + 0.05);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Calculates luminance based on the W3C formula. This returns a</div><div class="diff-removed">-    /// normalized value between 0 and 1 where 0 is black and 1 is white.</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// https://www.w3.org/TR/WCAG20/#relativeluminancedef</div><div class="diff-removed">-    pub fn luminance(self: RGB) f64 {</div><div class="diff-removed">-        const r_lum = componentLuminance(self.r);</div><div class="diff-removed">-        const g_lum = componentLuminance(self.g);</div><div class="diff-removed">-        const b_lum = componentLuminance(self.b);</div><div class="diff-removed">-        return 0.2126 * r_lum + 0.7152 * g_lum + 0.0722 * b_lum;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Calculates single-component luminance based on the W3C formula.</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// Expects sRGB color space which at the time of writing we don't</div><div class="diff-removed">-    /// generally use but it's a good enough approximation until we fix that.</div><div class="diff-removed">-    /// https://www.w3.org/TR/WCAG20/#relativeluminancedef</div><div class="diff-removed">-    fn componentLuminance(c: u8) f64 {</div><div class="diff-removed">-        const c_f64: f64 = @floatFromInt(c);</div><div class="diff-removed">-        const normalized: f64 = c_f64 / 255;</div><div class="diff-removed">-        if (normalized <= 0.03928) return normalized / 12.92;</div><div class="diff-removed">-        return std.math.pow(f64, (normalized + 0.055) / 1.055, 2.4);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Calculates "perceived luminance" which is better for determining</div><div class="diff-removed">-    /// light vs dark.</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// Source: https://www.w3.org/TR/AERT/#color-contrast</div><div class="diff-removed">-    pub fn perceivedLuminance(self: RGB) f64 {</div><div class="diff-removed">-        const r_f64: f64 = @floatFromInt(self.r);</div><div class="diff-removed">-        const g_f64: f64 = @floatFromInt(self.g);</div><div class="diff-removed">-        const b_f64: f64 = @floatFromInt(self.b);</div><div class="diff-removed">-        return 0.299 * (r_f64 / 255) + 0.587 * (g_f64 / 255) + 0.114 * (b_f64 / 255);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-added">+    // Compile‑time sanity checks.</div><div>     comptime {</div><div>         assert(@bitSizeOf(RGB) == 24);</div><div>         assert(@sizeOf(RGB) == 4);</div><div>     }</div><div> </div><div class="diff-removed">-    /// Parse a color from a floating point intensity value.</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// The value should be between 0.0 and 1.0, inclusive.</div><div class="diff-added">+    // Parse a color from a floating‑point intensity value.</div><div>     fn fromIntensity(value: []const u8) !u8 {</div><div>         const i = std.fmt.parseFloat(f64, value) catch return error.InvalidFormat;</div><div>         if (i < 0.0 or i > 1.0) {</div><div>             return error.InvalidFormat;</div><div>         }</div><div class="diff-removed">-</div><div>         return @intFromFloat(i * std.math.maxInt(u8));</div><div>     }</div><div> </div><div class="diff-removed">-    /// Parse a color from a string of hexadecimal digits</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// The string can contain 1, 2, 3, or 4 characters and represents the color</div><div class="diff-removed">-    /// value scaled in 4, 8, 12, or 16 bits, respectively.</div><div class="diff-added">+    // Parse a color from a string of hexadecimal digits.</div><div>     fn fromHex(value: []const u8) !u8 {</div><div>         if (value.len == 0 or value.len > 4) {</div><div>             return error.InvalidFormat;</div><div class="diff-info">@@ -189,35 +131,30 @@ pub const RGB = packed struct(u24) {</div><div>             4 => std.math.maxInt(u16),</div><div>             else => unreachable,</div><div>         };</div><div class="diff-removed">-</div><div>         return @intCast(@as(usize, color) * std.math.maxInt(u8) / divisor);</div><div>     }</div><div> </div><div class="diff-removed">-    /// Parse a color specification.</div><div class="diff-added">+    /// Parse a color.</div><div>     ///</div><div>     /// Any of the following forms are accepted:</div><div>     ///</div><div>     /// 1. rgb:<red>/<green>/<blue></div><div class="diff-removed">-    ///</div><div>     ///    <red>, <green>, <blue> := h | hh | hhh | hhhh</div><div>     ///</div><div class="diff-removed">-    ///    where `h` is a single hexadecimal digit.</div><div class="diff-removed">-    ///</div><div>     /// 2. rgbi:<red>/<green>/<blue></div><div class="diff-added">+    ///    where <red>, <green>, and <blue> are floating point values</div><div class="diff-added">+    ///    between 0.0 and 1.0 (inclusive).</div><div>     ///</div><div class="diff-removed">-    ///    where <red>, <green>, and <blue> are floating point values between</div><div class="diff-removed">-    ///    0.0 and 1.0 (inclusive).</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// 3. #rgb, #rrggbb, #rrrgggbbb #rrrrggggbbbb</div><div class="diff-removed">-    ///</div><div class="diff-added">+    /// 3. #rgb, #rrggbb, #rrrgggbbb, #rrrrggggbbbb</div><div>     ///    where `r`, `g`, and `b` are a single hexadecimal digit.</div><div>     ///    These specify a color with 4, 8, 12, and 16 bits of precision</div><div>     ///    per color channel.</div><div>     pub fn parse(value: []const u8) !RGB {</div><div>         if (value.len == 0) {</div><div class="diff-removed">-            return error.InvalidFormat;</div><div class="diff-added">+                return error.InvalidFormat;</div><div>         }</div><div> </div><div class="diff-added">+        // Hex literals.</div><div>         if (value[0] == '#') {</div><div>             switch (value.len) {</div><div>                 4 => return RGB{</div><div class="diff-info">@@ -240,78 +177,91 @@ pub const RGB = packed struct(u24) {</div><div>                     .g = try RGB.fromHex(value[5..9]),</div><div>                     .b = try RGB.fromHex(value[9..13]),</div><div>                 },</div><div class="diff-removed">-</div><div>                 else => return error.InvalidFormat,</div><div>             }</div><div>         }</div><div> </div><div class="diff-removed">-        // Check for X11 named colors. We allow whitespace around the edges</div><div class="diff-removed">-        // of the color because Kitty allows whitespace. This is not part of</div><div class="diff-removed">-        // any spec I could find.</div><div class="diff-removed">-        if (x11_color.map.get(std.mem.trim(u8, value, " "))) |rgb| return rgb;</div><div class="diff-added">+        // X11 named colors (trimmed for whitespace compatibility).</div><div class="diff-added">+        if (x11_color.map.get(std.mem.trim(u8, value, " "))) |rgb| {</div><div class="diff-added">+            return rgb;</div><div class="diff-added">+        }</div><div> </div><div class="diff-added">+        // RGB integer/float formats.</div><div>         if (value.len < "rgb:a/ghostty_src_terminal_color.zig_expectedoutput.txt (expected): usize = 3;</div><div> </div><div class="diff-removed">-        const use_intensity = if (value[i] == 'i') blk: {</div><div class="diff-removed">-            i += 1;</div><div class="diff-removed">-            break :blk true;</div><div class="diff-removed">-        } else false;</div><div class="diff-added">+        const use_intensity = if (value[i] == 'i') (i += 1; true) else false;</div><div> </div><div>         if (value[i] != ':') {</div><div>             return error.InvalidFormat;</div><div>         }</div><div class="diff-removed">-</div><div>         i += 1;</div><div> </div><div class="diff-removed">-        const r = r: {</div><div class="diff-removed">-            const slice = if (std.mem.indexOfScalarPos(u8, value, i, '/')) |end|</div><div class="diff-removed">-                value[i..end]</div><div class="diff-removed">-            else</div><div class="diff-added">+        const r = blk: {</div><div class="diff-added">+            const end = std.mem.indexOfScalarPos(u8, value, i, '/') orelse</div><div>                 return error.InvalidFormat;</div><div class="diff-removed">-</div><div class="diff-removed">-            i += slice.len + 1;</div><div class="diff-removed">-</div><div class="diff-removed">-            break :r if (use_intensity)</div><div class="diff-removed">-                try RGB.fromIntensity(slice)</div><div class="diff-removed">-            else</div><div class="diff-removed">-                try RGB.fromHex(slice);</div><div class="diff-added">+            const slice = value[i..end];</div><div class="diff-added">+            i = end + 1;</div><div class="diff-added">+            break :blk if (use_intensity) try RGB.fromIntensity(slice) else try RGB.fromHex(slice);</div><div>         };</div><div> </div><div class="diff-removed">-        const g = g: {</div><div class="diff-removed">-            const slice = if (std.mem.indexOfScalarPos(u8, value, i, '/')) |end|</div><div class="diff-removed">-                value[i..end]</div><div class="diff-removed">-            else</div><div class="diff-added">+        const g = blk: {</div><div class="diff-added">+            const end = std.mem.indexOfScalarPos(u8, value, i, '/') orelse</div><div>                 return error.InvalidFormat;</div><div class="diff-added">+            const slice = value[i..end];</div><div class="diff-added">+            i = end + 1;</div><div class="diff-added">+            break :blk if (use_intensity) try RGB.fromIntensity(slice) else try RGB.fromHex(slice);</div><div class="diff-added">+        };</div><div> </div><div class="diff-removed">-            i += slice.len + 1;</div><div class="diff-added">+        const b = if (use_intensity) try RGB.fromIntensity(value[i..]) else try RGB.fromHex(value[i..]);</div><div> </div><div class="diff-removed">-            break :g if (use_intensity)</div><div class="diff-removed">-                try RGB.fromIntensity(slice)</div><div class="diff-removed">-            else</div><div class="diff-removed">-                try RGB.fromHex(slice);</div><div class="diff-removed">-        };</div><div class="diff-added">+        return RGB{ .r = r, .g = g, .b = b };</div><div class="diff-added">+    }</div><div> </div><div class="diff-removed">-        const b = if (use_intensity)</div><div class="diff-removed">-            try RGB.fromIntensity(value[i..])</div><div class="diff-removed">-        else</div><div class="diff-removed">-            try RGB.fromHex(value[i..]);</div><div class="diff-added">+    /// Calculates luminance based on the W3C formula. Returns a normalized</div><div class="diff-added">+    /// value between 0 and 1 (0 = black, 1 = white).</div><div class="diff-added">+    pub fn luminance(self: RGB) f64 {</div><div class="diff-added">+        const r_lum = componentLuminance(self.r);</div><div class="diff-added">+        const g_lum = componentLuminance(self.g);</div><div class="diff-added">+        const b_lum = componentLuminance(self.b);</div><div class="diff-added">+        return 0.2126 * r_lum + 0.7152 * g_lum + 0.0722 * b_lum;</div><div class="diff-added">+    }</div><div> </div><div class="diff-removed">-        return RGB{</div><div class="diff-removed">-            .r = r,</div><div class="diff-removed">-            .g = g,</div><div class="diff-removed">-            .b = b,</div><div class="diff-added">+    /// Calculates single‑component luminance based on the W3C formula.</div><div class="diff-added">+    fn componentLuminance(c: u8) f64 {</div><div class="diff-added">+        const c_f: f64 = @floatFromInt(c);</div><div class="diff-added">+        const norm = c_f / 255;</div><div class="diff-added">+        if (norm <= 0.03928) {</div><div class="diff-added">+            return norm / 12.92;</div><div class="diff-added">+        }</div><div class="diff-added">+        return std.math.pow(f64, (norm + 0.055) / 1.055, 2.4);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Calculates the contrast ratio between two colors.</div><div class="diff-added">+    /// The ratio is from 1 (lowest) to 21 (highest).</div><div class="diff-added">+    pub fn contrast(self: RGB, other: RGB) f64 {</div><div class="diff-added">+        const pair: [2]f64 = blk: {</div><div class="diff-added">+            const a = self.luminance();</div><div class="diff-added">+            const b = other.luminance();</div><div class="diff-added">+            if (a > b) break :blk .{ a, b } else break :blk .{ b, a };</div><div>         };</div><div class="diff-added">+        return (pair[0] + 0.05) / (pair[1] + 0.05);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Calculates perceived luminance (improved light/dark detection).</div><div class="diff-added">+    pub fn perceivedLuminance(self: RGB) f64 {</div><div class="diff-added">+        const r = @floatFromInt(self.r);</div><div class="diff-added">+        const g = @floatFromInt(self.g);</div><div class="diff-added">+        const b = @floatFromInt(self.b);</div><div class="diff-added">+        return 0.299 * (r / 255) + 0.587 * (g / 255) + 0.114 * (b / 255);</div><div>     }</div><div> };</div><div> </div><div> test "palette: default" {</div><div>     const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-removed">-    // Safety check</div><div>     var i: u8 = 0;</div><div>     while (i < 16) : (i += 1) {</div><div>         try testing.expectEqual(Name.default(@as(Name, @enumFromInt(i))), default[i]);</div><div class="diff-info">@@ -325,17 +275,15 @@ test "RGB.parse" {</div><div>     try testing.expectEqual(RGB{ .r = 127, .g = 160, .b = 0 }, try RGB.parse("rgb:7f/a0a0/0"));</div><div>     try testing.expectEqual(RGB{ .r = 255, .g = 255, .b = 255 }, try RGB.parse("rgb:f/ff/fff"));</div><div>     try testing.expectEqual(RGB{ .r = 255, .g = 255, .b = 255 }, try RGB.parse("#ffffff"));</div><div class="diff-added">+    try testing.expectEqual(RGB{ .r = 255, .g = 0, .b = 16 }, try RGB.parse("#ff0010"));</div><div>     try testing.expectEqual(RGB{ .r = 255, .g = 255, .b = 255 }, try RGB.parse("#fff"));</div><div>     try testing.expectEqual(RGB{ .r = 255, .g = 255, .b = 255 }, try RGB.parse("#fffffffff"));</div><div>     try testing.expectEqual(RGB{ .r = 255, .g = 255, .b = 255 }, try RGB.parse("#ffffffffffff"));</div><div class="diff-removed">-    try testing.expectEqual(RGB{ .r = 255, .g = 0, .b = 16 }, try RGB.parse("#ff0010"));</div><div class="diff-removed">-</div><div>     try testing.expectEqual(RGB{ .r = 0, .g = 0, .b = 0 }, try RGB.parse("black"));</div><div>     try testing.expectEqual(RGB{ .r = 255, .g = 0, .b = 0 }, try RGB.parse("red"));</div><div>     try testing.expectEqual(RGB{ .r = 0, .g = 255, .b = 0 }, try RGB.parse("green"));</div><div>     try testing.expectEqual(RGB{ .r = 0, .g = 0, .b = 255 }, try RGB.parse("blue"));</div><div>     try testing.expectEqual(RGB{ .r = 255, .g = 255, .b = 255 }, try RGB.parse("white"));</div><div class="diff-removed">-</div><div>     try testing.expectEqual(RGB{ .r = 124, .g = 252, .b = 0 }, try RGB.parse("LawnGreen"));</div><div>     try testing.expectEqual(RGB{ .r = 0, .g = 250, .b = 154 }, try RGB.parse("medium spring green"));</div><div>     try testing.expectEqual(RGB{ .r = 34, .g = 139, .b = 34 }, try RGB.parse(" Forest Green "));</div><div class="diff-info">@@ -345,6 +293,8 @@ test "RGB.parse" {</div><div>     try testing.expectError(error.InvalidFormat, RGB.parse("rgb:"));</div><div>     try testing.expectError(error.InvalidFormat, RGB.parse(":a/ghostty_src_terminal_color.zig_expectedoutput.txt (expected):a/ghostty_src_terminal_color.zig_expectedoutput.txt (expected):00000///"));</div><div>     try testing.expectError(error.InvalidFormat, RGB.parse("rgb:000/"));</div><div class="diff-info">@@ -356,4 +306,5 @@ test "RGB.parse" {</div><div>     try testing.expectError(error.InvalidFormat, RGB.parse("#ffff"));</div><div>     try testing.expectError(error.InvalidFormat, RGB.parse("#fffff"));</div><div>     try testing.expectError(error.InvalidFormat, RGB.parse("#gggggg"));</div><div class="diff-removed">-}</div><div>\ No newline at end of file</div><div class="diff-added">+}</div><div class="diff-added">+```</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    