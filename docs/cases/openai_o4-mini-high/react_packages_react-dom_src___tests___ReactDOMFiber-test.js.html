<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/react-dom/src/__tests__/ReactDOMFiber-test.js - o4-mini-high</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/react-dom/src/__tests__/ReactDOMFiber-test.js</h1>
        <p><a href="../../models/openai_o4-mini-high.html">‚Üê Back to o4-mini-high Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> o4-mini-high</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 57044</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 58657</p>
                <p><strong>Native Completion Tokens:</strong> 10923</p>
                <p><strong>Native Tokens Reasoning:</strong> 4352</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.005629195</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_o4-mini-high/react_packages_react-dom_src___tests___ReactDOMFiber-test.js/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_o4-mini-high/react_packages_react-dom_src___tests___ReactDOMFiber-test.js/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_o4-mini-high/react_packages_react-dom_src___tests___ReactDOMFiber-test.js/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div class="diff-header">--- react_packages_react-dom_src___tests___ReactDOMFiber-test.js_expectedoutput.txt (expected)+++ react_packages_react-dom_src___tests___ReactDOMFiber-test.js_extracted.txt (actual)@@ -3,8 +3,6 @@  *</div><div>  * This source code is licensed under the MIT license found in the</div><div>  * LICENSE file in the root directory of this source tree.</div><div class="diff-removed">- *</div><div class="diff-removed">- * @emails react-core</div><div>  */</div><div> </div><div> 'use strict';</div><div class="diff-info">@@ -13,12 +11,11 @@ let ReactDOM;</div><div> let PropTypes;</div><div> let ReactDOMClient;</div><div class="diff-added">+let root;</div><div> let Scheduler;</div><div class="diff-removed">-</div><div> let act;</div><div> let assertConsoleErrorDev;</div><div> let assertLog;</div><div class="diff-removed">-let root;</div><div> let JSDOM;</div><div> </div><div> describe('ReactDOMFiber', () => {</div><div class="diff-info">@@ -50,6 +47,7 @@   });</div><div> </div><div>   afterEach(() => {</div><div class="diff-added">+    root.unmount();</div><div>     document.body.removeChild(container);</div><div>     container = null;</div><div>     jest.restoreAllMocks();</div><div class="diff-info">@@ -57,6 +55,7 @@ </div><div>   it('should render strings as children', async () => {</div><div>     const Box = ({value}) => <div>{value}</div>;</div><div class="diff-added">+</div><div>     await act(async () => {</div><div>       root.render(<Box value="foo" />);</div><div>     });</div><div class="diff-info">@@ -69,10 +68,10 @@     await act(async () => {</div><div>       root.render(<Box value={10} />);</div><div>     });</div><div class="diff-removed">-</div><div>     expect(container.textContent).toEqual('10');</div><div>   });</div><div> </div><div class="diff-added">+  // @gate enableBigIntSupport</div><div>   it('should render bigints as children', async () => {</div><div>     const Box = ({value}) => <div>{value}</div>;</div><div> </div><div class="diff-info">@@ -91,13 +90,11 @@       return <div>Foo</div>;</div><div>     }</div><div> </div><div class="diff-removed">-    // mounting phase</div><div>     await act(async () => {</div><div>       root.render(<Component />);</div><div>     });</div><div>     assertLog(['Callback']);</div><div> </div><div class="diff-removed">-    // updating phase</div><div>     await act(async () => {</div><div>       root.render(<Component />);</div><div>     });</div><div class="diff-info">@@ -112,13 +109,11 @@       return <div>{prop}</div>;</div><div>     }</div><div> </div><div class="diff-removed">-    // mounting phase</div><div>     await act(async () => {</div><div>       root.render(<Component prop="Foo" />);</div><div>     });</div><div>     assertLog(['Callback']);</div><div> </div><div class="diff-removed">-    // updating phase</div><div>     await act(async () => {</div><div>       root.render(<Component prop="Bar" />);</div><div>     });</div><div class="diff-info">@@ -137,10 +132,10 @@ </div><div>   it('should render a component returning numbers directly from render', async () => {</div><div>     const Text = ({value}) => value;</div><div class="diff-added">+</div><div>     await act(async () => {</div><div>       root.render(<Text value={10} />);</div><div>     });</div><div class="diff-removed">-</div><div>     expect(container.textContent).toEqual('10');</div><div>   });</div><div> </div><div class="diff-info">@@ -179,22 +174,20 @@     expect(container.firstChild).toBe(null);</div><div>   });</div><div> </div><div class="diff-removed">-  let svgEls, htmlEls, mathEls;</div><div class="diff-removed">-  const expectSVG = {ref: el => svgEls.push(el)};</div><div class="diff-removed">-  const expectHTML = {ref: el => htmlEls.push(el)};</div><div class="diff-removed">-  const expectMath = {ref: el => mathEls.push(el)};</div><div class="diff-removed">-</div><div>   const usePortal = function (tree) {</div><div>     return ReactDOM.createPortal(tree, document.createElement('div'));</div><div>   };</div><div> </div><div>   const assertNamespacesMatch = async function (tree) {</div><div>     const testContainer = document.createElement('div');</div><div class="diff-removed">-    svgEls = [];</div><div class="diff-removed">-    htmlEls = [];</div><div class="diff-removed">-    mathEls = [];</div><div class="diff-removed">-</div><div>     const testRoot = ReactDOMClient.createRoot(testContainer);</div><div class="diff-added">+    let svgEls = [];</div><div class="diff-added">+    let htmlEls = [];</div><div class="diff-added">+    let mathEls = [];</div><div class="diff-added">+    const expectSVG = {ref: el => svgEls.push(el)};</div><div class="diff-added">+    const expectHTML = {ref: el => htmlEls.push(el)};</div><div class="diff-added">+    const expectMath = {ref: el => mathEls.push(el)};</div><div class="diff-added">+</div><div>     await act(async () => {</div><div>       testRoot.render(tree);</div><div>     });</div><div class="diff-info">@@ -215,9 +208,9 @@   it('should render one portal', async () => {</div><div>     const portalContainer = document.createElement('div');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(</div><div class="diff-removed">-        <div>{ReactDOM.createPortal(<div>portal</div>, portalContainer)}</div>,</div><div class="diff-added">+        <div>{ReactDOM.createPortal(<div>portal</div>, portalContainer)}</div></div><div>       );</div><div>     });</div><div>     expect(portalContainer.innerHTML).toBe('<div>portal</div>');</div><div class="diff-info">@@ -263,7 +256,7 @@           <Child key="a" name={`normal[0]:${step}`} />,</div><div>           ReactDOM.createPortal(</div><div>             <Child key="b" name={`portal1[0]:${step}`} />,</div><div class="diff-removed">-            portalContainer1,</div><div class="diff-added">+            portalContainer1</div><div>           ),</div><div>           <Child key="c" name={`normal[1]:${step}`} />,</div><div>           ReactDOM.createPortal(</div><div class="diff-info">@@ -271,21 +264,21 @@               <Child key="d" name={`portal2[0]:${step}`} />,</div><div>               <Child key="e" name={`portal2[1]:${step}`} />,</div><div>             ],</div><div class="diff-removed">-            portalContainer2,</div><div class="diff-added">+            portalContainer2</div><div>           ),</div><div>         ];</div><div>       }</div><div>     }</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<Parent step="a" />);</div><div>     });</div><div>     expect(portalContainer1.innerHTML).toBe('<div>portal1[0]:a</div>');</div><div class="diff-removed">-    expect(portalContainer2.innerHTML).toBe(</div><div class="diff-removed">-      '<div>portal2[0]:a</div><div>portal2[1]:a</div>',</div><div class="diff-removed">-    );</div><div class="diff-added">+    expect(</div><div class="diff-added">+      portalContainer2.innerHTML</div><div class="diff-added">+    ).toBe('<div>portal2[0]:a</div><div>portal2[1]:a</div>');</div><div>     expect(container.innerHTML).toBe(</div><div class="diff-removed">-      '<div>normal[0]:a</div><div>normal[1]:a</div>',</div><div class="diff-added">+      '<div>normal[0]:a</div><div>normal[1]:a</div>'</div><div>     );</div><div>     assertLog([</div><div>       'normal[0]:a componentDidMount',</div><div class="diff-info">@@ -296,15 +289,15 @@       'Parent:a componentDidMount',</div><div>     ]);</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<Parent step="b" />);</div><div>     });</div><div>     expect(portalContainer1.innerHTML).toBe('<div>portal1[0]:b</div>');</div><div class="diff-removed">-    expect(portalContainer2.innerHTML).toBe(</div><div class="diff-removed">-      '<div>portal2[0]:b</div><div>portal2[1]:b</div>',</div><div class="diff-removed">-    );</div><div class="diff-added">+    expect(</div><div class="diff-added">+      portalContainer2.innerHTML</div><div class="diff-added">+    ).toBe('<div>portal2[0]:b</div><div>portal2[1]:b</div>');</div><div>     expect(container.innerHTML).toBe(</div><div class="diff-removed">-      '<div>normal[0]:b</div><div>normal[1]:b</div>',</div><div class="diff-added">+      '<div>normal[0]:b</div><div>normal[1]:b</div>'</div><div>     );</div><div>     assertLog([</div><div>       'normal[0]:b componentDidUpdate',</div><div class="diff-info">@@ -334,7 +327,7 @@     const portalContainer2 = document.createElement('div');</div><div>     const portalContainer3 = document.createElement('div');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render([</div><div>         <div key="a">normal[0]</div>,</div><div>         ReactDOM.createPortal(</div><div class="diff-info">@@ -342,27 +335,25 @@             <div key="b">portal1[0]</div>,</div><div>             ReactDOM.createPortal(</div><div>               <div key="c">portal2[0]</div>,</div><div class="diff-removed">-              portalContainer2,</div><div class="diff-added">+              portalContainer2</div><div>             ),</div><div>             ReactDOM.createPortal(</div><div>               <div key="d">portal3[0]</div>,</div><div class="diff-removed">-              portalContainer3,</div><div class="diff-added">+              portalContainer3</div><div>             ),</div><div>             <div key="e">portal1[1]</div>,</div><div>           ],</div><div class="diff-removed">-          portalContainer1,</div><div class="diff-added">+          portalContainer1</div><div>         ),</div><div>         <div key="f">normal[1]</div>,</div><div>       ]);</div><div>     });</div><div class="diff-removed">-    expect(portalContainer1.innerHTML).toBe(</div><div class="diff-removed">-      '<div>portal1[0]</div><div>portal1[1]</div>',</div><div class="diff-removed">-    );</div><div class="diff-added">+    expect(</div><div class="diff-added">+      portalContainer1.innerHTML</div><div class="diff-added">+    ).toBe('<div>portal1[0]</div><div>portal1[1]</div>');</div><div>     expect(portalContainer2.innerHTML).toBe('<div>portal2[0]</div>');</div><div>     expect(portalContainer3.innerHTML).toBe('<div>portal3[0]</div>');</div><div class="diff-removed">-    expect(container.innerHTML).toBe(</div><div class="diff-removed">-      '<div>normal[0]</div><div>normal[1]</div>',</div><div class="diff-removed">-    );</div><div class="diff-added">+    expect(container.innerHTML).toBe('<div>normal[0]</div><div>normal[1]</div>');</div><div> </div><div>     root.unmount();</div><div>     expect(portalContainer1.innerHTML).toBe('');</div><div class="diff-info">@@ -374,52 +365,54 @@   it('should reconcile portal children', async () => {</div><div>     const portalContainer = document.createElement('div');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(</div><div>         <div></div><div>           {ReactDOM.createPortal(<div>portal:1</div>, portalContainer)}</div><div class="diff-removed">-        </div>,</div><div class="diff-added">+        </div></div><div>       );</div><div>     });</div><div>     expect(portalContainer.innerHTML).toBe('<div>portal:1</div>');</div><div>     expect(container.innerHTML).toBe('<div></div>');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(</div><div>         <div></div><div>           {ReactDOM.createPortal(<div>portal:2</div>, portalContainer)}</div><div class="diff-removed">-        </div>,</div><div class="diff-added">+        </div></div><div>       );</div><div>     });</div><div>     expect(portalContainer.innerHTML).toBe('<div>portal:2</div>');</div><div>     expect(container.innerHTML).toBe('<div></div>');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(</div><div class="diff-removed">-        <div>{ReactDOM.createPortal(<p>portal:3</p>, portalContainer)}</div>,</div><div class="diff-added">+        <div>{ReactDOM.createPortal(<p>portal:3</p>, portalContainer)}</div></div><div>       );</div><div>     });</div><div>     expect(portalContainer.innerHTML).toBe('<p>portal:3</p>');</div><div>     expect(container.innerHTML).toBe('<div></div>');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(</div><div class="diff-removed">-        <div>{ReactDOM.createPortal(['Hi', 'Bye'], portalContainer)}</div>,</div><div class="diff-added">+        <div>{ReactDOM.createPortal(['Hi', 'Bye'], portalContainer)}</div></div><div>       );</div><div>     });</div><div>     expect(portalContainer.innerHTML).toBe('HiBye');</div><div>     expect(container.innerHTML).toBe('<div></div>');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(</div><div class="diff-removed">-        <div>{ReactDOM.createPortal(['Bye', 'Hi'], portalContainer)}</div>,</div><div class="diff-added">+        <div>{ReactDOM.createPortal(['Bye', 'Hi'], portalContainer)}</div></div><div>       );</div><div>     });</div><div>     expect(portalContainer.innerHTML).toBe('ByeHi');</div><div>     expect(container.innerHTML).toBe('<div></div>');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<div>{ReactDOM.createPortal(null, portalContainer)}</div>);</div><div class="diff-added">+    await act(async () => {</div><div class="diff-added">+      root.render(</div><div class="diff-added">+        <div>{ReactDOM.createPortal(null, portalContainer)}</div></div><div class="diff-added">+      );</div><div>     });</div><div>     expect(portalContainer.innerHTML).toBe('');</div><div>     expect(container.innerHTML).toBe('<div></div>');</div><div class="diff-info">@@ -427,11 +420,10 @@ </div><div>   it('should unmount empty portal component wherever it appears', async () => {</div><div>     const portalContainer = document.createElement('div');</div><div class="diff-removed">-    let instance;</div><div class="diff-added">+</div><div>     class Wrapper extends React.Component {</div><div>       constructor(props) {</div><div>         super(props);</div><div class="diff-removed">-        instance = this;</div><div>         this.state = {</div><div>           show: true,</div><div>         };</div><div class="diff-info">@@ -451,13 +443,15 @@       }</div><div>     }</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Wrapper />);</div><div class="diff-added">+    let instance;</div><div class="diff-added">+    await act(async () => {</div><div class="diff-added">+      root.render(<Wrapper ref={ref => (instance = ref)} />);</div><div>     });</div><div>     expect(container.innerHTML).toBe(</div><div class="diff-removed">-      '<div><div>child</div><div>parent</div></div>',</div><div class="diff-removed">-    );</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+      '<div><div>child</div><div>parent</div></div>'</div><div class="diff-added">+    );</div><div class="diff-added">+</div><div class="diff-added">+    await act(async () => {</div><div>       instance.setState({show: false});</div><div>     });</div><div>     expect(instance.state.show).toBe(false);</div><div class="diff-info">@@ -465,19 +459,24 @@   });</div><div> </div><div>   it('should keep track of namespace across portals (simple)', async () => {</div><div class="diff-added">+    const expectSVG = {ref: el => svgEls.push(el)};</div><div class="diff-added">+    const expectHTML = {ref: el => htmlEls.push(el)};</div><div class="diff-added">+    const expectMath = {ref: el => mathEls.push(el)};</div><div class="diff-added">+    let svgEls, htmlEls, mathEls;</div><div class="diff-added">+</div><div>     await assertNamespacesMatch(</div><div>       <svg {...expectSVG}></div><div>         <image {...expectSVG} /></div><div>         {usePortal(<div {...expectHTML} />)}</div><div>         <image {...expectSVG} /></div><div class="diff-removed">-      </svg>,</div><div class="diff-added">+      </svg></div><div>     );</div><div>     await assertNamespacesMatch(</div><div>       <math {...expectMath}></div><div>         <mi {...expectMath} /></div><div>         {usePortal(<div {...expectHTML} />)}</div><div>         <mi {...expectMath} /></div><div class="diff-removed">-      </math>,</div><div class="diff-added">+      </math></div><div>     );</div><div>     await assertNamespacesMatch(</div><div>       <div {...expectHTML}></div><div class="diff-info">@@ -485,14 +484,19 @@         {usePortal(</div><div>           <svg {...expectSVG}></div><div>             <image {...expectSVG} /></div><div class="diff-removed">-          </svg>,</div><div class="diff-added">+          </svg></div><div>         )}</div><div>         <p {...expectHTML} /></div><div class="diff-removed">-      </div>,</div><div class="diff-added">+      </div></div><div>     );</div><div>   });</div><div> </div><div>   it('should keep track of namespace across portals (medium)', async () => {</div><div class="diff-added">+    const expectSVG = {ref: el => svgEls.push(el)};</div><div class="diff-added">+    const expectHTML = {ref: el => htmlEls.push(el)};</div><div class="diff-added">+    const expectMath = {ref: el => mathEls.push(el)};</div><div class="diff-added">+    let svgEls, htmlEls, mathEls;</div><div class="diff-added">+</div><div>     await assertNamespacesMatch(</div><div>       <svg {...expectSVG}></div><div>         <image {...expectSVG} /></div><div class="diff-info">@@ -500,7 +504,7 @@         <image {...expectSVG} /></div><div>         {usePortal(<div {...expectHTML} />)}</div><div>         <image {...expectSVG} /></div><div class="diff-removed">-      </svg>,</div><div class="diff-added">+      </svg></div><div>     );</div><div>     await assertNamespacesMatch(</div><div>       <div {...expectHTML}></div><div class="diff-info">@@ -509,11 +513,11 @@           {usePortal(</div><div>             <svg {...expectSVG}></div><div>               <image {...expectSVG} /></div><div class="diff-removed">-            </svg>,</div><div class="diff-added">+            </svg></div><div>           )}</div><div>         </math></div><div>         <p {...expectHTML} /></div><div class="diff-removed">-      </div>,</div><div class="diff-added">+      </div></div><div>     );</div><div>     await assertNamespacesMatch(</div><div>       <math {...expectMath}></div><div class="diff-info">@@ -529,10 +533,10 @@               <p {...expectHTML} /></div><div>             </foreignObject></div><div>             <image {...expectSVG} /></div><div class="diff-removed">-          </svg>,</div><div class="diff-added">+          </svg></div><div>         )}</div><div>         <mi {...expectMath} /></div><div class="diff-removed">-      </math>,</div><div class="diff-added">+      </math></div><div>     );</div><div>     await assertNamespacesMatch(</div><div>       <div {...expectHTML}></div><div class="diff-info">@@ -540,10 +544,10 @@           <svg {...expectSVG}></div><div>             {usePortal(<div {...expectHTML} />)}</div><div>             <image {...expectSVG} /></div><div class="diff-removed">-          </svg>,</div><div class="diff-added">+          </svg></div><div>         )}</div><div>         <p {...expectHTML} /></div><div class="diff-removed">-      </div>,</div><div class="diff-added">+      </div></div><div>     );</div><div>     await assertNamespacesMatch(</div><div>       <svg {...expectSVG}></div><div class="diff-info">@@ -552,17 +556,22 @@           <image {...expectSVG} /></div><div>         </svg></div><div>         <image {...expectSVG} /></div><div class="diff-removed">-      </svg>,</div><div class="diff-added">+      </svg></div><div>     );</div><div>   });</div><div> </div><div>   it('should keep track of namespace across portals (complex)', async () => {</div><div class="diff-added">+    const expectSVG = {ref: el => svgEls.push(el)};</div><div class="diff-added">+    const expectHTML = {ref: el => htmlEls.push(el)};</div><div class="diff-added">+    const expectMath = {ref: el => mathEls.push(el)};</div><div class="diff-added">+    let svgEls, htmlEls, mathEls;</div><div class="diff-added">+</div><div>     await assertNamespacesMatch(</div><div>       <div {...expectHTML}></div><div>         {usePortal(</div><div>           <svg {...expectSVG}></div><div>             <image {...expectSVG} /></div><div class="diff-removed">-          </svg>,</div><div class="diff-added">+          </svg></div><div>         )}</div><div>         <p {...expectHTML} /></div><div>         <svg {...expectSVG}></div><div class="diff-info">@@ -575,7 +584,7 @@           <image {...expectSVG} /></div><div>         </svg></div><div>         <p {...expectHTML} /></div><div class="diff-removed">-      </div>,</div><div class="diff-added">+      </div></div><div>     );</div><div>     await assertNamespacesMatch(</div><div>       <div {...expectHTML}></div><div class="diff-info">@@ -589,7 +598,7 @@                   <image {...expectSVG} /></div><div>                 </svg></div><div>                 <image {...expectSVG} /></div><div class="diff-removed">-              </svg>,</div><div class="diff-added">+              </svg></div><div>             )}</div><div>             <image {...expectSVG} /></div><div>             <foreignObject {...expectSVG}></div><div class="diff-info">@@ -601,7 +610,7 @@           <image {...expectSVG} /></div><div>         </svg></div><div>         <p {...expectHTML} /></div><div class="diff-removed">-      </div>,</div><div class="diff-added">+      </div></div><div>     );</div><div>     await assertNamespacesMatch(</div><div>       <div {...expectHTML}></div><div class="diff-info">@@ -619,14 +628,14 @@                   {usePortal(<p {...expectHTML} />)}</div><div>                 </svg></div><div>                 <image {...expectSVG} /></div><div class="diff-removed">-              </svg>,</div><div class="diff-added">+              </svg></div><div>             )}</div><div>             <p {...expectHTML} /></div><div>           </foreignObject></div><div>           <image {...expectSVG} /></div><div>         </svg></div><div>         <p {...expectHTML} /></div><div class="diff-removed">-      </div>,</div><div class="diff-added">+      </div></div><div>     );</div><div>   });</div><div> </div><div class="diff-info">@@ -639,7 +648,7 @@       await assertNamespacesMatch(</div><div>         <svg {...expectSVG}></div><div>           <BrokenRender /></div><div class="diff-removed">-        </svg>,</div><div class="diff-added">+        </svg></div><div>       );</div><div>     }).rejects.toThrow('Hello');</div><div>     await assertNamespacesMatch(<div {...expectHTML} />);</div><div class="diff-info">@@ -673,7 +682,7 @@           </ErrorBoundary></div><div>         </foreignObject></div><div>         <image {...expectSVG} /></div><div class="diff-removed">-      </svg>,</div><div class="diff-added">+      </svg></div><div>     );</div><div>     await assertNamespacesMatch(<div {...expectHTML} />);</div><div>   });</div><div class="diff-info">@@ -702,13 +711,13 @@           {usePortal(</div><div>             <div {...expectHTML}></div><div>               <math {...expectMath}></div><div class="diff-removed">-                <BrokenRender />)</div><div class="diff-added">+                <BrokenRender /></div><div>               </math></div><div class="diff-removed">-            </div>,</div><div class="diff-added">+            </div></div><div>           )}</div><div>         </ErrorBoundary></div><div>         {usePortal(<div {...expectHTML} />)}</div><div class="diff-removed">-      </svg>,</div><div class="diff-added">+      </svg></div><div>     );</div><div>   });</div><div> </div><div class="diff-info">@@ -720,7 +729,6 @@       static contextTypes = {</div><div>         foo: PropTypes.string.isRequired,</div><div>       };</div><div class="diff-removed">-</div><div>       render() {</div><div>         return <div>{this.context.foo}</div>;</div><div>       }</div><div class="diff-info">@@ -730,13 +738,11 @@       static childContextTypes = {</div><div>         foo: PropTypes.string.isRequired,</div><div>       };</div><div class="diff-removed">-</div><div>       getChildContext() {</div><div>         return {</div><div>           foo: 'bar',</div><div>         };</div><div>       }</div><div class="diff-removed">-</div><div>       render() {</div><div>         return ReactDOM.createPortal(<Component />, portalContainer);</div><div>       }</div><div class="diff-info">@@ -746,449 +752,105 @@       root.render(<Parent />);</div><div>     });</div><div>     assertConsoleErrorDev([</div><div class="diff-removed">-      'Parent uses the legacy childContextTypes API which will soon be removed. ' +</div><div class="diff-removed">-        'Use React.createContext() instead. (https://react.dev/link/legacy-context)\n' +</div><div class="diff-removed">-        '    in Parent (at **)',</div><div class="diff-removed">-      'Component uses the legacy contextTypes API which will soon be removed. ' +</div><div class="diff-removed">-        'Use React.createContext() with static contextType instead. (https://react.dev/link/legacy-context)\n' +</div><div class="diff-removed">-        '    in Parent (at **)',</div><div class="diff-added">+      'Parent uses the legacy childContextTypes API which will soon be removed. Use React.createContext() instead.',</div><div class="diff-added">+      'Component uses the legacy contextTypes API which will soon be removed. Use React.createContext() with static contextType instead.',</div><div>     ]);</div><div>     expect(container.innerHTML).toBe('');</div><div>     expect(portalContainer.innerHTML).toBe('<div>bar</div>');</div><div>   });</div><div> </div><div class="diff-removed">-  it('should bubble events from the portal to the parent', async () => {</div><div class="diff-removed">-    const portalContainer = document.createElement('div');</div><div class="diff-removed">-    document.body.appendChild(portalContainer);</div><div class="diff-removed">-    try {</div><div class="diff-removed">-      let portal = null;</div><div class="diff-removed">-</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(</div><div class="diff-removed">-          <div onClick={() => Scheduler.log('parent clicked')}></div><div class="diff-removed">-            {ReactDOM.createPortal(</div><div class="diff-removed">-              <div</div><div class="diff-removed">-                onClick={() => Scheduler.log('portal clicked')}</div><div class="diff-removed">-                ref={n => (portal = n)}></div><div class="diff-removed">-                portal</div><div class="diff-removed">-              </div>,</div><div class="diff-removed">-              portalContainer,</div><div class="diff-removed">-            )}</div><div class="diff-removed">-          </div>,</div><div class="diff-removed">-        );</div><div class="diff-removed">-      });</div><div class="diff-removed">-</div><div class="diff-removed">-      expect(portal.tagName).toBe('DIV');</div><div class="diff-removed">-</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        portal.click();</div><div class="diff-removed">-      });</div><div class="diff-removed">-</div><div class="diff-removed">-      assertLog(['portal clicked', 'parent clicked']);</div><div class="diff-removed">-    } finally {</div><div class="diff-removed">-      document.body.removeChild(portalContainer);</div><div class="diff-removed">-    }</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should not onMouseLeave when staying in the portal', async () => {</div><div class="diff-removed">-    const portalContainer = document.createElement('div');</div><div class="diff-removed">-    document.body.appendChild(portalContainer);</div><div class="diff-removed">-</div><div class="diff-removed">-    let firstTarget = null;</div><div class="diff-removed">-    let secondTarget = null;</div><div class="diff-removed">-    let thirdTarget = null;</div><div class="diff-removed">-</div><div class="diff-removed">-    function simulateMouseMove(from, to) {</div><div class="diff-removed">-      if (from) {</div><div class="diff-removed">-        from.dispatchEvent(</div><div class="diff-removed">-          new MouseEvent('mouseout', {</div><div class="diff-removed">-            bubbles: true,</div><div class="diff-removed">-            cancelable: true,</div><div class="diff-removed">-            relatedTarget: to,</div><div class="diff-removed">-          }),</div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-      if (to) {</div><div class="diff-removed">-        to.dispatchEvent(</div><div class="diff-removed">-          new MouseEvent('mouseover', {</div><div class="diff-removed">-            bubbles: true,</div><div class="diff-removed">-            cancelable: true,</div><div class="diff-removed">-            relatedTarget: from,</div><div class="diff-removed">-          }),</div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    try {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(</div><div class="diff-removed">-          <div></div><div class="diff-removed">-            <div</div><div class="diff-removed">-              onMouseEnter={() => Scheduler.log('enter parent')}</div><div class="diff-removed">-              onMouseLeave={() => Scheduler.log('leave parent')}></div><div class="diff-removed">-              <div ref={n => (firstTarget = n)} /></div><div class="diff-removed">-              {ReactDOM.createPortal(</div><div class="diff-removed">-                <div</div><div class="diff-removed">-                  onMouseEnter={() => Scheduler.log('enter portal')}</div><div class="diff-removed">-                  onMouseLeave={() => Scheduler.log('leave portal')}</div><div class="diff-removed">-                  ref={n => (secondTarget = n)}></div><div class="diff-removed">-                  portal</div><div class="diff-removed">-                </div>,</div><div class="diff-removed">-                portalContainer,</div><div class="diff-removed">-              )}</div><div class="diff-removed">-            </div></div><div class="diff-removed">-            <div ref={n => (thirdTarget = n)} /></div><div class="diff-removed">-          </div>,</div><div class="diff-removed">-        );</div><div class="diff-removed">-      });</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        simulateMouseMove(null, firstTarget);</div><div class="diff-removed">-      });</div><div class="diff-removed">-      assertLog(['enter parent']);</div><div class="diff-removed">-</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        simulateMouseMove(firstTarget, secondTarget);</div><div class="diff-removed">-      });</div><div class="diff-removed">-      assertLog([</div><div class="diff-removed">-        // Parent did not invoke leave because we're still inside the portal.</div><div class="diff-removed">-        'enter portal',</div><div class="diff-removed">-      ]);</div><div class="diff-removed">-</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        simulateMouseMove(secondTarget, thirdTarget);</div><div class="diff-removed">-      });</div><div class="diff-removed">-      assertLog([</div><div class="diff-removed">-        'leave portal',</div><div class="diff-removed">-        'leave parent', // Only when we leave the portal does onMouseLeave fire.</div><div class="diff-removed">-      ]);</div><div class="diff-removed">-    } finally {</div><div class="diff-removed">-      document.body.removeChild(portalContainer);</div><div class="diff-removed">-    }</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // Regression test for https://github.com/facebook/react/issues/19562</div><div class="diff-removed">-  it('does not fire mouseEnter twice when relatedTarget is the root node', async () => {</div><div class="diff-removed">-    let target = null;</div><div class="diff-removed">-</div><div class="diff-removed">-    function simulateMouseMove(from, to) {</div><div class="diff-removed">-      if (from) {</div><div class="diff-removed">-        from.dispatchEvent(</div><div class="diff-removed">-          new MouseEvent('mouseout', {</div><div class="diff-removed">-            bubbles: true,</div><div class="diff-removed">-            cancelable: true,</div><div class="diff-removed">-            relatedTarget: to,</div><div class="diff-removed">-          }),</div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-      if (to) {</div><div class="diff-removed">-        to.dispatchEvent(</div><div class="diff-removed">-          new MouseEvent('mouseover', {</div><div class="diff-removed">-            bubbles: true,</div><div class="diff-removed">-            cancelable: true,</div><div class="diff-removed">-            relatedTarget: from,</div><div class="diff-removed">-          }),</div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(</div><div class="diff-removed">-        <div</div><div class="diff-removed">-          ref={n => (target = n)}</div><div class="diff-removed">-          onMouseEnter={() => Scheduler.log('enter')}</div><div class="diff-removed">-          onMouseLeave={() => Scheduler.log('leave')}</div><div class="diff-removed">-        />,</div><div class="diff-removed">-      );</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      simulateMouseMove(null, container);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      simulateMouseMove(container, target);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['enter']);</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      simulateMouseMove(target, container);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['leave']);</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      simulateMouseMove(container, null);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('listens to events that do not exist in the Portal subtree', async () => {</div><div class="diff-removed">-    const onClick = jest.fn();</div><div class="diff-removed">-</div><div class="diff-removed">-    const ref = React.createRef();</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(</div><div class="diff-removed">-        <div onClick={onClick}></div><div class="diff-removed">-          {ReactDOM.createPortal(</div><div class="diff-removed">-            <button ref={ref}>click</button>,</div><div class="diff-removed">-            document.body,</div><div class="diff-removed">-          )}</div><div class="diff-removed">-        </div>,</div><div class="diff-removed">-      );</div><div class="diff-removed">-    });</div><div class="diff-removed">-    const event = new MouseEvent('click', {</div><div class="diff-removed">-      bubbles: true,</div><div class="diff-removed">-    });</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      ref.current.dispatchEvent(event);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(onClick).toHaveBeenCalledTimes(1);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should throw on bad createPortal argument', () => {</div><div class="diff-removed">-    expect(() => {</div><div class="diff-removed">-      ReactDOM.createPortal(<div>portal</div>, null);</div><div class="diff-removed">-    }).toThrow('Target container is not a DOM element.');</div><div class="diff-removed">-    expect(() => {</div><div class="diff-removed">-      ReactDOM.createPortal(<div>portal</div>, document.createTextNode('hi'));</div><div class="diff-removed">-    }).toThrow('Target container is not a DOM element.');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn for non-functional event listeners', () => {</div><div class="diff-removed">-    class Example extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div onClick="woops" />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Example />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Expected `onClick` listener to be a function, instead got a value of `string` type.\n' +</div><div class="diff-removed">-        '    in div (at **)\n' +</div><div class="diff-removed">-        '    in Example (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn with a special message for `false` event listeners', () => {</div><div class="diff-removed">-    class Example extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div onClick={false} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Example />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Expected `onClick` listener to be a function, instead got `false`.\n\n' +</div><div class="diff-removed">-        'If you used to conditionally omit it with onClick={condition && value}, ' +</div><div class="diff-removed">-        'pass onClick={condition ? value : undefined} instead.\n' +</div><div class="diff-removed">-        '    in div (at **)\n' +</div><div class="diff-removed">-        '    in Example (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should not update event handlers until commit', async () => {</div><div class="diff-removed">-    const handlerA = () => Scheduler.log('A');</div><div class="diff-removed">-    const handlerB = () => Scheduler.log('B');</div><div class="diff-removed">-</div><div class="diff-removed">-    function click() {</div><div class="diff-removed">-      const event = new MouseEvent('click', {</div><div class="diff-removed">-        bubbles: true,</div><div class="diff-removed">-        cancelable: true,</div><div class="diff-removed">-      });</div><div class="diff-removed">-      Object.defineProperty(event, 'timeStamp', {</div><div class="diff-removed">-        value: 0,</div><div class="diff-removed">-      });</div><div class="diff-removed">-      node.dispatchEvent(event);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Example extends React.Component {</div><div class="diff-removed">-      state = {flip: false, count: 0};</div><div class="diff-removed">-      flip() {</div><div class="diff-removed">-        this.setState({flip: true, count: this.state.count + 1});</div><div class="diff-removed">-      }</div><div class="diff-removed">-      tick() {</div><div class="diff-removed">-        this.setState({count: this.state.count + 1});</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        const useB = !this.props.forceA && this.state.flip;</div><div class="diff-removed">-        return <div onClick={useB ? handlerB : handlerA} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Click extends React.Component {</div><div class="diff-removed">-      constructor() {</div><div class="diff-removed">-        super();</div><div class="diff-removed">-        node.click();</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    let inst;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render([<Example key="a" ref={n => (inst = n)} />]);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    const node = container.firstChild;</div><div class="diff-removed">-    expect(node.tagName).toEqual('DIV');</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      click();</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog(['A']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Render with the other event handler.</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      inst.flip();</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      click();</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog(['B']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Rerender without changing any props.</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      inst.tick();</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      click();</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog(['B']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Render a flip back to the A handler. The second component invokes the</div><div class="diff-removed">-    // click handler during render to simulate a click during an aborted</div><div class="diff-removed">-    // render. I use this hack because at current time we don't have a way to</div><div class="diff-removed">-    // test aborted ReactDOM renders.</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render([<Example key="a" forceA={true} />, <Click key="b" />]);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    // Because the new click handler has not yet committed, we should still</div><div class="diff-removed">-    // invoke B.</div><div class="diff-removed">-    assertLog(['B']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Any click that happens after commit, should invoke A.</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      click();</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['A']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div>   it('should not crash encountering low-priority tree', async () => {</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(</div><div>         <div hidden={true}></div><div>           <div /></div><div class="diff-removed">-        </div>,</div><div class="diff-removed">-      );</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-added">+        </div></div><div class="diff-added">+      );</div><div class="diff-added">+    });</div><div>     expect(container.innerHTML).toBe('<div hidden=""><div></div></div>');</div><div>   });</div><div> </div><div>   it('should not warn when rendering into an empty container', async () => {</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div>foo</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('<div>foo</div>');</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(null);</div><div>     });</div><div>     expect(container.innerHTML).toBe('');</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div>bar</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('<div>bar</div>');</div><div>   });</div><div> </div><div>   it('should warn when replacing a container which was manually updated outside of React', async () => {</div><div class="diff-removed">-    // when not messing with the DOM outside of React</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div key="1">foo</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('<div>foo</div>');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div key="1">bar</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('<div>bar</div>');</div><div> </div><div class="diff-removed">-    // then we mess with the DOM before an update</div><div class="diff-removed">-    // we know this will error - that is expected right now</div><div class="diff-removed">-    // It's an error of type 'NotFoundError' with no message</div><div>     container.innerHTML = '<div>MEOW.</div>';</div><div class="diff-removed">-</div><div>     await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        ReactDOM.flushSync(() => {</div><div class="diff-removed">-          root.render(<div key="2">baz</div>);</div><div class="diff-removed">-        });</div><div class="diff-added">+      ReactDOM.flushSync(() => {</div><div class="diff-added">+        root.render(<div key="2">baz</div>);</div><div>       });</div><div>     }).rejects.toThrow('The node to be removed is not a child of this node');</div><div>   });</div><div> </div><div>   it('should not warn when doing an update to a container manually updated outside of React', async () => {</div><div class="diff-removed">-    // when not messing with the DOM outside of React</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div>foo</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('<div>foo</div>');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div>bar</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('<div>bar</div>');</div><div> </div><div class="diff-removed">-    // then we mess with the DOM before an update</div><div>     container.innerHTML = '<div>MEOW.</div>';</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div>baz</div>);</div><div>     });</div><div class="diff-removed">-    // TODO: why not, and no error?</div><div class="diff-added">+    // no change, and no error</div><div>     expect(container.innerHTML).toBe('<div>MEOW.</div>');</div><div>   });</div><div> </div><div>   it('should not warn when doing an update to a container manually cleared outside of React', async () => {</div><div class="diff-removed">-    // when not messing with the DOM outside of React</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div>foo</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('<div>foo</div>');</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div>bar</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('<div>bar</div>');</div><div> </div><div class="diff-removed">-    // then we mess with the DOM before an update</div><div>     container.innerHTML = '';</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<div>baz</div>);</div><div>     });</div><div class="diff-removed">-    // TODO: why not, and no error?</div><div class="diff-added">+    // no change, and no error</div><div>     expect(container.innerHTML).toBe('');</div><div>   });</div><div> </div><div>   it('should render a text component with a text DOM node on the same document as the container', async () => {</div><div class="diff-removed">-    // 1. Create a new document through the use of iframe</div><div class="diff-removed">-    // 2. Set up the spy to make asserts when a text component</div><div class="diff-removed">-    //    is rendered inside the iframe container</div><div>     const textContent = 'Hello world';</div><div>     const iframe = document.createElement('iframe');</div><div>     document.body.appendChild(iframe);</div><div>     const iframeDocument = iframe.contentDocument;</div><div>     iframeDocument.write(</div><div class="diff-removed">-      '<!DOCTYPE html><html><head></head><body><div></div></body></html>',</div><div class="diff-added">+      '<!DOCTYPE html><html><head></head><body><div></div></body></html>'</div><div>     );</div><div>     iframeDocument.close();</div><div>     const iframeContainer = iframeDocument.body.firstChild;</div><div class="diff-info">@@ -1196,14 +858,14 @@     let actualDocument;</div><div>     let textNode;</div><div> </div><div class="diff-removed">-    spyOnDevAndProd(iframeContainer, 'appendChild').mockImplementation(node => {</div><div class="diff-added">+    spyOnDevAndProd(iframeContainer, 'appendChild').and.callFake(node => {</div><div>       actualDocument = node.ownerDocument;</div><div>       textNode = node;</div><div>     });</div><div> </div><div class="diff-removed">-    const iFrameRoot = ReactDOMClient.createRoot(iframeContainer);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      iFrameRoot.render(textContent);</div><div class="diff-added">+    const iframeRoot = ReactDOMClient.createRoot(iframeContainer);</div><div class="diff-added">+    await act(async () => {</div><div class="diff-added">+      iframeRoot.render(textContent);</div><div>     });</div><div> </div><div>     expect(textNode.textContent).toBe(textContent);</div><div class="diff-info">@@ -1215,7 +877,7 @@   it('should mount into a document fragment', async () => {</div><div>     const fragment = document.createDocumentFragment();</div><div>     const fragmentRoot = ReactDOMClient.createRoot(fragment);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       fragmentRoot.render(<div>foo</div>);</div><div>     });</div><div>     expect(container.innerHTML).toBe('');</div><div class="diff-info">@@ -1223,7 +885,6 @@     expect(container.innerHTML).toBe('<div>foo</div>');</div><div>   });</div><div> </div><div class="diff-removed">-  // Regression test for https://github.com/facebook/react/issues/12643#issuecomment-413727104</div><div>   it('should not diff memoized host components', async () => {</div><div>     const inputRef = React.createRef();</div><div>     let didCallOnChange = false;</div><div class="diff-info">@@ -1237,17 +898,7 @@         document.removeEventListener('click', this.update, true);</div><div>       }</div><div>       update = () => {</div><div class="diff-removed">-        // We're testing that this setState()</div><div class="diff-removed">-        // doesn't cause React to commit updates</div><div class="diff-removed">-        // to the input outside (which would itself</div><div class="diff-removed">-        // prevent the parent's onChange parent handler</div><div class="diff-removed">-        // from firing).</div><div>         this.setState({});</div><div class="diff-removed">-        // Note that onChange was always broken when there was an</div><div class="diff-removed">-        // earlier setState() in a manual document capture phase</div><div class="diff-removed">-        // listener *in the same component*. But that's very rare.</div><div class="diff-removed">-        // Here we're testing that a *child* component doesn't break</div><div class="diff-removed">-        // the parent if this happens.</div><div>       };</div><div>       render() {</div><div>         return <div />;</div><div class="diff-info">@@ -1255,7 +906,7 @@     }</div><div> </div><div>     class Parent extends React.Component {</div><div class="diff-removed">-      handleChange = val => {</div><div class="diff-added">+      handleChange = () => {</div><div>         didCallOnChange = true;</div><div>       };</div><div>       render() {</div><div class="diff-info">@@ -1273,39 +924,32 @@       }</div><div>     }</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<Parent />);</div><div>     });</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       inputRef.current.dispatchEvent(</div><div>         new MouseEvent('click', {</div><div>           bubbles: true,</div><div class="diff-removed">-        }),</div><div class="diff-added">+        })</div><div>       );</div><div>     });</div><div>     expect(didCallOnChange).toBe(true);</div><div>   });</div><div> </div><div>   it('should restore selection in the correct window', async () => {</div><div class="diff-removed">-    // creating new JSDOM instance to get a second window as window.open is not implemented</div><div class="diff-removed">-    // https://github.com/jsdom/jsdom/blob/c53efc81e75f38a0558fbf3ed75d30b78b4c4898/lib/jsdom/browser/Window.js#L987</div><div>     const {window: newWindow} = new JSDOM('');</div><div class="diff-removed">-    // creating a new container since the default cleanup expects the existing container to be in the document</div><div>     const newContainer = newWindow.document.createElement('div');</div><div>     newWindow.document.body.appendChild(newContainer);</div><div>     root = ReactDOMClient.createRoot(newContainer);</div><div> </div><div>     const Test = () => {</div><div>       const [reverse, setReverse] = React.useState(false);</div><div class="diff-removed">-      const [items] = React.useState(() => ['a', 'b', 'c']);</div><div class="diff-added">+      const [items] = React.useState(['a', 'b', 'c']);</div><div>       const onClick = () => {</div><div>         setReverse(true);</div><div>       };</div><div class="diff-removed">-</div><div class="diff-removed">-      // shuffle the items so that the react commit needs to restore focus</div><div class="diff-removed">-      // to the correct element after commit</div><div>       const itemsToRender = reverse ? items.reverse() : items;</div><div class="diff-removed">-</div><div>       return (</div><div>         <div></div><div>           {itemsToRender.map(item => (</div><div class="diff-info">@@ -1317,12 +961,12 @@       );</div><div>     };</div><div> </div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       root.render(<Test />);</div><div>     });</div><div> </div><div>     newWindow.document.getElementById('a').focus();</div><div class="diff-removed">-    await act(() => {</div><div class="diff-added">+    await act(async () => {</div><div>       newWindow.document.getElementById('a').click();</div><div>     });</div><div> </div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    