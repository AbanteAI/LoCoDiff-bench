<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: lib/segment/src/index/field_index/full_text_index/text_index.rs - o4-mini-high</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: lib/segment/src/index/field_index/full_text_index/text_index.rs</h1>
        <h2>Model: o4-mini-high</h2>
        <p><a href="../../models/openai_o4-mini-high.html">All o4-mini-high Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> o4-mini-high</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 34279</p>
                <p><strong>Native Prompt Tokens:</strong> 34289</p>
                <p><strong>Native Completion Tokens:</strong> 21585</p>
                <p><strong>Native Tokens Reasoning:</strong> 18624</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.1326919</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_o4-mini-high/qdrant_lib_segment_src_index_field_index_full_text_index_text_index.rs/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_o4-mini-high/qdrant_lib_segment_src_index_field_index_full_text_index_text_index.rs/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_o4-mini-high/qdrant_lib_segment_src_index_field_index_full_text_index_text_index.rs/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 9edafaca..af79a00f 100644</div><div class="diff-header">--- a/qdrant_lib_segment_src_index_field_index_full_text_index_text_index.rs_expectedoutput.txt (expected):tmp/tmphj1w0i0b_expected.txt	</div><div class="diff-header">+++ b/qdrant_lib_segment_src_index_field_index_full_text_index_text_index.rs_extracted.txt (actual):tmp/tmpr3fqksuj_actual.txt	</div><div class="diff-info">@@ -9,20 +9,17 @@ use rocksdb::DB;</div><div> use serde::{Deserialize, Serialize};</div><div> use serde_json::Value;</div><div> </div><div class="diff-removed">-use super::immutable_text_index::ImmutableFullTextIndex;</div><div class="diff-removed">-use super::inverted_index::{Document, InvertedIndex, ParsedQuery, TokenId};</div><div class="diff-removed">-use super::mmap_text_index::{FullTextMmapIndexBuilder, MmapFullTextIndex};</div><div class="diff-removed">-use super::mutable_text_index::MutableFullTextIndex;</div><div class="diff-removed">-use super::tokenizers::Tokenizer;</div><div class="diff-removed">-use crate::common::Flusher;</div><div> use crate::common::operation_error::{OperationError, OperationResult};</div><div> use crate::common::rocksdb_buffered_delete_wrapper::DatabaseColumnScheduledDeleteWrapper;</div><div> use crate::common::rocksdb_wrapper::DatabaseColumnWrapper;</div><div class="diff-added">+use crate::common::Flusher;</div><div> use crate::data_types::index::TextIndexParams;</div><div class="diff-removed">-use crate::index::field_index::{</div><div class="diff-removed">-    CardinalityEstimation, FieldIndexBuilderTrait, PayloadBlockCondition, PayloadFieldIndex,</div><div class="diff-removed">-    ValueIndexer,</div><div class="diff-removed">-};</div><div class="diff-added">+use crate::index::field_index::full_text_index::inverted_index::{Document, InvertedIndex, ParsedQuery, TokenId};</div><div class="diff-added">+use crate::index::field_index::full_text_index::immutable_text_index::ImmutableFullTextIndex;</div><div class="diff-added">+use crate::index::field_index::full_text_index::mutable_text_index::MutableFullTextIndex;</div><div class="diff-added">+use crate::index::field_index::full_text_index::mmap_text_index::{FullTextMmapIndexBuilder, MmapFullTextIndex};</div><div class="diff-added">+use crate::index::field_index::full_text_index::tokenizers::Tokenizer;</div><div class="diff-added">+use crate::index::field_index::{CardinalityEstimation, FieldIndexBuilderTrait, PayloadBlockCondition, PayloadFieldIndex, ValueIndexer};</div><div> use crate::telemetry::PayloadIndexTelemetry;</div><div> use crate::types::{FieldCondition, Match, PayloadKeyType};</div><div> </div><div class="diff-info">@@ -45,9 +42,9 @@ impl FullTextIndex {</div><div>             &store_cf_name,</div><div>         ));</div><div>         if is_appendable {</div><div class="diff-removed">-            Self::Mutable(MutableFullTextIndex::new(db_wrapper, config))</div><div class="diff-added">+            FullTextIndex::Mutable(MutableFullTextIndex::new(db_wrapper, config))</div><div>         } else {</div><div class="diff-removed">-            Self::Immutable(ImmutableFullTextIndex::new(db_wrapper, config))</div><div class="diff-added">+            FullTextIndex::Immutable(ImmutableFullTextIndex::new(db_wrapper, config))</div><div>         }</div><div>     }</div><div> </div><div class="diff-info">@@ -56,16 +53,14 @@ impl FullTextIndex {</div><div>         config: TextIndexParams,</div><div>         is_on_disk: bool,</div><div>     ) -> OperationResult<Self> {</div><div class="diff-removed">-        Ok(Self::Mmap(Box::new(MmapFullTextIndex::open(</div><div class="diff-removed">-            path, config, is_on_disk,</div><div class="diff-removed">-        )?)))</div><div class="diff-added">+        Ok(FullTextIndex::Mmap(Box::new(MmapFullTextIndex::open(path, config, is_on_disk)?)))</div><div>     }</div><div> </div><div>     pub fn init(&mut self) -> OperationResult<()> {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.init(),</div><div class="diff-removed">-            Self::Immutable(index) => index.init(),</div><div class="diff-removed">-            Self::Mmap(_) => unreachable!("not applicable for mmap immutable index"),</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.init(),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.init(),</div><div class="diff-added">+            FullTextIndex::Mmap(_) => unreachable!("not applicable for mmap immutable index"),</div><div>         }</div><div>     }</div><div> </div><div class="diff-info">@@ -74,7 +69,7 @@ impl FullTextIndex {</div><div>         config: TextIndexParams,</div><div>         field: &str,</div><div>     ) -> FullTextIndexBuilder {</div><div class="diff-removed">-        FullTextIndexBuilder(Self::new_memory(db, config, field, true))</div><div class="diff-added">+        FullTextIndexBuilder(FullTextIndex::new_memory(db, config, field, true))</div><div>     }</div><div> </div><div>     pub fn builder_mmap(</div><div class="diff-info">@@ -91,25 +86,25 @@ impl FullTextIndex {</div><div> </div><div>     fn config(&self) -> &TextIndexParams {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => &index.config,</div><div class="diff-removed">-            Self::Immutable(index) => &index.config,</div><div class="diff-removed">-            Self::Mmap(index) => &index.config,</div><div class="diff-added">+            FullTextIndex::Mutable(index) => &index.config,</div><div class="diff-added">+            FullTextIndex::Immutable(index) => &index.config,</div><div class="diff-added">+            FullTextIndex::Mmap(index) => &index.config,</div><div>         }</div><div>     }</div><div> </div><div>     fn points_count(&self) -> usize {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.inverted_index.points_count(),</div><div class="diff-removed">-            Self::Immutable(index) => index.inverted_index.points_count(),</div><div class="diff-removed">-            Self::Mmap(index) => index.inverted_index.points_count(),</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.inverted_index.points_count(),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.inverted_index.points_count(),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.inverted_index.points_count(),</div><div>         }</div><div>     }</div><div> </div><div>     fn get_token(&self, token: &str, hw_counter: &HardwareCounterCell) -> Option<TokenId> {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.inverted_index.get_token_id(token, hw_counter),</div><div class="diff-removed">-            Self::Immutable(index) => index.inverted_index.get_token_id(token, hw_counter),</div><div class="diff-removed">-            Self::Mmap(index) => index.inverted_index.get_token_id(token, hw_counter),</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.inverted_index.get_token_id(token, hw_counter),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.inverted_index.get_token_id(token, hw_counter),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.inverted_index.get_token_id(token, hw_counter),</div><div>         }</div><div>     }</div><div> </div><div class="diff-info">@@ -119,40 +114,9 @@ impl FullTextIndex {</div><div>         hw_counter: &'a HardwareCounterCell,</div><div>     ) -> Box<dyn Iterator<Item = PointOffsetType> + 'a> {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.inverted_index.filter(query, hw_counter),</div><div class="diff-removed">-            Self::Immutable(index) => index.inverted_index.filter(query, hw_counter),</div><div class="diff-removed">-            Self::Mmap(index) => index.inverted_index.filter(query, hw_counter),</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn payload_blocks(</div><div class="diff-removed">-        &self,</div><div class="diff-removed">-        threshold: usize,</div><div class="diff-removed">-        key: PayloadKeyType,</div><div class="diff-removed">-    ) -> Box<dyn Iterator<Item = PayloadBlockCondition> + '_> {</div><div class="diff-removed">-        match self {</div><div class="diff-removed">-            Self::Mutable(index) => Box::new(index.inverted_index.payload_blocks(threshold, key)),</div><div class="diff-removed">-            Self::Immutable(index) => Box::new(index.inverted_index.payload_blocks(threshold, key)),</div><div class="diff-removed">-            Self::Mmap(index) => Box::new(index.inverted_index.payload_blocks(threshold, key)),</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn estimate_cardinality(</div><div class="diff-removed">-        &self,</div><div class="diff-removed">-        query: &ParsedQuery,</div><div class="diff-removed">-        condition: &FieldCondition,</div><div class="diff-removed">-        hw_counter: &HardwareCounterCell,</div><div class="diff-removed">-    ) -> CardinalityEstimation {</div><div class="diff-removed">-        match self {</div><div class="diff-removed">-            Self::Mutable(index) => index</div><div class="diff-removed">-                .inverted_index</div><div class="diff-removed">-                .estimate_cardinality(query, condition, hw_counter),</div><div class="diff-removed">-            Self::Immutable(index) => index</div><div class="diff-removed">-                .inverted_index</div><div class="diff-removed">-                .estimate_cardinality(query, condition, hw_counter),</div><div class="diff-removed">-            Self::Mmap(index) => index</div><div class="diff-removed">-                .inverted_index</div><div class="diff-removed">-                .estimate_cardinality(query, condition, hw_counter),</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.inverted_index.filter(query, hw_counter),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.inverted_index.filter(query, hw_counter),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.inverted_index.filter(query, hw_counter),</div><div>         }</div><div>     }</div><div> </div><div class="diff-info">@@ -163,76 +127,9 @@ impl FullTextIndex {</div><div>         hw_counter: &HardwareCounterCell,</div><div>     ) -> bool {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index</div><div class="diff-removed">-                .inverted_index</div><div class="diff-removed">-                .check_match(query, point_id, hw_counter),</div><div class="diff-removed">-            Self::Immutable(index) => index</div><div class="diff-removed">-                .inverted_index</div><div class="diff-removed">-                .check_match(query, point_id, hw_counter),</div><div class="diff-removed">-            Self::Mmap(index) => index</div><div class="diff-removed">-                .inverted_index</div><div class="diff-removed">-                .check_match(query, point_id, hw_counter),</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    pub fn values_count(&self, point_id: PointOffsetType) -> usize {</div><div class="diff-removed">-        match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.inverted_index.values_count(point_id),</div><div class="diff-removed">-            Self::Immutable(index) => index.inverted_index.values_count(point_id),</div><div class="diff-removed">-            Self::Mmap(index) => index.inverted_index.values_count(point_id),</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    pub fn values_is_empty(&self, point_id: PointOffsetType) -> bool {</div><div class="diff-removed">-        match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.inverted_index.values_is_empty(point_id),</div><div class="diff-removed">-            Self::Immutable(index) => index.inverted_index.values_is_empty(point_id),</div><div class="diff-removed">-            Self::Mmap(index) => index.inverted_index.values_is_empty(point_id),</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    pub(super) fn store_key(id: PointOffsetType) -> Vec<u8> {</div><div class="diff-removed">-        bincode::serialize(&id).unwrap()</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    pub(super) fn restore_key(data: &[u8]) -> PointOffsetType {</div><div class="diff-removed">-        bincode::deserialize(data).unwrap()</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    pub(super) fn serialize_document_tokens(tokens: BTreeSet<String>) -> OperationResult<Vec<u8>> {</div><div class="diff-removed">-        #[derive(Serialize)]</div><div class="diff-removed">-        struct StoredDocument {</div><div class="diff-removed">-            tokens: BTreeSet<String>,</div><div class="diff-removed">-        }</div><div class="diff-removed">-        let doc = StoredDocument { tokens };</div><div class="diff-removed">-        serde_cbor::to_vec(&doc).map_err(|e| {</div><div class="diff-removed">-            OperationError::service_error(format!("Failed to serialize document: {e}"))</div><div class="diff-removed">-        })</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    pub(super) fn deserialize_document(data: &[u8]) -> OperationResult<BTreeSet<String>> {</div><div class="diff-removed">-        #[derive(Deserialize)]</div><div class="diff-removed">-        struct StoredDocument {</div><div class="diff-removed">-            tokens: BTreeSet<String>,</div><div class="diff-removed">-        }</div><div class="diff-removed">-        serde_cbor::from_slice::<StoredDocument>(data)</div><div class="diff-removed">-            .map_err(|e| {</div><div class="diff-removed">-                OperationError::service_error(format!("Failed to deserialize document: {e}"))</div><div class="diff-removed">-            })</div><div class="diff-removed">-            .map(|doc| doc.tokens)</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    pub fn get_telemetry_data(&self) -> PayloadIndexTelemetry {</div><div class="diff-removed">-        PayloadIndexTelemetry {</div><div class="diff-removed">-            field_name: None,</div><div class="diff-removed">-            index_type: match self {</div><div class="diff-removed">-                FullTextIndex::Mutable(_) => "mutable_full_text",</div><div class="diff-removed">-                FullTextIndex::Immutable(_) => "immutable_full_text",</div><div class="diff-removed">-                FullTextIndex::Mmap(_) => "mmap_full_text",</div><div class="diff-removed">-            },</div><div class="diff-removed">-            points_values_count: self.points_count(),</div><div class="diff-removed">-            points_count: self.points_count(),</div><div class="diff-removed">-            histogram_bucket_size: None,</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.inverted_index.check_match(query, point_id, hw_counter),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.inverted_index.check_match(query, point_id, hw_counter),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.inverted_index.check_match(query, point_id, hw_counter),</div><div>         }</div><div>     }</div><div> </div><div class="diff-info">@@ -266,33 +163,69 @@ impl FullTextIndex {</div><div>         self.filter(parsed_query, hw_counter)</div><div>     }</div><div> </div><div class="diff-removed">-    pub fn is_on_disk(&self) -> bool {</div><div class="diff-added">+    pub fn values_count(&self, point_id: PointOffsetType) -> usize {</div><div>         match self {</div><div class="diff-removed">-            FullTextIndex::Mutable(_) => false,</div><div class="diff-removed">-            FullTextIndex::Immutable(_) => false,</div><div class="diff-removed">-            FullTextIndex::Mmap(index) => index.is_on_disk(),</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.inverted_index.values_count(point_id),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.inverted_index.values_count(point_id),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.inverted_index.values_count(point_id),</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    /// Populate all pages in the mmap.</div><div class="diff-removed">-    /// Block until all pages are populated.</div><div class="diff-removed">-    pub fn populate(&self) -> OperationResult<()> {</div><div class="diff-added">+    pub fn values_is_empty(&self, point_id: PointOffsetType) -> bool {</div><div>         match self {</div><div class="diff-removed">-            FullTextIndex::Mutable(_) => {}   // Not a mmap</div><div class="diff-removed">-            FullTextIndex::Immutable(_) => {} // Not a mmap</div><div class="diff-removed">-            FullTextIndex::Mmap(index) => index.populate()?,</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.inverted_index.values_is_empty(point_id),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.inverted_index.values_is_empty(point_id),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.inverted_index.values_is_empty(point_id),</div><div>         }</div><div class="diff-removed">-        Ok(())</div><div>     }</div><div> </div><div class="diff-removed">-    /// Drop disk cache.</div><div class="diff-removed">-    pub fn clear_cache(&self) -> OperationResult<()> {</div><div class="diff-added">+    pub fn get_telemetry_data(&self) -> PayloadIndexTelemetry {</div><div class="diff-added">+        PayloadIndexTelemetry {</div><div class="diff-added">+            field_name: None,</div><div class="diff-added">+            index_type: match self {</div><div class="diff-added">+                FullTextIndex::Mutable(_) => "mutable_full_text",</div><div class="diff-added">+                FullTextIndex::Immutable(_) => "immutable_full_text",</div><div class="diff-added">+                FullTextIndex::Mmap(_) => "mmap_full_text",</div><div class="diff-added">+            },</div><div class="diff-added">+            points_values_count: self.points_count(),</div><div class="diff-added">+            points_count: self.points_count(),</div><div class="diff-added">+            histogram_bucket_size: None,</div><div class="diff-added">+        }</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    pub fn store_key(id: PointOffsetType) -> Vec<u8> {</div><div class="diff-added">+        bincode::serialize(&id).unwrap()</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    pub fn restore_key(data: &[u8]) -> PointOffsetType {</div><div class="diff-added">+        bincode::deserialize(data).unwrap()</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    fn serialize_document_tokens(tokens: BTreeSet<String>) -> OperationResult<Vec<u8>> {</div><div class="diff-added">+        #[derive(Serialize)]</div><div class="diff-added">+        struct StoredDocument {</div><div class="diff-added">+            tokens: BTreeSet<String>,</div><div class="diff-added">+        }</div><div class="diff-added">+        let doc = StoredDocument { tokens };</div><div class="diff-added">+        serde_cbor::to_vec(&doc).map_err(|e| OperationError::service_error(format!("Failed to serialize document: {e}")))</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    pub(super) fn deserialize_document(data: &[u8]) -> OperationResult<BTreeSet<String>> {</div><div class="diff-added">+        #[derive(Deserialize)]</div><div class="diff-added">+        struct StoredDocument {</div><div class="diff-added">+            tokens: BTreeSet<String>,</div><div class="diff-added">+        }</div><div class="diff-added">+        serde_cbor::from_slice::<StoredDocument>(data)</div><div class="diff-added">+            .map_err(|e| OperationError::service_error(format!("Failed to deserialize document: {e}")))</div><div class="diff-added">+            .map(|doc| doc.tokens)</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    fn db_wrapper(&self) -> &DatabaseColumnScheduledDeleteWrapper {</div><div>         match self {</div><div class="diff-removed">-            FullTextIndex::Mutable(_) => {}   // Not a mmap</div><div class="diff-removed">-            FullTextIndex::Immutable(_) => {} // Not a mmap</div><div class="diff-removed">-            FullTextIndex::Mmap(index) => index.clear_cache()?,</div><div class="diff-added">+            FullTextIndex::Mutable(index) => &index.db_wrapper,</div><div class="diff-added">+            FullTextIndex::Immutable(index) => &index.db_wrapper,</div><div class="diff-added">+            FullTextIndex::Mmap(index) => &index.db_wrapper,</div><div>         }</div><div class="diff-removed">-        Ok(())</div><div>     }</div><div> }</div><div> </div><div class="diff-info">@@ -329,21 +262,18 @@ impl ValueIndexer for FullTextIndex {</div><div>         hw_counter: &HardwareCounterCell,</div><div>     ) -> OperationResult<()> {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.add_many(idx, values, hw_counter),</div><div class="diff-removed">-            Self::Immutable(_) => Err(OperationError::service_error(</div><div class="diff-removed">-                "Cannot add values to immutable text index",</div><div class="diff-removed">-            )),</div><div class="diff-removed">-            Self::Mmap(_) => Err(OperationError::service_error(</div><div class="diff-removed">-                "Cannot add values to mmap text index",</div><div class="diff-removed">-            )),</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.add_many(idx, values, hw_counter),</div><div class="diff-added">+            FullTextIndex::Immutable(_) => Err(OperationError::service_error("Cannot add values to immutable text index")),</div><div class="diff-added">+            FullTextIndex::Mmap(_) => Err(OperationError::service_error("Cannot add values to mmap text index")),</div><div>         }</div><div>     }</div><div> </div><div>     fn get_value(value: &Value) -> Option<String> {</div><div>         if let Value::String(keyword) = value {</div><div class="diff-removed">-            return Some(keyword.to_owned());</div><div class="diff-added">+            Some(keyword.clone())</div><div class="diff-added">+        } else {</div><div class="diff-added">+            None</div><div>         }</div><div class="diff-removed">-        None</div><div>     }</div><div> </div><div>     fn remove_point(&mut self, id: PointOffsetType) -> OperationResult<()> {</div><div class="diff-info">@@ -362,41 +292,41 @@ impl PayloadFieldIndex for FullTextIndex {</div><div> </div><div>     fn load(&mut self) -> OperationResult<bool> {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.load_from_db(),</div><div class="diff-removed">-            Self::Immutable(index) => index.load_from_db(),</div><div class="diff-removed">-            Self::Mmap(_index) => Ok(true), // mmap index is always loaded</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.load_from_db(),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.load_from_db(),</div><div class="diff-added">+            FullTextIndex::Mmap(_) => Ok(true),</div><div>         }</div><div>     }</div><div> </div><div>     fn cleanup(self) -> OperationResult<()> {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.clear(),</div><div class="diff-removed">-            Self::Immutable(index) => index.clear(),</div><div class="diff-removed">-            Self::Mmap(index) => index.clear(),</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.clear(),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.clear(),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.clear(),</div><div>         }</div><div>     }</div><div> </div><div>     fn flusher(&self) -> Flusher {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(index) => index.db_wrapper.flusher(),</div><div class="diff-removed">-            Self::Immutable(index) => index.db_wrapper.flusher(),</div><div class="diff-removed">-            Self::Mmap(index) => index.flusher(),</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.db_wrapper.flusher(),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.db_wrapper.flusher(),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.flusher(),</div><div>         }</div><div>     }</div><div> </div><div>     fn files(&self) -> Vec<PathBuf> {</div><div>         match self {</div><div class="diff-removed">-            Self::Mutable(_) => vec![],</div><div class="diff-removed">-            Self::Immutable(_) => vec![],</div><div class="diff-removed">-            Self::Mmap(index) => index.files(),</div><div class="diff-added">+            FullTextIndex::Mutable(_) => vec![],</div><div class="diff-added">+            FullTextIndex::Immutable(_) => vec![],</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.files(),</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    fn filter<'a>(</div><div class="diff-removed">-        &'a self,</div><div class="diff-removed">-        condition: &'a FieldCondition,</div><div class="diff-removed">-        hw_counter: &'a HardwareCounterCell,</div><div class="diff-removed">-    ) -> Option<Box<dyn Iterator<Item = PointOffsetType> + 'a>> {</div><div class="diff-added">+    fn filter(</div><div class="diff-added">+        &self,</div><div class="diff-added">+        condition: &FieldCondition,</div><div class="diff-added">+        hw_counter: &HardwareCounterCell,</div><div class="diff-added">+    ) -> Option<Box<dyn Iterator<Item = PointOffsetType> + '_>> {</div><div>         if let Some(Match::Text(text_match)) = &condition.r#match {</div><div>             let parsed_query = self.parse_query(&text_match.text, hw_counter);</div><div>             return Some(self.filter(parsed_query, hw_counter));</div><div class="diff-info">@@ -421,6 +351,10 @@ impl PayloadFieldIndex for FullTextIndex {</div><div>         threshold: usize,</div><div>         key: PayloadKeyType,</div><div>     ) -> Box<dyn Iterator<Item = PayloadBlockCondition> + '_> {</div><div class="diff-removed">-        self.payload_blocks(threshold, key)</div><div class="diff-added">+        match self {</div><div class="diff-added">+            FullTextIndex::Mutable(index) => index.inverted_index.payload_blocks(threshold, key),</div><div class="diff-added">+            FullTextIndex::Immutable(index) => index.inverted_index.payload_blocks(threshold, key),</div><div class="diff-added">+            FullTextIndex::Mmap(index) => index.inverted_index.payload_blocks(threshold, key),</div><div class="diff-added">+        }</div><div>     }</div><div> }</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    