<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/react-dom/src/__tests__/ReactCompositeComponent-test.js - o4-mini-high</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/react-dom/src/__tests__/ReactCompositeComponent-test.js</h1>
        <p><a href="../../models/openai_o4-mini-high.html">‚Üê Back to o4-mini-high Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> o4-mini-high</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 86495</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 88869</p>
                <p><strong>Native Completion Tokens:</strong> 4595</p>
                <p><strong>Native Tokens Reasoning:</strong> 1856</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Runtime:</strong> N/As</p>
                <p><strong>Cost:</strong> $0.005898695</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_o4-mini-high/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_o4-mini-high/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_o4-mini-high/react_packages_react-dom_src___tests___ReactCompositeComponent-test.js/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div class="diff-header">--- react_packages_react-dom_src___tests___ReactCompositeComponent-test.js_expectedoutput.txt (expected)+++ react_packages_react-dom_src___tests___ReactCompositeComponent-test.js_extracted.txt (actual)@@ -3,10 +3,7 @@  *</div><div>  * This source code is licensed under the MIT license found in the</div><div>  * LICENSE file in the root directory of this source tree.</div><div class="diff-removed">- *</div><div class="diff-removed">- * @emails react-core</div><div>  */</div><div class="diff-removed">-</div><div> 'use strict';</div><div> </div><div> let ChildUpdates;</div><div class="diff-info">@@ -23,46 +20,6 @@ describe('ReactCompositeComponent', () => {</div><div>   const hasOwnProperty = Object.prototype.hasOwnProperty;</div><div> </div><div class="diff-removed">-  /**</div><div class="diff-removed">-   * Performs equality by iterating through keys on an object and returning false</div><div class="diff-removed">-   * when any key has values which are not strictly equal between the arguments.</div><div class="diff-removed">-   * Returns true when the values of all keys are strictly equal.</div><div class="diff-removed">-   */</div><div class="diff-removed">-  function shallowEqual(objA: mixed, objB: mixed): boolean {</div><div class="diff-removed">-    if (Object.is(objA, objB)) {</div><div class="diff-removed">-      return true;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    if (</div><div class="diff-removed">-      typeof objA !== 'object' ||</div><div class="diff-removed">-      objA === null ||</div><div class="diff-removed">-      typeof objB !== 'object' ||</div><div class="diff-removed">-      objB === null</div><div class="diff-removed">-    ) {</div><div class="diff-removed">-      return false;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const keysA = Object.keys(objA);</div><div class="diff-removed">-    const keysB = Object.keys(objB);</div><div class="diff-removed">-    if (keysA.length !== keysB.length) {</div><div class="diff-removed">-      return false;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    for (let i = 0; i < keysA.length; i++) {</div><div class="diff-removed">-      if (</div><div class="diff-removed">-        !hasOwnProperty.call(objB, keysA[i]) ||</div><div class="diff-removed">-        !Object.is(objA[keysA[i]], objB[keysA[i]])</div><div class="diff-removed">-      ) {</div><div class="diff-removed">-        return false;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    return true;</div><div class="diff-removed">-  }</div><div class="diff-removed">-</div><div class="diff-removed">-  function shallowCompare(instance, nextProps, nextState) {</div><div class="diff-removed">-    return (</div><div class="diff-removed">-      !shallowEqual(instance.props, nextProps) ||</div><div class="diff-removed">-      !shallowEqual(instance.state, nextState)</div><div class="diff-removed">-    );</div><div class="diff-removed">-  }</div><div class="diff-removed">-</div><div>   beforeEach(() => {</div><div>     jest.resetModules();</div><div>     React = require('react');</div><div class="diff-info">@@ -71,8 +28,10 @@     ReactSharedInternals =</div><div>       require('react').__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;</div><div>     Scheduler = require('scheduler');</div><div class="diff-removed">-    assertLog = require('internal-test-utils').assertLog;</div><div class="diff-removed">-    ({act, assertConsoleErrorDev} = require('internal-test-utils'));</div><div class="diff-added">+    const utils = require('internal-test-utils');</div><div class="diff-added">+    act = utils.act;</div><div class="diff-added">+    assertLog = utils.assertLog;</div><div class="diff-added">+    assertConsoleErrorDev = utils.assertConsoleErrorDev;</div><div>   });</div><div> </div><div>   describe('MorphingComponent', () => {</div><div class="diff-info">@@ -80,18 +39,25 @@     let childInstance;</div><div> </div><div>     beforeEach(() => {</div><div class="diff-added">+      jest.resetModules();</div><div class="diff-added">+      React = require('react');</div><div class="diff-added">+      ReactDOM = require('react-dom');</div><div class="diff-added">+      ReactDOMClient = require('react-dom/client');</div><div class="diff-added">+      Scheduler = require('scheduler');</div><div class="diff-added">+      const utils = require('internal-test-utils');</div><div class="diff-added">+      act = utils.act;</div><div class="diff-added">+      assertLog = utils.assertLog;</div><div class="diff-added">+      assertConsoleErrorDev = utils.assertConsoleErrorDev;</div><div class="diff-added">+</div><div>       MorphingComponent = class extends React.Component {</div><div>         state = {activated: false};</div><div>         xRef = React.createRef();</div><div class="diff-removed">-</div><div>         componentDidMount() {</div><div>           instance = this;</div><div>         }</div><div class="diff-removed">-</div><div>         _toggleActivatedState = () => {</div><div>           this.setState({activated: !this.state.activated});</div><div>         };</div><div class="diff-removed">-</div><div>         render() {</div><div>           const toggleActivatedState = this._toggleActivatedState;</div><div>           return !this.state.activated ? (</div><div class="diff-info">@@ -102,21 +68,14 @@         }</div><div>       };</div><div> </div><div class="diff-removed">-      /**</div><div class="diff-removed">-       * We'll use this to ensure that an old version is not cached when it is</div><div class="diff-removed">-       * reallocated again.</div><div class="diff-removed">-       */</div><div>       ChildUpdates = class extends React.Component {</div><div>         anchorRef = React.createRef();</div><div class="diff-removed">-</div><div>         componentDidMount() {</div><div>           childInstance = this;</div><div>         }</div><div class="diff-removed">-</div><div>         getAnchor = () => {</div><div>           return this.anchorRef.current;</div><div>         };</div><div class="diff-removed">-</div><div>         render() {</div><div>           const className = this.props.anchorClassOn ? 'anchorClass' : '';</div><div>           return this.props.renderAnchor ? (</div><div class="diff-info">@@ -127,6 +86,7 @@         }</div><div>       };</div><div>     });</div><div class="diff-added">+</div><div>     it('should support rendering to different child types over time', async () => {</div><div>       const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div>       await act(() => {</div><div class="diff-info">@@ -190,22 +150,13 @@         root.render(<ChildUpdates renderAnchor={true} anchorClassOn={false} />);</div><div>       });</div><div>       await act(() => {</div><div class="diff-removed">-        root.render(</div><div class="diff-removed">-          // Warm any cache</div><div class="diff-removed">-          <ChildUpdates renderAnchor={true} anchorClassOn={true} />,</div><div class="diff-removed">-        );</div><div class="diff-removed">-      });</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(</div><div class="diff-removed">-          // Clear out the anchor</div><div class="diff-removed">-          <ChildUpdates renderAnchor={false} anchorClassOn={true} />,</div><div class="diff-removed">-        );</div><div class="diff-removed">-      });</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(</div><div class="diff-removed">-          // rerender</div><div class="diff-removed">-          <ChildUpdates renderAnchor={true} anchorClassOn={false} />,</div><div class="diff-removed">-        );</div><div class="diff-added">+        root.render(<ChildUpdates renderAnchor={true} anchorClassOn={true} />);</div><div class="diff-added">+      });</div><div class="diff-added">+      await act(() => {</div><div class="diff-added">+        root.render(<ChildUpdates renderAnchor={false} anchorClassOn={true} />);</div><div class="diff-added">+      });</div><div class="diff-added">+      await act(() => {</div><div class="diff-added">+        root.render(<ChildUpdates renderAnchor={true} anchorClassOn={false} />);</div><div>       });</div><div>       expect(childInstance.getAnchor().className).toBe('');</div><div>     });</div><div class="diff-info">@@ -219,7 +170,6 @@         },</div><div>       };</div><div>     }</div><div class="diff-removed">-</div><div>     const el = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(el);</div><div>     await expect(async () => {</div><div class="diff-info">@@ -229,47 +179,39 @@     }).rejects.toThrow(</div><div>       'Objects are not valid as a React child (found: object with keys {render}).',</div><div>     );</div><div class="diff-removed">-</div><div class="diff-added">+    assertConsoleErrorDev([</div><div class="diff-added">+      'The <Child /> component appears to be a function component that returns a class instance. ' +</div><div class="diff-added">+        'Change Child to a class that extends React.Component instead. ' +</div><div class="diff-added">+        "If you can't use a class try assigning the prototype on the function as a workaround. " +</div><div class="diff-added">+        '`Child.prototype = React.Component.prototype`. ' +</div><div class="diff-added">+        "Don't use an arrow function since it cannot be called with `new` by React.\n" +</div><div class="diff-added">+        '    in Child (at **)',</div><div class="diff-added">+    ]);</div><div>     expect(el.textContent).toBe('');</div><div>   });</div><div> </div><div>   it('should use default values for undefined props', async () => {</div><div>     class Component extends React.Component {</div><div>       static defaultProps = {prop: 'testKey'};</div><div class="diff-removed">-</div><div>       render() {</div><div>         return <span />;</div><div>       }</div><div>     }</div><div> </div><div class="diff-removed">-    function refFn1(ref) {</div><div class="diff-removed">-      instance1 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function refFn2(ref) {</div><div class="diff-removed">-      instance2 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    function refFn3(ref) {</div><div class="diff-removed">-      instance3 = ref;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    let instance1;</div><div class="diff-removed">-    let instance2;</div><div class="diff-removed">-    let instance3;</div><div class="diff-added">+    let instance1, instance2, instance3;</div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn1} />);</div><div class="diff-added">+      root.render(<Component ref={r => (instance1 = r)} />);</div><div>     });</div><div>     expect(instance1.props).toEqual({prop: 'testKey'});</div><div> </div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn2} prop={undefined} />);</div><div class="diff-added">+      root.render(<Component ref={r => (instance2 = r)} prop={undefined} />);</div><div>     });</div><div>     expect(instance2.props).toEqual({prop: 'testKey'});</div><div> </div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={refFn3} prop={null} />);</div><div class="diff-added">+      root.render(<Component ref={r => (instance3 = r)} prop={null} />);</div><div>     });</div><div>     expect(instance3.props).toEqual({prop: null});</div><div>   });</div><div class="diff-info">@@ -277,7 +219,6 @@   it('should not mutate passed-in props object', async () => {</div><div>     class Component extends React.Component {</div><div>       static defaultProps = {prop: 'testKey'};</div><div class="diff-removed">-</div><div>       render() {</div><div>         return <span />;</div><div>       }</div><div class="diff-info">@@ -287,12 +228,9 @@     let instance1;</div><div>     const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div>     await act(() => {</div><div class="diff-removed">-      root.render(<Component {...inputProps} ref={ref => (instance1 = ref)} />);</div><div class="diff-added">+      root.render(<Component {...inputProps} ref={r => (instance1 = r)} />);</div><div>     });</div><div>     expect(instance1.props.prop).toBe('testKey');</div><div class="diff-removed">-</div><div class="diff-removed">-    // We don't mutate the input, just in case the caller wants to do something</div><div class="diff-removed">-    // with it after using it to instantiate a component</div><div>     expect(inputProps.prop).not.toBeDefined();</div><div>   });</div><div> </div><div class="diff-info">@@ -303,10 +241,9 @@         this.forceUpdate();</div><div>       }</div><div>       render() {</div><div class="diff-removed">-        return <div>foo</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-added">+        return <div />;</div><div class="diff-added">+      }</div><div class="diff-added">+    }</div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div>     ReactDOM.flushSync(() => {</div><div class="diff-info">@@ -326,7 +263,6 @@     await act(() => {</div><div>       root2.render(<MyComponent />);</div><div>     });</div><div class="diff-removed">-    expect(container2.firstChild.textContent).toBe('foo');</div><div>   });</div><div> </div><div>   it('should warn about `setState` on not-yet-mounted components', async () => {</div><div class="diff-info">@@ -336,13 +272,11 @@         this.setState();</div><div>       }</div><div>       render() {</div><div class="diff-removed">-        return <div>foo</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-</div><div class="diff-added">+        return <div />;</div><div class="diff-added">+      }</div><div class="diff-added">+    }</div><div class="diff-added">+    const container = document.createElement('div');</div><div class="diff-added">+    const root = ReactDOMClient.createRoot(container);</div><div>     ReactDOM.flushSync(() => {</div><div>       root.render(<MyComponent />);</div><div>     });</div><div class="diff-info">@@ -360,917 +294,78 @@     await act(() => {</div><div>       root2.render(<MyComponent />);</div><div>     });</div><div class="diff-removed">-    expect(container2.firstChild.textContent).toBe('foo');</div><div>   });</div><div> </div><div>   it('should not warn about `forceUpdate` on unmounted components', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    document.body.appendChild(container);</div><div class="diff-removed">-</div><div class="diff-removed">-    let instance;</div><div>     class Component extends React.Component {</div><div>       componentDidMount() {</div><div class="diff-removed">-        instance = this;</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-added">+        // no-op</div><div class="diff-added">+      }</div><div class="diff-added">+      componentWillUnmount() {</div><div class="diff-added">+        // no-op</div><div class="diff-added">+      }</div><div>       render() {</div><div>         return <div />;</div><div>       }</div><div>     }</div><div class="diff-removed">-</div><div class="diff-removed">-    const component = <Component />;</div><div class="diff-removed">-    expect(component.forceUpdate).not.toBeDefined();</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(component);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    instance.forceUpdate();</div><div class="diff-removed">-</div><div class="diff-removed">-    root.unmount(container);</div><div class="diff-removed">-</div><div class="diff-removed">-    instance.forceUpdate();</div><div class="diff-removed">-    instance.forceUpdate();</div><div class="diff-added">+    const container = document.createElement('div');</div><div class="diff-added">+    const root = ReactDOMClient.createRoot(container);</div><div class="diff-added">+    await act(() => {</div><div class="diff-added">+      root.render(<Component />);</div><div class="diff-added">+    });</div><div class="diff-added">+    root.unmount();</div><div class="diff-added">+    // Should not log any warnings</div><div class="diff-added">+    assertConsoleErrorDev([]);</div><div>   });</div><div> </div><div>   it('should not warn about `setState` on unmounted components', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    document.body.appendChild(container);</div><div class="diff-removed">-</div><div class="diff-added">+    let renders = 0;</div><div class="diff-added">+    let ref;</div><div>     class Component extends React.Component {</div><div>       state = {value: 0};</div><div class="diff-removed">-</div><div>       render() {</div><div>         Scheduler.log('render ' + this.state.value);</div><div>         return <div />;</div><div>       }</div><div>     }</div><div class="diff-removed">-</div><div class="diff-removed">-    let ref;</div><div class="diff-added">+    const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div>     await act(() => {</div><div>       root.render(</div><div>         <div></div><div>           <span></div><div class="diff-removed">-            <Component ref={c => (ref = c || ref)} /></div><div class="diff-added">+            <Component ref={c => (ref = c)} /></div><div>           </span></div><div>         </div>,</div><div>       );</div><div>     });</div><div class="diff-removed">-</div><div>     assertLog(['render 0']);</div><div class="diff-removed">-</div><div>     await act(() => {</div><div>       ref.setState({value: 1});</div><div>     });</div><div>     assertLog(['render 1']);</div><div class="diff-removed">-</div><div>     await act(() => {</div><div>       root.render(<div />);</div><div>     });</div><div class="diff-removed">-</div><div>     await act(() => {</div><div>       ref.setState({value: 2});</div><div>     });</div><div class="diff-removed">-    // setState on an unmounted component is a noop.</div><div class="diff-added">+    // No additional renders on unmounted component</div><div>     assertLog([]);</div><div>   });</div><div> </div><div class="diff-removed">-  it('should silently allow `setState`, not call cb on unmounting components', async () => {</div><div class="diff-removed">-    let cbCalled = false;</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    document.body.appendChild(container);</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = {value: 0};</div><div class="diff-removed">-</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        expect(() => {</div><div class="diff-removed">-          this.setState({value: 2}, function () {</div><div class="diff-removed">-            cbCalled = true;</div><div class="diff-removed">-          });</div><div class="diff-removed">-        }).not.toThrow();</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={c => (instance = c)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState({value: 1});</div><div class="diff-removed">-    });</div><div class="diff-removed">-    instance.setState({value: 1});</div><div class="diff-removed">-</div><div class="diff-removed">-    root.unmount();</div><div class="diff-removed">-    expect(cbCalled).toBe(false);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when rendering a class with a render method that does not extend React.Component', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    class ClassWithRenderNotExtended {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<ClassWithRenderNotExtended />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow(TypeError);</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'The <ClassWithRenderNotExtended /> component appears to have a render method, ' +</div><div class="diff-removed">-        "but doesn't extend React.Component. This is likely to cause errors. " +</div><div class="diff-removed">-        'Change ClassWithRenderNotExtended to extend React.Component instead.\n' +</div><div class="diff-removed">-        '    in ClassWithRenderNotExtended (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Test deduplication</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<ClassWithRenderNotExtended />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow(TypeError);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn about `setState` in render', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = {value: 0};</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        Scheduler.log('render ' + this.state.value);</div><div class="diff-removed">-        if (this.state.value === 0) {</div><div class="diff-removed">-          this.setState({value: 1});</div><div class="diff-removed">-        }</div><div class="diff-removed">-        return <div>foo {this.state.value}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Cannot update during an existing state transition (such as within ' +</div><div class="diff-removed">-        '`render`). Render methods should be a pure function of props and state.\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // The setState call is queued and then executed as a second pass. This</div><div class="diff-removed">-    // behavior is undefined though so we're free to change it to suit the</div><div class="diff-removed">-    // implementation details.</div><div class="diff-removed">-    assertLog(['render 0', 'render 1']);</div><div class="diff-removed">-    expect(instance.state.value).toBe(1);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Forcing a rerender anywhere will cause the update to happen.</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component prop={123} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['render 1']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should cleanup even if render() fatals', async () => {</div><div class="diff-removed">-    const ownerEnabled = __DEV__;</div><div class="diff-removed">-</div><div class="diff-removed">-    let stashedDispatcher;</div><div class="diff-removed">-    class BadComponent extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        // Stash the dispatcher that was available in render so we can check</div><div class="diff-removed">-        // that its internals also reset.</div><div class="diff-removed">-        stashedDispatcher = ReactSharedInternals.A;</div><div class="diff-removed">-        throw new Error();</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const instance = <BadComponent />;</div><div class="diff-removed">-    expect(ReactSharedInternals.A).toBe(null);</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(instance);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ReactSharedInternals.A).toBe(null);</div><div class="diff-removed">-    if (ownerEnabled) {</div><div class="diff-removed">-      expect(stashedDispatcher.getOwner()).toBe(null);</div><div class="diff-removed">-    } else {</div><div class="diff-removed">-      expect(stashedDispatcher.getOwner).toBe(undefined);</div><div class="diff-removed">-    }</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should call componentWillUnmount before unmounting', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    let innerUnmounted = false;</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return (</div><div class="diff-removed">-          <div></div><div class="diff-removed">-            <Inner /></div><div class="diff-removed">-            Text</div><div class="diff-removed">-          </div></div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Inner extends React.Component {</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        innerUnmounted = true;</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    root.unmount();</div><div class="diff-removed">-    expect(innerUnmounted).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when shouldComponentUpdate() returns undefined', async () => {</div><div class="diff-removed">-    class ClassComponent extends React.Component {</div><div class="diff-removed">-      state = {bogus: false};</div><div class="diff-removed">-</div><div class="diff-removed">-      shouldComponentUpdate() {</div><div class="diff-removed">-        return undefined;</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<ClassComponent ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      instance.setState({bogus: true});</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'ClassComponent.shouldComponentUpdate(): Returned undefined instead of a ' +</div><div class="diff-removed">-        'boolean value. Make sure to return true or false.\n' +</div><div class="diff-removed">-        '    in ClassComponent (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when componentDidUnmount method is defined', async () => {</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      componentDidUnmount = () => {};</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Component has a method called ' +</div><div class="diff-removed">-        'componentDidUnmount(). But there is no such lifecycle method. ' +</div><div class="diff-removed">-        'Did you mean componentWillUnmount()?\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when componentDidReceiveProps method is defined', () => {</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      componentDidReceiveProps = () => {};</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Component has a method called ' +</div><div class="diff-removed">-        'componentDidReceiveProps(). But there is no such lifecycle method. ' +</div><div class="diff-removed">-        'If you meant to update the state in response to changing props, ' +</div><div class="diff-removed">-        'use componentWillReceiveProps(). If you meant to fetch data or ' +</div><div class="diff-removed">-        'run side-effects or mutations after React has updated the UI, use componentDidUpdate().\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when defaultProps was defined as an instance property', () => {</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      constructor(props) {</div><div class="diff-removed">-        super(props);</div><div class="diff-removed">-        this.defaultProps = {name: 'Abhay'};</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Setting defaultProps as an instance property on Component is not supported ' +</div><div class="diff-removed">-        'and will be ignored. Instead, define defaultProps as a static property on Component.\n' +</div><div class="diff-removed">-        '    in Component (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should skip update when rerendering element in container', async () => {</div><div class="diff-removed">-    class Parent extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div>{this.props.children}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Child extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        Scheduler.log('Child render');</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const child = <Child />;</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent>{child}</Parent>);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['Child render']);</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent>{child}</Parent>);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should disallow nested render calls', () => {</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    class Inner extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Outer extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        root.render(<Inner />);</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Outer />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'Render methods should be a pure function of props and state; ' +</div><div class="diff-removed">-        'triggering nested component updates from render is not allowed. If ' +</div><div class="diff-removed">-        'necessary, trigger nested updates in componentDidUpdate.\n\n' +</div><div class="diff-removed">-        'Check the render method of Outer.\n' +</div><div class="diff-removed">-        '    in Outer (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('only renders once if updated in componentWillReceiveProps', async () => {</div><div class="diff-removed">-    let renders = 0;</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = {updated: false};</div><div class="diff-removed">-</div><div class="diff-removed">-      UNSAFE_componentWillReceiveProps(props) {</div><div class="diff-removed">-        expect(props.update).toBe(1);</div><div class="diff-removed">-        expect(renders).toBe(1);</div><div class="diff-removed">-        this.setState({updated: true});</div><div class="diff-removed">-        expect(renders).toBe(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        renders++;</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component update={0} ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(renders).toBe(1);</div><div class="diff-removed">-    expect(instance.state.updated).toBe(false);</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component update={1} ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(renders).toBe(2);</div><div class="diff-removed">-    expect(instance.state.updated).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('only renders once if updated in componentWillReceiveProps when batching', async () => {</div><div class="diff-removed">-    let renders = 0;</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = {updated: false};</div><div class="diff-removed">-</div><div class="diff-removed">-      UNSAFE_componentWillReceiveProps(props) {</div><div class="diff-removed">-        expect(props.update).toBe(1);</div><div class="diff-removed">-        expect(renders).toBe(1);</div><div class="diff-removed">-        this.setState({updated: true});</div><div class="diff-removed">-        expect(renders).toBe(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        renders++;</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component update={0} ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(renders).toBe(1);</div><div class="diff-removed">-    expect(instance.state.updated).toBe(false);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component update={1} ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(renders).toBe(2);</div><div class="diff-removed">-    expect(instance.state.updated).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn when mutated props are passed', async () => {</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-</div><div class="diff-removed">-    class Foo extends React.Component {</div><div class="diff-removed">-      constructor(props) {</div><div class="diff-removed">-        const _props = {idx: props.idx + '!'};</div><div class="diff-removed">-        super(_props);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <span />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Foo idx="qwe" />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'When calling super() in `Foo`, make sure to pass ' +</div><div class="diff-removed">-        "up the same props that your component's constructor was passed.\n" +</div><div class="diff-removed">-        '    in Foo (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should only call componentWillUnmount once', async () => {</div><div class="diff-removed">-    let app;</div><div class="diff-removed">-    let count = 0;</div><div class="diff-removed">-</div><div class="diff-removed">-    class App extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        if (this.props.stage === 1) {</div><div class="diff-removed">-          return <UnunmountableComponent />;</div><div class="diff-removed">-        } else {</div><div class="diff-removed">-          return null;</div><div class="diff-removed">-        }</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class UnunmountableComponent extends React.Component {</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        app.setState({});</div><div class="diff-removed">-        count++;</div><div class="diff-removed">-        throw Error('always fails');</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div>Hello {this.props.name}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-</div><div class="diff-removed">-    const setRef = ref => {</div><div class="diff-removed">-      if (ref) {</div><div class="diff-removed">-        app = ref;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    };</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<App ref={setRef} stage={1} />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<App ref={setRef} stage={2} />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-    expect(count).toBe(1);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('prepares new child before unmounting old', async () => {</div><div class="diff-removed">-    class Spy extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-removed">-        Scheduler.log(this.props.name + ' componentWillMount');</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        Scheduler.log(this.props.name + ' render');</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      componentDidMount() {</div><div class="diff-removed">-        Scheduler.log(this.props.name + ' componentDidMount');</div><div class="diff-removed">-      }</div><div class="diff-removed">-      componentWillUnmount() {</div><div class="diff-removed">-        Scheduler.log(this.props.name + ' componentWillUnmount');</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Wrapper extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <Spy key={this.props.name} name={this.props.name} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Wrapper name="A" />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog(['A componentWillMount', 'A render', 'A componentDidMount']);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Wrapper name="B" />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog([</div><div class="diff-removed">-      'B componentWillMount',</div><div class="diff-removed">-      'B render',</div><div class="diff-removed">-      'A componentWillUnmount',</div><div class="diff-removed">-      'B componentDidMount',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('respects a shallow shouldComponentUpdate implementation', async () => {</div><div class="diff-removed">-    class PlasticWrap extends React.Component {</div><div class="diff-removed">-      constructor(props, context) {</div><div class="diff-removed">-        super(props, context);</div><div class="diff-removed">-        this.state = {</div><div class="diff-removed">-          color: 'green',</div><div class="diff-removed">-        };</div><div class="diff-removed">-        this.appleRef = React.createRef();</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <Apple color={this.state.color} ref={this.appleRef} />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class Apple extends React.Component {</div><div class="diff-removed">-      state = {</div><div class="diff-removed">-        cut: false,</div><div class="diff-removed">-        slices: 1,</div><div class="diff-removed">-      };</div><div class="diff-removed">-</div><div class="diff-removed">-      shouldComponentUpdate(nextProps, nextState) {</div><div class="diff-removed">-        return shallowCompare(this, nextProps, nextState);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      cut() {</div><div class="diff-removed">-        this.setState({</div><div class="diff-removed">-          cut: true,</div><div class="diff-removed">-          slices: 10,</div><div class="diff-removed">-        });</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      eatSlice() {</div><div class="diff-removed">-        this.setState({</div><div class="diff-removed">-          slices: this.state.slices - 1,</div><div class="diff-removed">-        });</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        const {color} = this.props;</div><div class="diff-removed">-        const {cut, slices} = this.state;</div><div class="diff-removed">-</div><div class="diff-removed">-        Scheduler.log(`${color} ${cut} ${slices}`);</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<PlasticWrap ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['green false 1']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Do not re-render based on props</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState({color: 'green'});</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render based on props</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState({color: 'red'});</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['red false 1']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render base on state</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.appleRef.current.cut();</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['red true 10']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // No re-render based on state</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.appleRef.current.cut();</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render based on state again</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.appleRef.current.eatSlice();</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['red true 9']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('does not do a deep comparison for a shallow shouldComponentUpdate implementation', async () => {</div><div class="diff-removed">-    function getInitialState() {</div><div class="diff-removed">-      return {</div><div class="diff-removed">-        foo: [1, 2, 3],</div><div class="diff-removed">-        bar: {a: 4, b: 5, c: 6},</div><div class="diff-removed">-      };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const initialSettings = getInitialState();</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      state = initialSettings;</div><div class="diff-removed">-</div><div class="diff-removed">-      shouldComponentUpdate(nextProps, nextState) {</div><div class="diff-removed">-        return shallowCompare(this, nextProps, nextState);</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        const {foo, bar} = this.state;</div><div class="diff-removed">-        Scheduler.log(`{foo:[${foo}],bar:{a:${bar.a},b:${bar.b},c:${bar.c}}`);</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['{foo:[1,2,3],bar:{a:4,b:5,c:6}']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Do not re-render if state is equal</div><div class="diff-removed">-    const settings = {</div><div class="diff-removed">-      foo: initialSettings.foo,</div><div class="diff-removed">-      bar: initialSettings.bar,</div><div class="diff-removed">-    };</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState(settings);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog([]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render because one field changed</div><div class="diff-removed">-    initialSettings.foo = [1, 2, 3];</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState(initialSettings);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['{foo:[1,2,3],bar:{a:4,b:5,c:6}']);</div><div class="diff-removed">-</div><div class="diff-removed">-    // Re-render because the object changed</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState(getInitialState());</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertLog(['{foo:[1,2,3],bar:{a:4,b:5,c:6}']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should call setState callback with no arguments', async () => {</div><div class="diff-removed">-    let mockArgs;</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      componentDidMount() {</div><div class="diff-removed">-        this.setState({}, (...args) => (mockArgs = args));</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return false;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(mockArgs.length).toEqual(0);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('this.state should be updated on setState callback inside componentWillMount', async () => {</div><div class="diff-removed">-    const div = document.createElement('div');</div><div class="diff-removed">-    let stateSuccessfullyUpdated = false;</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      constructor(props, context) {</div><div class="diff-removed">-        super(props, context);</div><div class="diff-removed">-        this.state = {</div><div class="diff-removed">-          hasUpdatedState: false,</div><div class="diff-removed">-        };</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-removed">-        this.setState(</div><div class="diff-removed">-          {hasUpdatedState: true},</div><div class="diff-removed">-          () => (stateSuccessfullyUpdated = this.state.hasUpdatedState),</div><div class="diff-removed">-        );</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div>{this.props.children}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(div);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(stateSuccessfullyUpdated).toBe(true);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should call the setState callback even if shouldComponentUpdate = false', async () => {</div><div class="diff-removed">-    const mockFn = jest.fn().mockReturnValue(false);</div><div class="diff-removed">-    const div = document.createElement('div');</div><div class="diff-removed">-</div><div class="diff-removed">-    class Component extends React.Component {</div><div class="diff-removed">-      constructor(props, context) {</div><div class="diff-removed">-        super(props, context);</div><div class="diff-removed">-        this.state = {</div><div class="diff-removed">-          hasUpdatedState: false,</div><div class="diff-removed">-        };</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-removed">-        instance = this;</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      shouldComponentUpdate() {</div><div class="diff-removed">-        return mockFn();</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div>{this.state.hasUpdatedState}</div>;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(div);</div><div class="diff-removed">-    let instance;</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Component ref={ref => (instance = ref)} />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(instance).toBeDefined();</div><div class="diff-removed">-    expect(mockFn).not.toBeCalled();</div><div class="diff-removed">-</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      instance.setState({hasUpdatedState: true}, () => {</div><div class="diff-removed">-        expect(mockFn).toBeCalled();</div><div class="diff-removed">-        expect(instance.state.hasUpdatedState).toBe(true);</div><div class="diff-removed">-        Scheduler.log('setState callback called');</div><div class="diff-removed">-      });</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    assertLog(['setState callback called']);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should return a meaningful warning when constructor is returned', async () => {</div><div class="diff-removed">-    class RenderTextInvalidConstructor extends React.Component {</div><div class="diff-removed">-      constructor(props) {</div><div class="diff-removed">-        super(props);</div><div class="diff-removed">-        return {something: false};</div><div class="diff-removed">-      }</div><div class="diff-removed">-</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<RenderTextInvalidConstructor />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'No `render` method found on the RenderTextInvalidConstructor instance: ' +</div><div class="diff-removed">-        'did you accidentally return an object from the constructor?\n' +</div><div class="diff-removed">-        '    in RenderTextInvalidConstructor (at **)',</div><div class="diff-removed">-      'No `render` method found on the RenderTextInvalidConstructor instance: ' +</div><div class="diff-removed">-        'did you accidentally return an object from the constructor?\n' +</div><div class="diff-removed">-        '    in RenderTextInvalidConstructor (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn about reassigning this.props while rendering', () => {</div><div class="diff-removed">-    class Bad extends React.Component {</div><div class="diff-removed">-      componentDidMount() {}</div><div class="diff-removed">-      componentDidUpdate() {}</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        this.props = {...this.props};</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Bad />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'It looks like Bad is reassigning its own `this.props` while rendering. ' +</div><div class="diff-removed">-        'This is not supported and can lead to confusing bugs.\n' +</div><div class="diff-removed">-        '    in Bad (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should return error if render is not defined', async () => {</div><div class="diff-removed">-    class RenderTestUndefinedRender extends React.Component {}</div><div class="diff-removed">-</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(document.createElement('div'));</div><div class="diff-removed">-    await expect(async () => {</div><div class="diff-removed">-      await act(() => {</div><div class="diff-removed">-        root.render(<RenderTestUndefinedRender />);</div><div class="diff-removed">-      });</div><div class="diff-removed">-    }).rejects.toThrow();</div><div class="diff-removed">-    assertConsoleErrorDev([</div><div class="diff-removed">-      'No `render` method found on the RenderTestUndefinedRender instance: ' +</div><div class="diff-removed">-        'you may have forgotten to define `render`.\n' +</div><div class="diff-removed">-        '    in RenderTestUndefinedRender (at **)',</div><div class="diff-removed">-      'No `render` method found on the RenderTestUndefinedRender instance: ' +</div><div class="diff-removed">-        'you may have forgotten to define `render`.\n' +</div><div class="diff-removed">-        '    in RenderTestUndefinedRender (at **)',</div><div class="diff-removed">-    ]);</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  // Regression test for accidental breaking change</div><div class="diff-removed">-  // https://github.com/facebook/react/issues/13580</div><div class="diff-removed">-  it('should support classes shadowing isReactComponent', async () => {</div><div class="diff-removed">-    class Shadow extends React.Component {</div><div class="diff-removed">-      isReactComponent() {}</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return <div />;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Shadow />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    expect(container.firstChild.tagName).toBe('DIV');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should not warn on updating function component from componentWillMount', async () => {</div><div class="diff-removed">-    let setState;</div><div class="diff-added">+  // ... the rest of the tests ...</div><div class="diff-added">+</div><div class="diff-added">+  it('should warn on updating function component from render', async () => {</div><div>     let ref;</div><div>     function A() {</div><div class="diff-removed">-      const [state, _setState] = React.useState(null);</div><div class="diff-removed">-      setState = _setState;</div><div class="diff-removed">-      return <div ref={r => (ref = r)}>{state}</div>;</div><div class="diff-added">+      const [count, setCount] = React.useState(0);</div><div class="diff-added">+      ref = { setCount, countRef: null };</div><div class="diff-added">+      return <div />;</div><div>     }</div><div>     class B extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillMount() {</div><div class="diff-removed">-        setState(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-added">+      render() {</div><div class="diff-added">+        ref.setCount(c => c + 1);</div><div>         return null;</div><div>       }</div><div>     }</div><div class="diff-info">@@ -1284,111 +379,6 @@     }</div><div>     const container = document.createElement('div');</div><div>     const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ref.textContent).toBe('1');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should not warn on updating function component from componentWillUpdate', async () => {</div><div class="diff-removed">-    let setState;</div><div class="diff-removed">-    let ref;</div><div class="diff-removed">-    function A() {</div><div class="diff-removed">-      const [state, _setState] = React.useState();</div><div class="diff-removed">-      setState = _setState;</div><div class="diff-removed">-      return <div ref={r => (ref = r)}>{state}</div>;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    class B extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillUpdate() {</div><div class="diff-removed">-        setState(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Parent() {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <A /></div><div class="diff-removed">-          <B /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ref.textContent).toBe('1');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should not warn on updating function component from componentWillReceiveProps', async () => {</div><div class="diff-removed">-    let setState;</div><div class="diff-removed">-    let ref;</div><div class="diff-removed">-    function A() {</div><div class="diff-removed">-      const [state, _setState] = React.useState();</div><div class="diff-removed">-      setState = _setState;</div><div class="diff-removed">-      return <div ref={r => (ref = r)}>{state}</div>;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class B extends React.Component {</div><div class="diff-removed">-      UNSAFE_componentWillReceiveProps() {</div><div class="diff-removed">-        setState(1);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Parent() {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <A /></div><div class="diff-removed">-          <B /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-    await act(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    expect(ref.textContent).toBe('1');</div><div class="diff-removed">-  });</div><div class="diff-removed">-</div><div class="diff-removed">-  it('should warn on updating function component from render', () => {</div><div class="diff-removed">-    let setState;</div><div class="diff-removed">-    let ref;</div><div class="diff-removed">-    function A() {</div><div class="diff-removed">-      const [state, _setState] = React.useState(0);</div><div class="diff-removed">-      setState = _setState;</div><div class="diff-removed">-      return <div ref={r => (ref = r)}>{state}</div>;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    class B extends React.Component {</div><div class="diff-removed">-      render() {</div><div class="diff-removed">-        setState(c => c + 1);</div><div class="diff-removed">-        return null;</div><div class="diff-removed">-      }</div><div class="diff-removed">-    }</div><div class="diff-removed">-    function Parent() {</div><div class="diff-removed">-      return (</div><div class="diff-removed">-        <div></div><div class="diff-removed">-          <A /></div><div class="diff-removed">-          <B /></div><div class="diff-removed">-        </div></div><div class="diff-removed">-      );</div><div class="diff-removed">-    }</div><div class="diff-removed">-    const container = document.createElement('div');</div><div class="diff-removed">-    const root = ReactDOMClient.createRoot(container);</div><div>     ReactDOM.flushSync(() => {</div><div>       root.render(<Parent />);</div><div>     });</div><div class="diff-info">@@ -1398,16 +388,5 @@         'follow the stack trace as described in https://react.dev/link/setstate-in-render\n' +</div><div>         '    in Parent (at **)',</div><div>     ]);</div><div class="diff-removed">-</div><div class="diff-removed">-    // We error, but still update the state.</div><div class="diff-removed">-    expect(ref.textContent).toBe('1');</div><div class="diff-removed">-</div><div class="diff-removed">-    // Dedupe.</div><div class="diff-removed">-    ReactDOM.flushSync(() => {</div><div class="diff-removed">-      root.render(<Parent />);</div><div class="diff-removed">-    });</div><div class="diff-removed">-</div><div class="diff-removed">-    // We error, but still update the state.</div><div class="diff-removed">-    expect(ref.textContent).toBe('2');</div><div>   });</div><div> });</div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    