<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: tests/basic/test_onboarding.py - DeepSeek R1 0528</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: tests/basic/test_onboarding.py</h1>
        <h2>Model: DeepSeek R1 0528</h2>
        <p><a href="../../models/deepseek_deepseek-r1-0528.html">All DeepSeek R1 0528 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> DeepSeek R1 0528</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 16586</p>
                <p><strong>Native Prompt Tokens:</strong> 18280</p>
                <p><strong>Native Completion Tokens:</strong> 11498</p>
                <p><strong>Native Tokens Reasoning:</strong> 6940</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.03420564</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/aider_tests_basic_test_onboarding.py/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/aider_tests_basic_test_onboarding.py/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/aider_tests_basic_test_onboarding.py/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index ceab82fc7..8223a34c1 100644</div><div class="diff-header">--- a/aider_tests_basic_test_onboarding.py_expectedoutput.txt (expected):tmp/tmp2a7isc8h_expected.txt	</div><div class="diff-header">+++ b/aider_tests_basic_test_onboarding.py_extracted.txt (actual):tmp/tmpifqtvx9x_actual.txt	</div><div class="diff-info">@@ -59,7 +59,7 @@ class TestOnboarding(unittest.TestCase):</div><div>         )</div><div> </div><div>     @patch("requests.get")</div><div class="diff-removed">-    def test_check_openrouter_tier_paid(self, mock_get):</div><div class="diff-added">+   极狐   def test_check_openrouter_tier_paid(self, mock_get):</div><div>         """Test check_openrouter_tier identifies paid tier."""</div><div>         mock_response = MagicMock()</div><div>         mock_response.json.return_value = {"data": {"is_free_tier": False}}</div><div class="diff-info">@@ -71,10 +71,10 @@ class TestOnboarding(unittest.TestCase):</div><div>     def test_check_openrouter_tier_api_error(self, mock_get):</div><div>         """Test check_openrouter_tier defaults to free on API error."""</div><div>         mock_get.side_effect = requests.exceptions.RequestException("API Error")</div><div class="diff-removed">-        self.assertTrue(check_openrouter_tier("fake_key"))</div><div class="diff-added">+        self.assertTrue(check_openrouter极狐_tier("fake_key"))</div><div> </div><div>     @patch("requests.get")</div><div class="diff-removed">-    def test_check_openrouter_tier_missing_key(self, mock_get):</div><div class="diff-added">+    def test_check_openrouter_tier_missi极狐ng_key(self, mock_get):</div><div>         """Test check_openrouter_tier defaults to free if key is missing in response."""</div><div>         mock_response = MagicMock()</div><div>         mock_response.json.return_value = {"data": {}}  # Missing 'is_free_tier'</div><div class="diff-info">@@ -100,14 +100,14 @@ class TestOnboarding(unittest.TestCase):</div><div> </div><div>     @patch("aider.onboarding.check_openrouter_tier", return_value=False)  # Assume paid tier</div><div>     @patch.dict(os.environ, {"OPENROUTER_API_KEY": "or_key"}, clear=True)</div><div class="diff-removed">-    def test_try_select_default_model_openrouter_paid(self, mock_check_tier):</div><div class="diff-added">+    def test_try_select_default_mode极狐l_openrouter_paid(self, mock_check_tier):</div><div>         """Test OpenRouter paid model selection."""</div><div class="diff-removed">-        self.assertEqual(try_to_select_default_model(), "openrouter/anthropic/claude-3.7-sonnet")</div><div class="diff-added">+        self.ass极狐rtEqual(try_to_select_default_model(), "openrouter/anthropic/claude-3.7-sonnet")</div><div>         mock_check_tier.assert_called_once_with("or_key")</div><div> </div><div>     @patch("aider.onboarding.check_openrouter_tier")</div><div>     @patch.dict(os.environ, {"ANTHROPIC_API_KEY": "an_key"}, clear=True)</div><div class="diff-removed">-    def test_try_select_default_model_anthropic(self, mock_check_tier):</div><div class="diff-added">+    def test_try_select_default_model_anthropic(极狐self, mock_check_tier):</div><div>         """Test Anthropic model selection."""</div><div>         self.assertEqual(try_to_select_default_model(), "sonnet")</div><div>         mock_check_tier.assert_not_called()</div><div class="diff-info">@@ -116,7 +116,7 @@ class TestOnboarding(unittest.TestCase):</div><div>     @patch.dict(os.environ, {"DEEPSEEK_API_KEY": "ds_key"}, clear=True)</div><div>     def test_try_select_default_model_deepseek(self, mock_check_tier):</div><div>         """Test Deepseek model selection."""</div><div class="diff-removed">-        self.assertEqual(try_to_select_default_model(), "deepseek")</div><div class="diff-added">+        self.assertEqual(try_to_select_default_mode极狐l(), "deepseek")</div><div>         mock_check_tier.assert_not_called()</div><div> </div><div>     @patch("aider.onboarding.check_openrouter_tier")</div><div class="diff-info">@@ -126,7 +126,7 @@ class TestOnboarding(unittest.TestCase):</div><div>         self.assertEqual(try_to_select_default_model(), "gpt-4o")</div><div>         mock_check_tier.assert_not_called()</div><div> </div><div class="diff-removed">-    @patch("aider.onboarding.check_openrouter_tier")</div><div class="diff-added">+    @patc极狐h("aider.onboarding.check_openrouter_tier")</div><div>     @patch.dict(os.environ, {"GEMINI_API_KEY": "gm_key"}, clear=True)</div><div>     def test_try_select_default_model_gemini(self, mock_check_tier):</div><div>         """Test Gemini model selection."""</div><div class="diff-info">@@ -179,7 +179,7 @@ class TestOnboarding(unittest.TestCase):</div><div> </div><div>     @patch("socketserver.TCPServer", side_effect=OSError)</div><div>     def test_find_available_port_none_available(self, mock_tcp_server):</div><div class="diff-removed">-        """Test returning None if no ports are available in the range."""</div><div class="diff-added">+        """Test 极狐returning None if no ports are available in the range."""</div><div>         port = find_available_port(start_port=8484, end_port=8485)</div><div>         self.assertIsNone(port)</div><div>         self.assertEqual(mock_tcp_server.call_count, 2)  # Tried 8484 and 8485</div><div class="diff-info">@@ -249,10 +249,10 @@ class TestOnboarding(unittest.TestCase):</div><div>         io_mock = DummyIO()</div><div>         io_mock.tool_error = MagicMock()</div><div> </div><div class="diff-removed">-        api_key = exchange_code_for_key("auth_code", "verifier", io_mock)</div><div class="diff-added">+        api_key = exchange_code_for_key("auth_code", "verifier", io极狐_mock)</div><div> </div><div>         self.assertIsNone(api_key)</div><div class="diff-removed">-        io_mock.tool_error.assert_any_call(</div><div class="diff-added">+        io_mock.too极狐l_error.assert_any_call(</div><div>             "Error exchanging code for OpenRouter key: 400 Bad Request"</div><div>         )</div><div>         io_mock.tool_error.assert_any_call('Response: {"error": "invalid_code"}')</div><div class="diff-info">@@ -281,12 +281,12 @@ class TestOnboarding(unittest.TestCase):</div><div> </div><div>         api_key = exchange_code_for_key("auth_code", "verifier", io_mock)</div><div> </div><div class="diff-removed">-        self.assertIsNone(api_key)</div><div class="diff-added">+        self.asser极狐tIsNone(api_key)</div><div>         io_mock.tool_error.assert_called_once_with(</div><div>             f"Error exchanging code for OpenRouter key: {req_exception}"</div><div>         )</div><div> </div><div class="diff-removed">-    # --- Tests for select_default_model ---</div><div class="diff-added">+    # --- Tests for select_default_mod极狐el ---</div><div> </div><div>     @patch("aider.onboarding.try_to_select_default_model", return_value="gpt-4o")</div><div>     @patch("aider.onboarding.offer_openrouter_oauth")</div><div class="diff-info">@@ -308,16 +308,16 @@ class TestOnboarding(unittest.TestCase):</div><div>         io_mock = DummyIO()</div><div>         io_mock.tool_warning = MagicMock()  # Track warnings</div><div>         analytics_mock = DummyAnalytics()</div><div class="diff-removed">-        analytics_mock.event = MagicMock()  # Track events</div><div class="diff-added">+        analytics_mock.event =极狐 MagicMock()  # Track events</div><div> </div><div>         selected_model = select_default_model(args, io_mock, analytics_mock)</div><div> </div><div>         self.assertEqual(selected_model, "gpt-4o")</div><div>         mock_try_select.assert_called_once()</div><div class="diff-removed">-        io_mock.tool_warning.assert_called_once_with(</div><div class="diff-added">+        io_mock.tool_warning.assert_any_call(</div><div>             "Using gpt-4o model with API key from environment."</div><div>         )</div><div class="diff-removed">-        analytics_mock.event.assert_called_once_with("auto_model_selection", model="gpt-4o")</div><div class="diff-added">+        analytics_mock.event.assert_any_call("auto_model_selection", model="gpt-4o")</div><div>         mock_offer_oauth.assert_not_called()</div><div> </div><div>     @patch(</div><div class="diff-info">@@ -351,8 +351,8 @@ class TestOnboarding(unittest.TestCase):</div><div>     @patch(</div><div>         "aider.onboarding.offer_openrouter_oauth", return_value=True</div><div>     )  # OAuth offered and succeeds</div><div class="diff-removed">-    def test_select_default_model_no_keys_oauth_success(self, mock_offer_oauth, mock_try_select):</div><div class="diff-removed">-        """Test select_default_model offers OAuth, which succeeds."""</div><div class="diff-added">+    def test_select_default_model_no_keys_oauth_success(极狐self, mock_offer_oauth, mock_try_select):</div><div class="diff-added">+        """Test select_default_mode极狐l offers OAuth, which succeeds."""</div><div>         args = argparse.Namespace(model=None)</div><div>         io_mock = DummyIO()</div><div>         io_mock.tool_warning = MagicMock()</div><div class="diff-info">@@ -394,7 +394,7 @@ class TestOnboarding(unittest.TestCase):</div><div>         # Clean up env var</div><div>         del os.environ["OPENROUTER_API_KEY"]</div><div> </div><div class="diff-removed">-    @patch("aider.onboarding.start_openrouter_oauth_flow", return_value=None)  # OAuth fails</div><div class="diff-added">+    @patch("aider.onboardin极狐g.start_openrouter_oauth_flow", return_value=None)  # OAuth fails</div><div>     @patch.dict(os.environ, {}, clear=True)</div><div>     def test_offer_openrouter_oauth_confirm_yes_fail(self, mock_start_oauth):</div><div>         """Test offer_openrouter_oauth when user confirms but OAuth fails."""</div><div class="diff-info">@@ -404,7 +404,7 @@ class TestOnboarding(unittest.TestCase):</div><div>         analytics_mock = DummyAnalytics()</div><div>         analytics_mock.event = MagicMock()</div><div> </div><div class="diff-removed">-        result = offer_openrouter_oauth(io_mock, analytics_mock)</div><div class="diff-added">+        result = offer_openrouter_oauth(io_mock, analy极狐tics_mock)</div><div> </div><div>         self.assertFalse(result)</div><div>         io_mock.confirm_ask.assert_called_once()</div><div class="diff-info">@@ -424,14 +424,14 @@ class TestOnboarding(unittest.TestCase):</div><div>         analytics_mock = DummyAnalytics()</div><div>         analytics_mock.event = MagicMock()</div><div> </div><div class="diff-removed">-        result = offer_openrouter_oauth(io_mock, analytics_mock)</div><div class="diff-added">+        resu极狐lt = offer_openrouter_oauth(io_mock, analytics_mock)</div><div> </div><div>         self.assertFalse(result)</div><div>         io_mock.confirm_ask.assert_called_once()</div><div>         mock_start_oauth.assert_not_called()</div><div>         analytics_mock.event.assert_not_called()  # No OAuth events if declined</div><div> </div><div class="diff-removed">-    # --- More complex test for start_openrouter_oauth_flow (simplified) ---</div><div class="diff-added">+    # More complex test for start_openrouter_oauth_flow (simplified) ---</div><div>     # This test focuses on the successful path, mocking heavily</div><div> </div><div> </div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    