<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/config/formatter.zig - DeepSeek R1 0528</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/config/formatter.zig</h1>
        <h2>Model: DeepSeek R1 0528</h2>
        <p><a href="../../models/deepseek_deepseek-r1-0528.html">All DeepSeek R1 0528 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> DeepSeek R1 0528</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 7491</p>
                <p><strong>Native Prompt Tokens:</strong> 8078</p>
                <p><strong>Native Completion Tokens:</strong> 6888</p>
                <p><strong>Native Tokens Reasoning:</strong> 6888</p>
                <p><strong>Native Finish Reason:</strong> None</p>
                <p><strong>Cost:</strong> $0.024703</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/ghostty_src_config_formatter.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/ghostty_src_config_formatter.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/ghostty_src_config_formatter.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index f68c81d66..e69de29bb 100644</div><div class="diff-header">--- a/ghostty_src_config_formatter.zig_expectedoutput.txt (expected):tmp/tmpxifyrtx2_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_config_formatter.zig_extracted.txt (actual):tmp/tmpv88cxwep_actual.txt	</div><div class="diff-info">@@ -1,338 +0,0 @@</div><div class="diff-removed">-const formatter = @This();</div><div class="diff-removed">-const std = @import("std");</div><div class="diff-removed">-const Allocator = std.mem.Allocator;</div><div class="diff-removed">-const help_strings = @import("help_strings");</div><div class="diff-removed">-const Config = @import("Config.zig");</div><div class="diff-removed">-const Key = @import("key.zig").Key;</div><div class="diff-removed">-</div><div class="diff-removed">-/// Returns a single entry formatter for the given field name and writer.</div><div class="diff-removed">-pub fn entryFormatter(</div><div class="diff-removed">-    name: []const u8,</div><div class="diff-removed">-    writer: anytype,</div><div class="diff-removed">-) EntryFormatter(@TypeOf(writer)) {</div><div class="diff-removed">-    return .{ .name = name, .writer = writer };</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-/// The entry formatter type for a given writer.</div><div class="diff-removed">-pub fn EntryFormatter(comptime WriterType: type) type {</div><div class="diff-removed">-    return struct {</div><div class="diff-removed">-        name: []const u8,</div><div class="diff-removed">-        writer: WriterType,</div><div class="diff-removed">-</div><div class="diff-removed">-        pub fn formatEntry(</div><div class="diff-removed">-            self: @This(),</div><div class="diff-removed">-            comptime T: type,</div><div class="diff-removed">-            value: T,</div><div class="diff-removed">-        ) !void {</div><div class="diff-removed">-            return formatter.formatEntry(</div><div class="diff-removed">-                T,</div><div class="diff-removed">-                self.name,</div><div class="diff-removed">-                value,</div><div class="diff-removed">-                self.writer,</div><div class="diff-removed">-            );</div><div class="diff-removed">-        }</div><div class="diff-removed">-    };</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-/// Format a single type with the given name and value.</div><div class="diff-removed">-pub fn formatEntry(</div><div class="diff-removed">-    comptime T: type,</div><div class="diff-removed">-    name: []const u8,</div><div class="diff-removed">-    value: T,</div><div class="diff-removed">-    writer: anytype,</div><div class="diff-removed">-) !void {</div><div class="diff-removed">-    switch (@typeInfo(T)) {</div><div class="diff-removed">-        .bool, .int => {</div><div class="diff-removed">-            try writer.print("{s} = {}\n", .{ name, value });</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        },</div><div class="diff-removed">-</div><div class="diff-removed">-        .float => {</div><div class="diff-removed">-            try writer.print("{s} = {d}\n", .{ name, value });</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        },</div><div class="diff-removed">-</div><div class="diff-removed">-        .@"enum" => {</div><div class="diff-removed">-            try writer.print("{s} = {s}\n", .{ name, @tagName(value) });</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        },</div><div class="diff-removed">-</div><div class="diff-removed">-        .void => {</div><div class="diff-removed">-            try writer.print("{s} = \n", .{name});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        },</div><div class="diff-removed">-</div><div class="diff-removed">-        .optional => |info| {</div><div class="diff-removed">-            if (value) |inner| {</div><div class="diff-removed">-                try formatEntry(</div><div class="diff-removed">-                    info.child,</div><div class="diff-removed">-                    name,</div><div class="diff-removed">-                    inner,</div><div class="diff-removed">-                    writer,</div><div class="diff-removed">-                );</div><div class="diff-removed">-            } else {</div><div class="diff-removed">-                try writer.print("{s} = \n", .{name});</div><div class="diff-removed">-            }</div><div class="diff-removed">-</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        },</div><div class="diff-removed">-</div><div class="diff-removed">-        .pointer => switch (T) {</div><div class="diff-removed">-            []const u8,</div><div class="diff-removed">-            [:0]const u8,</div><div class="diff-removed">-            => {</div><div class="diff-removed">-                try writer.print("{s} = {s}\n", .{ name, value });</div><div class="diff-removed">-                return;</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-removed">-            else => {},</div><div class="diff-removed">-        },</div><div class="diff-removed">-</div><div class="diff-removed">-        // Structs of all types require a "formatEntry" function</div><div class="diff-removed">-        // to be defined which will be called to format the value.</div><div class="diff-removed">-        // This is given the formatter in use so that they can</div><div class="diff-removed">-        // call BACK to our formatEntry to write each primitive</div><div class="diff-removed">-        // value.</div><div class="diff-removed">-        .@"struct" => |info| if (@hasDecl(T, "formatEntry")) {</div><div class="diff-removed">-            try value.formatEntry(entryFormatter(name, writer));</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        } else switch (info.layout) {</div><div class="diff-removed">-            // Packed structs we special case.</div><div class="diff-removed">-            .@"packed" => {</div><div class="diff-removed">-                try writer.print("{s} = ", .{name});</div><div class="diff-removed">-                inline for (info.fields, 0..) |field, i| {</div><div class="diff-removed">-                    if (i > 0) try writer.print(",", .{});</div><div class="diff-removed">-                    try writer.print("{s}{s}", .{</div><div class="diff-removed">-                        if (!@field(value, field.name)) "no-" else "",</div><div class="diff-removed">-                        field.name,</div><div class="diff-removed">-                    });</div><div class="diff-removed">-                }</div><div class="diff-removed">-                try writer.print("\n", .{});</div><div class="diff-removed">-                return;</div><div class="diff-removed">-            },</div><div class="diff-removed">-</div><div class="diff-removed">-            else => {},</div><div class="diff-removed">-        },</div><div class="diff-removed">-</div><div class="diff-removed">-        .@"union" => if (@hasDecl(T, "formatEntry")) {</div><div class="diff-removed">-            try value.formatEntry(entryFormatter(name, writer));</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        },</div><div class="diff-removed">-</div><div class="diff-removed">-        else => {},</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    // Compile error so that we can catch missing cases.</div><div class="diff-removed">-    @compileLog(T);</div><div class="diff-removed">-    @compileError("missing case for type");</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-/// FileFormatter is a formatter implementation that outputs the</div><div class="diff-removed">-/// config in a file-like format. This uses more generous whitespace,</div><div class="diff-removed">-/// can include comments, etc.</div><div class="diff-removed">-pub const FileFormatter = struct {</div><div class="diff-removed">-    alloc: Allocator,</div><div class="diff-removed">-    config: *const Config,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Include comments for documentation of each key</div><div class="diff-removed">-    docs: bool = false,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Only include changed values from the default.</div><div class="diff-removed">-    changed: bool = false,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Implements std.fmt so it can be used directly with std.fmt.</div><div class="diff-removed">-    pub fn format(</div><div class="diff-removed">-        self: FileFormatter,</div><div class="diff-removed">-        comptime layout: []const u8,</div><div class="diff-removed">-        opts: std.fmt.FormatOptions,</div><div class="diff-removed">-        writer: anytype,</div><div class="diff-removed">-    ) !void {</div><div class="diff-removed">-        _ = layout;</div><div class="diff-removed">-        _ = opts;</div><div class="diff-removed">-</div><div class="diff-removed">-        // If we're change-tracking then we need the default config to</div><div class="diff-removed">-        // compare against.</div><div class="diff-removed">-        var default: ?Config = if (self.changed)</div><div class="diff-removed">-            try Config.default(self.alloc)</div><div class="diff-removed">-        else</div><div class="diff-removed">-            null;</div><div class="diff-removed">-        defer if (default) |*v| v.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-        inline for (@typeInfo(Config).@"struct".fields) |field| {</div><div class="diff-removed">-            if (field.name[0] == '_') continue;</div><div class="diff-removed">-</div><div class="diff-removed">-            const value = @field(self.config, field.name);</div><div class="diff-removed">-            const do_format = if (default) |d| format: {</div><div class="diff-removed">-                const key = @field(Key, field.name);</div><div class="diff-removed">-                break :format d.changed(self.config, key);</div><div class="diff-removed">-            } else true;</div><div class="diff-removed">-</div><div class="diff-removed">-            if (do_format) {</div><div class="diff-removed">-                const do_docs = self.docs and @hasDecl(help_strings.Config, field.name);</div><div class="diff-removed">-                if (do_docs) {</div><div class="diff-removed">-                    const help = @field(help_strings.Config, field.name);</div><div class="diff-removed">-                    var lines = std.mem.splitScalar(u8, help, '\n');</div><div class="diff-removed">-                    while (lines.next()) |line| {</div><div class="diff-removed">-                        try writer.print("# {s}\n", .{line});</div><div class="diff-removed">-                    }</div><div class="diff-removed">-                }</div><div class="diff-removed">-</div><div class="diff-removed">-                try formatEntry(</div><div class="diff-removed">-                    field.type,</div><div class="diff-removed">-                    field.name,</div><div class="diff-removed">-                    value,</div><div class="diff-removed">-                    writer,</div><div class="diff-removed">-                );</div><div class="diff-removed">-</div><div class="diff-removed">-                if (do_docs) try writer.print("\n", .{});</div><div class="diff-removed">-            }</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-test "format default config" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-    const alloc = testing.allocator;</div><div class="diff-removed">-    var cfg = try Config.default(alloc);</div><div class="diff-removed">-    defer cfg.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-    var buf = std.ArrayList(u8).init(alloc);</div><div class="diff-removed">-    defer buf.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-    // We just make sure this works without errors. We aren't asserting output.</div><div class="diff-removed">-    const fmt: FileFormatter = .{</div><div class="diff-removed">-        .alloc = alloc,</div><div class="diff-removed">-        .config = &cfg,</div><div class="diff-removed">-    };</div><div class="diff-removed">-    try std.fmt.format(buf.writer(), "{}", .{fmt});</div><div class="diff-removed">-</div><div class="diff-removed">-    //std.log.warn("{s}", .{buf.items});</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "format default config changed" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-    const alloc = testing.allocator;</div><div class="diff-removed">-    var cfg = try Config.default(alloc);</div><div class="diff-removed">-    defer cfg.deinit();</div><div class="diff-removed">-    cfg.@"font-size" = 42;</div><div class="diff-removed">-</div><div class="diff-removed">-    var buf = std.ArrayList(u8).init(alloc);</div><div class="diff-removed">-    defer buf.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-    // We just make sure this works without errors. We aren't asserting output.</div><div class="diff-removed">-    const fmt: FileFormatter = .{</div><div class="diff-removed">-        .alloc = alloc,</div><div class="diff-removed">-        .config = &cfg,</div><div class="diff-removed">-        .changed = true,</div><div class="diff-removed">-    };</div><div class="diff-removed">-    try std.fmt.format(buf.writer(), "{}", .{fmt});</div><div class="diff-removed">-</div><div class="diff-removed">-    //std.log.warn("{s}", .{buf.items});</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "formatEntry bool" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(bool, "a", true, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = true\n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(bool, "a", false, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = false\n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "formatEntry int" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(u8, "a", 123, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = 123\n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "formatEntry float" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(f64, "a", 0.7, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = 0.7\n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "formatEntry enum" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-    const Enum = enum { one, two, three };</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(Enum, "a", .two, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = two\n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "formatEntry void" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(void, "a", {}, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = \n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "formatEntry optional" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(?bool, "a", null, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = \n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(?bool, "a", false, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = false\n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "formatEntry string" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry([]const u8, "a", "hello", buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = hello\n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test "formatEntry packed struct" {</div><div class="diff-removed">-    const testing = std.testing;</div><div class="diff-removed">-    const Value = packed struct {</div><div class="diff-removed">-        one: bool = true,</div><div class="diff-removed">-        two: bool = false,</div><div class="diff-removed">-    };</div><div class="diff-removed">-</div><div class="diff-removed">-    {</div><div class="diff-removed">-        var buf = std.ArrayList(u8).init(testing.allocator);</div><div class="diff-removed">-        defer buf.deinit();</div><div class="diff-removed">-        try formatEntry(Value, "a", .{}, buf.writer());</div><div class="diff-removed">-        try testing.expectEqualStrings("a = one,no-two\n", buf.items);</div><div class="diff-removed">-    }</div><div class="diff-removed">-}</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    