<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/terminal/modes.zig - DeepSeek R1 0528</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/terminal/modes.zig</h1>
        <h2>Model: DeepSeek R1 0528</h2>
        <p><a href="../../models/deepseek_deepseek-r1-0528.html">All DeepSeek R1 0528 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> DeepSeek R1 0528</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 12161</p>
                <p><strong>Native Prompt Tokens:</strong> 10438</p>
                <p><strong>Native Completion Tokens:</strong> 7183</p>
                <p><strong>Native Tokens Reasoning:</strong> 7183</p>
                <p><strong>Native Finish Reason:</strong> None</p>
                <p><strong>Cost:</strong> $0.026768</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/ghostty_src_terminal_modes.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/ghostty_src_terminal_modes.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/ghostty_src_terminal_modes.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index dffd96d41..e69de29bb 100644</div><div class="diff-header">--- a/ghostty_src_terminal_modes.zig_expectedoutput.txt (expected):tmp/tmp0wk58ed4_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_terminal_modes.zig_extracted.txt (actual):tmp/tmpidl1vp42_actual.txt	</div><div class="diff-info">@@ -1,259 +0,0 @@</div><div class="diff-removed">-//! This file contains all the terminal modes that we support</div><div class="diff-removed">-//! and various support types for them: an enum of supported modes,</div><div class="diff-removed">-//! a packed struct to store mode values, a more generalized state</div><div class="diff-removed">-//! struct to store values plus handle save/restore, and much more.</div><div class="diff-removed">-//!</div><div class="diff-removed">-//! There is pretty heavy comptime usage and type generation here.</div><div class="diff-removed">-//! I don't love to have this sort of complexity but its a good way</div><div class="diff-removed">-//! to ensure all our various types and logic remain in sync.</div><div class="diff-removed">-</div><div class="diff-removed">-const std = @import("std");</div><div class="diff-removed">-const testing = std.testing;</div><div class="diff-removed">-</div><div class="diff-removed">-/// A struct that maintains the state of all the settable modes.</div><div class="diff-removed">-pub const ModeState = struct {</div><div class="diff-removed">-    /// The values of the current modes.</div><div class="diff-removed">-    values: ModePacked = .{},</div><div class="diff-removed">-</div><div class="diff-removed">-    /// The saved values. We only allow saving each mode once.</div><div class="diff-removed">-    /// This is in line with other terminals that implement XTSAVE</div><div class="diff-removed">-    /// and XTRESTORE. We can improve this in the future if it becomes</div><div class="diff-removed">-    /// a real-world issue but we need to be aware of a DoS vector.</div><div class="diff-removed">-    saved: ModePacked = .{},</div><div class="diff-removed">-</div><div class="diff-removed">-    /// The default values for the modes. This is used to reset</div><div class="diff-removed">-    /// the modes to their default values during reset.</div><div class="diff-removed">-    default: ModePacked = .{},</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Reset the modes to their default values. This also clears the</div><div class="diff-removed">-    /// saved state.</div><div class="diff-removed">-    pub fn reset(self: *ModeState) void {</div><div class="diff-removed">-        self.values = self.default;</div><div class="diff-removed">-        self.saved = .{};</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Set a mode to a value.</div><div class="diff-removed">-    pub fn set(self: *ModeState, mode: Mode, value: bool) void {</div><div class="diff-removed">-        switch (mode) {</div><div class="diff-removed">-            inline else => |mode_comptime| {</div><div class="diff-removed">-                const entry = comptime entryForMode(mode_comptime);</div><div class="diff-removed">-                @field(self.values, entry.name) = value;</div><div class="diff-removed">-            },</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Get the value of a mode.</div><div class="diff-removed">-    pub fn get(self: *ModeState, mode: Mode) bool {</div><div class="diff-removed">-        switch (mode) {</div><div class="diff-removed">-            inline else => |mode_comptime| {</div><div class="diff-removed">-                const entry = comptime entryForMode(mode_comptime);</div><div class="diff-removed">-                return @field(self.values, entry.name);</div><div class="diff-removed">-            },</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Save the state of the given mode. This can then be restored</div><div class="diff-removed">-    /// with restore. This will only be accurate if the previous</div><div class="diff-removed">-    /// mode was saved exactly once and not restored. Otherwise this</div><div class="diff-removed">-    /// will just keep restoring the last stored value in memory.</div><div class="diff-removed">-    pub fn save(self: *ModeState, mode: Mode) void {</div><div class="diff-removed">-        switch (mode) {</div><div class="diff-removed">-            inline else => |mode_comptime| {</div><div class="diff-removed">-                const entry = comptime entryForMode(mode_comptime);</div><div class="diff-removed">-                @field(self.saved, entry.name) = @field(self.values, entry.name);</div><div class="diff-removed">-            },</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// See save. This will return the restored value.</div><div class="diff-removed">-    pub fn restore(self: *ModeState, mode: Mode) bool {</div><div class="diff-removed">-        switch (mode) {</div><div class="diff-removed">-            inline else => |mode_comptime| {</div><div class="diff-removed">-                const entry = comptime entryForMode(mode_comptime);</div><div class="diff-removed">-                @field(self.values, entry.name) = @field(self.saved, entry.name);</div><div class="diff-removed">-                return @field(self.values, entry.name);</div><div class="diff-removed">-            },</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    test {</div><div class="diff-removed">-        // We have this here so that we explicitly fail when we change the</div><div class="diff-removed">-        // size of modes. The size of modes is NOT particularly important,</div><div class="diff-removed">-        // we just want to be mentally aware when it happens.</div><div class="diff-removed">-        try std.testing.expectEqual(8, @sizeOf(ModePacked));</div><div class="diff-removed">-    }</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-/// A packed struct of all the settable modes. This shouldn't</div><div class="diff-removed">-/// be used directly but rather through the ModeState struct.</div><div class="diff-removed">-pub const ModePacked = packed_struct: {</div><div class="diff-removed">-    const StructField = std.builtin.Type.StructField;</div><div class="diff-removed">-    var fields: [entries.len]StructField = undefined;</div><div class="diff-removed">-    for (entries, 0..) |entry, i| {</div><div class="diff-removed">-        fields[i] = .{</div><div class="diff-removed">-            .name = entry.name,</div><div class="diff-removed">-            .type = bool,</div><div class="diff-removed">-            .default_value_ptr = &entry.default,</div><div class="diff-removed">-            .is_comptime = false,</div><div class="diff-removed">-            .alignment = 0,</div><div class="diff-removed">-        };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    break :packed_struct @Type(.{ .@"struct" = .{</div><div class="diff-removed">-        .layout = .@"packed",</div><div class="diff-removed">-        .fields = &fields,</div><div class="diff-removed">-        .decls = &.{},</div><div class="diff-removed">-        .is_tuple = false,</div><div class="diff-removed">-    } });</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-/// An enum(u16) of the available modes. See entries for available values.</div><div class="diff-removed">-pub const Mode = mode_enum: {</div><div class="diff-removed">-    const EnumField = std.builtin.Type.EnumField;</div><div class="diff-removed">-    var fields: [entries.len]EnumField = undefined;</div><div class="diff-removed">-    for (entries, 0..) |entry, i| {</div><div class="diff-removed">-        fields[i] = .{</div><div class="diff-removed">-            .name = entry.name,</div><div class="diff-removed">-            .value = @as(ModeTag.Backing, @bitCast(ModeTag{</div><div class="diff-removed">-                .value = entry.value,</div><div class="diff-removed">-                .ansi = entry.ansi,</div><div class="diff-removed">-            })),</div><div class="diff-removed">-        };</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    break :mode_enum @Type(.{ .@"enum" = .{</div><div class="diff-removed">-        .tag_type = ModeTag.Backing,</div><div class="diff-removed">-        .fields = &fields,</div><div class="diff-removed">-        .decls = &.{},</div><div class="diff-removed">-        .is_exhaustive = true,</div><div class="diff-removed">-    } });</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-/// The tag type for our enum is a u16 but we use a packed struct</div><div class="diff-removed">-/// in order to pack the ansi bit into the tag.</div><div class="diff-removed">-pub const ModeTag = packed struct(u16) {</div><div class="diff-removed">-    pub const Backing = @typeInfo(@This()).@"struct".backing_integer.?;</div><div class="diff-removed">-    value: u15,</div><div class="diff-removed">-    ansi: bool = false,</div><div class="diff-removed">-</div><div class="diff-removed">-    test "order" {</div><div class="diff-removed">-        const t: ModeTag = .{ .value = 1 };</div><div class="diff-removed">-        const int: Backing = @bitCast(t);</div><div class="diff-removed">-        try std.testing.expectEqual(@as(Backing, 1), int);</div><div class="diff-removed">-    }</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-pub fn modeFromInt(v: u16, ansi: bool) ?Mode {</div><div class="diff-removed">-    inline for (entries) |entry| {</div><div class="diff-removed">-        if (comptime !entry.disabled) {</div><div class="diff-removed">-            if (entry.value == v and entry.ansi == ansi) {</div><div class="diff-removed">-                const tag: ModeTag = .{ .ansi = ansi, .value = entry.value };</div><div class="diff-removed">-                const int: ModeTag.Backing = @bitCast(tag);</div><div class="diff-removed">-                return @enumFromInt(int);</div><div class="diff-removed">-            }</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    return null;</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-fn entryForMode(comptime mode: Mode) ModeEntry {</div><div class="diff-removed">-    @setEvalBranchQuota(10_000);</div><div class="diff-removed">-    const name = @tagName(mode);</div><div class="diff-removed">-    for (entries) |entry| {</div><div class="diff-removed">-        if (std.mem.eql(u8, entry.name, name)) return entry;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    unreachable;</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-/// A single entry of a possible mode we support. This is used to</div><div class="diff-removed">-/// dynamically define the enum and other tables.</div><div class="diff-removed">-const ModeEntry = struct {</div><div class="diff-removed">-    name: [:0]const u8,</div><div class="diff-removed">-    value: comptime_int,</div><div class="diff-removed">-    default: bool = false,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// True if this is an ANSI mode, false if its a DEC mode (?-prefixed).</div><div class="diff-removed">-    ansi: bool = false,</div><div class="diff-removed">-</div><div class="diff-removed">-    /// If true, this mode is disabled and Ghostty will not allow it to be</div><div class="diff-removed">-    /// set or queried. The mode enum still has it, allowing Ghostty developers</div><div class="diff-removed">-    /// to develop a mode without exposing it to real users.</div><div class="diff-removed">-    disabled: bool = false,</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-/// The full list of available entries. For documentation see how</div><div class="diff-removed">-/// they're used within Ghostty or google their values. It is not</div><div class="diff-removed">-/// valuable to redocument them all here.</div><div class="diff-removed">-const entries: []const ModeEntry = &.{</div><div class="diff-removed">-    // ANSI</div><div class="diff-removed">-    .{ .name = "disable_keyboard", .value = 2, .ansi = true }, // KAM</div><div class="diff-removed">-    .{ .name = "insert", .value = 4, .ansi = true },</div><div class="diff-removed">-    .{ .name = "send_receive_mode", .value = 12, .ansi = true, .default = true }, // SRM</div><div class="diff-removed">-    .{ .name = "linefeed", .value = 20, .ansi = true },</div><div class="diff-removed">-</div><div class="diff-removed">-    // DEC</div><div class="diff-removed">-    .{ .name = "cursor_keys", .value = 1 }, // DECCKM</div><div class="diff-removed">-    .{ .name = "132_column", .value = 3 },</div><div class="diff-removed">-    .{ .name = "slow_scroll", .value = 4 },</div><div class="diff-removed">-    .{ .name = "reverse_colors", .value = 5 },</div><div class="diff-removed">-    .{ .name = "origin", .value = 6 },</div><div class="diff-removed">-    .{ .name = "wraparound", .value = 7, .default = true },</div><div class="diff-removed">-    .{ .name = "autorepeat", .value = 8 },</div><div class="diff-removed">-    .{ .name = "mouse_event_x10", .value = 9 },</div><div class="diff-removed">-    .{ .name = "cursor_blinking", .value = 12 },</div><div class="diff-removed">-    .{ .name = "cursor_visible", .value = 25, .default = true },</div><div class="diff-removed">-    .{ .name = "enable_mode_3", .value = 40 },</div><div class="diff-removed">-    .{ .name = "reverse_wrap", .value = 45 },</div><div class="diff-removed">-    .{ .name = "keypad_keys", .value = 66 },</div><div class="diff-removed">-    .{ .name = "enable_left_and_right_margin", .value = 69 },</div><div class="diff-removed">-    .{ .name = "mouse_event_normal", .value = 1000 },</div><div class="diff-removed">-    .{ .name = "mouse_event_button", .value = 1002 },</div><div class="diff-removed">-    .{ .name = "mouse_event_any", .value = 1003 },</div><div class="diff-removed">-    .{ .name = "focus_event", .value = 1004 },</div><div class="diff-removed">-    .{ .name = "mouse_format_utf8", .value = 1005 },</div><div class="diff-removed">-    .{ .name = "mouse_format_sgr", .value = 1006 },</div><div class="diff-removed">-    .{ .name = "mouse_alternate_scroll", .value = 1007, .default = true },</div><div class="diff-removed">-    .{ .name = "mouse_format_urxvt", .value = 1015 },</div><div class="diff-removed">-    .{ .name = "mouse_format_sgr_pixels", .value = 1016 },</div><div class="diff-removed">-    .{ .name = "ignore_keypad_with_numlock", .value = 1035, .default = true },</div><div class="diff-removed">-    .{ .name = "alt_esc_prefix", .value = 1036, .default = true },</div><div class="diff-removed">-    .{ .name = "alt_sends_escape", .value = 1039 },</div><div class="diff-removed">-    .{ .name = "reverse_wrap_extended", .value = 1045 },</div><div class="diff-removed">-    .{ .name = "alt_screen", .value = 1047 },</div><div class="diff-removed">-    .{ .name = "alt_screen_save_cursor_clear_enter", .value = 1049 },</div><div class="diff-removed">-    .{ .name = "bracketed_paste", .value = 2004 },</div><div class="diff-removed">-    .{ .name = "synchronized_output", .value = 2026 },</div><div class="diff-removed">-    .{ .name = "grapheme_cluster", .value = 2027 },</div><div class="diff-removed">-    .{ .name = "report_color_scheme", .value = 2031 },</div><div class="diff-removed">-    .{ .name = "in_band_size_reports", .value = 2048 },</div><div class="diff-removed">-};</div><div class="diff-removed">-</div><div class="diff-removed">-test {</div><div class="diff-removed">-    _ = Mode;</div><div class="diff-removed">-    _ = ModePacked;</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test modeFromInt {</div><div class="diff-removed">-    try testing.expect(modeFromInt(4, true).? == .insert);</div><div class="diff-removed">-    try testing.expect(modeFromInt(9, true) == null);</div><div class="diff-removed">-    try testing.expect(modeFromInt(9, false).? == .mouse_event_x10);</div><div class="diff-removed">-    try testing.expect(modeFromInt(14, true) == null);</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-test ModeState {</div><div class="diff-removed">-    var state: ModeState = .{};</div><div class="diff-removed">-</div><div class="diff-removed">-    // Normal set/get</div><div class="diff-removed">-    try testing.expect(!state.get(.cursor_keys));</div><div class="diff-removed">-    state.set(.cursor_keys, true);</div><div class="diff-removed">-    try testing.expect(state.get(.cursor_keys));</div><div class="diff-removed">-</div><div class="diff-removed">-    // Save/restore</div><div class="diff-removed">-    state.save(.cursor_keys);</div><div class="diff-removed">-    state.set(.cursor_keys, false);</div><div class="diff-removed">-    try testing.expect(!state.get(.cursor_keys));</div><div class="diff-removed">-    try testing.expect(state.restore(.cursor_keys));</div><div class="diff-removed">-    try testing.expect(state.get(.cursor_keys));</div><div class="diff-removed">-}</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    