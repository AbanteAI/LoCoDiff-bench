<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/react-reconciler/src/ReactFiberUnwindWork.js - DeepSeek R1 0528</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/react-reconciler/src/ReactFiberUnwindWork.js</h1>
        <h2>Model: DeepSeek R1 0528</h2>
        <p><a href="../../models/deepseek_deepseek-r1-0528.html">All DeepSeek R1 0528 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> DeepSeek R1 0528</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 80001</p>
                <p><strong>Native Prompt Tokens:</strong> 84257</p>
                <p><strong>Native Completion Tokens:</strong> 9987</p>
                <p><strong>Native Tokens Reasoning:</strong> 7267</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.06390016</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/react_packages_react-reconciler_src_ReactFiberUnwindWork.js/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/react_packages_react-reconciler_src_ReactFiberUnwindWork.js/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/deepseek_deepseek-r1-0528/react_packages_react-reconciler_src_ReactFiberUnwindWork.js/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index ba169d3f5..b979fd22a 100644</div><div class="diff-header">--- a/react_packages_react-reconciler_src_ReactFiberUnwindWork.js_expectedoutput.txt (expected):tmp/tmp4u61rsqm_expected.txt	</div><div class="diff-header">+++ b/react_packages_react-reconciler_src_ReactFiberUnwindWork.js_extracted.txt (actual):tmp/tmpm7ehphee_actual.txt	</div><div class="diff-info">@@ -1,5 +1,5 @@</div><div> /**</div><div class="diff-removed">- * Copyright (c) Meta Platforms, Inc. and affiliates.</div><div class="diff-added">+ * Copyright (c) 2013-present, Facebook, Inc.</div><div>  *</div><div>  * This source code is licensed under the MIT license found in the</div><div>  * LICENSE file in the root directory of this source tree.</div><div class="diff-info">@@ -7,315 +7,415 @@</div><div>  * @flow</div><div>  */</div><div> </div><div class="diff-removed">-import type {ReactContext} from 'shared/ReactTypes';</div><div class="diff-removed">-import type {Fiber, FiberRoot} from './ReactInternalTypes';</div><div class="diff-removed">-import type {Lanes} from './ReactFiberLane';</div><div class="diff-removed">-import type {ActivityState} from './ReactFiberActivityComponent';</div><div class="diff-removed">-import type {SuspenseState} from './ReactFiberSuspenseComponent';</div><div class="diff-removed">-import type {Cache} from './ReactFiberCacheComponent';</div><div class="diff-removed">-import type {TracingMarkerInstance} from './ReactFiberTracingMarkerComponent';</div><div class="diff-added">+import type {HostConfig} from 'react-reconciler';</div><div class="diff-added">+import type {Fiber} from './ReactFiber';</div><div class="diff-added">+import type {ExpirationTime} from './ReactFiberExpirationTime';</div><div class="diff-added">+import type {HostContext} from './ReactFiberHostContext';</div><div class="diff-added">+import type {LegacyContext} from './ReactFiberContext';</div><div class="diff-added">+import type {NewContext} from './ReactFiberNewContext';</div><div class="diff-added">+import type {CapturedValue} from './ReactCapturedValue';</div><div class="diff-added">+import type {ProfilerTimer} from './ReactProfilerTimer';</div><div class="diff-added">+import type {Update} from './ReactUpdateQueue';</div><div class="diff-added">+import type {Thenable} from './ReactFiberScheduler';</div><div class="diff-added">+</div><div class="diff-added">+import {createCapturedValue} from './ReactCapturedValue';</div><div class="diff-added">+import {</div><div class="diff-added">+  enqueueCapturedUpdate,</div><div class="diff-added">+  createUpdate,</div><div class="diff-added">+  enqueueUpdate,</div><div class="diff-added">+  CaptureUpdate,</div><div class="diff-added">+} from './ReactUpdateQueue';</div><div class="diff-added">+import {logError} from './ReactFiberCommitWork';</div><div> </div><div> import {</div><div>   ClassComponent,</div><div>   HostRoot,</div><div>   HostComponent,</div><div class="diff-removed">-  HostHoistable,</div><div class="diff-removed">-  HostSingleton,</div><div>   HostPortal,</div><div>   ContextProvider,</div><div class="diff-removed">-  ActivityComponent,</div><div class="diff-removed">-  SuspenseComponent,</div><div class="diff-removed">-  SuspenseListComponent,</div><div class="diff-removed">-  OffscreenComponent,</div><div class="diff-removed">-  LegacyHiddenComponent,</div><div class="diff-removed">-  CacheComponent,</div><div class="diff-removed">-  TracingMarkerComponent,</div><div class="diff-removed">-} from './ReactWorkTags';</div><div class="diff-removed">-import {DidCapture, NoFlags, ShouldCapture} from './ReactFiberFlags';</div><div class="diff-removed">-import {NoMode, ProfileMode} from './ReactTypeOfMode';</div><div class="diff-added">+  Profiler,</div><div class="diff-added">+  PlaceholderComponent,</div><div class="diff-added">+} from 'shared/ReactTypeOfWork';</div><div> import {</div><div class="diff-added">+  DidCapture,</div><div class="diff-added">+  Incomplete,</div><div class="diff-added">+  NoEffect,</div><div class="diff-added">+  ShouldCapture,</div><div class="diff-added">+  Update as UpdateEffect,</div><div class="diff-added">+} from 'shared/ReactTypeOfSideEffect';</div><div class="diff-added">+import {</div><div class="diff-added">+  enableGetDerivedStateFromCatch,</div><div>   enableProfilerTimer,</div><div class="diff-removed">-  enableTransitionTracing,</div><div class="diff-removed">-  enableRenderableContext,</div><div class="diff-added">+  enableSuspense,</div><div> } from 'shared/ReactFeatureFlags';</div><div> </div><div class="diff-removed">-import {popHostContainer, popHostContext} from './ReactFiberHostContext';</div><div class="diff-removed">-import {</div><div class="diff-removed">-  popSuspenseListContext,</div><div class="diff-removed">-  popSuspenseHandler,</div><div class="diff-removed">-} from './ReactFiberSuspenseContext';</div><div class="diff-removed">-import {popHiddenContext} from './ReactFiberHiddenContext';</div><div class="diff-removed">-import {resetHydrationState} from './ReactFiberHydrationContext';</div><div class="diff-removed">-import {</div><div class="diff-removed">-  isContextProvider as isLegacyContextProvider,</div><div class="diff-removed">-  popContext as popLegacyContext,</div><div class="diff-removed">-  popTopLevelContextObject as popTopLevelLegacyContextObject,</div><div class="diff-removed">-} from './ReactFiberContext';</div><div class="diff-removed">-import {popProvider} from './ReactFiberNewContext';</div><div class="diff-removed">-import {popCacheProvider} from './ReactFiberCacheComponent';</div><div class="diff-removed">-import {transferActualDuration} from './ReactProfilerTimer';</div><div class="diff-removed">-import {popTreeContext} from './ReactFiberTreeContext';</div><div class="diff-removed">-import {popRootTransition, popTransition} from './ReactFiberTransition';</div><div class="diff-removed">-import {</div><div class="diff-removed">-  popMarkerInstance,</div><div class="diff-removed">-  popRootMarkerInstance,</div><div class="diff-removed">-} from './ReactFiberTracingMarkerComponent';</div><div class="diff-added">+import {Sync, expirationTimeToMs} from './ReactFiberExpirationTime';</div><div> </div><div class="diff-removed">-function unwindWork(</div><div class="diff-removed">-  current: Fiber | null,</div><div class="diff-removed">-  workInProgress: Fiber,</div><div class="diff-removed">-  renderLanes: Lanes,</div><div class="diff-removed">-): Fiber | null {</div><div class="diff-removed">-  // Note: This intentionally doesn't check if we're hydrating because comparing</div><div class="diff-removed">-  // to the current tree provider fiber is just as fast and less error-prone.</div><div class="diff-removed">-  // Ideally we would have a special version of the work loop only</div><div class="diff-removed">-  // for hydration.</div><div class="diff-removed">-  popTreeContext(workInProgress);</div><div class="diff-removed">-  switch (workInProgress.tag) {</div><div class="diff-removed">-    case ClassComponent: {</div><div class="diff-removed">-      const Component = workInProgress.type;</div><div class="diff-removed">-      if (isLegacyContextProvider(Component)) {</div><div class="diff-removed">-        popLegacyContext(workInProgress);</div><div class="diff-removed">-      }</div><div class="diff-removed">-      const flags = workInProgress.flags;</div><div class="diff-removed">-      if (flags & ShouldCapture) {</div><div class="diff-removed">-        workInProgress.flags = (flags & ~ShouldCapture) | DidCapture;</div><div class="diff-added">+export default function<T, P, I, TI, HI, PI, C, CC, CX, PL>(</div><div class="diff-added">+  config: HostConfig<T, P, I, TI, HI, PI, C, CC, CX, PL>,</div><div class="diff-added">+  hostContext: HostContext<C, CX>,</div><div class="diff-added">+  legacyContext: LegacyContext,</div><div class="diff-added">+  newContext: NewContext,</div><div class="diff-added">+  scheduleWork: (fiber: Fiber, expirationTime: ExpirationTime) => void,</div><div class="diff-added">+  computeExpirationForFiber: (</div><div class="diff-added">+    startTime: ExpirationTime,</div><div class="diff-added">+    fiber: Fiber,</div><div class="diff-added">+  ) => ExpirationTime,</div><div class="diff-added">+  recalculateCurrentTime: () => ExpirationTime,</div><div class="diff-added">+  markLegacyErrorBoundaryAsFailed: (instance: mixed) => void,</div><div class="diff-added">+  isAlreadyFailedLegacyErrorBoundary: (instance: mixed) => boolean,</div><div class="diff-added">+  onUncaughtError: (error: mixed) => void,</div><div class="diff-added">+  profilerTimer: ProfilerTimer,</div><div class="diff-added">+  suspendRoot: (</div><div class="diff-added">+    root: FiberRoot,</div><div class="diff-added">+    thenable: Thenable,</div><div class="diff-added">+    timeoutMs: number,</div><div class="diff-added">+    suspendedTime: ExpirationTime,</div><div class="diff-added">+  ) => void,</div><div class="diff-added">+  retrySuspendedRoot: (root: FiberRoot, suspendedTime: ExpirationTime) => void,</div><div class="diff-added">+) {</div><div class="diff-added">+  const {popHostContainer, popHostContext} = hostContext;</div><div class="diff-added">+  const {</div><div class="diff-added">+    popContextProvider: popLegacyContextProvider,</div><div class="diff-added">+    popTopLevelContextObject: popTopLevelLegacyContextObject,</div><div class="diff-added">+  } = legacyContext;</div><div class="diff-added">+  const {popProvider} = newContext;</div><div class="diff-added">+  const {</div><div class="diff-added">+    resumeActualRenderTimerIfPaused,</div><div class="diff-added">+    recordElapsedActualRenderTime,</div><div class="diff-added">+  } = profilerTimer;</div><div class="diff-added">+</div><div class="diff-added">+  function createRootErrorUpdate(</div><div class="diff-added">+    fiber: Fiber,</div><div class="diff-added">+    errorInfo: CapturedValue<mixed>,</div><div class="diff-added">+    expirationTime: ExpirationTime,</div><div class="diff-added">+  ): Update<null> {</div><div class="diff-added">+    const update = createUpdate(expirationTime);</div><div class="diff-added">+    // Unmount the root by rendering null.</div><div class="diff-added">+    update.tag = CaptureUpdate;</div><div class="diff-added">+    // Caution: React DevTools currently depends on this property</div><div class="diff-added">+    // being called "element".</div><div class="diff-added">+    update.payload = {element: null};</div><div class="diff-added">+    const error = errorInfo.value;</div><div class="diff-added">+    update.callback = () => {</div><div class="diff-added">+      onUncaughtError(error);</div><div class="diff-added">+      logError(fiber, errorInfo);</div><div class="diff-added">+    };</div><div class="diff-added">+    return update;</div><div class="diff-added">+  }</div><div class="diff-added">+</div><div class="diff-added">+  function createClassErrorUpdate(</div><div class="diff-added">+    fiber: Fiber,</div><div class="diff-added">+    errorInfo: CapturedValue<mixed>,</div><div class="diff-added">+    expirationTime: ExpirationTime,</div><div class="diff-added">+  ): Update<mixed> {</div><div class="diff-added">+    const update = createUpdate(expirationTime);</div><div class="diff-added">+    update.tag = CaptureUpdate;</div><div class="diff-added">+    const getDerivedStateFromCatch = fiber.type.getDerivedStateFromCatch;</div><div class="diff-added">+    if (</div><div class="diff-added">+      enableGetDerivedStateFromCatch &&</div><div class="diff-added">+      typeof getDerivedStateFromCatch === 'function'</div><div class="diff-added">+    ) {</div><div class="diff-added">+      const error = errorInfo.value;</div><div class="diff-added">+      update.payload = () => {</div><div class="diff-added">+        return getDerivedStateFromCatch(error);</div><div class="diff-added">+      };</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    const inst = fiber.stateNode;</div><div class="diff-added">+    if (inst !== null && typeof inst.componentDidCatch === 'function') {</div><div class="diff-added">+      update.callback = function callback() {</div><div>         if (</div><div class="diff-removed">-          enableProfilerTimer &&</div><div class="diff-removed">-          (workInProgress.mode & ProfileMode) !== NoMode</div><div class="diff-added">+          !enableGetDerivedStateFromCatch ||</div><div class="diff-added">+          getDerivedStateFromCatch !== 'function'</div><div>         ) {</div><div class="diff-removed">-          transferActualDuration(workInProgress);</div><div class="diff-added">+          // To preserve the preexisting retry behavior of error boundaries,</div><div class="diff-added">+          // we keep track of which ones already failed during this batch.</div><div class="diff-added">+          // This gets reset before we yield back to the browser.</div><div class="diff-added">+          // TODO: Warn in strict mode if getDerivedStateFromCatch is</div><div class="diff-added">+          // not defined.</div><div class="diff-added">+          markLegacyErrorBoundaryAsFailed(this);</div><div>         }</div><div class="diff-removed">-        return workInProgress;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      return null;</div><div class="diff-added">+        const error = errorInfo.value;</div><div class="diff-added">+        const stack = errorInfo.stack;</div><div class="diff-added">+        logError(fiber, errorInfo);</div><div class="diff-added">+        this.componentDidCatch(error, {</div><div class="diff-added">+          componentStack: stack !== null ? stack : '',</div><div class="diff-added">+        });</div><div class="diff-added">+      };</div><div>     }</div><div class="diff-removed">-    case HostRoot: {</div><div class="diff-removed">-      const root: FiberRoot = workInProgress.stateNode;</div><div class="diff-removed">-      const cache: Cache = workInProgress.memoizedState.cache;</div><div class="diff-removed">-      popCacheProvider(workInProgress, cache);</div><div class="diff-added">+    return update;</div><div class="diff-added">+  }</div><div> </div><div class="diff-removed">-      if (enableTransitionTracing) {</div><div class="diff-removed">-        popRootMarkerInstance(workInProgress);</div><div class="diff-removed">-      }</div><div class="diff-added">+  function schedulePing(finishedWork) {</div><div class="diff-added">+    // Once the promise resolves, we should try rendering the non-</div><div class="diff-added">+    // placeholder state again.</div><div class="diff-added">+    const currentTime = recalculateCurrentTime();</div><div class="diff-added">+    const expirationTime = computeExpirationForFiber(currentTime, finishedWork);</div><div class="diff-added">+    const recoveryUpdate = createUpdate(expirationTime);</div><div class="diff-added">+    enqueueUpdate(finishedWork, recoveryUpdate, expirationTime);</div><div class="diff-added">+    scheduleWork(finishedWork, expirationTime);</div><div class="diff-added">+  }</div><div> </div><div class="diff-removed">-      popRootTransition(workInProgress, root, renderLanes);</div><div class="diff-removed">-      popHostContainer(workInProgress);</div><div class="diff-removed">-      popTopLevelLegacyContextObject(workInProgress);</div><div class="diff-removed">-      const flags = workInProgress.flags;</div><div class="diff-removed">-      if (</div><div class="diff-removed">-        (flags & ShouldCapture) !== NoFlags &&</div><div class="diff-removed">-        (flags & DidCapture) === NoFlags</div><div class="diff-removed">-      ) {</div><div class="diff-removed">-        // There was an error during render that wasn't captured by a suspense</div><div class="diff-removed">-        // boundary. Do a second pass on the root to unmount the children.</div><div class="diff-removed">-        workInProgress.flags = (flags & ~ShouldCapture) | DidCapture;</div><div class="diff-removed">-        return workInProgress;</div><div class="diff-removed">-      }</div><div class="diff-removed">-      // We unwound to the root without completing it. Exit.</div><div class="diff-removed">-      return null;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    case HostHoistable:</div><div class="diff-removed">-    case HostSingleton:</div><div class="diff-removed">-    case HostComponent: {</div><div class="diff-removed">-      // TODO: popHydrationState</div><div class="diff-removed">-      popHostContext(workInProgress);</div><div class="diff-removed">-      return null;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    case ActivityComponent: {</div><div class="diff-removed">-      const activityState: null | ActivityState = workInProgress.memoizedState;</div><div class="diff-removed">-      if (activityState !== null) {</div><div class="diff-removed">-        popSuspenseHandler(workInProgress);</div><div class="diff-added">+  function throwException(</div><div class="diff-added">+    root: FiberRoot,</div><div class="diff-added">+    returnFiber: Fiber,</div><div class="diff-added">+    sourceFiber: Fiber,</div><div class="diff-added">+    value: mixed,</div><div class="diff-added">+    renderExpirationTime: ExpirationTime,</div><div class="diff-added">+    currentTimeMs: number,</div><div class="diff-added">+  ) {</div><div class="diff-added">+    // The source fiber did not complete.</div><div class="diff-added">+    sourceFiber.effectTag |= Incomplete;</div><div class="diff-added">+    // Its effect list is no longer valid.</div><div class="diff-added">+    sourceFiber.firstEffect = sourceFiber.lastEffect = null;</div><div> </div><div class="diff-removed">-        if (workInProgress.alternate === null) {</div><div class="diff-removed">-          throw new Error(</div><div class="diff-removed">-            'Threw in newly mounted dehydrated component. This is likely a bug in ' +</div><div class="diff-removed">-              'React. Please file an issue.',</div><div class="diff-removed">-          );</div><div class="diff-removed">-        }</div><div class="diff-added">+    if (</div><div class="diff-added">+      enableSuspense &&</div><div class="diff-added">+      value !== null &&</div><div class="diff-added">+      typeof value === 'object' &&</div><div class="diff-added">+      typeof value.then === 'function'</div><div class="diff-added">+    ) {</div><div class="diff-added">+      // This is a thenable.</div><div class="diff-added">+      const thenable: Thenable = (value: any);</div><div> </div><div class="diff-removed">-        resetHydrationState();</div><div class="diff-added">+      const expirationTimeMs = expirationTimeToMs(renderExpirationTime);</div><div class="diff-added">+      const startTimeMs = expirationTimeMs - 5000;</div><div class="diff-added">+      let elapsedMs = currentTimeMs - startTimeMs;</div><div class="diff-added">+      if (elapsedMs < 0) {</div><div class="diff-added">+        elapsedMs = 0;</div><div>       }</div><div class="diff-added">+      const remainingTimeMs = expirationTimeMs - currentTimeMs;</div><div> </div><div class="diff-removed">-      const flags = workInProgress.flags;</div><div class="diff-removed">-      if (flags & ShouldCapture) {</div><div class="diff-removed">-        workInProgress.flags = (flags & ~ShouldCapture) | DidCapture;</div><div class="diff-removed">-        // Captured a suspense effect. Re-render the boundary.</div><div class="diff-removed">-        if (</div><div class="diff-removed">-          enableProfilerTimer &&</div><div class="diff-removed">-          (workInProgress.mode & ProfileMode) !== NoMode</div><div class="diff-removed">-        ) {</div><div class="diff-removed">-          transferActualDuration(workInProgress);</div><div class="diff-added">+      // Find the earliest timeout of all the timeouts in the ancestor path.</div><div class="diff-added">+      // TODO: Alternatively, we could store the earliest timeout on the context</div><div class="diff-added">+      // stack, rather than searching on every suspend.</div><div class="diff-added">+      let workInProgress = returnFiber;</div><div class="diff-added">+      let earliestTimeoutMs = -1;</div><div class="diff-added">+      searchForEarliestTimeout: do {</div><div class="diff-added">+        if (workInProgress.tag === PlaceholderComponent) {</div><div class="diff-added">+          const current = work极Progress.alternate;</div><div class="diff-added">+          if (current !== null && current.memoizedState === true) {</div><div class="diff-added">+            // A parent Placeholder already committed in a placeholder state. We</div><div class="diff-added">+            // need to handle this promise immediately. In other words, we</div><div class="diff-added">+            // should never suspend inside a tree that already expired.</div><div class="diff-added">+            earliestTimeoutMs = 0;</div><div class="diff-added">+            break searchForEarliestTimeout;</div><div class="diff-added">+          }</div><div class="diff-added">+          let timeoutPropMs = workInProgress.pendingProps.ms;</div><div class="diff-added">+          if (typeof timeoutPropMs === 'number') {</div><div class="diff-added">+            if (timeoutPropMs <= 0) {</div><div class="diff-added">+              earliestTimeoutMs = 0;</div><div class="diff-added">+              break searchForEarliestTimeout;</div><div class="diff-added">+            } else if (</div><div class="diff-added">+              earliestTimeoutMs === -1 ||</div><div class="diff-added">+              timeoutPropMs < earliestTimeoutMs</div><div class="diff-added">+            ) {</div><div class="diff-added">+              earliestTimeoutMs = timeoutPropMs;</div><div class="diff-added">+            }</div><div class="diff-added">+          } else if (earliestTimeoutMs === -1) {</div><div class="diff-added">+            earliestTimeoutMs = remaining极Ms;</div><div class="diff-added">+          }</div><div>         }</div><div class="diff-removed">-        return workInProgress;</div><div class="diff-added">+        workInProgress = workInProgress.return;</div><div class="diff-added">+      } while (workInProgress !== null);</div><div class="diff-added">+</div><div class="diff-added">+      // Compute the remaining time until the timeout.</div><div class="diff-added">+      const msUntilTimeout = earliestTimeoutMs - elapsedMs;</div><div class="diff-added">+</div><div class="diff-added">+      if (renderExpirationTime === Sync || msUntilTimeout > 0) {</div><div class="diff-added">+        // There's still time remaining.</div><div class="diff-added">+        suspendRoot(root, thenable, msUntilTimeout, renderExpirationTime);</div><div class="diff-added">+        const onResolveOrReject = () => {</div><div class="diff-added">+          retrySuspendedRoot(root, renderExpirationTime);</div><div class="diff-added">+        };</div><div class="diff-added">+        thenable.then(onResolveOrReject, onResolveOrReject);</div><div class="diff-added">+        return;</div><div class="diff-added">+      } else {</div><div class="diff-added">+        // No time remaining. Need to fallback to placeholder.</div><div class="diff-added">+        // Find the nearest placeholder that can be retried.</div><div class="diff-added">+        workInProgress = returnFiber;</div><div class="diff-added">+        do {</div><div class="diff-added">+          switch (workInProgress.tag) {</div><div class="diff-added">+            case HostRoot: {</div><div class="diff-added">+              // The root expired, but no fallback was provided. Throw a</div><div class="diff-added">+              // helpful error.</div><div class="diff-added">+              const message =</div><div class="diff-added">+                renderExpirationTime === Sync</div><div class="diff-added">+                  ? 'A synchronous update was suspended, but no fallback UI ' +</div><div class="diff-added">+                    'was provided.'</div><div class="diff-added">+                  : 'An update was suspended for longer than the timeout, ' +</div><div class="diff-added">+                    'but no fallback UI was provided.';</div><div class="diff-added">+              value = new Error(message);</div><div class="diff-added">+              break;</div><div class="diff-added">+            }</div><div class="diff-added">+            case PlaceholderComponent: {</div><div class="diff-added">+              if ((workInProgress.effectTag & DidCapture) === NoEffect) {</div><div class="diff-added">+                workInProgress.effectTag |= ShouldCapture;</div><div class="diff-added">+                const onResolveOrReject = schedulePing.bind(</div><div class="diff-added">+                  null,</div><div class="diff-added">+                  workInProgress,</div><div class="diff-added">+                );</div><div class="diff-added">+                thenable.then(onResolveOrReject, onResolveOrReject);</div><div class="diff-added">+                return;</div><div class="diff-added">+              }</div><div class="diff-added">+              // Already captured during this render. Continue to the next</div><div class="diff-added">+              // Placeholder ancestor.</div><div class="diff-added">+              break;</div><div class="diff-added">+            }</div><div class="diff-added">+          }</div><div class="diff-added">+          workInProgress = workInProgress.return;</div><div class="diff-added">+        } while (workInProgress !== null);</div><div>       }</div><div class="diff-removed">-      return null;</div><div>     }</div><div class="diff-removed">-    case SuspenseComponent: {</div><div class="diff-removed">-      popSuspenseHandler(workInProgress);</div><div class="diff-removed">-      const suspenseState: null | SuspenseState = workInProgress.memoizedState;</div><div class="diff-removed">-      if (suspenseState !== null && suspenseState.dehydrated !== null) {</div><div class="diff-removed">-        if (workInProgress.alternate === null) {</div><div class="diff-removed">-          throw new Error(</div><div class="diff-removed">-            'Threw in newly mounted dehydrated component. This is likely a bug in ' +</div><div class="diff-removed">-              'React. Please file an issue.',</div><div class="diff-added">+</div><div class="diff-added">+    // We didn't find a boundary that could handle this type of exception. Start</div><div class="diff-added">+    // over and traverse parent path again, this time treating the exception</div><div class="diff-added">+    // as an error.</div><div class="diff-added">+    value = createCapturedValue(value, sourceFiber);</div><div class="diff-added">+    let workInProgress = returnFiber;</div><div class="diff-added">+    do {</div><div class="diff-added">+      switch (workInProgress.tag) {</div><div class="diff-added">+        case HostRoot: {</div><div class="diff-added">+          const errorInfo = value;</div><div class="diff-added">+          workInProgress.effectTag |= ShouldCapture;</div><div class="diff-added">+          const update = createRootErrorUpdate(</div><div class="diff-added">+            workInProgress,</div><div class="diff-added">+            errorInfo,</div><div class="diff-added">+            renderExpirationTime,</div><div>           );</div><div class="diff-added">+          enqueueCapturedUpdate(workInProgress, update, renderExpirationTime);</div><div class="diff-added">+          return;</div><div>         }</div><div class="diff-removed">-</div><div class="diff-removed">-        resetHydrationState();</div><div class="diff-added">+        case ClassComponent:</div><div class="diff-added">+          // Capture and retry</div><div class="diff-added">+          const errorInfo = value;</div><div class="diff-added">+          const ctor = workInProgress.type;</div><div class="diff-added">+          const instance = workInProgress.stateNode;</div><div class="diff-added">+          if (</div><div class="diff-added">+            (workInProgress.effectTag & DidCapture) === NoEffect &&</div><div class="diff-added">+            ((typeof ctor.getDerivedStateFromCatch === 'function' &&</div><div class="diff-added">+              enableGet极StateFromCatch) ||</div><div class="diff-added">+              (instance !== null &&</div><div class="diff-added">+                typeof instance.componentDidCatch === 'function' &&</div><div class="diff-added">+                !isAlreadyFailedLegacyErrorBoundary(instance)))</div><div class="diff-added">+          ) {</div><div class="diff-added">+            workInProgress.effectTag |= ShouldCapture;</div><div class="diff-added">+            const update = createClassErrorUpdate(</div><div class="diff-added">+              workInProgress,</div><div class="diff-added">+              errorInfo,</div><div class="diff-added">+              renderExpirationTime,</div><div class="diff-added">+            );</div><div class="diff-added">+            enqueueCapturedUpdate(workInProgress, update, renderExpirationTime);</div><div class="diff-added">+            return;</div><div class="diff-added">+          }</div><div class="diff-added">+          break;</div><div class="diff-added">+        default:</div><div class="diff-added">+          break;</div><div>       }</div><div class="diff-added">+      workInProgress = workInProgress.return;</div><div class="diff-added">+    } while (workInProgress !== null);</div><div class="diff-added">+  }</div><div> </div><div class="diff-removed">-      const flags = workInProgress.flags;</div><div class="diff-removed">-      if (flags & ShouldCapture) {</div><div class="diff-removed">-        workInProgress.flags = (flags & ~ShouldCapture) | DidCapture;</div><div class="diff-removed">-        // Captured a suspense effect. Re-render the boundary.</div><div class="diff-removed">-        if (</div><div class="diff-removed">-          enableProfilerTimer &&</div><div class="diff-removed">-          (workInProgress.mode & ProfileMode) !== NoMode</div><div class="diff-removed">-        ) {</div><div class="diff-removed">-          transferActualDuration(workInProgress);</div><div class="diff-removed">-        }</div><div class="diff-removed">-        return workInProgress;</div><div class="diff-added">+  function unwindWork(</div><div class="diff-added">+    workInProgress: Fiber,</div><div class="diff-added">+    renderExpirationTime: ExpirationTime,</div><div class="diff-added">+  ) {</div><div class="diff-added">+    if (enableProfilerTimer) {</div><div class="diff-added">+      if (workInProgress.mode & ProfileMode) {</div><div class="diff-added">+        recordElapsedActualRenderTime(workInProgress);</div><div>       }</div><div class="diff-removed">-      return null;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    case SuspenseListComponent: {</div><div class="diff-removed">-      popSuspenseListContext(workInProgress);</div><div class="diff-removed">-      // SuspenseList doesn't actually catch anything. It should've been</div><div class="diff-removed">-      // caught by a nested boundary. If not, it should bubble through.</div><div class="diff-removed">-      return null;</div><div>     }</div><div class="diff-removed">-    case HostPortal:</div><div class="diff-removed">-      popHostContainer(workInProgress);</div><div class="diff-removed">-      return null;</div><div class="diff-removed">-    case ContextProvider:</div><div class="diff-removed">-      let context: ReactContext<any>;</div><div class="diff-removed">-      if (enableRenderableContext) {</div><div class="diff-removed">-        context = workInProgress.type;</div><div class="diff-removed">-      } else {</div><div class="diff-removed">-        context = workInProgress.type._context;</div><div class="diff-added">+</div><div class="diff-added">+    switch (workInProgress.tag) {</div><div class="diff-added">+      case ClassComponent: {</div><div class="diff-added">+        popLegacyContextProvider(workInProgress);</div><div class="diff-added">+        const effectTag = workInProgress.effectTag;</div><div class="diff-added">+        if (effectTag & ShouldCapture) {</div><div class="diff-added">+          workInProgress.effectTag = (effectTag & ~ShouldCapture) | DidCapture;</div><div class="diff-added">+          return workInProgress;</div><div class="diff-added">+        }</div><div class="diff-added">+        return null;</div><div>       }</div><div class="diff-removed">-      popProvider(context, workInProgress);</div><div class="diff-removed">-      return null;</div><div class="diff-removed">-    case OffscreenComponent:</div><div class="diff-removed">-    case LegacyHiddenComponent: {</div><div class="diff-removed">-      popSuspenseHandler(workInProgress);</div><div class="diff-removed">-      popHiddenContext(workInProgress);</div><div class="diff-removed">-      popTransition(workInProgress, current);</div><div class="diff-removed">-      const flags = workInProgress.flags;</div><div class="diff-removed">-      if (flags & ShouldCapture) {</div><div class="diff-removed">-        workInProgress.flags = (flags & ~ShouldCapture) | DidCapture;</div><div class="diff-removed">-        // Captured a suspense effect. Re-render the boundary.</div><div class="diff-removed">-        if (</div><div class="diff-removed">-          enableProfilerTimer &&</div><div class="diff-removed">-          (workInProgress.mode & ProfileMode) !== NoMode</div><div class="diff-removed">-        ) {</div><div class="diff-removed">-          transferActualDuration(workInProgress);</div><div class="diff-added">+      case HostRoot: {</div><div class="diff-added">+        popHostContainer(workInProgress);</div><div class="diff-added">+        popTopLevelLegacyContextObject(workInProgress);</div><div class="diff-added">+        const effectTag = workInProgress.effectTag;</div><div class="diff-added">+        if (effectTag & ShouldCapture) {</div><div class="diff-added">+          workInProgress.effectTag = (effectTag & ~ShouldCapture) | DidCapture;</div><div class="diff-added">+          return workInProgress;</div><div>         }</div><div class="diff-removed">-        return workInProgress;</div><div class="diff-added">+        return null;</div><div>       }</div><div class="diff-removed">-      return null;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    case CacheComponent:</div><div class="diff-removed">-      const cache: Cache = workInProgress.memoizedState.cache;</div><div class="diff-removed">-      popCacheProvider(workInProgress, cache);</div><div class="diff-removed">-      return null;</div><div class="diff-removed">-    case TracingMarkerComponent:</div><div class="diff-removed">-      if (enableTransitionTracing) {</div><div class="diff-removed">-        if (workInProgress.stateNode !== null) {</div><div class="diff-removed">-          popMarkerInstance(workInProgress);</div><div class="diff-added">+      case HostComponent: {</div><div class="diff-added">+        popHostContext(workInProgress);</div><div class="diff-added">+        return null;</div><div class="diff-added">+      }</div><div class="diff-added">+      case PlaceholderComponent: {</div><div class="diff-added">+        const effectTag = workInProgress.effectTag;</div><div class="diff-added">+        if (effectTag & ShouldCapture) {</div><div class="diff-added">+          workInProgress.effectTag = (effectTag & ~ShouldCapture) | DidCapture;</div><div class="diff-added">+          return workInProgress;</div><div>         }</div><div class="diff-added">+        return null;</div><div>       }</div><div class="diff-removed">-      return null;</div><div class="diff-removed">-    default:</div><div class="diff-removed">-      return null;</div><div class="diff-added">+      case HostPortal:</div><div class="diff-added">+        popHostContainer(workInProgress);</div><div class="diff-added">+        return null;</div><div class="diff-added">+      case ContextProvider:</div><div class="diff-added">+        popProvider(workInProgress);</div><div class="diff-added">+        return null;</div><div class="diff-added">+      default:</div><div class="diff-added">+        return null;</div><div class="diff-added">+    }</div><div>   }</div><div class="diff-removed">-}</div><div> </div><div class="diff-removed">-function unwindInterruptedWork(</div><div class="diff-removed">-  current: Fiber | null,</div><div class="diff-removed">-  interruptedWork: Fiber,</div><div class="diff-removed">-  renderLanes: Lanes,</div><div class="diff-removed">-) {</div><div class="diff-removed">-  // Note: This intentionally doesn't check if we're hydrating because comparing</div><div class="diff-removed">-  // to the current tree provider fiber is just as fast and less error-prone.</div><div class="diff-removed">-  // Ideally we would have a special version of the work loop only</div><div class="diff-removed">-  // for hydration.</div><div class="diff-removed">-  popTreeContext(interruptedWork);</div><div class="diff-removed">-  switch (interruptedWork.tag) {</div><div class="diff-removed">-    case ClassComponent: {</div><div class="diff-removed">-      const childContextTypes = interruptedWork.type.childContextTypes;</div><div class="diff-removed">-      if (childContextTypes !== null && childContextTypes !== undefined) {</div><div class="diff-removed">-        popLegacyContext(interruptedWork);</div><div class="diff-added">+  function unwindInterruptedWork(interruptedWork: Fiber) {</div><div class="diff-added">+    if (enableProfilerTimer) {</div><div class="diff-added">+      if (interruptedWork.mode & ProfileMode) {</div><div class="diff-added">+        // Resume in case we're picking up on work that was paused.</div><div class="diff-added">+        resumeActualRenderTimerIfPaused();</div><div class="diff-added">+        recordElapsedActualRenderTime(interruptedWork);</div><div>       }</div><div class="diff-removed">-      break;</div><div>     }</div><div class="diff-removed">-    case HostRoot: {</div><div class="diff-removed">-      const root: FiberRoot = interruptedWork.stateNode;</div><div class="diff-removed">-      const cache: Cache = interruptedWork.memoizedState.cache;</div><div class="diff-removed">-      popCacheProvider(interruptedWork, cache);</div><div> </div><div class="diff-removed">-      if (enableTransitionTracing) {</div><div class="diff-removed">-        popRootMarkerInstance(interruptedWork);</div><div class="diff-added">+    switch (interruptedWork.tag) {</div><div class="diff-added">+      case ClassComponent: {</div><div class="diff-added">+        popLegacyContextProvider(interruptedWork);</div><div class="diff-added">+        break;</div><div>       }</div><div class="diff-removed">-</div><div class="diff-removed">-      popRootTransition(interruptedWork, root, renderLanes);</div><div class="diff-removed">-      popHostContainer(interruptedWork);</div><div class="diff-removed">-      popTopLevelLegacyContextObject(interruptedWork);</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    case HostHoistable:</div><div class="diff-removed">-    case HostSingleton:</div><div class="diff-removed">-    case HostComponent: {</div><div class="diff-removed">-      popHostContext(interruptedWork);</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    case HostPortal:</div><div class="diff-removed">-      popHostContainer(interruptedWork);</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    case ActivityComponent: {</div><div class="diff-removed">-      if (interruptedWork.memoizedState !== null) {</div><div class="diff-removed">-        popSuspenseHandler(interruptedWork);</div><div class="diff-added">+      case HostRoot: {</div><div class="diff-added">+        popHostContainer(interruptedWork);</div><div class="diff-added">+        popTopLevelLegacyContextObject(interruptedWork);</div><div class="diff-added">+        break;</div><div>       }</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    }</div><div class="diff-removed">-    case SuspenseComponent:</div><div class="diff-removed">-      popSuspenseHandler(interruptedWork);</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    case SuspenseListComponent:</div><div class="diff-removed">-      popSuspenseListContext(interruptedWork);</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    case ContextProvider:</div><div class="diff-removed">-      let context: ReactContext<any>;</div><div class="diff-removed">-      if (enableRenderableContext) {</div><div class="diff-removed">-        context = interruptedWork.type;</div><div class="diff-removed">-      } else {</div><div class="diff-removed">-        context = interruptedWork.type._context;</div><div class="diff-added">+      case HostComponent: {</div><div class="diff-added">+        popHostContext(interruptedWork);</div><div class="diff-added">+        break;</div><div>       }</div><div class="diff-removed">-      popProvider(context, interruptedWork);</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    case OffscreenComponent:</div><div class="diff-removed">-    case LegacyHiddenComponent:</div><div class="diff-removed">-      popSuspenseHandler(interruptedWork);</div><div class="diff-removed">-      popHiddenContext(interruptedWork);</div><div class="diff-removed">-      popTransition(interruptedWork, current);</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    case CacheComponent:</div><div class="diff-removed">-      const cache: Cache = interruptedWork.memoizedState.cache;</div><div class="diff-removed">-      popCacheProvider(interruptedWork, cache);</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    case TracingMarkerComponent:</div><div class="diff-removed">-      if (enableTransitionTracing) {</div><div class="diff-removed">-        const instance: TracingMarkerInstance | null =</div><div class="diff-removed">-          interruptedWork.stateNode;</div><div class="diff-removed">-        if (instance !== null) {</div><div class="diff-removed">-          popMarkerInstance(interruptedWork);</div><div class="diff-added">+      case HostPortal:</div><div class="diff-added">+        popHostContainer(interruptedWork);</div><div class="diff-added">+        break;</div><div class="diff-added">+      case ContextProvider:</div><div class="diff-added">+        popProvider(interruptedWork);</div><div class="diff-added">+        break;</div><div class="diff-added">+      case Profiler:</div><div class="diff-added">+        if (enableProfilerTimer) {</div><div class="diff-added">+          // Resume in case we're picking up on work that was paused.</div><div class="diff-added">+          resumeActualRenderTimerIfPaused();</div><div class="diff-added">+          recordElapsedActualRenderTime(interruptedWork);</div><div>         }</div><div class="diff-removed">-      }</div><div class="diff-removed">-      break;</div><div class="diff-removed">-    default:</div><div class="diff-removed">-      break;</div><div class="diff-added">+        break;</div><div class="diff-added">+      default:</div><div class="diff-added">+        break;</div><div class="diff-added">+    }</div><div>   }</div><div class="diff-removed">-}</div><div> </div><div class="diff-removed">-export {unwindWork, unwindInterruptedWork};</div><div>\ No newline at end of file</div><div class="diff-added">+  return {</div><div class="diff-added">+    throwException,</div><div class="diff-added">+    unwindWork,</div><div class="diff-added">+    unwindInterruptedWork,</div><div class="diff-added">+    createRootErrorUpdate,</div><div class="diff-added">+    createClassErrorUpdate,</div><div class="diff-added">+  };</div><div class="diff-added">+}</div><div>\ No newline at end of file</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    