<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: src/apprt/glfw.zig - GPT-4.1</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: src/apprt/glfw.zig</h1>
        <h2>Model: GPT-4.1</h2>
        <p><a href="../../models/openai_gpt-4.1.html">All GPT-4.1 Cases</a> | <a href="../../cases.html">All Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> GPT-4.1</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 62392</p>
                <p><strong>Native Prompt Tokens:</strong> 62622</p>
                <p><strong>Native Completion Tokens:</strong> 10129</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.0103138</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_gpt-4.1/ghostty_src_apprt_glfw.zig/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_gpt-4.1/ghostty_src_apprt_glfw.zig/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_gpt-4.1/ghostty_src_apprt_glfw.zig/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index afd17d61..1746c523 100644</div><div class="diff-header">--- a/ghostty_src_apprt_glfw.zig_expectedoutput.txt (expected):tmp/tmp3w5npxyy_expected.txt	</div><div class="diff-header">+++ b/ghostty_src_apprt_glfw.zig_extracted.txt (actual):tmp/tmpy8rdbqky_actual.txt	</div><div class="diff-info">@@ -102,9 +102,6 @@ pub const App = struct {</div><div>             .new_window = .{},</div><div>         }, .{ .forever = {} });</div><div> </div><div class="diff-removed">-        // We want the event loop to wake up instantly so we can process our tick.</div><div class="diff-removed">-        glfw.postEmptyEvent();</div><div class="diff-removed">-</div><div>         return .{</div><div>             .app = core_app,</div><div>             .config = config,</div><div class="diff-info">@@ -172,6 +169,8 @@ pub const App = struct {</div><div>                 .surface => |v| v,</div><div>             }),</div><div> </div><div class="diff-added">+            .toggle_fullscreen => self.toggleFullscreen(target),</div><div class="diff-added">+</div><div>             .size_limit => switch (target) {</div><div>                 .app => {},</div><div>                 .surface => |surface| try surface.rt_surface.setSizeLimits(.{</div><div class="diff-info">@@ -191,10 +190,6 @@ pub const App = struct {</div><div>                 ),</div><div>             },</div><div> </div><div class="diff-removed">-            .toggle_fullscreen => self.toggleFullscreen(target),</div><div class="diff-removed">-</div><div class="diff-removed">-            .open_config => try configpkg.edit.open(self.app.alloc),</div><div class="diff-removed">-</div><div>             .set_title => switch (target) {</div><div>                 .app => {},</div><div>                 .surface => |surface| try surface.rt_surface.setTitle(value.title),</div><div class="diff-info">@@ -213,6 +208,16 @@ pub const App = struct {</div><div>                 }),</div><div>             },</div><div> </div><div class="diff-added">+            .initial_position => switch (target) {</div><div class="diff-added">+                .app => {},</div><div class="diff-added">+                .surface => |surface| try surface.setInitialWindowPosition(</div><div class="diff-added">+                    value.x,</div><div class="diff-added">+                    value.y,</div><div class="diff-added">+                ),</div><div class="diff-added">+            },</div><div class="diff-added">+</div><div class="diff-added">+            .open_config => try configpkg.edit.open(self.app.alloc),</div><div class="diff-added">+</div><div>             .reload_config => try self.reloadConfig(target, value),</div><div> </div><div>             // Unimplemented</div><div class="diff-info">@@ -257,11 +262,6 @@ pub const App = struct {</div><div>         return true;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Reload the configuration. This should return the new configuration.</div><div class="diff-removed">-    /// The old value can be freed immediately at this point assuming a</div><div class="diff-removed">-    /// successful return.</div><div class="diff-removed">-    ///</div><div class="diff-removed">-    /// The returned pointer value is only valid for a stable self pointer.</div><div>     fn reloadConfig(</div><div>         self: *App,</div><div>         target: apprt.action.Target,</div><div class="diff-info">@@ -342,6 +342,26 @@ pub const App = struct {</div><div>         win.setMonitor(monitor, 0, 0, video_mode.getWidth(), video_mode.getHeight(), 0);</div><div>     }</div><div> </div><div class="diff-added">+    /// Create a new surface for the app.</div><div class="diff-added">+    fn newSurface(self: *App, parent_: ?*CoreSurface) !*Surface {</div><div class="diff-added">+        // Grab a surface allocation because we're going to need it.</div><div class="diff-added">+        var surface = try self.app.alloc.create(Surface);</div><div class="diff-added">+        errdefer self.app.alloc.destroy(surface);</div><div class="diff-added">+</div><div class="diff-added">+        // Create the surface -- because windows are surfaces for glfw.</div><div class="diff-added">+        try surface.init(self);</div><div class="diff-added">+        errdefer surface.deinit();</div><div class="diff-added">+</div><div class="diff-added">+        // If we have a parent, inherit some properties</div><div class="diff-added">+        if (self.config.@"window-inherit-font-size") {</div><div class="diff-added">+            if (parent_) |parent| {</div><div class="diff-added">+                try surface.core_surface.setFontSize(parent.font_size);</div><div class="diff-added">+            }</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        return surface;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div>     /// Create a new tab in the parent surface.</div><div>     fn newTab(self: *App, parent_: ?*CoreSurface) !void {</div><div>         if (comptime !darwin_enabled) {</div><div class="diff-info">@@ -381,25 +401,6 @@ pub const App = struct {</div><div>         };</div><div>     }</div><div> </div><div class="diff-removed">-    fn newSurface(self: *App, parent_: ?*CoreSurface) !*Surface {</div><div class="diff-removed">-        // Grab a surface allocation because we're going to need it.</div><div class="diff-removed">-        var surface = try self.app.alloc.create(Surface);</div><div class="diff-removed">-        errdefer self.app.alloc.destroy(surface);</div><div class="diff-removed">-</div><div class="diff-removed">-        // Create the surface -- because windows are surfaces for glfw.</div><div class="diff-removed">-        try surface.init(self);</div><div class="diff-removed">-        errdefer surface.deinit();</div><div class="diff-removed">-</div><div class="diff-removed">-        // If we have a parent, inherit some properties</div><div class="diff-removed">-        if (self.config.@"window-inherit-font-size") {</div><div class="diff-removed">-            if (parent_) |parent| {</div><div class="diff-removed">-                try surface.core_surface.setFontSize(parent.font_size);</div><div class="diff-removed">-            }</div><div class="diff-removed">-        }</div><div class="diff-removed">-</div><div class="diff-removed">-        return surface;</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     /// Close the given surface.</div><div>     pub fn closeSurface(self: *App, surface: *Surface) void {</div><div>         surface.deinit();</div><div class="diff-info">@@ -420,20 +421,6 @@ pub const App = struct {</div><div>         // GLFW doesn't support the inspector</div><div>     }</div><div> </div><div class="diff-removed">-    fn glfwErrorCallback(code: glfw.ErrorCode, desc: [:0]const u8) void {</div><div class="diff-removed">-        std.log.warn("glfw error={} message={s}", .{ code, desc });</div><div class="diff-removed">-</div><div class="diff-removed">-        // Workaround for: https://github.com/ocornut/imgui/issues/5908</div><div class="diff-removed">-        // If we get an invalid value with "scancode" in the message we assume</div><div class="diff-removed">-        // it is from the glfw key callback that imgui sets and we clear the</div><div class="diff-removed">-        // error so that our future code doesn't crash.</div><div class="diff-removed">-        if (code == glfw.ErrorCode.InvalidValue and</div><div class="diff-removed">-            std.mem.indexOf(u8, desc, "scancode") != null)</div><div class="diff-removed">-        {</div><div class="diff-removed">-            _ = glfw.getError();</div><div class="diff-removed">-        }</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     pub fn keyboardLayout(self: *const App) input.KeyboardLayout {</div><div>         _ = self;</div><div> </div><div class="diff-info">@@ -619,10 +606,17 @@ pub const Surface = struct {</div><div>             app.app.alloc,</div><div>             &config,</div><div>             app.app,</div><div class="diff-removed">-            app,</div><div>             self,</div><div>         );</div><div>         errdefer self.core_surface.deinit();</div><div class="diff-added">+</div><div class="diff-added">+        // If we have a desired window size, we can now calculate the size</div><div class="diff-added">+        // because we have the cell size.</div><div class="diff-added">+</div><div class="diff-added">+        // Set initial window size is now part of performAction</div><div class="diff-added">+</div><div class="diff-added">+        // Set maximized, if requested by the config</div><div class="diff-added">+        // Not implemented</div><div>     }</div><div> </div><div>     pub fn deinit(self: *Surface) void {</div><div class="diff-info">@@ -643,7 +637,6 @@ pub const Surface = struct {</div><div>                 // destroyed so unset it so that the later logic doesn't try to</div><div>                 // use it.</div><div>                 1 => {},</div><div class="diff-removed">-</div><div>                 // If our tab bar is visible and we are going down to 1 window,</div><div>                 // hide the tab bar. The check is "2" because our current window</div><div>                 // is still present.</div><div class="diff-info">@@ -677,50 +670,6 @@ pub const Surface = struct {</div><div>         self.app.app.alloc.destroy(self);</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the initial window size. This is called exactly once at</div><div class="diff-removed">-    /// surface initialization time. This may be called before "self"</div><div class="diff-removed">-    /// is fully initialized.</div><div class="diff-removed">-    fn setInitialWindowSize(self: *const Surface, width: u32, height: u32) !void {</div><div class="diff-removed">-        const monitor = self.window.getMonitor() orelse glfw.Monitor.getPrimary() orelse {</div><div class="diff-removed">-            log.warn("window is not on a monitor, not setting initial size", .{});</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        };</div><div class="diff-removed">-</div><div class="diff-removed">-        const workarea = monitor.getWorkarea();</div><div class="diff-removed">-        self.window.setSize(.{</div><div class="diff-removed">-            .width = @min(width, workarea.width),</div><div class="diff-removed">-            .height = @min(height, workarea.height),</div><div class="diff-removed">-        });</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Set the initial window position. This is called exactly once at</div><div class="diff-removed">-    /// surface initialization time. This may be called before "self"</div><div class="diff-removed">-    /// is fully initialized.</div><div class="diff-removed">-    fn setInitialWindowPosition(win: glfw.Window, x: ?i16, y: ?i16) void {</div><div class="diff-removed">-        const start_position_x = x orelse return;</div><div class="diff-removed">-        const start_position_y = y orelse return;</div><div class="diff-removed">-</div><div class="diff-removed">-        log.debug("setting initial window position ({},{})", .{ start_position_x, start_position_y });</div><div class="diff-removed">-        win.setPos(.{ .x = start_position_x, .y = start_position_y });</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    /// Set the size limits of the window.</div><div class="diff-removed">-    /// Note: this interface is not good, we should redo it if we plan</div><div class="diff-removed">-    /// to use this more. i.e. you can't set max width but no max height,</div><div class="diff-removed">-    /// or no mins.</div><div class="diff-removed">-    fn setSizeLimits(self: *Surface, min: apprt.SurfaceSize, max_: ?apprt.SurfaceSize) !void {</div><div class="diff-removed">-        self.window.setSizeLimits(.{</div><div class="diff-removed">-            .width = min.width,</div><div class="diff-removed">-            .height = min.height,</div><div class="diff-removed">-        }, if (max_) |max| .{</div><div class="diff-removed">-            .width = max.width,</div><div class="diff-removed">-            .height = max.height,</div><div class="diff-removed">-        } else .{</div><div class="diff-removed">-            .width = null,</div><div class="diff-removed">-            .height = null,</div><div class="diff-removed">-        });</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     /// Returns the content scale for the created window.</div><div>     pub fn getContentScale(self: *const Surface) !apprt.ContentScale {</div><div>         const scale = self.window.getContentScale();</div><div class="diff-info">@@ -757,60 +706,56 @@ pub const Surface = struct {</div><div>         return self.window.shouldClose();</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the title of the window.</div><div class="diff-removed">-    fn setTitle(self: *Surface, slice: [:0]const u8) !void {</div><div class="diff-removed">-        if (self.title_text) |t| self.core_surface.alloc.free(t);</div><div class="diff-removed">-        self.title_text = try self.core_surface.alloc.dupeZ(u8, slice);</div><div class="diff-removed">-        self.window.setTitle(self.title_text.?.ptr);</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     /// Return the title of the window.</div><div>     pub fn getTitle(self: *Surface) ?[:0]const u8 {</div><div>         return self.title_text;</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the shape of the cursor.</div><div class="diff-removed">-    fn setMouseShape(self: *Surface, shape: terminal.MouseShape) !void {</div><div class="diff-removed">-        if ((comptime builtin.target.os.tag.isDarwin()) and</div><div class="diff-removed">-            !internal_os.macos.isAtLeastVersion(13, 0, 0))</div><div class="diff-removed">-        {</div><div class="diff-removed">-            // We only set our cursor if we're NOT on Mac, or if we are then the</div><div class="diff-removed">-            // macOS version is >= 13 (Ventura). On prior versions, glfw crashes</div><div class="diff-removed">-            // since we use a tab group.</div><div class="diff-removed">-            return;</div><div class="diff-removed">-        }</div><div class="diff-removed">-</div><div class="diff-removed">-        const new = glfw.Cursor.createStandard(switch (shape) {</div><div class="diff-removed">-            .default => .arrow,</div><div class="diff-removed">-            .text => .ibeam,</div><div class="diff-removed">-            .crosshair => .crosshair,</div><div class="diff-removed">-            .pointer => .pointing_hand,</div><div class="diff-removed">-            .ew_resize => .resize_ew,</div><div class="diff-removed">-            .ns_resize => .resize_ns,</div><div class="diff-removed">-            .nwse_resize => .resize_nwse,</div><div class="diff-removed">-            .nesw_resize => .resize_nesw,</div><div class="diff-removed">-            .all_scroll => .resize_all,</div><div class="diff-removed">-            .not_allowed => .not_allowed,</div><div class="diff-removed">-            else => return, // unsupported, ignore</div><div class="diff-removed">-        }) orelse {</div><div class="diff-removed">-            const err = glfw.mustGetErrorCode();</div><div class="diff-removed">-            log.warn("error creating cursor: {}", .{err});</div><div class="diff-added">+    /// Set the initial window size. This is called exactly once at</div><div class="diff-added">+    /// surface initialization time. This may be called before "self"</div><div class="diff-added">+    /// is fully initialized.</div><div class="diff-added">+    fn setInitialWindowSize(self: *const Surface, width: u32, height: u32) !void {</div><div class="diff-added">+        const monitor = self.window.getMonitor() orelse glfw.Monitor.getPrimary() orelse {</div><div class="diff-added">+            log.warn("window is not on a monitor, not setting initial size", .{});</div><div>             return;</div><div>         };</div><div class="diff-removed">-        errdefer new.destroy();</div><div> </div><div class="diff-removed">-        // Set our cursor before we destroy the old one</div><div class="diff-removed">-        self.window.setCursor(new);</div><div class="diff-added">+        const workarea = monitor.getWorkarea();</div><div class="diff-added">+        self.window.setSize(.{</div><div class="diff-added">+            .width = @min(width, workarea.width),</div><div class="diff-added">+            .height = @min(height, workarea.height),</div><div class="diff-added">+        });</div><div class="diff-added">+    }</div><div> </div><div class="diff-removed">-        if (self.cursor) |c| c.destroy();</div><div class="diff-removed">-        self.cursor = new;</div><div class="diff-added">+    /// Set the initial window position. This is called exactly once at</div><div class="diff-added">+    /// surface initialization time. This may be called before "self"</div><div class="diff-added">+    /// is fully initialized.</div><div class="diff-added">+    fn setInitialWindowPosition(win: glfw.Window, x: ?i16, y: ?i16) void {</div><div class="diff-added">+        const start_position_x = x orelse return;</div><div class="diff-added">+        const start_position_y = y orelse return;</div><div class="diff-added">+</div><div class="diff-added">+        log.debug("setting initial window position ({},{})", .{ start_position_x, start_position_y });</div><div class="diff-added">+        win.setPos(.{ .x = start_position_x, .y = start_position_y });</div><div>     }</div><div> </div><div class="diff-removed">-    /// Set the visibility of the mouse cursor.</div><div class="diff-removed">-    fn setMouseVisibility(self: *Surface, visible: bool) void {</div><div class="diff-removed">-        self.window.setInputModeCursor(if (visible) .normal else .hidden);</div><div class="diff-added">+    /// Set the size limits of the window.</div><div class="diff-added">+    /// Note: this interface is not good, we should redo it if we plan</div><div class="diff-added">+    /// to use this more. i.e. you can't set max width but no max height,</div><div class="diff-added">+    /// or no mins.</div><div class="diff-added">+    fn setSizeLimits(self: *Surface, min: apprt.SurfaceSize, max_: ?apprt.SurfaceSize) !void {</div><div class="diff-added">+        self.window.setSizeLimits(.{</div><div class="diff-added">+            .width = min.width,</div><div class="diff-added">+            .height = min.height,</div><div class="diff-added">+        }, if (max_) |max| .{</div><div class="diff-added">+            .width = max.width,</div><div class="diff-added">+            .height = max.height,</div><div class="diff-added">+        } else .{</div><div class="diff-added">+            .width = null,</div><div class="diff-added">+            .height = null,</div><div class="diff-added">+        });</div><div>     }</div><div> </div><div class="diff-added">+    /// Returns the clipboard support.</div><div>     pub fn supportsClipboard(</div><div>         self: *const Surface,</div><div>         clipboard_type: apprt.Clipboard,</div><div class="diff-info">@@ -887,6 +832,74 @@ pub const Surface = struct {</div><div>         };</div><div>     }</div><div> </div><div class="diff-added">+    /// Get the renderer health status, not supported, stub.</div><div class="diff-added">+    pub fn updateRendererHealth(self: *const Surface, health: renderer.Health) void {</div><div class="diff-added">+        // We don't support this in GLFW.</div><div class="diff-added">+        _ = self;</div><div class="diff-added">+        _ = health;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Set the shape of the cursor.</div><div class="diff-added">+    fn setMouseShape(self: *Surface, shape: terminal.MouseShape) !void {</div><div class="diff-added">+        if ((comptime builtin.target.os.tag.isDarwin()) and</div><div class="diff-added">+            !internal_os.macos.isAtLeastVersion(13, 0, 0))</div><div class="diff-added">+        {</div><div class="diff-added">+            // We only set our cursor if we're NOT on Mac, or if we are then the</div><div class="diff-added">+            // macOS version is >= 13 (Ventura). On prior versions, glfw crashes</div><div class="diff-added">+            // since we use a tab group.</div><div class="diff-added">+            return;</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        const new = glfw.Cursor.createStandard(switch (shape) {</div><div class="diff-added">+            .default => .arrow,</div><div class="diff-added">+            .text => .ibeam,</div><div class="diff-added">+            .crosshair => .crosshair,</div><div class="diff-added">+            .pointer => .pointing_hand,</div><div class="diff-added">+            .ew_resize => .resize_ew,</div><div class="diff-added">+            .ns_resize => .resize_ns,</div><div class="diff-added">+            .nwse_resize => .resize_nwse,</div><div class="diff-added">+            .nesw_resize => .resize_nesw,</div><div class="diff-added">+            .all_scroll => .resize_all,</div><div class="diff-added">+            .not_allowed => .not_allowed,</div><div class="diff-added">+            else => return, // unsupported, ignore</div><div class="diff-added">+        }) orelse {</div><div class="diff-added">+            const err = glfw.mustGetErrorCode();</div><div class="diff-added">+            log.warn("error creating cursor: {}", .{err});</div><div class="diff-added">+            return;</div><div class="diff-added">+        };</div><div class="diff-added">+        errdefer new.destroy();</div><div class="diff-added">+</div><div class="diff-added">+        // Set our cursor before we destroy the old one</div><div class="diff-added">+        self.window.setCursor(new);</div><div class="diff-added">+</div><div class="diff-added">+        if (self.cursor) |c| c.destroy();</div><div class="diff-added">+        self.cursor = new;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    pub fn mouseOverLink(self: *Surface, uri: ?[]const u8) void {</div><div class="diff-added">+        // We don't do anything in GLFW.</div><div class="diff-added">+        _ = self;</div><div class="diff-added">+        _ = uri;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Set the visibility of the mouse cursor.</div><div class="diff-added">+    fn setMouseVisibility(self: *Surface, visible: bool) void {</div><div class="diff-added">+        self.window.setInputModeCursor(if (visible) .normal else .hidden);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    fn setTitle(self: *Surface, slice: [:0]const u8) !void {</div><div class="diff-added">+        if (self.title_text) |t| self.core_surface.alloc.free(t);</div><div class="diff-added">+        self.title_text = try self.core_surface.alloc.dupeZ(u8, slice);</div><div class="diff-added">+        self.window.setTitle(self.title_text.?.ptr);</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    /// Set the cell size. Unused by GLFW.</div><div class="diff-added">+    fn setCellSize(self: *const Surface, width: u32, height: u32) !void {</div><div class="diff-added">+        _ = self;</div><div class="diff-added">+        _ = width;</div><div class="diff-added">+        _ = height;</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div>     pub fn defaultTermioEnv(self: *Surface) !std.process.EnvMap {</div><div>         return try internal_os.getEnvMap(self.app.app.alloc);</div><div>     }</div><div class="diff-info">@@ -927,14 +940,6 @@ pub const Surface = struct {</div><div>         };</div><div>         key_event.utf8 = buf[0..len];</div><div> </div><div class="diff-removed">-        // On macOS we need to also disable some modifiers because</div><div class="diff-removed">-        // alt+key consumes the alt.</div><div class="diff-removed">-        if (comptime builtin.target.os.tag.isDarwin()) {</div><div class="diff-removed">-            // For GLFW, we say we always consume alt because</div><div class="diff-removed">-            // GLFW doesn't have a way to disable the alt key.</div><div class="diff-removed">-            key_event.consumed_mods.alt = true;</div><div class="diff-removed">-        }</div><div class="diff-removed">-</div><div>         _ = core_win.keyCallback(key_event) catch |err| {</div><div>             log.err("error in key callback err={}", .{err});</div><div>             return;</div><div class="diff-info">@@ -952,6 +957,9 @@ pub const Surface = struct {</div><div> </div><div>         const core_win = window.getUserPointer(CoreSurface) orelse return;</div><div> </div><div class="diff-added">+        // Reset our consumption state</div><div class="diff-added">+        core_win.rt_surface.key_event = null;</div><div class="diff-added">+</div><div>         // Convert our glfw types into our input types</div><div>         const mods: input.Mods = .{</div><div>             .shift = glfw_mods.shift,</div><div class="diff-info">@@ -1115,6 +1123,14 @@ pub const Surface = struct {</div><div>             .unshifted_codepoint = if (utf8.len > 0) @intCast(utf8[0]) else 0,</div><div>         };</div><div> </div><div class="diff-added">+        // On macOS we need to also disable some modifiers because</div><div class="diff-added">+        // alt+key consumes the alt.</div><div class="diff-added">+        if (comptime builtin.target.os.tag.isDarwin()) {</div><div class="diff-added">+            // For GLFW, we say we always consume alt because</div><div class="diff-added">+            // GLFW doesn't have a way to disable the alt key.</div><div class="diff-added">+            key_event.consumed_mods.alt = true;</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div>         const effect = core_win.keyCallback(key_event) catch |err| {</div><div>             log.err("error in key callback err={}", .{err});</div><div>             return;</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    