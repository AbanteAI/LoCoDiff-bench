<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: lib/segment/src/id_tracker/immutable_id_tracker.rs - GPT-4.1</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: lib/segment/src/id_tracker/immutable_id_tracker.rs</h1>
        <p><a href="../../models/openai_gpt-4.1.html">‚Üê Back to GPT-4.1 Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> GPT-4.1</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 29271</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 29430</p>
                <p><strong>Native Completion Tokens:</strong> 7507</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Cost:</strong> $0.0059458</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_gpt-4.1/qdrant_lib_segment_src_id_tracker_immutable_id_tracker.rs/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_gpt-4.1/qdrant_lib_segment_src_id_tracker_immutable_id_tracker.rs/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_gpt-4.1/qdrant_lib_segment_src_id_tracker_immutable_id_tracker.rs/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div></div><div>index 012de67c..adcdda6c 100644</div><div class="diff-header">--- a/qdrant_lib_segment_src_id_tracker_immutable_id_tracker.rs_expectedoutput.txt (expected):tmp/tmple1arhgs_expected.txt	</div><div class="diff-header">+++ b/qdrant_lib_segment_src_id_tracker_immutable_id_tracker.rs_extracted.txt (actual):tmp/tmp69hhw11f_actual.txt	</div><div class="diff-info">@@ -17,13 +17,13 @@ use crate::common::Flusher;</div><div> use crate::common::mmap_bitslice_buffered_update_wrapper::MmapBitSliceBufferedUpdateWrapper;</div><div> use crate::common::mmap_slice_buffered_update_wrapper::MmapSliceBufferedUpdateWrapper;</div><div> use crate::common::operation_error::{OperationError, OperationResult};</div><div class="diff-removed">-use crate::id_tracker::IdTracker;</div><div> use crate::id_tracker::compressed::compressed_point_mappings::CompressedPointMappings;</div><div> use crate::id_tracker::compressed::external_to_internal::CompressedExternalToInternal;</div><div> use crate::id_tracker::compressed::internal_to_external::CompressedInternalToExternal;</div><div> use crate::id_tracker::compressed::versions_store::CompressedVersions;</div><div> use crate::id_tracker::in_memory_id_tracker::InMemoryIdTracker;</div><div> use crate::id_tracker::point_mappings::FileEndianess;</div><div class="diff-added">+use crate::id_tracker::IdTracker;</div><div> use crate::types::{ExtendedPointId, PointIdType, SeqNumberType};</div><div> </div><div> pub const DELETED_FILE_NAME: &str = "id_tracker.deleted";</div><div class="diff-info">@@ -88,7 +88,6 @@ impl ImmutableIdTracker {</div><div>         let len = reader.read_u64::<FileEndianess>()? as usize;</div><div> </div><div>         let mut deleted = deleted.unwrap_or_else(|| BitVec::repeat(false, len));</div><div class="diff-removed">-</div><div>         deleted.truncate(len);</div><div> </div><div>         let mut internal_to_external = CompressedInternalToExternal::with_capacity(len);</div><div class="diff-info">@@ -102,7 +101,8 @@ impl ImmutableIdTracker {</div><div>             // Need to push this regardless of point deletion as the vecs index represents the internal id</div><div>             // which would become wrong if we leave out entries.</div><div>             if internal_to_external.len() <= internal_id as usize {</div><div class="diff-removed">-                internal_to_external.resize(internal_id as usize + 1, PointIdType::NumId(0));</div><div class="diff-added">+                internal_to_external</div><div class="diff-added">+                    .resize(internal_id as usize + 1, PointIdType::NumId(0));</div><div>             }</div><div> </div><div>             internal_to_external.set(internal_id, external_id);</div><div class="diff-info">@@ -170,7 +170,7 @@ impl ImmutableIdTracker {</div><div>         Ok((internal_id, external_id))</div><div>     }</div><div> </div><div class="diff-removed">-    /// Serializes the `PointMappings` into the given writer using the file format specified below.</div><div class="diff-added">+    /// Serializes the `CompressedPointMappings` into the given writer using the file format specified below.</div><div>     ///</div><div>     /// ## File format</div><div>     /// In general the format looks like this:</div><div class="diff-info">@@ -563,7 +563,14 @@ pub(super) mod test {</div><div>     #[test]</div><div>     fn test_mixed_types_iterator() {</div><div>         let dir = Builder::new().prefix("storage_dir").tempdir().unwrap();</div><div class="diff-removed">-        let id_tracker = make_immutable_tracker(dir.path());</div><div class="diff-added">+        let mut id_tracker = InMemoryIdTracker::new();</div><div class="diff-added">+</div><div class="diff-added">+        for (id, value) in TEST_POINTS.iter().enumerate() {</div><div class="diff-added">+            id_tracker.set_link(*value, id as PointOffsetType).unwrap();</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        let id_tracker =</div><div class="diff-added">+            ImmutableIdTracker::from_in_memory_tracker(id_tracker, dir.path()).unwrap();</div><div> </div><div>         let sorted_from_tracker = id_tracker.iter_from(None).map(|(k, _)| k).collect_vec();</div><div> </div><div class="diff-info">@@ -573,6 +580,26 @@ pub(super) mod test {</div><div>         assert_eq!(sorted_from_tracker, values);</div><div>     }</div><div> </div><div class="diff-added">+    fn make_in_memory_tracker_from_memory() -> InMemoryIdTracker {</div><div class="diff-added">+        const DEFAULT_VERSION: SeqNumberType = 42;</div><div class="diff-added">+        let mut id_tracker = InMemoryIdTracker::new();</div><div class="diff-added">+</div><div class="diff-added">+        for value in TEST_POINTS.iter() {</div><div class="diff-added">+            let internal_id = id_tracker.total_point_count() as PointOffsetType;</div><div class="diff-added">+            id_tracker.set_link(*value, internal_id).unwrap();</div><div class="diff-added">+            id_tracker</div><div class="diff-added">+                .set_internal_version(internal_id, DEFAULT_VERSION)</div><div class="diff-added">+                .unwrap()</div><div class="diff-added">+        }</div><div class="diff-added">+</div><div class="diff-added">+        id_tracker</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div class="diff-added">+    fn make_immutable_tracker(path: &Path) -> ImmutableIdTracker {</div><div class="diff-added">+        let id_tracker = make_in_memory_tracker_from_memory();</div><div class="diff-added">+        ImmutableIdTracker::from_in_memory_tracker(id_tracker, path).unwrap()</div><div class="diff-added">+    }</div><div class="diff-added">+</div><div>     #[test]</div><div>     fn test_load_store() {</div><div>         let dir = Builder::new().prefix("storage_dir").tempdir().unwrap();</div><div class="diff-info">@@ -606,6 +633,7 @@ pub(super) mod test {</div><div>     /// ID tracker.</div><div>     #[test]</div><div>     fn test_store_load_mutated() {</div><div class="diff-added">+        const DEFAULT_VERSION: SeqNumberType = 42;</div><div>         let mut rng = StdRng::seed_from_u64(RAND_SEED);</div><div> </div><div>         let dir = Builder::new().prefix("storage_dir").tempdir().unwrap();</div><div class="diff-info">@@ -627,7 +655,7 @@ pub(super) mod test {</div><div>                 }</div><div> </div><div>                 if index % 5 == 0 {</div><div class="diff-removed">-                    let new_version = rng.next_u64();</div><div class="diff-added">+                    let new_version = rng.random_range(0..1000);</div><div>                     id_tracker</div><div>                         .set_internal_version(index as PointOffsetType, new_version)</div><div>                         .unwrap();</div><div class="diff-info">@@ -814,29 +842,9 @@ pub(super) mod test {</div><div>         }</div><div>     }</div><div> </div><div class="diff-removed">-    const DEFAULT_VERSION: SeqNumberType = 42;</div><div class="diff-removed">-</div><div class="diff-removed">-    fn make_in_memory_tracker_from_memory() -> InMemoryIdTracker {</div><div class="diff-removed">-        let mut id_tracker = InMemoryIdTracker::new();</div><div class="diff-removed">-</div><div class="diff-removed">-        for value in TEST_POINTS.iter() {</div><div class="diff-removed">-            let internal_id = id_tracker.total_point_count() as PointOffsetType;</div><div class="diff-removed">-            id_tracker.set_link(*value, internal_id).unwrap();</div><div class="diff-removed">-            id_tracker</div><div class="diff-removed">-                .set_internal_version(internal_id, DEFAULT_VERSION)</div><div class="diff-removed">-                .unwrap()</div><div class="diff-removed">-        }</div><div class="diff-removed">-</div><div class="diff-removed">-        id_tracker</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div class="diff-removed">-    fn make_immutable_tracker(path: &Path) -> ImmutableIdTracker {</div><div class="diff-removed">-        let id_tracker = make_in_memory_tracker_from_memory();</div><div class="diff-removed">-        ImmutableIdTracker::from_in_memory_tracker(id_tracker, path).unwrap()</div><div class="diff-removed">-    }</div><div class="diff-removed">-</div><div>     #[test]</div><div>     fn test_id_tracker_equal() {</div><div class="diff-added">+        const DEFAULT_VERSION: SeqNumberType = 42;</div><div>         let in_memory_id_tracker = make_in_memory_tracker_from_memory();</div><div> </div><div>         let immutable_id_tracker_dir = Builder::new()</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    