<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case: packages/store/src/lib/Store.ts - GPT-4.1</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <h1>Case: packages/store/src/lib/Store.ts</h1>
        <p><a href="../../models/openai_gpt-4.1.html">‚Üê Back to GPT-4.1 Cases</a> | <a href="../../index.html">Home</a></p>
    </header>
    <main>
        <section class="case-details">
            <div class="case-info">
                <h2>Benchmark Case Information</h2>
                <p><strong>Model:</strong> GPT-4.1</p>
                <p><strong>Status:</strong> <span class="failure">Failure</span></p>
                <p><strong>Prompt Tokens:</strong> 51786</p>
                <p><strong>Output Tokens:</strong> N/A</p>
                <p><strong>Native Prompt Tokens:</strong> 51722</p>
                <p><strong>Native Completion Tokens:</strong> 6999</p>
                <p><strong>Native Tokens Reasoning:</strong> 0</p>
                <p><strong>Native Finish Reason:</strong> stop</p>
                <p><strong>Runtime:</strong> N/As</p>
                <p><strong>Cost:</strong> $0.0079718</p>
            </div>
            
            <div class="content-links">
                <h2>View Content</h2>
                <ul>
                    <li><a href="../../content/openai_gpt-4.1/tldraw_packages_store_src_lib_Store.ts/prompt.html" class="content-link">View Prompt</a></li>
                    <li><a href="../../content/openai_gpt-4.1/tldraw_packages_store_src_lib_Store.ts/expected.html" class="content-link">View Expected Output</a></li>
                    <li><a href="../../content/openai_gpt-4.1/tldraw_packages_store_src_lib_Store.ts/actual.html" class="content-link">View Actual Output</a></li>
                </ul>
            </div>
            
            <div class="diff-section">
                <h2>Diff (Expected vs Actual)</h2>
                <div id="diff-output">
                    <pre class="diff"><div class="diff-header">--- tldraw_packages_store_src_lib_Store.ts_expectedoutput.txt (expected)+++ tldraw_packages_store_src_lib_Store.ts_extracted.txt (actual)@@ -1,4 +1,3 @@-import { Atom, Reactor, Signal, atom, computed, reactor, transact } from '@tldraw/state'</div><div> import {</div><div> 	WeakCache,</div><div> 	assert,</div><div class="diff-info">@@ -135,9 +134,12 @@ 	 * @public</div><div> 	 * @readonly</div><div> 	 */</div><div class="diff-removed">-	readonly history: Atom<number, RecordsDiff<R>> = atom('history', 0, {</div><div class="diff-removed">-		historyLength: 1000,</div><div class="diff-removed">-	})</div><div class="diff-added">+	readonly history: Atom<number, RecordsDiff<R>> = (() => {</div><div class="diff-added">+		// the atoms used to be a number, so keep this the same for now</div><div class="diff-added">+		return (require('@tldraw/state') as any).atom('history', 0, {</div><div class="diff-added">+			historyLength: 1000,</div><div class="diff-added">+		}) as Atom<number, RecordsDiff<R>></div><div class="diff-added">+	})()</div><div> </div><div> 	/**</div><div> 	 * A StoreQueries instance for this store.</div><div class="diff-info">@@ -217,7 +219,7 @@ </div><div> 		this.query = new StoreQueries<R>(this.records, this.history)</div><div> </div><div class="diff-removed">-		this.historyReactor = reactor(</div><div class="diff-added">+		this.historyReactor = (require('@tldraw/state') as any).reactor(</div><div> 			'Store.historyReactor',</div><div> 			() => {</div><div> 				// deref to make sure we're subscribed regardless of whether we need to propagate</div><div class="diff-info">@@ -225,7 +227,7 @@ 				// If we have accumulated history, flush it and update listeners</div><div> 				this._flushHistory()</div><div> 			},</div><div class="diff-removed">-			{ scheduleEffect: (cb) => (this.cancelHistoryReactor = throttleToNextFrame(cb)) }</div><div class="diff-added">+			{ scheduleEffect: (cb: () => void) => (this.cancelHistoryReactor = throttleToNextFrame(cb)) }</div><div> 		)</div><div> 		this.scopedTypes = {</div><div> 			document: new Set(</div><div class="diff-info">@@ -280,10 +282,6 @@ 		}</div><div> 	}</div><div> </div><div class="diff-removed">-	dispose() {</div><div class="diff-removed">-		this.cancelHistoryReactor()</div><div class="diff-removed">-	}</div><div class="diff-removed">-</div><div> 	/**</div><div> 	 * Filters out non-document changes from a diff. Returns null if there are no changes left.</div><div> 	 * @param change - the records diff</div><div class="diff-info">@@ -671,10 +669,6 @@ 			return fn()</div><div> 		}</div><div> </div><div class="diff-removed">-		if (this._isInAtomicOp) {</div><div class="diff-removed">-			throw new Error('Cannot merge remote changes while in atomic operation')</div><div class="diff-removed">-		}</div><div class="diff-removed">-</div><div> 		try {</div><div> 			this.atomic(fn, true, true)</div><div> 		} finally {</div><div class="diff-info">@@ -689,7 +683,7 @@ 		const changes: Array<RecordsDiff<R>> = []</div><div> 		const dispose = this.historyAccumulator.addInterceptor((entry) => changes.push(entry.changes))</div><div> 		try {</div><div class="diff-removed">-			transact(fn)</div><div class="diff-added">+			;(require('@tldraw/state') as any).transact(fn)</div><div> 			return squashRecordDiffs(changes)</div><div> 		} finally {</div><div> 			dispose()</div><div class="diff-info">@@ -739,6 +733,10 @@ 		}, runCallbacks)</div><div> 	}</div><div> </div><div class="diff-added">+	dispose() {</div><div class="diff-added">+		this.cancelHistoryReactor()</div><div class="diff-added">+	}</div><div class="diff-added">+</div><div> 	/**</div><div> 	 * Create a cache based on values in the store. Pass in a function that takes and ID and a</div><div> 	 * signal for the underlying record. Return a signal (usually a computed) for the cached value.</div><div class="diff-info">@@ -763,7 +761,7 @@ 	 *</div><div> 	 * @param name - The name of the derivation cache.</div><div> 	 * @param derive - A function used to derive the value of the cache.</div><div class="diff-removed">-	 * @param opts - Options for the computed cache.</div><div class="diff-added">+	 * @param isEqual - A function that determines equality between two records.</div><div> 	 * @public</div><div> 	 */</div><div> 	createComputedCache<Result, Record extends R = R>(</div><div class="diff-info">@@ -773,10 +771,14 @@ 	): ComputedCache<Result, Record> {</div><div> 		return this.createCache((id, record) => {</div><div> 			const recordSignal = opts?.areRecordsEqual</div><div class="diff-removed">-				? computed(`${name}:${id}:isEqual`, () => record.get(), { isEqual: opts.areRecordsEqual })</div><div class="diff-added">+				? (require('@tldraw/state') as any).computed(</div><div class="diff-added">+						`${name}:${id}:isEqual`,</div><div class="diff-added">+						() => record.get(),</div><div class="diff-added">+						{ isEqual: opts.areRecordsEqual }</div><div class="diff-added">+				  )</div><div> 				: record</div><div> </div><div class="diff-removed">-			return computed<Result | undefined>(</div><div class="diff-added">+			return (require('@tldraw/state') as any).computed<Result | undefined>(</div><div> 				name + ':' + id,</div><div> 				() => {</div><div> 					return derive(recordSignal.get() as Record)</div><div class="diff-info">@@ -858,7 +860,7 @@ 	private _isInAtomicOp = false</div><div> 	/** @internal */</div><div> 	atomic<T>(fn: () => T, runCallbacks = true, isMergingRemoteChanges = false): T {</div><div class="diff-removed">-		return transact(() => {</div><div class="diff-added">+		return (require('@tldraw/state') as any).transact(() => {</div><div> 			if (this._isInAtomicOp) {</div><div> 				if (!this.pendingAfterEvents) this.pendingAfterEvents = new Map()</div><div> 				const prevSideEffectsEnabled = this.sideEffects.isEnabled()</div><div class="diff-info">@@ -906,43 +908,6 @@ 			fn(entry, this.isMergingRemoteChanges ? 'remote' : 'user')</div><div> 		)</div><div> 	}</div><div class="diff-removed">-}</div><div class="diff-removed">-</div><div class="diff-removed">-/**</div><div class="diff-removed">- * Collect all history entries by their adjacent sources.</div><div class="diff-removed">- * For example, [user, user, remote, remote, user] would result in [user, remote, user],</div><div class="diff-removed">- * with adjacent entries of the same source squashed into a single entry.</div><div class="diff-removed">- *</div><div class="diff-removed">- * @param entries - The array of history entries.</div><div class="diff-removed">- * @returns A map of history entries by their sources.</div><div class="diff-removed">- * @public</div><div class="diff-removed">- */</div><div class="diff-removed">-function squashHistoryEntries<T extends UnknownRecord>(</div><div class="diff-removed">-	entries: HistoryEntry<T>[]</div><div class="diff-removed">-): HistoryEntry<T>[] {</div><div class="diff-removed">-	if (entries.length === 0) return []</div><div class="diff-removed">-</div><div class="diff-removed">-	const chunked: HistoryEntry<T>[][] = []</div><div class="diff-removed">-	let chunk: HistoryEntry<T>[] = [entries[0]]</div><div class="diff-removed">-	let entry: HistoryEntry<T></div><div class="diff-removed">-</div><div class="diff-removed">-	for (let i = 1, n = entries.length; i < n; i++) {</div><div class="diff-removed">-		entry = entries[i]</div><div class="diff-removed">-		if (chunk[0].source !== entry.source) {</div><div class="diff-removed">-			chunked.push(chunk)</div><div class="diff-removed">-			chunk = []</div><div class="diff-removed">-		}</div><div class="diff-removed">-		chunk.push(entry)</div><div class="diff-removed">-	}</div><div class="diff-removed">-	// Push the last chunk</div><div class="diff-removed">-	chunked.push(chunk)</div><div class="diff-removed">-</div><div class="diff-removed">-	return devFreeze(</div><div class="diff-removed">-		chunked.map((chunk) => ({</div><div class="diff-removed">-			source: chunk[0].source,</div><div class="diff-removed">-			changes: squashRecordDiffs(chunk.map((e) => e.changes)),</div><div class="diff-removed">-		}))</div><div class="diff-removed">-	)</div><div> }</div><div> </div><div> class HistoryAccumulator<T extends UnknownRecord> {</div><div></div></pre>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
</body>
</html>
    