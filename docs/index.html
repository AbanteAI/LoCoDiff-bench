<!DOCTYPE html>
<!--

THIS FILE IS AUTOMATICALLY GENERATED BY benchmark_pipeline/3_generate_pages.py
DO NOT EDIT DIRECTLY - ANY CHANGES WILL BE OVERWRITTEN
Last generated: 2025-04-30 18:19:12

-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoCoDiff Benchmark Results</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>LoCoDiff Benchmark Results</h1>
        <p>Generated on 2025-04-30 18:19:12</p>
    </header>
    <main>

    <section id="token-chart">
        <h2>Success Rate by Prompt Size</h2>
        <div class="chart-controls">
            <div class="model-selection">
                <h3>Models</h3>
                <div id="model-checkboxes"></div>
            </div>
            <div class="language-selection">
                <h3>Languages</h3>
                <div id="language-checkboxes"></div>
            </div>
            <div class="display-options">
                <h3>Display Options</h3>
                <div class="checkbox-item">
                    <label>
                        <input type="checkbox" id="show-confidence-intervals" checked>
                        Show 95% Confidence Intervals
                    </label>
                </div>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="token-success-chart"></canvas>
        </div>
    </section>
    
    <section id="overall-stats">
        <h2>Overall Model Performance</h2>
        <table>
            <thead>
                <tr>
                    <th>Model</th>
                    <th>Success Rate</th>
                    <th>Cases Run</th>
                    <th>Total Cost</th>
                    <th>Avg Cost per Run</th>
                </tr>
            </thead>
            <tbody>
    
                <tr>
                    <td>Sonnet 3.6</td>
                    <td>23.33% (21/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$17.283123</td>
                    <td>$0.192035</td>
                </tr>
        
                <tr>
                    <td>Sonnet 3.7 Thinking</td>
                    <td>50.00% (45/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$26.258118</td>
                    <td>$0.291757</td>
                </tr>
        
                <tr>
                    <td>DeepSeek Chat v3-0324</td>
                    <td>26.67% (24/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$1.780908</td>
                    <td>$0.019788</td>
                </tr>
        
                <tr>
                    <td>DeepSeek R1</td>
                    <td>22.22% (20/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$3.128464</td>
                    <td>$0.034761</td>
                </tr>
        
                <tr>
                    <td>Gemini 2.5 Flash</td>
                    <td>21.11% (19/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$0.804390</td>
                    <td>$0.008938</td>
                </tr>
        
                <tr>
                    <td>Gemini 2.5 Flash Thinking</td>
                    <td>11.11% (10/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$5.426933</td>
                    <td>$0.060299</td>
                </tr>
        
                <tr>
                    <td>Gemini 2.5 Pro</td>
                    <td>37.50% (33/88)</td>
                    <td>88/90 (97.78%)</td>
                    <td>$13.472755</td>
                    <td>$0.153099</td>
                </tr>
        
                <tr>
                    <td>GPT-4.1</td>
                    <td>26.67% (24/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$0.494486</td>
                    <td>$0.005494</td>
                </tr>
        
                <tr>
                    <td>o3</td>
                    <td>14.44% (13/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$52.797622</td>
                    <td>$0.586640</td>
                </tr>
        
                <tr>
                    <td>o4-mini-medium</td>
                    <td>8.89% (8/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$5.355000</td>
                    <td>$0.059500</td>
                </tr>
        
                <tr>
                    <td>o4-mini-high</td>
                    <td>7.78% (7/90)</td>
                    <td>90/90 (100.00%)</td>
                    <td>$13.442351</td>
                    <td>$0.149359</td>
                </tr>
        
            </tbody>
        </table>
    </section>
    
    <section id="quartile-stats">
        <h2>Success Rates by Prompt Size Quartiles</h2>
        <table>
            <thead>
                <tr>
                    <th>Model</th>
    <th>Q1 (2123-20299 tokens)</th><th>Q2 (20299-32616 tokens)</th><th>Q3 (32616-47089 tokens)</th><th>Q4 (47089-73593 tokens)</th>
                </tr>
            </thead>
            <tbody>
    <tr><td>Sonnet 3.6</td><td>52.17% (12/23)</td><td>21.74% (5/23)</td><td>13.64% (3/22)</td><td>4.55% (1/22)</td></tr><tr><td>Sonnet 3.7 Thinking</td><td>69.57% (16/23)</td><td>47.83% (11/23)</td><td>31.82% (7/22)</td><td>50.00% (11/22)</td></tr><tr><td>DeepSeek Chat v3-0324</td><td>47.83% (11/23)</td><td>43.48% (10/23)</td><td>0.00% (0/22)</td><td>13.64% (3/22)</td></tr><tr><td>DeepSeek R1</td><td>56.52% (13/23)</td><td>17.39% (4/23)</td><td>9.09% (2/22)</td><td>4.55% (1/22)</td></tr><tr><td>Gemini 2.5 Flash</td><td>43.48% (10/23)</td><td>8.70% (2/23)</td><td>22.73% (5/22)</td><td>9.09% (2/22)</td></tr><tr><td>Gemini 2.5 Flash Thinking</td><td>30.43% (7/23)</td><td>4.35% (1/23)</td><td>0.00% (0/22)</td><td>9.09% (2/22)</td></tr><tr><td>Gemini 2.5 Pro</td><td>56.52% (13/23)</td><td>47.83% (11/23)</td><td>27.27% (6/22)</td><td>15.00% (3/20)</td></tr><tr><td>GPT-4.1</td><td>56.52% (13/23)</td><td>17.39% (4/23)</td><td>27.27% (6/22)</td><td>4.55% (1/22)</td></tr><tr><td>o3</td><td>47.83% (11/23)</td><td>0.00% (0/23)</td><td>0.00% (0/22)</td><td>9.09% (2/22)</td></tr><tr><td>o4-mini-medium</td><td>26.09% (6/23)</td><td>0.00% (0/23)</td><td>0.00% (0/22)</td><td>9.09% (2/22)</td></tr><tr><td>o4-mini-high</td><td>21.74% (5/23)</td><td>0.00% (0/23)</td><td>0.00% (0/22)</td><td>9.09% (2/22)</td></tr>
            </tbody>
        </table>
    </section>
    
    <section id="language-stats">
        <h2>Success Rates by Programming Language</h2>
        <table>
            <thead>
                <tr>
                    <th>Model</th>
    <th>javascript (4)</th><th>python (28)</th><th>typescript (28)</th><th>zig (30)</th>
                </tr>
            </thead>
            <tbody>
    <tr><td>Sonnet 3.6</td><td>25.00% (1/4)</td><td>32.14% (9/28)</td><td>17.86% (5/28)</td><td>20.00% (6/30)</td></tr><tr><td>Sonnet 3.7 Thinking</td><td>75.00% (3/4)</td><td>50.00% (14/28)</td><td>50.00% (14/28)</td><td>46.67% (14/30)</td></tr><tr><td>DeepSeek Chat v3-0324</td><td>0.00% (0/4)</td><td>25.00% (7/28)</td><td>32.14% (9/28)</td><td>26.67% (8/30)</td></tr><tr><td>DeepSeek R1</td><td>25.00% (1/4)</td><td>14.29% (4/28)</td><td>21.43% (6/28)</td><td>30.00% (9/30)</td></tr><tr><td>Gemini 2.5 Flash</td><td>50.00% (2/4)</td><td>10.71% (3/28)</td><td>17.86% (5/28)</td><td>30.00% (9/30)</td></tr><tr><td>Gemini 2.5 Flash Thinking</td><td>0.00% (0/4)</td><td>3.57% (1/28)</td><td>10.71% (3/28)</td><td>20.00% (6/30)</td></tr><tr><td>Gemini 2.5 Pro</td><td>25.00% (1/4)</td><td>29.63% (8/27)</td><td>37.04% (10/27)</td><td>46.67% (14/30)</td></tr><tr><td>GPT-4.1</td><td>50.00% (2/4)</td><td>10.71% (3/28)</td><td>32.14% (9/28)</td><td>33.33% (10/30)</td></tr><tr><td>o3</td><td>25.00% (1/4)</td><td>7.14% (2/28)</td><td>10.71% (3/28)</td><td>23.33% (7/30)</td></tr><tr><td>o4-mini-medium</td><td>0.00% (0/4)</td><td>3.57% (1/28)</td><td>7.14% (2/28)</td><td>16.67% (5/30)</td></tr><tr><td>o4-mini-high</td><td>0.00% (0/4)</td><td>3.57% (1/28)</td><td>7.14% (2/28)</td><td>13.33% (4/30)</td></tr>
            </tbody>
        </table>
    </section>
    
    <section id="explore-benchmarks">
        <h2>Explore Benchmark Prompts and Model Outputs</h2>
        <p>Select a model below to view its benchmark cases:</p>
        <ul class="model-list">
    
            <li>
                <a href="models/anthropic_claude-3.5-sonnet.html" class="model-link">
                    Sonnet 3.6
                </a>
            </li>
        
            <li>
                <a href="models/anthropic_claude-3.7-sonnetthinking.html" class="model-link">
                    Sonnet 3.7 Thinking
                </a>
            </li>
        
            <li>
                <a href="models/deepseek_deepseek-chat-v3-0324.html" class="model-link">
                    DeepSeek Chat v3-0324
                </a>
            </li>
        
            <li>
                <a href="models/deepseek_deepseek-r1.html" class="model-link">
                    DeepSeek R1
                </a>
            </li>
        
            <li>
                <a href="models/google_gemini-2.5-flash-preview.html" class="model-link">
                    Gemini 2.5 Flash
                </a>
            </li>
        
            <li>
                <a href="models/google_gemini-2.5-flash-previewthinking.html" class="model-link">
                    Gemini 2.5 Flash Thinking
                </a>
            </li>
        
            <li>
                <a href="models/google_gemini-2.5-pro-preview-03-25.html" class="model-link">
                    Gemini 2.5 Pro
                </a>
            </li>
        
            <li>
                <a href="models/openai_gpt-4.1.html" class="model-link">
                    GPT-4.1
                </a>
            </li>
        
            <li>
                <a href="models/openai_o3.html" class="model-link">
                    o3
                </a>
            </li>
        
            <li>
                <a href="models/openai_o4-mini.html" class="model-link">
                    o4-mini-medium
                </a>
            </li>
        
            <li>
                <a href="models/openai_o4-mini-high.html" class="model-link">
                    o4-mini-high
                </a>
            </li>
        
        </ul>
    </section>
    
    </main>
    <footer>
        <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench">GitHub Repository</a></p>
    </footer>
    
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Load chart data
fetch('chart_data.json')
    .then(response => response.json())
    .then(wrapper => {
        // Use the data property which contains the actual chart data
        // The _warning property contains the auto-generation warning
        initializeChart(wrapper.data);
    });

// JavaScript implementation of Wilson score interval for confidence intervals
function wilson_score_interval(successful, attempts, z = 1.96) {
    if (attempts === 0) return [0.0, 0.0];
    
    // Observed proportion
    const p_hat = successful / attempts;
    
    // Wilson score calculation
    const denominator = 1 + (z * z / attempts);
    const center = (p_hat + (z * z / (2 * attempts))) / denominator;
    const interval = z * Math.sqrt((p_hat * (1 - p_hat) + (z * z / (4 * attempts))) / attempts) / denominator;
    
    const lower_bound = Math.max(0.0, center - interval);
    const upper_bound = Math.min(1.0, center + interval);
    
    return [lower_bound, upper_bound];
}

function initializeChart(chartData) {
    // Define chart colors
    const colors = [
        '#4e79a7', '#f28e2c', '#e15759', '#76b7b2', '#59a14f',
        '#edc949', '#af7aa1', '#ff9da7', '#9c755f', '#bab0ab'
    ];
    
    // Get canvas context
    const ctx = document.getElementById('token-success-chart').getContext('2d');
    
    // Create a fixed color mapping for all models first
    const modelColorMap = {};
    chartData.models.forEach((model, index) => {
        modelColorMap[model] = colors[index % colors.length];
    });
    
    // Create model checkboxes using the fixed color mapping
    const modelCheckboxes = document.getElementById('model-checkboxes');
    chartData.models.forEach((model) => {
        const color = modelColorMap[model]; // Use consistent color from the mapping
        // Use display name if available, otherwise use original model name
        const displayName = chartData.model_display_names && chartData.model_display_names[model] 
            ? chartData.model_display_names[model] 
            : model;
        
        const checkbox = document.createElement('div');
        checkbox.className = 'checkbox-item';
        checkbox.innerHTML = `
            <label>
                <input type="checkbox" data-model="${model}" checked>
                <span class="checkbox-color" style="background-color: ${color};"></span>
                ${displayName}
            </label>
        `;
        modelCheckboxes.appendChild(checkbox);
    });
    
    // Create language checkboxes
    const languageCheckboxes = document.getElementById('language-checkboxes');
    chartData.languages.forEach(language => {
        const checkbox = document.createElement('div');
        checkbox.className = 'checkbox-item';
        checkbox.innerHTML = `
            <label>
                <input type="checkbox" data-language="${language}" checked>
                ${language}
            </label>
        `;
        languageCheckboxes.appendChild(checkbox);
    });
    
    // Create chart
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartData.buckets.map(bucket => bucket.bucket_location_k + 'k'),
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Prompt Token Length (k)'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Success Rate (%)'
                    },
                    min: 0,
                    max: 100
                }
            },
            plugins: {
                legend: {
                    labels: {
                        // Custom filter function to exclude datasets with display: false from the legend
                        filter: (legendItem, data) => {
                            const dataset = data.datasets[legendItem.datasetIndex];
                            return dataset && dataset.display !== false;
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            // Safety check - make sure context and dataset exist
                            if (!context || !context.dataset || !context.dataset.label) {
                                return null;
                            }
                            
                            // Don't show tooltips for confidence interval datasets
                            if (context.dataset.label.includes('CI')) {
                                return null;
                            }
                            
                            try {
                                // Get display name (which is the label) and the original model name for data lookup
                                const displayName = context.dataset.label;
                                // Use originalModel property we added to dataset for data lookup
                                const originalModel = context.dataset.originalModel || displayName;
                                
                                // Safety check for dataIndex
                                if (context.dataIndex === undefined || !chartData.buckets[context.dataIndex]) {
                                    return [`${displayName}`];
                                }
                                
                                const bucketData = chartData.buckets[context.dataIndex];
                                
                                // Safety check for model data
                                if (!bucketData.models || !bucketData.models[originalModel]) {
                                    return [`${displayName}: No data available`];
                                }
                                
                                const modelData = bucketData.models[originalModel];
                                
                                // Get basic stats
                                const successRate = context.raw;
                                
                                // Use filtered data if available, otherwise fall back to overall data
                                let successful, attempts;
                                
                                // Check if we have filtered data for this bucket and model
                                if (bucketData.filteredData && bucketData.filteredData[originalModel]) {
                                    successful = bucketData.filteredData[originalModel].successful;
                                    attempts = bucketData.filteredData[originalModel].attempts;
                                } else {
                                    // Fall back to overall data (before filtering)
                                    successful = modelData.overall.successful;
                                    attempts = modelData.overall.attempts;
                                }
                                
                                // Get confidence interval
                                let ciInfo = '';
                                const ciElement = document.getElementById('show-confidence-intervals');
                                if (ciElement && ciElement.checked && attempts > 0) {
                                    // Use the filtered counts we already have for CI calculation
                                    const [lower, upper] = wilson_score_interval(successful, attempts);
                                    ciInfo = `
95% CI: ${(lower * 100).toFixed(2)}% - ${(upper * 100).toFixed(2)}%`;
                                }
                                
                                return [
                                    `${displayName}: ${successRate !== null && successRate !== undefined ? successRate.toFixed(2) : 'N/A'}% (${successful}/${attempts})`,
                                    `Token Range: ${bucketData.bucket_range}${ciInfo}`
                                ];
                            } catch (error) {
                                console.error('Error in tooltip callback:', error);
                                return ['Error displaying tooltip'];
                            }
                        }
                    }
                }
            }
        }
    });
    
    // Function to update chart based on selected models and languages
    function updateChart() {
        // Get selected models and languages
        const selectedModels = Array.from(document.querySelectorAll('input[data-model]:checked'))
            .map(checkbox => checkbox.getAttribute('data-model'));
        
        const selectedLanguages = Array.from(document.querySelectorAll('input[data-language]:checked'))
            .map(checkbox => checkbox.getAttribute('data-language'));
        
        // Clear filteredData from previous filter selections
        chartData.buckets.forEach(bucket => {
            bucket.filteredData = {};
        });
        
        // Clear current datasets
        chart.data.datasets = [];
        
        // Create datasets for each selected model
        selectedModels.forEach((model) => {
            // Use the consistent color from our color map
            const color = modelColorMap[model];
            
            // Calculate data points and store filtered data for tooltip
            const dataPoints = chartData.buckets.map((bucket, bucketIndex) => {
                const modelData = bucket.models[model];
                
                // Filter by selected languages
                let successful = 0;
                let attempts = 0;
                
                if (selectedLanguages.length === 0) {
                    // No languages selected, show empty chart (consistent with model selection behavior)
                    return null;
                } else {
                    // Use only selected languages
                    selectedLanguages.forEach(language => {
                        if (modelData.languages[language]) {
                            successful += modelData.languages[language].successful;
                            attempts += modelData.languages[language].attempts;
                        }
                    });
                }
                
                // Store filtered data for this bucket and model for tooltip access
                if (!bucket.filteredData) {
                    bucket.filteredData = {};
                }
                if (!bucket.filteredData[model]) {
                    bucket.filteredData[model] = {};
                }
                
                bucket.filteredData[model] = {
                    successful: successful,
                    attempts: attempts
                };
                
                // Calculate success rate
                return attempts > 0 ? (successful / attempts * 100) : null;
            });
            
            // Calculate confidence interval data points if languages are selected
            let lowerBoundPoints = null;
            let upperBoundPoints = null;
            
            if (selectedLanguages.length > 0) {
                lowerBoundPoints = chartData.buckets.map(bucket => {
                    const modelData = bucket.models[model];
                    
                    // Use only selected languages
                    let langSuccessful = 0;
                    let langAttempts = 0;
                    
                    selectedLanguages.forEach(language => {
                        if (modelData.languages[language]) {
                            langSuccessful += modelData.languages[language].successful;
                            langAttempts += modelData.languages[language].attempts;
                        }
                    });
                    
                    if (langAttempts > 0) {
                        // Recalculate Wilson interval for the combined languages
                        const [lower, upper] = wilson_score_interval(langSuccessful, langAttempts);
                        return lower * 100; // Convert to percentage
                    }
                    return null;
                });
                
                upperBoundPoints = chartData.buckets.map(bucket => {
                    const modelData = bucket.models[model];
                    
                    // Use only selected languages
                    let langSuccessful = 0;
                    let langAttempts = 0;
                    
                    selectedLanguages.forEach(language => {
                        if (modelData.languages[language]) {
                            langSuccessful += modelData.languages[language].successful;
                            langAttempts += modelData.languages[language].attempts;
                        }
                    });
                    
                    if (langAttempts > 0) {
                        // Recalculate Wilson interval for the combined languages
                        const [lower, upper] = wilson_score_interval(langSuccessful, langAttempts);
                        return upper * 100; // Convert to percentage
                    }
                    return null;
                });
            }
            
            // Get display name if available
            const displayName = chartData.model_display_names && chartData.model_display_names[model] 
                ? chartData.model_display_names[model] 
                : model;
                
            // Add main dataset
            chart.data.datasets.push({
                label: displayName,
                originalModel: model, // Store original model name for data lookup
                data: dataPoints,
                borderColor: color,
                backgroundColor: color + '33',
                fill: false,
                tension: 0.1,
                pointRadius: 4,
                pointHoverRadius: 6
            });
            
            // Add confidence interval datasets if enabled
            const showConfidenceIntervals = document.getElementById('show-confidence-intervals').checked;
            
            if (showConfidenceIntervals && selectedLanguages.length > 0) {
                // Add lower bound line first (needed for reference by the area dataset)
                const lowerBoundIndex = chart.data.datasets.length;
                chart.data.datasets.push({
                    label: `${displayName} (95% CI lower)`,
                    data: lowerBoundPoints,
                    borderColor: 'transparent',
                    backgroundColor: 'transparent',
                    pointRadius: 0,
                    tension: 0.1,
                    fill: false,
                    showLine: false, // Don't draw a line for this dataset
                    display: false   // Completely exclude from legend
                });
                
                // Add confidence interval area
                chart.data.datasets.push({
                    label: `${displayName} (95% CI)`,
                    data: upperBoundPoints,
                    borderColor: 'transparent',
                    backgroundColor: color + '22', // Very transparent version of the line color
                    pointRadius: 0,
                    tension: 0.1,
                    fill: lowerBoundIndex, // Fill to the specific dataset index (the lower bound)
                    display: false         // Completely exclude from legend
                });
            }
        });
        
        // Update chart
        chart.update();
    }
    
    // Add event listeners to model and language checkboxes
    document.querySelectorAll('input[data-model], input[data-language]').forEach(checkbox => {
        checkbox.addEventListener('change', updateChart);
    });
    
    // Add event listener to confidence interval checkbox
    document.getElementById('show-confidence-intervals').addEventListener('change', updateChart);
    
    // Initial chart update
    updateChart();
}
</script>

</body>
</html>
