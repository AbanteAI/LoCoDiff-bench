<!DOCTYPE html>
<!--

THIS FILE IS AUTOMATICALLY GENERATED BY benchmark_pipeline/3_generate_pages.py
DO NOT EDIT DIRECTLY - ANY CHANGES WILL BE OVERWRITTEN
Last generated: 2025-08-07 22:57:53

-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoCoDiff Benchmark</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>LoCoDiff: Natural <span style="font-weight:bold">Lo</span>ng <span style="font-weight:bold">Co</span>ntext Code Bench</h1>
        <p style="margin-top: 0; font-size: 0.9em; color: #666;"><a href="https://mentat.ai" target="_blank">Mentat AI Team</a> - May 8th 2025</p>
    </header>
    <main>

    <section id="locodiff-summary" style="background-color: transparent; border: none; padding: 0;">
        <p style="margin-bottom: 10px;">
            LoCoDiff is a novel <strong>lo</strong>ng-<strong>co</strong>ntext benchmark with several unique strengths:
        </p>
        <ul style="margin-top: 0; margin-bottom: 20px; margin-left: 20px;">
            <li>Utilizes <strong>naturally interconnected content</strong>, not artificially generated or padded context</li>
            <li><strong>No junk context</strong>: every part of the context is required for the task</li>
            <li><strong>Tests a real skill critical for coding agents</strong>: keeping track of the state of edited files</li>
            <li>Prompt generation and output evaluation are <strong>simple and easy to understand</strong></li>
            <li>Challenges models' capacity to generate <strong>long-form outputs</strong></li>
            <li>Surprisingly <strong>difficult for reasoning models</strong> to reason about</li>
            <li><strong>Easy to procedurally generate</strong>: any file in any git repo can be made into a benchmark case</li>
        </ul>
        <p style="margin-bottom: 20px;">
            100% of the code for the LoCoDiff was written by 
            <a href="https://mentat.ai">Mentat</a>, a coding agent developed by AbanteAI. Mentat also generated the prompts and ran the benchmark on the models, setup the github page hosting, and built this site. All benchmark code and results are on the <a href="https://github.com/AbanteAI/LoCoDiff-bench">Github repo</a>, and you can see the Mentat agent runs <a href="https://mentat.ai/gh/AbanteAI/LoCoDiff-bench/agents">here</a>.
        </p>
    </section>
    
    <section id="token-chart">
        <div class="chart-container">
            <canvas id="token-success-chart"></canvas>
        </div>
        <h3 style="margin-top: 15px; margin-bottom: 5px; font-size: 1.1em;">Chart Options</h3>
        <div class="chart-controls" style="font-size: 0.85em; margin-top: 10px; padding: 5px;">
            <div class="model-selection" style="margin-right: 15px;">
                <h3 style="font-size: 1em; margin: 5px 0;">Models</h3>
                <div id="model-checkboxes"></div>
            </div>
            <div class="language-selection" style="margin-right: 15px;">
                <h3 style="font-size: 1em; margin: 5px 0;">Languages</h3>
                <div id="language-checkboxes"></div>
            </div>
            <div class="bucketing-options" style="margin-right: 15px;">
                <h3 style="font-size: 1em; margin: 5px 0;">Bucketing Options</h3>
                <div class="bucket-count-control" style="margin: 5px 0;">
                    <label for="bucket-count" style="font-size: 0.9em;">Number of Buckets: <span id="bucket-count-display">4</span></label>
                    <input type="range" id="bucket-count" min="1" max="10" value="4" step="1" style="width: 100%;">
                </div>
            </div>
            <div class="display-options">
                <h3 style="font-size: 1em; margin: 5px 0;">Display Options</h3>
                <div class="checkbox-item" style="margin: 3px 0;">
                    <label style="font-size: 0.9em;">
                        <input type="checkbox" id="show-confidence-intervals">
                        95% Wilson Score Intervals
                    </label>
                </div>
            </div>
        </div>
    </section>
    
    <section id="key-takeaways">
        <h2>Key Takeaways</h2>
        <p style="margin-bottom: 15px;">
            <strong>Performance drops rapidly as context increases:</strong> While some models score near 100% for prompts <5k tokens, all drop significantly by 10k. All models drop to under 50% accuracy when prompts are just 25k tokens long. When we originally conceived of this benchmark, we were excited to put the million token long context limits of some models to the test, but it seems they are not yet ready for that.
        </p>
        <p style="margin-bottom: 15px;">
            <strong>Claude 3.7 Sonnet Thinking is the clear SOTA:</strong> It's the best for all context lengths and languages. We believe its ability to track the evolving state of files over long contexts is one of the reasons it makes such a strong model for coding agents.
        </p>
        <p style="margin-bottom: 15px;">
            <strong>Reasoning models, except for Sonnet do WORSE than their non-reasoning counterparts:</strong> DeepSeek's Chat v3 beats R1, Gemini 2.5 Flash Non-thinking beats Gemini 2.5 Flash Thinking, and GPT-4.1 beats o3 and o4-mini. The only exception to this trend is Sonnet 3.7 Thinking, which beats Sonnet 3.7 Non-thinking. It's unclear how reasoning models should best use their tokens to solve this task, but somehow Sonnet 3.7 uses them well.
        </p>
    </section>
    
    <section id="benchmark-example" style="background-color: transparent; border: none; padding: 0;">
        <h2>Methodology</h2>
        
        <p style="margin-bottom: 15px;">
            For each benchmark prompt, we show the model the commit history of a particular file, and ask the model to infer the exact current state of that file. This requires the model to track the state of the file as it changes, from the initial commit, diffs along various branches, and merge conflict resolutions. Accuracy is the percentage of files that matched exactly - there is no partial credit.
        </p>
        <p style="margin-bottom: 15px;">
            The exact command we use to generate the history for each file is: <code style="background-color: #f6f8fa; padding: 2px 4px; border-radius: 3px; font-family: monospace;">git log -p --cc --reverse --topo-order -- path/to/file</code>. <code style="background-color: #f6f8fa; padding: 2px 4px; border-radius: 3px; font-family: monospace;">-p</code> and <code style="background-color: #f6f8fa; padding: 2px 4px; border-radius: 3px; font-family: monospace;">--cc</code> display the diffs for commits and show merge commit diffs with respect to each parent. <code style="background-color: #f6f8fa; padding: 2px 4px; border-radius: 3px; font-family: monospace;">--reverse</code> and <code style="background-color: #f6f8fa; padding: 2px 4px; border-radius: 3px; font-family: monospace;">--topo-order</code> make sure the commits are shown from oldest to newest, with parent commits always appearing before children. This is the cleanest, clearest way to present the history to the model.
        </p>
        
        <p style="margin-bottom: 15px;">
            The benchmark consists of 200 files, 40 each from 5 repos: 
            <a href="https://github.com/Aider-AI/aider" target="_blank">Aider</a> (Python), 
            <a href="https://github.com/ghostty-org/ghostty" target="_blank">Ghostty</a> (Zig), 
            <a href="https://github.com/tldraw/tldraw" target="_blank">tldraw</a> (TypeScript), 
            <a href="https://github.com/qdrant/qdrant" target="_blank">Qdrant</a> (Rust), and 
            <a href="https://github.com/facebook/react" target="_blank">React</a> (JavaScript). 
            For each repo, we filtered to files modified in the last 6 months that were no longer than 12k tokens long (in their final state - what the model needs to output). We then sampled, biasing the sampling to target an even distribution of prompt lengths, with a limit of 100k.
        </p>

        <p style="margin-bottom: 15px;">
            All case prompts, expected outputs, and model answers can be explored <a href="cases.html">here</a>. A <a href="/LoCoDiff-bench/content/anthropic_claude-3.7-sonnetthinking/qdrant_src_actix_api_snapshot_api.rs/prompt.html">typical prompt</a> consisting of 50k tokens can be extremely complex, containing 50-150 commits and ending up with several hundred lines to reproduce.
        </p>
        
        <p style="margin-bottom: 15px;">
            To quickly understand what the model sees, here is a minimal example:
        </p>

        <div class="example-timeline">
            <h3 style="text-align: left;">Toy Example with Shopping List</h3>
            <div class="branch-structure-container">
                <div class="branch-diagram-box">
                    <pre class="branch-diagram">
A
/  \
B    C
\  /
D
</pre>
                </div>
                <div class="branch-explanation">
                    <p class="commit-description">
                        Commit A: Creates initial shopping list file<br>
                        Commit B: Changes "apples" to "oranges", and adds new item at the end<br>
                        Commit C: On a separate branch from B, changes "apples" to "bananas"<br>
                        Commit D: Merges B and C branches, resolving conflict by keeping both "oranges" and "bananas"
                    </p>
                </div>
            </div>
        </div>
        
        <div class="example-io-container">
            <div class="example-prompt" style="border: 1px solid #ddd; border-radius: 6px; padding: 15px; background-color: #f8f8f8;">
                <h3>Input: git log output for a file</h3>
                <pre style="background-color: #f1f1f1; border: 1px solid #e1e4e8; border-radius: 3px;"><code class="language-diff">> git log -p \
    --cc \
    --reverse \
    --topo-order \
    -- shopping_list.txt


commit 008db723cd371b87c8b1e3df08cec4b4672e581b
Author: Example User <example@example.com>
Date:   Wed May 7 21:12:52 2025 +0000

    Initial shopping list

diff --git a/shopping_list.txt b/shopping_list.txt
new file mode 100644
index 0000000..868d98c
--- /dev/null
+++ b/shopping_list.txt
@@ -0,0 +1,6 @@
+# shopping_list.txt
+apples
+milk
+bread
+eggs
+coffee

commit b6d826ab1b332fe4ca1dc8f67a00f220a8469e48
Author: Example User <example@example.com>
Date:   Wed May 7 21:12:52 2025 +0000

    Change apples to oranges and add cheese

diff --git a/shopping_list.txt b/shopping_list.txt
index 868d98c..7c335bb 100644
--- a/shopping_list.txt
+++ b/shopping_list.txt
@@ -1,6 +1,7 @@
 # shopping_list.txt
-apples
+oranges
 milk
 bread
 eggs
 coffee
+cheese

commit 7f75f32283192e4f838a389c2afa8678c7e6e137
Author: Example User <example@example.com>
Date:   Wed May 7 21:12:52 2025 +0000

    Change apples to bananas

diff --git a/shopping_list.txt b/shopping_list.txt
index 868d98c..2712810 100644
--- a/shopping_list.txt
+++ b/shopping_list.txt
@@ -1,5 +1,5 @@
 # shopping_list.txt
-apples
+bananas
 milk
 bread
 eggs

commit 820b839ff793e85febc07de3f639549fc5ef5181
Merge: b6d826a 7f75f32
Author: Example User <example@example.com>
Date:   Wed May 7 21:12:52 2025 +0000

    Merge feature/bananas into feature/oranges

diff --cc shopping_list.txt
index 7c335bb,2712810..012208c
--- a/shopping_list.txt
+++ b/shopping_list.txt
@@@ -1,5 -1,5 +1,6 @@@
  # shopping_list.txt
 +oranges
+ bananas
  milk
  bread
  eggs
</code></pre>
            </div>
            
            <div class="example-expected" style="border: 1px solid #ddd; border-radius: 6px; padding: 15px; background-color: #f8f8f8;">
                <h3>Target Output: Exact final state of the file</h3>
                <pre style="background-color: #f1f1f1; border: 1px solid #e1e4e8; border-radius: 3px;"><code class="language-text"># shopping_list.txt
oranges
bananas
milk
bread
eggs
coffee
cheese
</code></pre>
            </div>
        </div>
        
    </section>
    
    <section id="quartile-stats">
        <h2>Accuracy by Context Length Quartiles</h2>
        <p style="margin-top: 0; margin-bottom: 10px; font-size: 0.9em; color: #666; text-align: center;"><img src="assets/images/mentat-logo-transparent.png" alt="Mentat" style="height: 24px; vertical-align: middle; margin-right: 5px;">Mentat.ai LoCoDiff Bench</p>
        <table>
            <thead>
                <tr>
                    <th>Model</th>
    <th>Q1 (1994-20990 tokens)</th><th>Q2 (21186-35454 tokens)</th><th>Q3 (35974-59828 tokens)</th><th>Q4 (59831-97521 tokens)</th><th>Total Cost</th>
                </tr>
            </thead>
            <tbody>
    <tr><td>Sonnet 3.6</td><td>64.00% (32/50)</td><td>22.00% (11/50)</td><td>6.00% (3/50)</td><td>6.00% (3/50)</td><td>$44.01</td></tr><tr><td>Sonnet 3.7</td><td>52.00% (26/50)</td><td>38.00% (19/50)</td><td>24.00% (12/50)</td><td>18.00% (9/50)</td><td>$47.88</td></tr><tr><td>Sonnet 3.7 Thinking</td><td class="bronze">🥉 74.00% (37/50)</td><td class="bronze">🥉 48.00% (24/50)</td><td class="bronze">🥉 44.00% (22/50)</td><td class="bronze">🥉 22.00% (11/50)</td><td>$70.57</td></tr><tr><td>Sonnet 4</td><td class="gold">🥇 90.00% (45/50)</td><td class="gold">🥇 74.00% (37/50)</td><td class="silver">🥈 68.00% (34/50)</td><td class="silver">🥈 66.00% (33/50)</td><td>$48.75</td></tr><tr><td>Sonnet 4 Thinking</td><td class="silver">🥈 76.00% (38/50)</td><td class="gold">🥇 74.00% (37/50)</td><td class="gold">🥇 70.00% (35/50)</td><td class="gold">🥇 72.00% (36/50)</td><td>$65.89</td></tr><tr><td>DeepSeek Chat v3-0324</td><td>54.00% (27/50)</td><td>30.00% (15/50)</td><td>14.00% (7/50)</td><td>6.00% (3/50)</td><td>$4.53</td></tr><tr><td>DeepSeek R1</td><td>50.00% (25/50)</td><td>14.00% (7/50)</td><td>8.00% (4/50)</td><td>0.00% (0/50)</td><td>$8.07</td></tr><tr><td>DeepSeek R1 0528</td><td>28.00% (14/50)</td><td>12.00% (6/50)</td><td>4.00% (2/50)</td><td>2.00% (1/50)</td><td>$11.24</td></tr><tr><td>Gemini 2.5 Flash</td><td>48.00% (24/50)</td><td>8.00% (4/50)</td><td>18.00% (9/50)</td><td>4.00% (2/50)</td><td>$2.12</td></tr><tr><td>Gemini 2.5 Flash Thinking</td><td>34.00% (17/50)</td><td>4.00% (2/50)</td><td>6.00% (3/50)</td><td>0.00% (0/50)</td><td>$12.39</td></tr><tr><td>Gemini 2.5 Pro 05-06</td><td>64.00% (32/50)</td><td>38.00% (19/50)</td><td>28.00% (14/50)</td><td>20.00% (10/50)</td><td>$34.66</td></tr><tr><td>Gemini 2.5 Pro 03-25</td><td>62.00% (31/50)</td><td>44.00% (22/50)</td><td>22.45% (11/49)</td><td>20.00% (10/50)</td><td>$34.82</td></tr><tr><td>Gemini 2.5 Pro 06-05</td><td class="bronze">🥉 74.00% (37/50)</td><td>38.00% (19/50)</td><td>32.00% (16/50)</td><td>20.00% (10/50)</td><td>$63.14</td></tr><tr><td>Kimi K2</td><td>44.00% (22/50)</td><td>10.00% (5/50)</td><td>12.00% (6/50)</td><td>2.00% (1/50)</td><td>$6.71</td></tr><tr><td>GPT-4.1</td><td>46.00% (23/50)</td><td>14.00% (7/50)</td><td>14.00% (7/50)</td><td>4.00% (2/50)</td><td>$1.22</td></tr><tr><td>GPT-5</td><td>70.00% (35/50)</td><td>30.00% (15/50)</td><td>22.00% (11/50)</td><td>4.00% (2/50)</td><td>$1.17</td></tr><tr><td>GPT OSS 120B</td><td>4.00% (2/50)</td><td>0.00% (0/50)</td><td>2.00% (1/50)</td><td>0.00% (0/50)</td><td>$2.47</td></tr><tr><td>o3</td><td>38.00% (19/50)</td><td>0.00% (0/50)</td><td>4.00% (2/50)</td><td>2.00% (1/50)</td><td>$128.93</td></tr><tr><td>o4-mini-medium</td><td>28.00% (14/50)</td><td>0.00% (0/50)</td><td>4.00% (2/50)</td><td>0.00% (0/50)</td><td>$10.74</td></tr><tr><td>o4-mini-high</td><td>22.00% (11/50)</td><td>0.00% (0/50)</td><td>4.00% (2/50)</td><td>0.00% (0/50)</td><td>$26.07</td></tr><tr><td>Horizon Alpha</td><td class="bronze">🥉 74.00% (37/50)</td><td>40.82% (20/49)</td><td>28.57% (14/49)</td><td>11.11% (5/45)</td><td>$0.00</td></tr><tr><td>Grok 3</td><td>64.00% (32/50)</td><td>38.00% (19/50)</td><td>14.00% (7/50)</td><td>6.00% (3/50)</td><td>$37.14</td></tr><tr><td>Grok 3 Mini</td><td>22.00% (11/50)</td><td>0.00% (0/50)</td><td>2.00% (1/50)</td><td>0.00% (0/50)</td><td>$2.98</td></tr><tr><td>Grok 4</td><td>56.00% (28/50)</td><td>18.00% (9/50)</td><td>6.00% (3/50)</td><td>2.00% (1/50)</td><td>$62.00</td></tr>
            </tbody>
        </table>
    </section>
    
    <section id="language-stats">
        <h2>Accuracy by Programming Language</h2>
        <p style="margin-top: 0; margin-bottom: 10px; font-size: 0.9em; color: #666; text-align: center;"><img src="assets/images/mentat-logo-transparent.png" alt="Mentat" style="height: 24px; vertical-align: middle; margin-right: 5px;">Mentat.ai LoCoDiff Bench</p>
        <table>
            <thead>
                <tr>
                    <th>Model</th>
    <th>javascript (42)</th><th>python (39)</th><th>rust (39)</th><th>typescript (40)</th><th>zig (40)</th>
                </tr>
            </thead>
            <tbody>
    <tr><td>Sonnet 3.6</td><td>21.43% (9/42)</td><td>38.46% (15/39)</td><td>17.95% (7/39)</td><td>22.50% (9/40)</td><td>22.50% (9/40)</td></tr><tr><td>Sonnet 3.7</td><td>40.48% (17/42)</td><td>35.90% (14/39)</td><td>25.64% (10/39)</td><td>40.00% (16/40)</td><td>22.50% (9/40)</td></tr><tr><td>Sonnet 3.7 Thinking</td><td>47.62% (20/42)</td><td class="bronze">🥉 48.72% (19/39)</td><td class="bronze">🥉 33.33% (13/39)</td><td class="bronze">🥉 55.00% (22/40)</td><td>50.00% (20/40)</td></tr><tr><td>Sonnet 4</td><td class="gold">🥇 76.19% (32/42)</td><td class="gold">🥇 74.36% (29/39)</td><td class="silver">🥈 56.41% (22/39)</td><td class="gold">🥇 80.00% (32/40)</td><td class="gold">🥇 85.00% (34/40)</td></tr><tr><td>Sonnet 4 Thinking</td><td class="silver">🥈 71.43% (30/42)</td><td class="silver">🥈 69.23% (27/39)</td><td class="gold">🥇 71.79% (28/39)</td><td class="silver">🥈 70.00% (28/40)</td><td class="silver">🥈 82.50% (33/40)</td></tr><tr><td>DeepSeek Chat v3-0324</td><td>19.05% (8/42)</td><td>28.21% (11/39)</td><td>15.38% (6/39)</td><td>32.50% (13/40)</td><td>35.00% (14/40)</td></tr><tr><td>DeepSeek R1</td><td>16.67% (7/42)</td><td>17.95% (7/39)</td><td>2.56% (1/39)</td><td>22.50% (9/40)</td><td>30.00% (12/40)</td></tr><tr><td>DeepSeek R1 0528</td><td>11.90% (5/42)</td><td>10.26% (4/39)</td><td>2.56% (1/39)</td><td>25.00% (10/40)</td><td>7.50% (3/40)</td></tr><tr><td>Gemini 2.5 Flash</td><td>23.81% (10/42)</td><td>15.38% (6/39)</td><td>10.26% (4/39)</td><td>20.00% (8/40)</td><td>27.50% (11/40)</td></tr><tr><td>Gemini 2.5 Flash Thinking</td><td>11.90% (5/42)</td><td>5.13% (2/39)</td><td>5.13% (2/39)</td><td>12.50% (5/40)</td><td>20.00% (8/40)</td></tr><tr><td>Gemini 2.5 Pro 05-06</td><td>38.10% (16/42)</td><td>30.77% (12/39)</td><td>25.64% (10/39)</td><td>52.50% (21/40)</td><td>40.00% (16/40)</td></tr><tr><td>Gemini 2.5 Pro 03-25</td><td>35.71% (15/42)</td><td>28.95% (11/38)</td><td>20.51% (8/39)</td><td>47.50% (19/40)</td><td>52.50% (21/40)</td></tr><tr><td>Gemini 2.5 Pro 06-05</td><td class="bronze">🥉 54.76% (23/42)</td><td>30.77% (12/39)</td><td>17.95% (7/39)</td><td>45.00% (18/40)</td><td class="bronze">🥉 55.00% (22/40)</td></tr><tr><td>Kimi K2</td><td>21.43% (9/42)</td><td>12.82% (5/39)</td><td>10.26% (4/39)</td><td>25.00% (10/40)</td><td>15.00% (6/40)</td></tr><tr><td>GPT-4.1</td><td>23.81% (10/42)</td><td>12.82% (5/39)</td><td>2.56% (1/39)</td><td>32.50% (13/40)</td><td>25.00% (10/40)</td></tr><tr><td>GPT-5</td><td>30.95% (13/42)</td><td>35.90% (14/39)</td><td>20.51% (8/39)</td><td>30.00% (12/40)</td><td>40.00% (16/40)</td></tr><tr><td>GPT OSS 120B</td><td>0.00% (0/42)</td><td>2.56% (1/39)</td><td>2.56% (1/39)</td><td>2.50% (1/40)</td><td>0.00% (0/40)</td></tr><tr><td>o3</td><td>11.90% (5/42)</td><td>7.69% (3/39)</td><td>2.56% (1/39)</td><td>10.00% (4/40)</td><td>22.50% (9/40)</td></tr><tr><td>o4-mini-medium</td><td>14.29% (6/42)</td><td>2.56% (1/39)</td><td>2.56% (1/39)</td><td>7.50% (3/40)</td><td>12.50% (5/40)</td></tr><tr><td>o4-mini-high</td><td>7.14% (3/42)</td><td>2.56% (1/39)</td><td>2.56% (1/39)</td><td>10.00% (4/40)</td><td>10.00% (4/40)</td></tr><tr><td>Horizon Alpha</td><td>28.21% (11/39)</td><td>48.65% (18/37)</td><td>25.64% (10/39)</td><td>43.59% (17/39)</td><td>51.28% (20/39)</td></tr><tr><td>Grok 3</td><td>30.95% (13/42)</td><td>35.90% (14/39)</td><td>23.08% (9/39)</td><td>40.00% (16/40)</td><td>22.50% (9/40)</td></tr><tr><td>Grok 3 Mini</td><td>9.52% (4/42)</td><td>0.00% (0/39)</td><td>2.56% (1/39)</td><td>10.00% (4/40)</td><td>7.50% (3/40)</td></tr><tr><td>Grok 4</td><td>21.43% (9/42)</td><td>17.95% (7/39)</td><td>12.82% (5/39)</td><td>27.50% (11/40)</td><td>22.50% (9/40)</td></tr>
            </tbody>
        </table>
    </section>
    
    <section id="explore-benchmarks">
        <h2>Explore Benchmark Prompts and Model Outputs</h2>
        <div class="explore-options">
            <div class="case-view">
                <h3>View by Case</h3>
                <p>View all benchmark cases with their results across models:</p>
                <a href="cases.html" class="view-all-cases-button">View All Cases</a>
            </div>
            <div class="model-view">
                <h3>View by Model</h3>
                <p>Select a model to view all its benchmark cases:</p>
                <ul class="model-list">
    
                    <li>
                        <a href="models/anthropic_claude-3.5-sonnet.html" class="model-link">
                            Sonnet 3.6
                        </a>
                    </li>
        
                    <li>
                        <a href="models/anthropic_claude-3.7-sonnet.html" class="model-link">
                            Sonnet 3.7
                        </a>
                    </li>
        
                    <li>
                        <a href="models/anthropic_claude-3.7-sonnetthinking.html" class="model-link">
                            Sonnet 3.7 Thinking
                        </a>
                    </li>
        
                    <li>
                        <a href="models/anthropic_claude-sonnet-4.html" class="model-link">
                            Sonnet 4
                        </a>
                    </li>
        
                    <li>
                        <a href="models/anthropic_claude-sonnet-4thinking.html" class="model-link">
                            Sonnet 4 Thinking
                        </a>
                    </li>
        
                    <li>
                        <a href="models/deepseek_deepseek-chat-v3-0324.html" class="model-link">
                            DeepSeek Chat v3-0324
                        </a>
                    </li>
        
                    <li>
                        <a href="models/deepseek_deepseek-r1.html" class="model-link">
                            DeepSeek R1
                        </a>
                    </li>
        
                    <li>
                        <a href="models/deepseek_deepseek-r1-0528.html" class="model-link">
                            DeepSeek R1 0528
                        </a>
                    </li>
        
                    <li>
                        <a href="models/google_gemini-2.5-flash-preview.html" class="model-link">
                            Gemini 2.5 Flash
                        </a>
                    </li>
        
                    <li>
                        <a href="models/google_gemini-2.5-flash-previewthinking.html" class="model-link">
                            Gemini 2.5 Flash Thinking
                        </a>
                    </li>
        
                    <li>
                        <a href="models/google_gemini-2.5-pro-preview.html" class="model-link">
                            Gemini 2.5 Pro 05-06
                        </a>
                    </li>
        
                    <li>
                        <a href="models/google_gemini-2.5-pro-preview-03-25.html" class="model-link">
                            Gemini 2.5 Pro 03-25
                        </a>
                    </li>
        
                    <li>
                        <a href="models/google_gemini-2.5-pro-preview-06-05.html" class="model-link">
                            Gemini 2.5 Pro 06-05
                        </a>
                    </li>
        
                    <li>
                        <a href="models/moonshotai_kimi-k2.html" class="model-link">
                            Kimi K2
                        </a>
                    </li>
        
                    <li>
                        <a href="models/openai_gpt-4.1.html" class="model-link">
                            GPT-4.1
                        </a>
                    </li>
        
                    <li>
                        <a href="models/openai_gpt-5.html" class="model-link">
                            GPT-5
                        </a>
                    </li>
        
                    <li>
                        <a href="models/openai_gpt-oss-120b.html" class="model-link">
                            GPT OSS 120B
                        </a>
                    </li>
        
                    <li>
                        <a href="models/openai_o3.html" class="model-link">
                            o3
                        </a>
                    </li>
        
                    <li>
                        <a href="models/openai_o4-mini.html" class="model-link">
                            o4-mini-medium
                        </a>
                    </li>
        
                    <li>
                        <a href="models/openai_o4-mini-high.html" class="model-link">
                            o4-mini-high
                        </a>
                    </li>
        
                    <li>
                        <a href="models/openrouter_horizon-alpha.html" class="model-link">
                            Horizon Alpha
                        </a>
                    </li>
        
                    <li>
                        <a href="models/x-ai_grok-3-beta.html" class="model-link">
                            Grok 3
                        </a>
                    </li>
        
                    <li>
                        <a href="models/x-ai_grok-3-mini-beta.html" class="model-link">
                            Grok 3 Mini
                        </a>
                    </li>
        
                    <li>
                        <a href="models/x-ai_grok-4-07-09.html" class="model-link">
                            Grok 4
                        </a>
                    </li>
        
                </ul>
            </div>
        </div>
    </section>
    
    </main>
    <footer>
        <div class="footer-content">
            <p>LoCoDiff-bench - <a href="https://github.com/AbanteAI/LoCoDiff-bench" class="github-link"><img src="assets/images/github-logo.png" alt="GitHub" class="github-icon"></a></p>
            <p class="built-with">
                built with <a href="https://mentat.ai" target="_blank" class="mentat-link">mentat.ai</a> <a href="https://mentat.ai" target="_blank" class="mentat-link"><img src="assets/images/mentat-logo-transparent.png" alt="Mentat" class="mentat-icon"></a>
            </p>
        </div>
    </footer>
    
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Load chart data
fetch('chart_data.json')
    .then(response => response.json())
    .then(wrapper => {
        // Use the data property which contains the actual chart data
        // The _warning property contains the auto-generation warning
        initializeChart(wrapper.data);
    });

// JavaScript implementation of Wilson score interval for confidence intervals
function wilson_score_interval(successful, attempts, z = 1.96) {
    if (attempts === 0) return [0.0, 0.0];
    
    // Observed proportion
    const p_hat = successful / attempts;
    
    // Wilson score calculation
    const denominator = 1 + (z * z / attempts);
    const center = (p_hat + (z * z / (2 * attempts))) / denominator;
    const interval = z * Math.sqrt((p_hat * (1 - p_hat) + (z * z / (4 * attempts))) / attempts) / denominator;
    
    const lower_bound = Math.max(0.0, center - interval);
    const upper_bound = Math.min(1.0, center + interval);
    
    return [lower_bound, upper_bound];
}

function initializeChart(chartData) {
    // Define chart colors
    const colors = [
        '#4e79a7', '#f28e2c', '#e15759', '#76b7b2', '#59a14f',
        '#edc949', '#af7aa1', '#ff9da7', '#9c755f', '#bab0ab'
    ];
    
    // Create global variables for chart state that need to be accessed by callbacks
    let currentSelectedLanguages = [];
    let currentSelectedModels = [];
    let currentBucketCount = chartData.default_bucket_count || 4;
    let buckets = []; // Will be calculated dynamically
    
    // Define models to check by default
    const defaultSelectedModels = [
        "anthropic/claude-sonnet-4",
        "google/gemini-2.5-pro-preview-06-05",
        "openai/gpt-4.1",
        "openai/o3",
        "x-ai/grok-3-beta",
        "x-ai/grok-4-07-09"
    ];
    
    // Get canvas context
    const ctx = document.getElementById('token-success-chart').getContext('2d');
    
    // Create model checkboxes
    const modelCheckboxes = document.getElementById('model-checkboxes');
    chartData.models.forEach((model) => {
        // Use display name if available, otherwise use original model name
        const displayName = chartData.model_display_names && chartData.model_display_names[model] 
            ? chartData.model_display_names[model] 
            : model;
        
        // Check if this model should be checked by default
        const isChecked = defaultSelectedModels.includes(model);
        
        const checkbox = document.createElement('div');
        checkbox.className = 'checkbox-item';
        checkbox.innerHTML = `
            <label>
                <input type="checkbox" data-model="${model}" ${isChecked ? 'checked' : ''}>
                ${displayName}
            </label>
        `;
        modelCheckboxes.appendChild(checkbox);
    });
    
    // Create language checkboxes
    const languageCheckboxes = document.getElementById('language-checkboxes');
    chartData.languages.forEach(language => {
        const checkbox = document.createElement('div');
        checkbox.className = 'checkbox-item';
        checkbox.innerHTML = `
            <label>
                <input type="checkbox" data-language="${language}" checked>
                ${language}
            </label>
        `;
        languageCheckboxes.appendChild(checkbox);
    });
    
    // Setup bucket count slider
    const bucketCountSlider = document.getElementById('bucket-count');
    const bucketCountDisplay = document.getElementById('bucket-count-display');
    
    // Make sure the elements exist before trying to access them
    if (bucketCountSlider && bucketCountDisplay) {
        bucketCountSlider.value = currentBucketCount;
        bucketCountDisplay.textContent = currentBucketCount;
        
        bucketCountSlider.addEventListener('input', function() {
            currentBucketCount = parseInt(this.value);
            bucketCountDisplay.textContent = currentBucketCount;
            calculateBuckets();
            updateChart();
        });
    } else {
        console.warn('Bucket count slider elements not found. Check that the HTML includes the proper elements.');
    }
    
    // Create watermark plugin
    const watermarkPlugin = {
        id: 'watermark',
        beforeDraw: (chart) => {
            const ctx = chart.ctx;
            const { chartArea: { top, left, right, bottom }, width, height } = chart;
            
            // Create an image object
            const image = new Image();
            image.src = 'assets/images/mentat-logo-transparent.png';
            
            // Only draw the image once it's loaded
            if (image.complete) {
                const logoWidth = width * 0.15;  // Reduced from 30% to 15% of chart width
                const logoHeight = logoWidth * (image.height / image.width);
                
                // Position the image in the top right of the chart with a margin
                const margin = 20;
                const x = right - logoWidth - margin;
                const y = top + margin + 40;  // Added 40px to move it down
                
                // Set transparency
                ctx.globalAlpha = 0.15;
                
                // Add "mentat.ai" text above the logo
                ctx.globalAlpha = 0.8;  // More visible text
                ctx.font = 'bold 16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('mentat.ai', x + logoWidth/2, y + 12);
                
                // Draw image
                ctx.globalAlpha = 0.15;  // Reset to logo transparency
                ctx.drawImage(image, x, y, logoWidth, logoHeight);
                
                // Reset transparency
                ctx.globalAlpha = 1.0;
            } else {
                // Set up image.onload if the image isn't loaded yet
                image.onload = () => chart.draw();
            }
        }
    };
    
    // Create chart
    const chart = new Chart(ctx, {
        type: 'line',
        plugins: [watermarkPlugin],  // Register the watermark plugin
        data: {
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'linear',
                    min: 0,
                    max: chartData.max_tokens_k,
                    // We'll override ticks in updateChart
                    ticks: {
                        // Empty default ticks configuration - will be set dynamically
                    },
                    title: {
                        display: true,
                        text: 'Prompt Token Length'
                    },
                    grid: {
                        // Make grid lines match our ticks
                        z: -1 // Draw grid lines behind the data
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Success Rate'
                    },
                    min: 0,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            plugins: {
                watermark: {
                    // Empty object enables the plugin
                },
                title: {
                    display: true,
                    text: 'LoCoDiff: Natural Long Context Code Bench',
                    font: {
                        size: 18
                    },
                    padding: {
                        top: 10,
                        bottom: 5
                    }
                },
                subtitle: {
                    display: true,
                    text: 'All Languages',
                    color: '#666',
                    font: {
                        size: 14,
                        style: 'italic'
                    },
                    padding: {
                        bottom: 20
                    }
                },
                legend: {
                    labels: {
                        filter: (legendItem, data) => {
                            const dataset = data.datasets[legendItem.datasetIndex];
                            return dataset && dataset.display !== false;
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        // Add title callback to display bucket information once at the top
                        title: function(tooltipItems) {
                            if (!tooltipItems || tooltipItems.length === 0) return '';
                            
                            try {
                                const xValue = tooltipItems[0].raw.x; // Token count in thousands
                                
                                // Find the bucket with matching token count
                                const bucketData = buckets.find(bucket => 
                                    Math.abs((bucket.avgTokens / 1000) - xValue) < 0.01
                                );
                                
                                if (!bucketData) return 'Bucket Information';
                                
                                // Format bucket information
                                return [
                                    `Token Range: ${bucketData.minTokens/1000}k–${bucketData.maxTokens/1000}k`,
                                    `Average Tokens: ${(bucketData.avgTokens/1000).toFixed(1)}k`,
                                    `Total Cases: ${bucketData.caseCount}`
                                ];
                            } catch (error) {
                                console.error('Error in tooltip title callback:', error);
                                return 'Bucket Information';
                            }
                        },
                        
                        // Modify label callback to show only model-specific information
                        label: function(context) {
                            if (!context || !context.dataset || !context.dataset.label) {
                                return null;
                            }
                            
                            if (context.dataset.label.includes('CI')) {
                                return null;
                            }
                            
                            try {
                                const displayName = context.dataset.label;
                                const originalModel = context.dataset.originalModel || displayName;
                                const xValue = context.raw.x; // Token count in thousands
                                
                                // Find the bucket with matching token count
                                const bucketData = buckets.find(bucket => 
                                    Math.abs((bucket.avgTokens / 1000) - xValue) < 0.01
                                );
                                
                                if (!bucketData) {
                                    return `${displayName}`;
                                }
                                
                                const modelStats = bucketData.modelStats[originalModel];
                                if (!modelStats) {
                                    return `${displayName}: No data available`;
                                }
                                
                                const successRate = context.raw.y;
                                const successful = modelStats.successful;
                                const attempts = modelStats.attempts;
                                const caseCount = bucketData.caseCount;
                                
                                // Format model success rate
                                let modelInfo = `${displayName}: ${successRate.toFixed(2)}% (${successful}/${caseCount})`;
                                
                                // Add model-specific notes if any
                                const untestedCases = caseCount - attempts;
                                if (untestedCases > 0) {
                                    modelInfo += ` (${untestedCases} untested)`;
                                }
                                
                                // Add confidence interval if enabled
                                const ciElement = document.getElementById('show-confidence-intervals');
                                if (ciElement && ciElement.checked && attempts > 0) {
                                    const [lower, upper] = wilson_score_interval(successful, caseCount);
                                    modelInfo += `
  95% CI: ${(lower * 100).toFixed(2)}% - ${(upper * 100).toFixed(2)}%`;
                                }
                                
                                return modelInfo;
                            } catch (error) {
                                console.error('Error in tooltip label callback:', error);
                                return 'Error displaying model data';
                            }
                        }
                    }
                }
            }
        }
    });
    
    // Function to filter cases based on selected languages
    function getFilteredCases() {
        if (currentSelectedLanguages.length === 0) {
            return [];
        }
        
        return chartData.cases.filter(caseData => 
            currentSelectedLanguages.includes(caseData.language)
        );
    }
    
    // Function to calculate buckets based on filtered cases
    function calculateBuckets() {
        const filteredCases = getFilteredCases();
        if (filteredCases.length === 0) {
            buckets = [];
            return;
        }
        
        // Sort cases by token count (should already be sorted, but just to be safe)
        filteredCases.sort((a, b) => a.token_count - b.token_count);
        
        // Calculate cases per bucket
        const casesPerBucket = Math.floor(filteredCases.length / currentBucketCount);
        const extraCases = filteredCases.length % currentBucketCount;
        
        // Create new buckets array
        buckets = [];
        
        let caseIndex = 0;
        for (let i = 0; i < currentBucketCount; i++) {
            // Calculate how many cases go in this bucket
            // Last bucket gets the extra cases if count isn't evenly divisible
            const bucketSize = (i === currentBucketCount - 1) 
                ? casesPerBucket + extraCases 
                : casesPerBucket;
            
            if (bucketSize === 0) continue;
            
            // Get cases for this bucket
            const bucketCases = filteredCases.slice(caseIndex, caseIndex + bucketSize);
            caseIndex += bucketSize;
            
            // Calculate token stats
            const minTokens = bucketCases[0].token_count;
            const maxTokens = bucketCases[bucketCases.length - 1].token_count;
            const avgTokens = bucketCases.reduce((sum, c) => sum + c.token_count, 0) / bucketCases.length;
            
            // Initialize bucket data
            const bucket = {
                minTokens,
                maxTokens,
                avgTokens,
                caseCount: bucketCases.length,
                cases: bucketCases,
                modelStats: {}
            };
            
            // Calculate model statistics for this bucket
            chartData.models.forEach(model => {
                const modelStats = {
                    successful: 0,
                    attempts: 0
                };
                
                bucketCases.forEach(caseData => {
                    const result = caseData.results[model];
                    if (result.attempted) {
                        modelStats.attempts++;
                        if (result.success) {
                            modelStats.successful++;
                        }
                    }
                });
                
                bucket.modelStats[model] = modelStats;
            });
            
            buckets.push(bucket);
        }
    }
    
    // Function to update the chart subtitle based on selected languages
    function updateChartSubtitle() {
        // Get language description
        let languageText = '';
        
        if (currentSelectedLanguages.length === 0) {
            languageText = 'no languages selected';
        } else if (currentSelectedLanguages.length === chartData.languages.length) {
            languageText = 'all languages';
        } else if (currentSelectedLanguages.length <= 3) {
            // Show all selected languages if there are 3 or fewer
            languageText = currentSelectedLanguages.join(', ');
        } else {
            // Show count if more than 3 languages selected
            languageText = `${currentSelectedLanguages.length} languages selected`;
        }
        
        // Count filtered cases
        const filteredCases = getFilteredCases();
        const caseCount = filteredCases.length;
        
        // Create the full subtitle with case count, bucket count, and language info
        let subtitleText = '';
        if (caseCount === 0) {
            subtitleText = `No cases to display (${languageText})`;
        } else {
            subtitleText = `${caseCount} cases, divided into ${currentBucketCount} buckets (${languageText})`;
        }
        
        // Update the chart subtitle
        chart.options.plugins.subtitle.text = subtitleText;
    }
    
    // Function to update chart based on selected models, languages, and bucket count
    function updateChart() {
        // Get selected models and languages
        currentSelectedModels = Array.from(document.querySelectorAll('input[data-model]:checked'))
            .map(checkbox => checkbox.getAttribute('data-model'));
        
        currentSelectedLanguages = Array.from(document.querySelectorAll('input[data-language]:checked'))
            .map(checkbox => checkbox.getAttribute('data-language'));
        
        // Update the chart subtitle based on selected languages
        updateChartSubtitle();
        
        // Recalculate buckets based on selected languages and bucket count
        calculateBuckets();
        
        // Clear current datasets
        chart.data.datasets = [];
        
        // If no buckets (e.g., no languages selected), don't update further
        if (buckets.length === 0) {
            chart.update();
            return;
        }
        
        // Update x-axis scale and ticks based on actual data
        const minToken = buckets[0].minTokens / 1000;
        const maxToken = buckets[buckets.length - 1].maxTokens / 1000;
        
        // Create custom ticks for each bucket
        const customTicks = buckets.map(bucket => {
            // Position tick at the bucket's average token count
            const tickValue = bucket.avgTokens / 1000;
            
            // Label shows the token range for this bucket (rounded to whole numbers)
            const minK = Math.round(bucket.minTokens / 1000);
            const maxK = Math.round(bucket.maxTokens / 1000);
            const tickLabel = `${minK}-${maxK}k`;
            
            return {
                value: tickValue,
                label: tickLabel
            };
        });
        
        // Calculate min/max from bucket averages (not the absolute min/max prompt values)
        const firstBucketAvg = buckets[0].avgTokens / 1000;
        const lastBucketAvg = buckets[buckets.length - 1].avgTokens / 1000;
        
        // Set precise min/max values with small padding for visual appeal
        chart.options.scales.x.min = Math.max(0, firstBucketAvg - 1.5);
        chart.options.scales.x.max = lastBucketAvg + 1.5;
        
        // Use our custom ticks
        chart.options.scales.x.ticks = {
            callback: function(val, index) {
                // Find the tick with this value
                const tick = customTicks.find(t => Math.abs(t.value - val) < 0.01);
                return tick ? tick.label : '';
            }
        };
        
        // Set up explicit ticks array to ensure our ticks are used
        chart.options.scales.x.afterBuildTicks = function(scale) {
            scale.ticks = customTicks;
            return;
        };
        
        // Create datasets for each selected model
        currentSelectedModels.forEach((model, index) => {
            const color = colors[index % colors.length];
            
            // Calculate data points for this model
            const dataPoints = buckets.map(bucket => {
                const modelStats = bucket.modelStats[model];
                const successful = modelStats.successful;
                const caseCount = bucket.caseCount;
                
                // Calculate success rate
                const successRate = (caseCount > 0) ? (successful / caseCount) * 100 : 0;
                
                return {
                    x: bucket.avgTokens / 1000, // Convert to k
                    y: successRate
                };
            });
            
            // Calculate confidence interval data points
            let lowerBoundPoints = null;
            let upperBoundPoints = null;
            
            if (document.getElementById('show-confidence-intervals').checked) {
                lowerBoundPoints = buckets.map(bucket => {
                    const modelStats = bucket.modelStats[model];
                    const successful = modelStats.successful;
                    const caseCount = bucket.caseCount;
                    
                    const [lower, upper] = wilson_score_interval(successful, caseCount);
                    
                    return {
                        x: bucket.avgTokens / 1000,
                        y: lower * 100
                    };
                });
                
                upperBoundPoints = buckets.map(bucket => {
                    const modelStats = bucket.modelStats[model];
                    const successful = modelStats.successful;
                    const caseCount = bucket.caseCount;
                    
                    const [lower, upper] = wilson_score_interval(successful, caseCount);
                    
                    return {
                        x: bucket.avgTokens / 1000,
                        y: upper * 100
                    };
                });
            }
            
            // Get display name if available
            const displayName = chartData.model_display_names && chartData.model_display_names[model] 
                ? chartData.model_display_names[model] 
                : model;
                
            // Add main dataset
            chart.data.datasets.push({
                label: displayName,
                originalModel: model,
                data: dataPoints,
                borderColor: color,
                backgroundColor: color + '33',
                fill: false,
                tension: 0.1,
                pointRadius: 4,
                pointHoverRadius: 6,
                parsing: false
            });
            
            // Add confidence interval datasets if enabled
            if (document.getElementById('show-confidence-intervals').checked) {
                // Add lower bound line (needed for reference by the area dataset)
                const lowerBoundIndex = chart.data.datasets.length;
                chart.data.datasets.push({
                    label: `${displayName} (95% CI lower)`,
                    data: lowerBoundPoints,
                    borderColor: 'transparent',
                    backgroundColor: 'transparent',
                    pointRadius: 0,
                    tension: 0.1,
                    fill: false,
                    parsing: false,
                    showLine: false,
                    display: false
                });
                
                // Add confidence interval area
                chart.data.datasets.push({
                    label: `${displayName} (95% CI)`,
                    data: upperBoundPoints,
                    borderColor: 'transparent',
                    backgroundColor: color + '22',
                    pointRadius: 0,
                    tension: 0.1,
                    parsing: false,
                    fill: lowerBoundIndex,
                    display: false
                });
            }
        });
        
        // Update chart
        chart.update();
    }
    
    // Add event listeners
    document.querySelectorAll('input[data-model], input[data-language]').forEach(checkbox => {
        checkbox.addEventListener('change', updateChart);
    });
    
    document.getElementById('show-confidence-intervals').addEventListener('change', updateChart);
    
    // Calculate initial buckets and update chart
    calculateBuckets();
    updateChart();
}

</script>

    <script>
        // Highlight diff lines (added/removed) on load
        document.addEventListener('DOMContentLoaded', function() {
            // Select all code blocks in the example prompt
            const codeBlocks = document.querySelectorAll('.example-prompt pre code.language-diff');
            
            codeBlocks.forEach(function(codeBlock) {
                // Get all lines in the code block
                const content = codeBlock.innerHTML;
                
                // Replace the content with highlighted version
                let highlightedContent = '';
                
                // Split by real newlines in the content
                const lines = content.split('\n');
                
                // Process each line and preserve empty lines
                let highlightedLines = [];
                for (let i = 0; i < lines.length; i++) {
                    let line = lines[i];
                    
                    if (line === '') {
                        // Preserve blank lines by using a non-breaking space
                        highlightedLines.push('<span class="empty-line">&nbsp;</span>');
                    }
                    // Skip highlighting for file path indicators
                    else if (line.startsWith('+++') || line.startsWith('---')) {
                        highlightedLines.push('<span>' + line + '</span>');
                    }
                    // Highlight added lines - check for both '+' at start and '+' after whitespace (for merge conflicts)
                    else if (line.startsWith('+') || line.trim().startsWith('+')) {
                        highlightedLines.push('<span style="background-color: #e6ffec; color: #22863a;">' + line + '</span>');
                    }
                    // Highlight removed lines - check for both '-' at start and '-' after whitespace
                    // But exclude command-line options that start with '--'
                    else if ((line.startsWith('-') && !line.startsWith('--')) || 
                             (line.trim().startsWith('-') && !line.trim().startsWith('--'))) {
                        highlightedLines.push('<span style="background-color: #ffebe9; color: #cb2431;">' + line + '</span>');
                    }
                    // Normal line
                    else {
                        highlightedLines.push('<span>' + line + '</span>');
                    }
                }
                
                // Concatenate the spans directly without adding newlines
                highlightedContent = highlightedLines.join('');
                
                // Replace code block content
                codeBlock.innerHTML = highlightedContent;
            });
            
            // Initialize highlight.js 
            hljs.highlightAll();
        });
    </script>
    
</body>
</html>
