{% extends "base.html" %}

{% block title %}Details for {{ details.benchmark_case_prefix }} - {{ details.model_name }} - LoCoDiff Explorer{% endblock %}

{% block content %}
    <h1>Benchmark Case Details</h1>
    <p>
        <a href="{{ url_for('index') }}">Back to Overview</a> |
        <a href="{{ url_for('model_results', model_name=details.model_name) }}">Back to Model: {{ details.model_name }}</a>
    </p>

    <h2>Run Information</h2>
    <ul>
        <li><strong>Benchmark Case Prefix:</strong> {{ details.benchmark_case_prefix }}</li>
        <li><strong>Model:</strong> {{ details.model_name }}</li>
        <li><strong>Timestamp:</strong> {{ details.timestamp }}</li>
        <li><strong>Run Directory:</strong> {{ details.run_dir }}</li>
    </ul>

    {% if details.error %}
        <div class="failure metadata-box">
            <strong>Error loading details:</strong> {{ details.error }}
        </div>
    {% endif %}

    {% if details.metadata %}
        <div class="metadata-box">
            <h3>Run Metadata</h3>
            <ul>
                <li><strong>Success:</strong> <span class="{{ 'success' if details.metadata.success else 'failure' }}">{{ details.metadata.success }}</span></li>
                {% if details.metadata.error %}
                    <li><strong>Error Message:</strong> <span class="failure">{{ details.metadata.error }}</span></li>
                {% endif %}
                 <li><strong>Cost (USD):</strong> {{ details.metadata.cost_usd if details.metadata.cost_usd is not none else 'N/A' }}</li>
                 <li><strong>Generation ID:</strong> {{ details.metadata.generation_id or 'N/A' }}</li>
                 <li><strong>Prompt Tokens:</strong> {{ details.metadata.prompt_tokens or 'N/A' }}</li>
                 <li><strong>Completion Tokens:</strong> {{ details.metadata.completion_tokens or 'N/A' }}</li>
                 <li><strong>Total Tokens:</strong> {{ details.metadata.total_tokens or 'N/A' }}</li>
                 <li><strong>Native Prompt Tokens:</strong> {{ details.metadata.native_prompt_tokens or 'N/A' }}</li>
                 <li><strong>Native Completion Tokens:</strong> {{ details.metadata.native_completion_tokens or 'N/A' }}</li>
                 <li><strong>Stats Error:</strong> {{ details.metadata.stats_error or 'None' }}</li>
                 <li><strong>Raw Response Length:</strong> {{ details.metadata.raw_response_length }}</li>
                 <li><strong>Extracted Output Length:</strong> {{ details.metadata.extracted_output_length if details.metadata.extracted_output_length is not none else 'N/A (Extraction Failed?)' }}</li>
                 <li><strong>Expected Output Length:</strong> {{ details.metadata.expected_output_length }}</li>
                 <li><strong>Timestamp (UTC):</strong> {{ details.metadata.timestamp_utc }}</li>
            </ul>
        </div>
    {% else %}
         <p class="failure">Run metadata (metadata.json) could not be loaded.</p>
    {% endif %}

    <div class="file-content">
        <h3>Prompt Content</h3>
        {% if details.prompt_content %}
            <pre>{{ details.prompt_content }}</pre>
        {% else %}
            <p class="failure">Prompt file could not be loaded.</p>
        {% endif %}
    </div>

    <div class="file-content">
        <h3>Expected Output</h3>
         {% if details.expected_content %}
            <pre>{{ details.expected_content }}</pre>
        {% else %}
            <p class="failure">Expected output file could not be loaded.</p>
        {% endif %}
    </div>

    <div class="file-content">
        <h3>Raw Model Response</h3>
         {% if details.raw_response %}
            <pre>{{ details.raw_response }}</pre>
        {% elif details.metadata %}
             <p>Raw response file (raw_response.txt) not found in run directory.</p>
        {% else %}
             <p class="failure">Raw response could not be loaded (dependent on run directory).</p>
        {% endif %}
    </div>

    <div class="file-content">
        <h3>Extracted Output</h3>
         {% if details.extracted_output %}
            <pre>{{ details.extracted_output }}</pre>
        {% elif details.metadata and details.metadata.error == "Extraction backticks not found" %}
             <p class="failure">Extraction failed: Backticks not found in raw response.</p>
        {% elif details.metadata %}
             <p>Extracted output file (extracted_output.txt) not found in run directory.</p>
        {% else %}
             <p class="failure">Extracted output could not be loaded (dependent on run directory).</p>
        {% endif %}
    </div>

    <div class="file-content">
        <h3>Diff (Expected vs Extracted)</h3>
         {% if details.diff_content %}
            <pre>{{ details.diff_content }}</pre>
        {% elif details.metadata and details.metadata.success %}
             <p class="success">No differences found (Success reported in metadata).</p>
             <p><small>Note: output.diff file might contain "No differences found." message.</small></p>
        {% elif details.metadata %}
             <p>Diff file (output.diff) not found in run directory.</p>
        {% else %}
             <p class="failure">Diff content could not be loaded (dependent on run directory).</p>
        {% endif %}
    </div>

{% endblock %}
