{% extends "base.html" %}

{% block title %}Results for {{ model_name }} - LoCoDiff Explorer{% endblock %}

{% block content %}
    <h1>Results for Model: {{ model_name }}</h1>
    <p><a href="{{ url_for('index') }}">Back to Overview</a></p>

    {% if not runs_by_bucket %}
        <p>No runs found for this model.</p>
    {% else %}
        {% for bucket_key, runs in runs_by_bucket.items() %}
            <h2>
                {% if bucket_key == "all_runs" %}
                    All Runs (Benchmark metadata not found)
                {% elif bucket_key == "unknown" %}
                    Runs for Unknown/Missing Benchmark Cases
                {% else %}
                    Bucket: {{ bucket_key }} tokens
                {% endif %}
            </h2>
            {% if not runs %}
                <p>No runs found in this bucket for this model.</p>
            {% else %}
                <table>
                    <thead>
                        <tr>
                            <th>Benchmark Case Prefix</th>
                            <th>Timestamp</th>
                            <th>Success</th>
                            <th>Cost (USD)</th>
                            <th>Prompt Tokens</th>
                            <th>Completion Tokens</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for run in runs %}
                            <tr>
                                <td>{{ run.benchmark_case_prefix }}</td>
                                <td>{{ run.timestamp }}</td>
                                <td class="{{ 'success' if run.success else 'failure' }}">
                                    {{ 'Yes' if run.success else 'No' }}
                                    {% if run.metadata and run.metadata.error and not run.success %}
                                        <br><small>({{ run.metadata.error }})</small>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if run.metadata and run.metadata.cost_usd is not none %}
                                        ${{ "%.6f"|format(run.metadata.cost_usd) }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </td>
                                <td>{{ run.metadata.prompt_tokens if run.metadata else 'N/A' }}</td>
                                <td>{{ run.metadata.completion_tokens if run.metadata else 'N/A' }}</td>
                                <td>
                                    <a href="{{ url_for('case_details', benchmark_case_prefix=run.benchmark_case_prefix, model_name=original_model_name, timestamp=run.timestamp) }}">View</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endblock %}
